<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Data Science Workshops</title>
  <meta name="description" content="Data Science Workshops" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Data Science Workshops" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data Science Workshops" />
  <meta name="github-repo" content="IQSS/dss-workshops" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Data Science Workshops" />
  
  <meta name="twitter:description" content="Data Science Workshops" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science Workshop Materials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path=""><a href="#table-of-contents"><i class="fa fa-check"></i>Table of Contents</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="part"><span><b>I General</b></span></li>
<li class="chapter" data-level="" data-path=""><a href="#data-science-tools"><i class="fa fa-check"></i>Data Science Tools</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#tools-for-working-with-data"><i class="fa fa-check"></i>Tools for working with data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#the-puzzle-pieces"><i class="fa fa-check"></i>The puzzle pieces</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#data-analysis-building-blocks"><i class="fa fa-check"></i>Data analysis building blocks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#examples"><i class="fa fa-check"></i>Examples</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#old-school-example"><i class="fa fa-check"></i>Old-school example</a></li>
<li class="chapter" data-level="" data-path=""><a href="#something-old-something-new"><i class="fa fa-check"></i>Something old &amp; something new</a></li>
<li class="chapter" data-level="" data-path=""><a href="#a-modern-version"><i class="fa fa-check"></i>A modern version</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#data-storage-retrieval"><i class="fa fa-check"></i>Data storage &amp; retrieval</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#text-files"><i class="fa fa-check"></i>Text files</a></li>
<li class="chapter" data-level="" data-path=""><a href="#binary-files"><i class="fa fa-check"></i>Binary files</a></li>
<li class="chapter" data-level="" data-path=""><a href="#databases"><i class="fa fa-check"></i>Databases</a></li>
<li class="chapter" data-level="" data-path=""><a href="#distributed-file-storage"><i class="fa fa-check"></i>Distributed file storage</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#programming-languages-statistics-packages"><i class="fa fa-check"></i>Programming languages &amp; statistics packages</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#programming-language-features"><i class="fa fa-check"></i>Programming language features</a></li>
<li class="chapter" data-level="" data-path=""><a href="#program-comparison"><i class="fa fa-check"></i>Program comparison</a></li>
<li class="chapter" data-level="" data-path=""><a href="#examples-read-data-from-a-file-summarize"><i class="fa fa-check"></i>Examples: Read data from a file &amp; summarize</a></li>
<li class="chapter" data-level="" data-path=""><a href="#examples-fit-a-linear-regression"><i class="fa fa-check"></i>Examples: Fit a linear regression</a></li>
<li class="chapter" data-level="" data-path=""><a href="#examples-extract-links-for-.html-file"><i class="fa fa-check"></i>Examples: Extract links for .html file</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#creating-reports"><i class="fa fa-check"></i>Creating reports</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#markup-languages"><i class="fa fa-check"></i>Markup languages</a></li>
<li class="chapter" data-level="" data-path=""><a href="#word-processors"><i class="fa fa-check"></i>Word processors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#text-editors-integrated-development-environments"><i class="fa fa-check"></i>Text editors &amp; Integrated Development Environments</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#language-specific-editors-ides"><i class="fa fa-check"></i>Language specific editors &amp; IDEs</a></li>
<li class="chapter" data-level="" data-path=""><a href="#general-purpose-editors-ides"><i class="fa fa-check"></i>General purpose editors &amp; IDEs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#literate-programming-notebooks"><i class="fa fa-check"></i>Literate programming &amp; notebooks</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#literate-programming"><i class="fa fa-check"></i>Literate programming</a></li>
<li class="chapter" data-level="" data-path=""><a href="#notebooks"><i class="fa fa-check"></i>Notebooks</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#big-data-annoying-data-computationally-intensive-methods"><i class="fa fa-check"></i>Big data, annoying data, &amp; computationally intensive methods</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#computing-clusters-at-harvard"><i class="fa fa-check"></i>Computing clusters at Harvard</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up"><i class="fa fa-check"></i>Wrap up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II R</b></span></li>
<li class="chapter" data-level="" data-path=""><a href="#r-installation"><i class="fa fa-check"></i>R Installation</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#troubleshooting-session"><i class="fa fa-check"></i>Troubleshooting session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#materials"><i class="fa fa-check"></i>Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#software"><i class="fa fa-check"></i>Software</a></li>
<li><a href="#installing-the-tidyverse">Installing the <code>tidyverse</code></a>
<ul>
<li><a href="#troubleshooting-tidyverse-installation">Troubleshooting <code>tidyverse</code> installation</a></li>
</ul></li>
<li><a href="#installing-rmarkdown-optional">Installing <code>rmarkdown</code> (optional)</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-1"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#r-introduction"><i class="fa fa-check"></i>R Introduction</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#r-basics"><i class="fa fa-check"></i>R basics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-r"><i class="fa fa-check"></i>What is R?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#why-use-r"><i class="fa fa-check"></i>Why use R?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#how-does-r-work"><i class="fa fa-check"></i>How does R work?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#interfaces"><i class="fa fa-check"></i>Interfaces</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-a-session"><i class="fa fa-check"></i>Launch a session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0"><i class="fa fa-check"></i>Exercise 0</a></li>
<li class="chapter" data-level="" data-path=""><a href="#syntax-rules"><i class="fa fa-check"></i>Syntax rules</a></li>
<li class="chapter" data-level="" data-path=""><a href="#function-calls"><i class="fa fa-check"></i>Function calls</a></li>
<li class="chapter" data-level="" data-path=""><a href="#assignment"><i class="fa fa-check"></i>Assignment</a></li>
<li class="chapter" data-level="" data-path=""><a href="#asking-for-help"><i class="fa fa-check"></i>Asking for help</a></li>
<li class="chapter" data-level="" data-path=""><a href="#reading-data"><i class="fa fa-check"></i>Reading data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#installing-using-packages"><i class="fa fa-check"></i>Installing &amp; using packages</a></li>
<li><a href="#the-tidyverse">The <code>tidyverse</code></a></li>
<li class="chapter" data-level="" data-path=""><a href="#readers-for-common-file-types"><i class="fa fa-check"></i>Readers for common file types</a></li>
<li class="chapter" data-level="" data-path=""><a href="#baby-names-data"><i class="fa fa-check"></i>Baby names data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#manipulating-data"><i class="fa fa-check"></i>Manipulating data</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#filter-select-arrange"><i class="fa fa-check"></i>Filter, select, &amp; arrange</a></li>
<li class="chapter" data-level="" data-path=""><a href="#logical-relational-operators"><i class="fa fa-check"></i>Logical &amp; relational operators</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2.1"><i class="fa fa-check"></i>Exercise 2.1</a></li>
<li class="chapter" data-level="" data-path=""><a href="#pipe-operator"><i class="fa fa-check"></i>Pipe operator</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2.2"><i class="fa fa-check"></i>Exercise 2.2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#plotting-data"><i class="fa fa-check"></i>Plotting data</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#creating-variables"><i class="fa fa-check"></i>Creating variables</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#create-or-modify-columns"><i class="fa fa-check"></i>Create or modify columns</a></li>
<li class="chapter" data-level="" data-path=""><a href="#operating-by-group"><i class="fa fa-check"></i>Operating by group</a></li>
<li class="chapter" data-level="" data-path=""><a href="#recoding-variables"><i class="fa fa-check"></i>Recoding variables</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#aggregating-variables"><i class="fa fa-check"></i>Aggregating variables</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#saving-work"><i class="fa fa-check"></i>Saving work</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#saving-individual-datasets"><i class="fa fa-check"></i>Saving individual datasets</a></li>
<li class="chapter" data-level="" data-path=""><a href="#saving-multiple-datasets"><i class="fa fa-check"></i>Saving multiple datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-1"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-1"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-2"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#r-regression-models"><i class="fa fa-check"></i>R Regression Models</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-1"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials-1"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-1"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-1"><i class="fa fa-check"></i>Goals</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-an-r-session"><i class="fa fa-check"></i>Launch an R session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#modeling-workflow"><i class="fa fa-check"></i>Modeling workflow</a></li>
<li class="chapter" data-level="" data-path=""><a href="#r-modeling-ecosystem"><i class="fa fa-check"></i>R modeling ecosystem</a></li>
<li class="chapter" data-level="" data-path=""><a href="#before-fitting-a-model"><i class="fa fa-check"></i>Before fitting a model</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#load-the-data"><i class="fa fa-check"></i>Load the data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#examine-the-data"><i class="fa fa-check"></i>Examine the data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#plot-the-data"><i class="fa fa-check"></i>Plot the data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#models-with-continuous-outcomes"><i class="fa fa-check"></i>Models with continuous outcomes</a>
<ul>
<li><a href="#why-is-the-association-between-expense-sat-scores-negative">Why is the association between expense &amp; SAT scores <em>negative</em>?</a></li>
<li><a href="#the-lm-class-methods">The <code>lm</code> class &amp; methods</a></li>
<li class="chapter" data-level="" data-path=""><a href="#ols-regression-assumptions"><i class="fa fa-check"></i>OLS regression assumptions</a></li>
<li class="chapter" data-level="" data-path=""><a href="#comparing-models"><i class="fa fa-check"></i>Comparing models</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-1"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#interactions-factors"><i class="fa fa-check"></i>Interactions &amp; factors</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#modeling-interactions"><i class="fa fa-check"></i>Modeling interactions</a></li>
<li class="chapter" data-level="" data-path=""><a href="#regression-with-categorical-predictors"><i class="fa fa-check"></i>Regression with categorical predictors</a></li>
<li class="chapter" data-level="" data-path=""><a href="#setting-factor-reference-groups-contrasts"><i class="fa fa-check"></i>Setting factor reference groups &amp; contrasts</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#models-with-binary-outcomes"><i class="fa fa-check"></i>Models with binary outcomes</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#logistic-regression"><i class="fa fa-check"></i>Logistic regression</a></li>
<li class="chapter" data-level="" data-path=""><a href="#logistic-regression-example"><i class="fa fa-check"></i>Logistic regression example</a></li>
<li class="chapter" data-level="" data-path=""><a href="#odds-ratios"><i class="fa fa-check"></i>Odds ratios</a></li>
<li class="chapter" data-level="" data-path=""><a href="#predicted-marginal-means"><i class="fa fa-check"></i>Predicted marginal means</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#multilevel-modeling"><i class="fa fa-check"></i>Multilevel modeling</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#multilevel-modeling-overview"><i class="fa fa-check"></i>Multilevel modeling overview</a></li>
<li class="chapter" data-level="" data-path=""><a href="#the-exam-data"><i class="fa fa-check"></i>The Exam data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#the-null-model-icc"><i class="fa fa-check"></i>The null model &amp; ICC</a></li>
<li class="chapter" data-level="" data-path=""><a href="#adding-fixed-effects-predictors"><i class="fa fa-check"></i>Adding fixed-effects predictors</a></li>
<li class="chapter" data-level="" data-path=""><a href="#multiple-degree-of-freedom-comparisons"><i class="fa fa-check"></i>Multiple degree of freedom comparisons</a></li>
<li class="chapter" data-level="" data-path=""><a href="#random-slopes"><i class="fa fa-check"></i>Random slopes</a></li>
<li class="chapter" data-level="" data-path=""><a href="#test-the-significance-of-the-random-slope"><i class="fa fa-check"></i>Test the significance of the random slope</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-2"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-2"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-3"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#r-graphics"><i class="fa fa-check"></i>R Graphics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-2"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials-2"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-2"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-an-r-session-1"><i class="fa fa-check"></i>Launch an R session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#packages-1"><i class="fa fa-check"></i>Packages</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-2"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li><a href="#why-ggplot2">Why <code>ggplot2</code>?</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-the-grammar-of-graphics"><i class="fa fa-check"></i>What is the Grammar Of Graphics?</a></li>
<li><a href="#ggplot2-vs-base-graphics"><code>ggplot2</code> VS base graphics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#geometric-objects-aesthetics"><i class="fa fa-check"></i>Geometric objects &amp; aesthetics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#aesthetic-mapping"><i class="fa fa-check"></i>Aesthetic mapping</a></li>
<li><a href="#geometric-objects-geom">Geometric objects (<code>geom</code>)</a></li>
<li class="chapter" data-level="" data-path=""><a href="#aesthetic-mapping-vs-assignment"><i class="fa fa-check"></i>Aesthetic mapping VS assignment</a></li>
<li class="chapter" data-level="" data-path=""><a href="#mapping-variables-to-other-aesthetics"><i class="fa fa-check"></i>Mapping variables to other aesthetics</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-2"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#statistical-transformations"><i class="fa fa-check"></i>Statistical transformations</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#why-transform-data"><i class="fa fa-check"></i>Why transform data?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#setting-arguments"><i class="fa fa-check"></i>Setting arguments</a></li>
<li class="chapter" data-level="" data-path=""><a href="#changing-the-transformation"><i class="fa fa-check"></i>Changing the transformation</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#scales"><i class="fa fa-check"></i>Scales</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#controlling-aesthetic-mapping"><i class="fa fa-check"></i>Controlling aesthetic mapping</a></li>
<li class="chapter" data-level="" data-path=""><a href="#common-scale-arguments"><i class="fa fa-check"></i>Common scale arguments</a></li>
<li class="chapter" data-level="" data-path=""><a href="#scale-modification-examples"><i class="fa fa-check"></i>Scale modification examples</a></li>
<li class="chapter" data-level="" data-path=""><a href="#using-different-color-scales"><i class="fa fa-check"></i>Using different color scales</a></li>
<li class="chapter" data-level="" data-path=""><a href="#available-scales"><i class="fa fa-check"></i>Available scales</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#faceting"><i class="fa fa-check"></i>Faceting</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-faceting"><i class="fa fa-check"></i>What is faceting?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#what-is-the-trend-in-housing-prices-in-each-state"><i class="fa fa-check"></i>What is the trend in housing prices in each state?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#faceting-to-the-rescue"><i class="fa fa-check"></i>Faceting to the rescue</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#themes"><i class="fa fa-check"></i>Themes</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-are-themes"><i class="fa fa-check"></i>What are themes?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#overriding-theme-defaults"><i class="fa fa-check"></i>Overriding theme defaults</a></li>
<li class="chapter" data-level="" data-path=""><a href="#creating-saving-new-themes"><i class="fa fa-check"></i>Creating &amp; saving new themes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#saving-plots"><i class="fa fa-check"></i>Saving plots</a></li>
<li class="chapter" data-level="" data-path=""><a href="#the-1-faq"><i class="fa fa-check"></i>The #1 FAQ</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#map-aesthetic-to-different-columns"><i class="fa fa-check"></i>Map aesthetic to different columns</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-3"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-3"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-4"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#r-data-wrangling"><i class="fa fa-check"></i>R Data Wrangling</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-3"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials-3"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-3"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-an-r-session-2"><i class="fa fa-check"></i>Launch an R session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#packages-2"><i class="fa fa-check"></i>Packages</a></li>
<li class="chapter" data-level="" data-path=""><a href="#workshop-outline"><i class="fa fa-check"></i>Workshop Outline</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#working-with-excel-worksheets"><i class="fa fa-check"></i>Working with Excel worksheets</a>
<ul>
<li><a href="#iterating-with-map">Iterating with <code>map()</code></a></li>
<li class="chapter" data-level="" data-path=""><a href="#filtering-strings-using-regex"><i class="fa fa-check"></i>Filtering strings using regex</a></li>
<li class="chapter" data-level="" data-path=""><a href="#writing-your-own-functions"><i class="fa fa-check"></i>Writing your own functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#reading-excel-data-files"><i class="fa fa-check"></i>Reading Excel data files</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#data-cleanup"><i class="fa fa-check"></i>Data cleanup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#selecting-columns"><i class="fa fa-check"></i>Selecting columns</a></li>
<li class="chapter" data-level="" data-path=""><a href="#data-types-and-structures"><i class="fa fa-check"></i>Data types and structures</a></li>
<li class="chapter" data-level="" data-path=""><a href="#list-indexing"><i class="fa fa-check"></i>List indexing</a></li>
<li class="chapter" data-level="" data-path=""><a href="#dropping-missing-values"><i class="fa fa-check"></i>Dropping missing values</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path=""><a href="#reshaping-from-wide-to-long"><i class="fa fa-check"></i>Reshaping from wide to long</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#data-organization-storage"><i class="fa fa-check"></i>Data organization &amp; storage</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#a-list-of-data-frames"><i class="fa fa-check"></i>A list of data frames</a></li>
<li class="chapter" data-level="" data-path=""><a href="#one-big-data-frame"><i class="fa fa-check"></i>One big data frame</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#complete-code"><i class="fa fa-check"></i>Complete code</a></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-4"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-4"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-5"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Python</b></span></li>
<li class="chapter" data-level="" data-path=""><a href="#python-installation"><i class="fa fa-check"></i>Python Installation</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#troubleshooting-session-1"><i class="fa fa-check"></i>Troubleshooting session</a></li>
<li class="chapter" data-level="" data-path=""><a href="#materials-1"><i class="fa fa-check"></i>Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#software-1"><i class="fa fa-check"></i>Software</a></li>
<li class="chapter" data-level="" data-path=""><a href="#jupyter-notebook-interfaces"><i class="fa fa-check"></i>Jupyter notebook interfaces</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#launch-jupyterlab"><i class="fa fa-check"></i>Launch JupyterLab</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-6"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#python-introduction"><i class="fa fa-check"></i>Python Introduction</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-4"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials-4"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-4"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-3"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#python-basics"><i class="fa fa-check"></i>Python basics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-python"><i class="fa fa-check"></i>What is Python?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#why-use-python"><i class="fa fa-check"></i>Why use Python?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#how-does-python-work"><i class="fa fa-check"></i>How does Python work?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#interfaces-1"><i class="fa fa-check"></i>Interfaces</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-jupyterlab-1"><i class="fa fa-check"></i>Launch JupyterLab</a></li>
<li class="chapter" data-level="" data-path=""><a href="#syntax-rules-1"><i class="fa fa-check"></i>Syntax rules</a></li>
<li class="chapter" data-level="" data-path=""><a href="#function-calls-1"><i class="fa fa-check"></i>Function calls</a></li>
<li class="chapter" data-level="" data-path=""><a href="#assignment-1"><i class="fa fa-check"></i>Assignment</a></li>
<li class="chapter" data-level="" data-path=""><a href="#reading-data-1"><i class="fa fa-check"></i>Reading data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#object-methods"><i class="fa fa-check"></i>Object methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#using-object-methods-lists"><i class="fa fa-check"></i>Using object methods &amp; lists</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#splitting-a-string-into-a-list-of-words"><i class="fa fa-check"></i>Splitting a string into a list of words</a></li>
<li class="chapter" data-level="" data-path=""><a href="#working-with-lists"><i class="fa fa-check"></i>Working with lists</a></li>
<li class="chapter" data-level="" data-path=""><a href="#extracting-subsets-from-lists"><i class="fa fa-check"></i>Extracting subsets from lists</a></li>
<li class="chapter" data-level="" data-path=""><a href="#using-sets-to-count-unique-items"><i class="fa fa-check"></i>Using sets to count unique items</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-3"><i class="fa fa-check"></i>Exercise 0</a></li>
<li class="chapter" data-level="" data-path=""><a href="#control-flow"><i class="fa fa-check"></i>Control flow</a></li>
<li class="chapter" data-level="" data-path=""><a href="#logical-relational-operators-1"><i class="fa fa-check"></i>Logical &amp; relational operators</a></li>
<li class="chapter" data-level="" data-path=""><a href="#counting-list-elements"><i class="fa fa-check"></i>Counting list elements</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#iterating-over-collections-of-data"><i class="fa fa-check"></i>Iterating over collections of data</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#iterating-over-lists-using-for-loops"><i class="fa fa-check"></i>Iterating over lists using for-loops</a></li>
<li class="chapter" data-level="" data-path=""><a href="#organizing-results-in-dictionaries"><i class="fa fa-check"></i>Organizing results in dictionaries</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#importing-packages"><i class="fa fa-check"></i>Importing packages</a></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-5"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-5"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-7"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#python-web-scraping"><i class="fa fa-check"></i>Python Web-Scraping</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-5"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#software-and-materials-5"><i class="fa fa-check"></i>Software and Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-5"><i class="fa fa-check"></i>Class Structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-4"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#web-scraping-background"><i class="fa fa-check"></i>Web scraping background</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-web-scraping"><i class="fa fa-check"></i>What is web scraping?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#is-web-scraping-legal-is-it-ethical"><i class="fa fa-check"></i>Is web scraping legal? Is it ethical?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#web-scraping-approaches"><i class="fa fa-check"></i>Web scraping approaches</a></li>
<li class="chapter" data-level="" data-path=""><a href="#how-does-the-web-work"><i class="fa fa-check"></i>How does the web work?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#retrieve-data-in-json-format-if-you-can"><i class="fa fa-check"></i>Retrieve data in JSON format if you can</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#examine-the-websites-structure"><i class="fa fa-check"></i>Examine the website’s structure</a></li>
<li class="chapter" data-level="" data-path=""><a href="#launch-jupyterlab-2"><i class="fa fa-check"></i>Launch JupyterLab</a></li>
<li class="chapter" data-level="" data-path=""><a href="#making-requests"><i class="fa fa-check"></i>Making requests</a></li>
<li class="chapter" data-level="" data-path=""><a href="#parsing-json-data"><i class="fa fa-check"></i>Parsing JSON data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#organizing-saving-the-data"><i class="fa fa-check"></i>Organizing &amp; saving the data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#iterating-to-retrieve-all-the-data"><i class="fa fa-check"></i>Iterating to retrieve all the data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-4"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#parsing-html-if-you-have-to"><i class="fa fa-check"></i>Parsing HTML if you have to</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#document-object-model-dom"><i class="fa fa-check"></i>Document Object Model (DOM)</a></li>
<li class="chapter" data-level="" data-path=""><a href="#retrieving-html"><i class="fa fa-check"></i>Retrieving HTML</a></li>
<li class="chapter" data-level="" data-path=""><a href="#parsing-html-using-the-lxml-library"><i class="fa fa-check"></i>Parsing HTML using the lxml library</a></li>
<li class="chapter" data-level="" data-path=""><a href="#using-xpath-to-extract-content-from-html"><i class="fa fa-check"></i>Using XPath to extract content from HTML</a></li>
<li class="chapter" data-level="" data-path=""><a href="#iterating-to-retrieve-content-from-a-list-of-html-elements"><i class="fa fa-check"></i>Iterating to retrieve content from a list of HTML elements</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li><a href="#scrapy-for-large-complex-projects"><code>Scrapy</code>: for large / complex projects</a></li>
<li class="chapter" data-level="" data-path=""><a href="#browser-drivers-a-last-resort"><i class="fa fa-check"></i>Browser drivers: a last resort</a></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-6"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-6"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-8"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Stata</b></span></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-installation"><i class="fa fa-check"></i>Stata Installation</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#troubleshooting"><i class="fa fa-check"></i>Troubleshooting</a></li>
<li class="chapter" data-level="" data-path=""><a href="#materials-2"><i class="fa fa-check"></i>Materials</a></li>
<li class="chapter" data-level="" data-path=""><a href="#software-2"><i class="fa fa-check"></i>Software</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-9"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-introduction"><i class="fa fa-check"></i>Stata Introduction</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-6"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-and-organization"><i class="fa fa-check"></i>Class Structure and organization</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-5"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-basics"><i class="fa fa-check"></i>Stata basics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#what-is-stata"><i class="fa fa-check"></i>What is Stata?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#why-use-stata"><i class="fa fa-check"></i>Why use Stata?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#how-does-stata-work"><i class="fa fa-check"></i>How does Stata work?</a></li>
<li class="chapter" data-level="" data-path=""><a href="#interfaces-2"><i class="fa fa-check"></i>Interfaces</a></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-help"><i class="fa fa-check"></i>Stata help</a></li>
<li class="chapter" data-level="" data-path=""><a href="#syntax-rules-2"><i class="fa fa-check"></i>Syntax rules</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-5"><i class="fa fa-check"></i>Exercise 0</a></li>
<li class="chapter" data-level="" data-path=""><a href="#working-directory"><i class="fa fa-check"></i>Working directory</a></li>
<li class="chapter" data-level="" data-path=""><a href="#reading-data-2"><i class="fa fa-check"></i>Reading data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#statistics-graphs"><i class="fa fa-check"></i>Statistics &amp; graphs</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#basic-graphing-commands"><i class="fa fa-check"></i>Basic graphing commands</a></li>
<li><a href="#the-by-command">The <code>by</code> command</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-6"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#basic-data-management"><i class="fa fa-check"></i>Basic data management</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#variable-value-labels"><i class="fa fa-check"></i>Variable &amp; value labels</a></li>
<li class="chapter" data-level="" data-path=""><a href="#working-on-subsets"><i class="fa fa-check"></i>Working on subsets</a></li>
<li class="chapter" data-level="" data-path=""><a href="#generating-replacing-variables"><i class="fa fa-check"></i>Generating &amp; replacing variables</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-4"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#bivariate-analyses"><i class="fa fa-check"></i>Bivariate analyses</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#chi-squared-test"><i class="fa fa-check"></i>Chi-squared test</a></li>
<li class="chapter" data-level="" data-path=""><a href="#t-test"><i class="fa fa-check"></i>t-test</a></li>
<li class="chapter" data-level="" data-path=""><a href="#one-way-anova"><i class="fa fa-check"></i>One-way ANOVA</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3-4"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-7"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-7"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-10"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-data-management"><i class="fa fa-check"></i>Stata Data Management</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-7"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-and-organization-1"><i class="fa fa-check"></i>Class structure and organization</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-6"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#opening-files"><i class="fa fa-check"></i>Opening Files</a></li>
<li class="chapter" data-level="" data-path=""><a href="#generating-replacing-variables-1"><i class="fa fa-check"></i>Generating &amp; replacing variables</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#generate-replace"><i class="fa fa-check"></i>Generate &amp; Replace</a></li>
<li class="chapter" data-level="" data-path=""><a href="#recode"><i class="fa fa-check"></i>Recode</a></li>
<li class="chapter" data-level="" data-path=""><a href="#egen"><i class="fa fa-check"></i>egen</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-6"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#missing-values"><i class="fa fa-check"></i>Missing values</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#making-sure-missingness-is-preserved"><i class="fa fa-check"></i>Making sure missingness is preserved</a></li>
<li class="chapter" data-level="" data-path=""><a href="#bulk-conversion-to-missing-values"><i class="fa fa-check"></i>Bulk Conversion to missing values</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#variable-types"><i class="fa fa-check"></i>Variable types</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#converting-to-from-strings"><i class="fa fa-check"></i>Converting to &amp; from Strings</a></li>
<li class="chapter" data-level="" data-path=""><a href="#converting-strings-to-date-time"><i class="fa fa-check"></i>Converting strings to date / time</a></li>
<li class="chapter" data-level="" data-path=""><a href="#formatting-numbers-as-dates"><i class="fa fa-check"></i>Formatting numbers as dates</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-7"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#merging-appending-collapsing"><i class="fa fa-check"></i>Merging, appending, &amp; collapsing</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#appending-datasets"><i class="fa fa-check"></i>Appending datasets</a></li>
<li class="chapter" data-level="" data-path=""><a href="#merging-datasets"><i class="fa fa-check"></i>Merging datasets</a></li>
<li class="chapter" data-level="" data-path=""><a href="#merge-options"><i class="fa fa-check"></i>Merge Options</a></li>
<li class="chapter" data-level="" data-path=""><a href="#many-to-many-merges---joinby-command"><i class="fa fa-check"></i>Many-to-many merges - joinby command</a></li>
<li class="chapter" data-level="" data-path=""><a href="#collapse"><i class="fa fa-check"></i>Collapse</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-5"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-8"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-8"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-11"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-regression-models"><i class="fa fa-check"></i>Stata Regression Models</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-8"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-and-organization-2"><i class="fa fa-check"></i>Class structure and organization</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-7"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#modeling-workflow-1"><i class="fa fa-check"></i>Modeling workflow</a></li>
<li class="chapter" data-level="" data-path=""><a href="#before-fitting-a-model-1"><i class="fa fa-check"></i>Before fitting a model</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#the-dataset"><i class="fa fa-check"></i>The dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#set-working-directory"><i class="fa fa-check"></i>Set working directory</a></li>
<li class="chapter" data-level="" data-path=""><a href="#load-the-data-1"><i class="fa fa-check"></i>Load the data</a></li>
<li class="chapter" data-level="" data-path=""><a href="#examine-descriptive-statistics"><i class="fa fa-check"></i>Examine descriptive statistics</a></li>
<li class="chapter" data-level="" data-path=""><a href="#visualize-the-data"><i class="fa fa-check"></i>Visualize the data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#models-with-continuous-outcomes-1"><i class="fa fa-check"></i>Models with continuous outcomes</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#fit-the-model"><i class="fa fa-check"></i>Fit the model</a></li>
<li class="chapter" data-level="" data-path=""><a href="#ols-assumptions"><i class="fa fa-check"></i>OLS assumptions</a></li>
<li class="chapter" data-level="" data-path=""><a href="#interactions"><i class="fa fa-check"></i>Interactions</a></li>
<li class="chapter" data-level="" data-path=""><a href="#categorical-predictors"><i class="fa fa-check"></i>Categorical predictors</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-7"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#models-with-binary-outcomes-1"><i class="fa fa-check"></i>Models with binary outcomes</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#the-dataset-1"><i class="fa fa-check"></i>The Dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#load-the-dataset"><i class="fa fa-check"></i>Load the dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#recode-the-outcome-variable"><i class="fa fa-check"></i>Recode the outcome variable</a></li>
<li class="chapter" data-level="" data-path=""><a href="#run-summary-statistics"><i class="fa fa-check"></i>Run summary statistics</a></li>
<li class="chapter" data-level="" data-path=""><a href="#run-the-logistic-model"><i class="fa fa-check"></i>Run the logistic model</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-8"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#exporting-saving-results"><i class="fa fa-check"></i>Exporting &amp; saving results</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#storing-results"><i class="fa fa-check"></i>Storing results</a></li>
<li class="chapter" data-level="" data-path=""><a href="#comparing-models-1"><i class="fa fa-check"></i>Comparing models</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exporting-to-excel"><i class="fa fa-check"></i>Exporting to Excel</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-2-6"><i class="fa fa-check"></i>Exercise 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#obtaining-quantities-of-interest"><i class="fa fa-check"></i>Obtaining quantities of interest</a></li>
<li class="chapter" data-level="" data-path=""><a href="#margins-of-responses"><i class="fa fa-check"></i>Margins of responses</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#the-dataset-2"><i class="fa fa-check"></i>The dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#fit-a-model"><i class="fa fa-check"></i>Fit a model</a></li>
<li class="chapter" data-level="" data-path=""><a href="#apm-average-predictive-margins"><i class="fa fa-check"></i>APM: Average Predictive Margins</a></li>
<li class="chapter" data-level="" data-path=""><a href="#pmm-predictive-margins-at-the-means"><i class="fa fa-check"></i>PMM: Predictive Margins at the Means</a></li>
<li class="chapter" data-level="" data-path=""><a href="#pmr-predictive-margins-at-representative-values"><i class="fa fa-check"></i>PMR: Predictive Margins at Representative values</a></li>
<li class="chapter" data-level="" data-path=""><a href="#graph-margins-of-responses"><i class="fa fa-check"></i>Graph margins of responses</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-3-5"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#margins-of-changes-in-responses"><i class="fa fa-check"></i>Margins of changes in responses</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#the-dataset-3"><i class="fa fa-check"></i>The dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#fit-a-model-1"><i class="fa fa-check"></i>Fit a model</a></li>
<li class="chapter" data-level="" data-path=""><a href="#ame-average-marginal-effects"><i class="fa fa-check"></i>AME: Average Marginal Effects</a></li>
<li class="chapter" data-level="" data-path=""><a href="#mem-marginal-effects-at-the-mean"><i class="fa fa-check"></i>MEM: Marginal Effects at the Mean</a></li>
<li class="chapter" data-level="" data-path=""><a href="#mer-marginal-effects-at-representative-values"><i class="fa fa-check"></i>MER: Marginal Effects at Representative values</a></li>
<li class="chapter" data-level="" data-path=""><a href="#graph-margins-of-changes-in-responses"><i class="fa fa-check"></i>Graph margins of changes in responses</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-4-2"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-9"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-9"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-12"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-graphics"><i class="fa fa-check"></i>Stata Graphics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#setup-9"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#class-structure-and-organization-3"><i class="fa fa-check"></i>Class structure and organization</a></li>
<li class="chapter" data-level="" data-path=""><a href="#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path=""><a href="#goals-8"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#graphing-in-stata"><i class="fa fa-check"></i>Graphing in Stata</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#graphing-strategies"><i class="fa fa-check"></i>Graphing strategies</a></li>
<li class="chapter" data-level="" data-path=""><a href="#terrible-graph"><i class="fa fa-check"></i>Terrible graph</a></li>
<li class="chapter" data-level="" data-path=""><a href="#much-better-graph"><i class="fa fa-check"></i>Much better graph</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#univariate-graphics"><i class="fa fa-check"></i>Univariate graphics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#our-first-dataset"><i class="fa fa-check"></i>Our first dataset</a></li>
<li class="chapter" data-level="" data-path=""><a href="#single-continuous-variable"><i class="fa fa-check"></i>Single continuous variable</a></li>
<li class="chapter" data-level="" data-path=""><a href="#single-categorical-variable"><i class="fa fa-check"></i>Single categorical variable</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-0-8"><i class="fa fa-check"></i>Exercise 0</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#bivariate-graphics"><i class="fa fa-check"></i>Bivariate graphics</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#next-dataset"><i class="fa fa-check"></i>Next dataset</a></li>
<li><a href="#the-twoway-family">The <code>twoway</code> family</a></li>
<li class="chapter" data-level="" data-path=""><a href="#overlaying-twoway-graphs"><i class="fa fa-check"></i>Overlaying twoway graphs</a></li>
<li class="chapter" data-level="" data-path=""><a href="#twoway-line-graphs"><i class="fa fa-check"></i>Twoway line graphs</a></li>
<li class="chapter" data-level="" data-path=""><a href="#stata-graphing-lines"><i class="fa fa-check"></i>Stata graphing lines</a></li>
<li class="chapter" data-level="" data-path=""><a href="#exercise-1-9"><i class="fa fa-check"></i>Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#exporting-graphs"><i class="fa fa-check"></i>Exporting graphs</a></li>
<li class="chapter" data-level="" data-path=""><a href="#wrap-up-10"><i class="fa fa-check"></i>Wrap-up</a>
<ul>
<li class="chapter" data-level="" data-path=""><a href="#feedback-10"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path=""><a href="#resources-13"><i class="fa fa-check"></i>Resources</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Workshops</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Data Science Workshops</h1>
<p class="author"><em></em></p>
<p class="date"><em>August 2020</em></p>
</div>
<p>Materials for the software workshops held at the <a href="http://dss.iq.harvard.edu/">Institute for Quantitative Social Science</a> and <a href="https://training.rcs.hbs.org">Harvard Business School</a> at Harvard University.</p>
<div id="table-of-contents" class="section level1 unnumbered">
<h1>Table of Contents</h1>
<ul>
<li><a href="./DataScienceTools.html">Data Science Tools</a></li>
<li><a href="./Rinstall.html">R Installation</a></li>
<li><a href="./Rintro.html">R Introduction</a></li>
<li><a href="./Rmodels.html">R Regression Models</a></li>
<li><a href="./Rgraphics.html">R Graphics</a></li>
<li><a href="./RDataWrangling.html">R Data Wrangling</a></li>
<li><a href="./PythonInstall.html">Python Installation</a></li>
<li><a href="./PythonIntro.html">Python Introduction</a></li>
<li><a href="./PythonWebScrape.html">Python Web-Scraping</a></li>
<li><a href="./StataInstall.html">Stata Installation</a></li>
<li><a href="./StataIntro.html">Stata Introduction</a></li>
<li><a href="./StataDataManage.html">Stata Data Management</a></li>
<li><a href="./StataModels.html">Stata Regression Models</a></li>
<li><a href="./StataGraphics.html">Stata Graphics</a></li>
</ul>
<div id="contributors" class="section level2 unnumbered">
<h2>Contributors</h2>
<p>The contents of these workshops are the result of a collaborative effort from members of the <a href="http://dss.iq.harvard.edu">Data Science Services</a> team at IQSS and the <a href="https://training.rcs.hbs.org">Research Computing Services</a> team at HBS. The main contributors are: Ista Zahn, Steve Worthington, Bob Freeman, Jinjie Liu, Yihan Wang, and Victoria Liublinska.</p>
<p>These workshops are a work-in-progress, please provide feedback! Email: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>

</div>
</div>



<div id="data-science-tools" class="section level1">
<h1>Data Science Tools</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Data science tool selection</li>
<li>Data analysis pipelines</li>
<li>Programming languages comparison</li>
<li>Text editor and IDE comparison</li>
<li>Tools for creating reports</li>
</ul>
<div id="tools-for-working-with-data" class="section level2">
<h2>Tools for working with data</h2>
<p>Working with data effectively requires learning at least one programming or scripting language. You can get by without this, but it would be like trying to cook with only a butter knife; not recommended! Compared to using a menu-driven interface (e.g., SPSS or SAS) or a spreadsheet (e.g., Excel), using a programming language allows you to:</p>
<ul>
<li>reproduce results,</li>
<li>correct errors and update output,</li>
<li>reuse code,</li>
<li>collaborate with others,</li>
<li>automate repetitive tasks, and</li>
<li>generate manuscripts, reports, and other documents from your code.</li>
</ul>
<p>So, you need to learn a programming language for working with data, but which one should you learn? Since you’ll be writing code you’ll want to set up a comfortable environment for writing and editing that code. Which text editors are good for this? You’ll probably also want to learn at least one markup language (e.g., LaTeX, Markdown) so that you can create reproducible manuscripts. What tools are good for this? These questions will guide our discussion, the goal of which is to help you decide which tools you should invest time in learning.</p>
</div>
<div id="the-puzzle-pieces" class="section level2">
<h2>The puzzle pieces</h2>
<p>As we’ve noted, working effectively with data requires using a number of tools.</p>
<div id="data-analysis-building-blocks" class="section level3">
<h3>Data analysis building blocks</h3>
<p>The basic pieces are:</p>
<ul>
<li>a data storage and retrieval system,</li>
<li>an editor for writing code,</li>
<li>an interpreter or compiler for executing that code,</li>
<li>a system for presenting results, and</li>
<li>some “glue” to make all the pieces work together.</li>
</ul>
</div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>Before looking in detail at each of these building blocks we’ll look at a few examples to get an intuitive feel for the basic elements.</p>
<div id="old-school-example" class="section level3">
<h3>Old-school example</h3>
<p>In this example we’re going to process data in a text file in a way that would be familiar to a statistician working forty years ago. Surprisingly, it’s not much different from the way we would do it today. Programs come and go, but the basic ideas remain pretty much the same!</p>
<p>Specifically, we’ll process the data in <code>1980_census.txt</code> by writing <strong>fortran</strong> code in the <strong>vi</strong> text editor and running it through the <strong>fortran</strong> compiler. Then we’ll take the results and put them in to a <strong>TeX</strong> file, again using the <strong>vi</strong> editor to create the report. For “glue” we will use a terminal emulator running the bash shell. All of these tools were available in 1980, though some features have been added since that time.</p>
<p>OLD SCHOOL DEMO:</p>
<table>
<thead>
<tr class="header">
<th align="left">example</th>
<th align="left">data storage</th>
<th align="left">editor</th>
<th align="left">program</th>
<th align="left">report tool</th>
<th align="left">glue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">old school</td>
<td align="left">ASCII text file</td>
<td align="left">vi</td>
<td align="left">fortran</td>
<td align="left">TeX</td>
<td align="left">Bourne (compatible) shell</td>
</tr>
</tbody>
</table>
</div>
<div id="something-old-something-new" class="section level3">
<h3>Something old &amp; something new</h3>
<p>Next we’re going to do the same basic process, this time using a modern text editor (<strong>Atom</strong>), a different programming language (<strong>Python</strong>), and a modern report generation system (<strong>LaTeX</strong> processed via <strong>xelatex</strong>). For the glue we’re still going to use a shell.</p>
<p>OLD AND NEW DEMO:</p>
<table>
<thead>
<tr class="header">
<th align="left">example</th>
<th align="left">data storage</th>
<th align="left">editor</th>
<th align="left">program</th>
<th align="left">report tool</th>
<th align="left">glue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">old school</td>
<td align="left">ASCII text file</td>
<td align="left">vi</td>
<td align="left">fortran</td>
<td align="left">TeX</td>
<td align="left">Bourne (compatible) shell</td>
</tr>
<tr class="even">
<td align="left">old and new</td>
<td align="left">ASCII text file</td>
<td align="left">Atom</td>
<td align="left">python</td>
<td align="left">LaTeX</td>
<td align="left">Bash shell</td>
</tr>
</tbody>
</table>
</div>
<div id="a-modern-version" class="section level3">
<h3>A modern version</h3>
<p>Finally, we’ll produce the same report using modern tools. Remember, the process is basically the same: we’re just using different tools.</p>
<p>MODERN DEMO:</p>
<table>
<thead>
<tr class="header">
<th align="left">example</th>
<th align="left">data storage</th>
<th align="left">editor</th>
<th align="left">program</th>
<th align="left">report tool</th>
<th align="left">glue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">old school</td>
<td align="left">ASCII text file</td>
<td align="left">vi</td>
<td align="left">fortran</td>
<td align="left">TeX</td>
<td align="left">Bourne (compatable) shell</td>
</tr>
<tr class="even">
<td align="left">old and new</td>
<td align="left">ASCII text file</td>
<td align="left">Atom</td>
<td align="left">python</td>
<td align="left">LaTeX</td>
<td align="left">Bash shell</td>
</tr>
<tr class="odd">
<td align="left">modern</td>
<td align="left">SQLite database</td>
<td align="left">Rstudio</td>
<td align="left">R</td>
<td align="left">R Markdown</td>
<td align="left">Rstudio</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="data-storage-retrieval" class="section level2">
<h2>Data storage &amp; retrieval</h2>
<p>Data storage and retrieval is a fairly dry topic, so we won’t spend too much time on it. There are roughly four types of technology for storing and retrieving data.</p>
<div id="text-files" class="section level3">
<h3>Text files</h3>
<p>Storing data in text files (e.g., comma separated values, other delimited text formats) is simple and makes the data easy to access from just about any program. It is also good for archiving data since no specialized software is needed to read it. The main downsides are that retrieval is slow and often all-or-nothing, and the fact that storing metadata in plain text files is cumbersome.</p>
</div>
<div id="binary-files" class="section level3">
<h3>Binary files</h3>
<p>Many statistics packages and programming languages have a “native” binary data storage format. For example, Stata stores data in <code>.dta</code> files, and R stores data in <code>.rds</code> or <code>.Rdata</code> files. These storage formats usually more efficient than text files, and usually provide faster read/write access. They usually include a mechanism for storing metadata. The down side is that specialized software is required to read them (will Stata exist in 50 years? Are you sure?) and the ability to read them using other programs may be limited.</p>
</div>
<div id="databases" class="section level3">
<h3>Databases</h3>
<p>Storing data in a database requires more up-front planning and set up, but has several advantages. Databases provide fast selective retrieval and facilitate efficient storage and flexible retrieval.</p>
</div>
<div id="distributed-file-storage" class="section level3">
<h3>Distributed file storage</h3>
<p>Data that is too large to fit on a single hard drive may be stored and analyzed on a distributed file system or database such as the <em>Hadoop Distributed File System</em> or <em>Cassandra</em>. When working with data on this scale considerable infrastructure and specialized tools will be required.</p>
</div>
</div>
<div id="programming-languages-statistics-packages" class="section level2">
<h2>Programming languages &amp; statistics packages</h2>
<p>There are tens of programs for statistics and data science available. Here we will focus only on the more popular programs that offer a wide range of features. Note that for specific applications a specialized program may be better, e.g., many people use Mplus for structural equation models and another program for everything else.</p>
<div id="programming-language-features" class="section level3">
<h3>Programming language features</h3>
<p>Things we want a statistics program to do include:</p>
<ul>
<li>read/write data from/to a variety of data storage systems,</li>
<li>manipulate data,</li>
<li>perform statistical methods,</li>
<li>visualize data and results,</li>
<li>export results in a variety of formats,</li>
<li>be easy to use,</li>
<li>be well documented,</li>
<li>have a large user community.</li>
</ul>
<p>Note that this list is deceptively simple; each item may include a diversity of complicated features. For example,“read/write data from/to a variety of data storage systems” may include reading from databases, image files, .pdf files, .html and .xml files from a website, and any number of proprietary data storage formats.</p>
</div>
<div id="program-comparison" class="section level3">
<h3>Program comparison</h3>
<table>
<colgroup>
<col width="9%" />
<col width="12%" />
<col width="16%" />
<col width="20%" />
<col width="14%" />
<col width="21%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Program</th>
<th align="left">Statistics</th>
<th align="left">Visualization</th>
<th align="left">Machine learning</th>
<th align="left">Ease of use</th>
<th align="left">Power/flexibility</th>
<th align="left">Fun</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Stata</td>
<td align="left">Excellent</td>
<td align="left">Servicable</td>
<td align="left">Limited</td>
<td align="left">Very easy</td>
<td align="left">Low</td>
<td align="left">Some</td>
</tr>
<tr class="even">
<td align="left">SPSS</td>
<td align="left">OK</td>
<td align="left">Servicable</td>
<td align="left">Limited</td>
<td align="left">Easy</td>
<td align="left">Low</td>
<td align="left">None</td>
</tr>
<tr class="odd">
<td align="left">SAS</td>
<td align="left">Good</td>
<td align="left">Not great</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Moderate</td>
<td align="left">None</td>
</tr>
<tr class="even">
<td align="left">Matlab</td>
<td align="left">Good</td>
<td align="left">Good</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Good</td>
<td align="left">Some</td>
</tr>
<tr class="odd">
<td align="left">R</td>
<td align="left">Excellent</td>
<td align="left">Excellent</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Excellent</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">Python</td>
<td align="left">Good</td>
<td align="left">Good</td>
<td align="left">Excellent</td>
<td align="left">Moderate</td>
<td align="left">Excellent</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">Julia</td>
<td align="left">OK</td>
<td align="left">Excellent</td>
<td align="left">Good</td>
<td align="left">Hard</td>
<td align="left">Excellent</td>
<td align="left">Yes</td>
</tr>
</tbody>
</table>
</div>
<div id="examples-read-data-from-a-file-summarize" class="section level3">
<h3>Examples: Read data from a file &amp; summarize</h3>
<p>In this example we will compare the syntax for reading and summarizing data stored in a file.</p>
<ul>
<li>Stata</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1"></a>import delimited <span class="kw">using</span> <span class="st">&quot;https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics/dataSets/EconomistData.csv&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">sum</span></span></code></pre></div>
<pre><code>set more off
 &quot;EconomistData.csv&quot;
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=gasp -Dswing.aatext=true -Dsun.java2d.opengl=true
(6 vars, 173 obs)
sum

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          v1 |        173          87    50.08493          1        173
     country |          0
     hdirank |        173    95.28324    55.00767          1        187
         hdi |        173    .6580867    .1755888       .286       .943
         cpi |        173    4.052023    2.116782        1.5        9.5
-------------+---------------------------------------------------------
      region |          0</code></pre>
<ul>
<li>R</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>cpi &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics/dataSets/EconomistData.csv&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">summary</span>(cpi)</span></code></pre></div>
<pre><code>      X              Country       HDI.Rank           HDI        
Min.   :  1   Afghanistan:  1   Min.   :  1.00   Min.   :0.2860  
1st Qu.: 44   Albania    :  1   1st Qu.: 47.00   1st Qu.:0.5090  
Median : 87   Algeria    :  1   Median : 96.00   Median :0.6980  
Mean   : 87   Angola     :  1   Mean   : 95.28   Mean   :0.6581  
3rd Qu.:130   Argentina  :  1   3rd Qu.:143.00   3rd Qu.:0.7930  
Max.   :173   Armenia    :  1   Max.   :187.00   Max.   :0.9430  
              (Other)    :167                                    
     CPI                      Region  
Min.   :1.500   Americas         :31  
1st Qu.:2.500   Asia Pacific     :30  
Median :3.200   East EU Cemt Asia:18  
Mean   :4.052   EU W. Europe     :30  
3rd Qu.:5.100   MENA             :18  
Max.   :9.500   SSA              :46</code></pre>
<ul>
<li>Matlab</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">tmpfile</span> <span class="op">=</span> <span class="va">websave</span>(<span class="va">tempname</span>()<span class="op">,</span> <span class="ss">&#39;https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics/dataSets/EconomistData.csv&#39;</span>)<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="va">cpi</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">tmpfile</span>)<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="va">summary</span>(<span class="va">cpi</span>)</span></code></pre></div>
<pre><code>tmpfile = websave(tempname(), &#39;https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics/dataSets/EconomistData.csv&#39;);
cpi = readtable(tmpfile);
summary(cpi)

Variables:

    Var1: 173×1 cell array of character vectors

    Country: 173×1 cell array of character vectors

    HDI_Rank: 173×1 double

        Description:  Original column heading: &#39;HDI.Rank&#39;
        Values:

            Min         1       
            Median     96       
            Max       187       

    HDI: 173×1 double

        Values:

            Min       0.286
            Median    0.698
            Max       0.943

    CPI: 173×1 double

        Values:

            Min       1.5  
            Median    3.2  
            Max       9.5  

    Region: 173×1 cell array of character vectors
&#39;org_babel_eoe&#39;

ans =

    &#39;org_babel_eoe&#39;</code></pre>
<ul>
<li>Python</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2"></a>cpi <span class="op">=</span> pd.read_csv(<span class="st">&#39;https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics/dataSets/EconomistData.csv&#39;</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>cpi.describe(include <span class="op">=</span> <span class="st">&#39;all&#39;</span>)</span></code></pre></div>
<pre><code>Python 3.6.2 (default, Jul 20 2017, 03:52:27) 
[GCC 7.1.1 20170630] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
        Unnamed: 0 Country    HDI.Rank         HDI         CPI Region
count   173.000000     173  173.000000  173.000000  173.000000    173
unique         NaN     173         NaN         NaN         NaN      6
top            NaN    Oman         NaN         NaN         NaN    SSA
freq           NaN       1         NaN         NaN         NaN     46
mean     87.000000     NaN   95.283237    0.658087    4.052023    NaN
std      50.084928     NaN   55.007670    0.175589    2.116782    NaN
min       1.000000     NaN    1.000000    0.286000    1.500000    NaN
25%      44.000000     NaN   47.000000    0.509000    2.500000    NaN
50%      87.000000     NaN   96.000000    0.698000    3.200000    NaN
75%     130.000000     NaN  143.000000    0.793000    5.100000    NaN
max     173.000000     NaN  187.000000    0.943000    9.500000    NaN</code></pre>
</div>
<div id="examples-fit-a-linear-regression" class="section level3">
<h3>Examples: Fit a linear regression</h3>
<p>Fitting statistical models is pretty straight-forward in all popular programs.</p>
<ul>
<li>Stata</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">regress</span> hdi cpi</span></code></pre></div>
<pre><code>regress hdi cpi

      Source |       SS           df       MS      Number of obs   =       173
-------------+----------------------------------   F(1, 171)       =    168.85
       Model |  2.63475703         1  2.63475703   Prob &gt; F        =    0.0000
    Residual |   2.6682467       171  .015603782   R-squared       =    0.4968
-------------+----------------------------------   Adj R-squared   =    0.4939
       Total |  5.30300372       172  .030831417   Root MSE        =    .12492

------------------------------------------------------------------------------
         hdi |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         cpi |   .0584696   .0044996    12.99   0.000     .0495876    .0673515
       _cons |   .4211666   .0205577    20.49   0.000     .3805871    .4617462
------------------------------------------------------------------------------</code></pre>
<ul>
<li>R</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">summary</span>(<span class="kw">lm</span>(HDI <span class="op">~</span><span class="st"> </span>CPI, <span class="dt">data =</span> cpi))</span></code></pre></div>
<pre><code>Call:
lm(formula = HDI ~ CPI, data = cpi)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.28452 -0.08380  0.01372  0.09157  0.24104 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.42117    0.02056   20.49   &lt;2e-16 ***
CPI          0.05847    0.00450   12.99   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1249 on 171 degrees of freedom
Multiple R-squared:  0.4968,    Adjusted R-squared:  0.4939 
F-statistic: 168.9 on 1 and 171 DF,  p-value: &lt; 2.2e-16</code></pre>
<ul>
<li>Matlab</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb13-1"><a href="#cb13-1"></a><span class="va">fitlm</span>(<span class="va">cpi</span><span class="op">,</span> <span class="ss">&#39;HDI~CPI&#39;</span>)</span></code></pre></div>
<pre><code>fitlm(cpi, &#39;HDI~CPI&#39;)

ans = 


Linear regression model:
    HDI ~ 1 + CPI

Estimated Coefficients:
                   Estimate       SE        tStat       pValue  
                   ________    _________    ______    __________

    (Intercept)    0.42117      0.020558    20.487    6.7008e-48
    CPI            0.05847     0.0044996    12.994    2.6908e-27


Number of observations: 173, Error degrees of freedom: 171
Root Mean Squared Error: 0.125
R-squared: 0.497,  Adjusted R-Squared 0.494
F-statistic vs. constant model: 169, p-value = 2.69e-27
&#39;org_babel_eoe&#39;

ans =

    &#39;org_babel_eoe&#39;</code></pre>
<ul>
<li>Python</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> model</span>
<span id="cb15-2"><a href="#cb15-2"></a>X <span class="op">=</span> cpi[[<span class="st">&#39;CPI&#39;</span>]]</span>
<span id="cb15-3"><a href="#cb15-3"></a>Y <span class="op">=</span> cpi[[<span class="st">&#39;HDI&#39;</span>]]</span>
<span id="cb15-4"><a href="#cb15-4"></a>model.OLS(Y, X).fit().summary()</span></code></pre></div>
<pre><code>&lt;class &#39;statsmodels.iolib.summary.Summary&#39;&gt;
&quot;&quot;&quot;
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    HDI   R-squared:                       0.885
Model:                            OLS   Adj. R-squared:                  0.884
Method:                 Least Squares   F-statistic:                     1325.
Date:                Thu, 31 Aug 2017   Prob (F-statistic):           9.89e-83
Time:                        23:16:45   Log-Likelihood:                 8.1584
No. Observations:                 173   AIC:                            -14.32
Df Residuals:                     172   BIC:                            -11.16
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
CPI            0.1402      0.004     36.401      0.000       0.133       0.148
==============================================================================
Omnibus:                       10.423   Durbin-Watson:                   1.616
Prob(Omnibus):                  0.005   Jarque-Bera (JB):               11.099
Skew:                          -0.599   Prob(JB):                      0.00389
Kurtosis:                       2.674   Cond. No.                         1.00
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
&quot;&quot;&quot;</code></pre>
</div>
<div id="examples-extract-links-for-.html-file" class="section level3">
<h3>Examples: Extract links for .html file</h3>
<p>Retrieving data from a website is a common task. Here we parse a simple web page containing links to files we wish to download.</p>
<ul>
<li>Stata</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb17-1"><a href="#cb17-1"></a>disp <span class="st">&quot;Ha ha ha! No, you do not want to use Stata for this!&quot;</span></span></code></pre></div>
<pre><code>disp &quot;Ha ha ha! No, you do not want to use Stata for this!&quot;
Ha ha ha! No, you do not want to use Stata for this!</code></pre>
<ul>
<li>R</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">library</span>(xml2)</span>
<span id="cb19-2"><a href="#cb19-2"></a>index_page &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a>all_anchors &lt;-<span class="st"> </span><span class="kw">xml_find_all</span>(index_page, <span class="st">&quot;//a&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>all_hrefs &lt;-<span class="st"> </span><span class="kw">xml_attr</span>(all_anchors, <span class="st">&quot;href&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a>data_hrefs &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.csv$&quot;</span>, all_hrefs, <span class="dt">value =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a>data_links &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&quot;</span>, data_hrefs)</span>
<span id="cb19-7"><a href="#cb19-7"></a>data_links</span></code></pre></div>
<pre><code> [1] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1996.csv&quot; 
 [2] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1997.csv&quot; 
 [3] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1998.csv&quot; 
 [4] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1999.csv&quot; 
 [5] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2000.csv&quot; 
 [6] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2001.csv&quot; 
 [7] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2002.csv&quot; 
 [8] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2003.csv&quot; 
 [9] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2004.csv&quot; 
[10] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2005.csv&quot; 
[11] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2006.csv&quot; 
[12] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2007.csv&quot; 
[13] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2008.csv&quot; 
[14] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2009.csv&quot; 
[15] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2010.csv&quot; 
[16] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2011.csv&quot; 
[17] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2012.csv&quot; 
[18] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2013.csv&quot; 
[19] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2014.csv&quot; 
[20] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2015.csv&quot; 
[21] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1996.csv&quot;
[22] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1997.csv&quot;
[23] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1998.csv&quot;
[24] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1999.csv&quot;
[25] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2000.csv&quot;
[26] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2001.csv&quot;
[27] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2002.csv&quot;
[28] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2003.csv&quot;
[29] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2004.csv&quot;
[30] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2005.csv&quot;
[31] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2006.csv&quot;
[32] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2007.csv&quot;
[33] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2008.csv&quot;
[34] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2009.csv&quot;
[35] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2010.csv&quot;
[36] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2011.csv&quot;
[37] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2012.csv&quot;
[38] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2013.csv&quot;
[39] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2014.csv&quot;
[40] &quot;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2015.csv&quot;</code></pre>
<ul>
<li>Matlab</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb21-1"><a href="#cb21-1"></a><span class="va">index_page</span> <span class="op">=</span> <span class="va">urlread</span>(<span class="ss">&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;</span>)<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="va">all_hrefs</span> <span class="op">=</span> <span class="va">regexp</span>(<span class="va">index_page</span><span class="op">,</span> <span class="ss">&#39;&lt;a href=&quot;([^&quot;]*\.csv)&quot;&gt;&#39;</span><span class="op">,</span> <span class="ss">&#39;tokens&#39;</span>)<span class="op">&#39;;</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="va">all_hrefs</span> <span class="op">=</span> [<span class="va">all_hrefs</span>{<span class="op">:</span>}]<span class="op">&#39;;</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="va">all_links</span> <span class="op">=</span> <span class="va">strcat</span>(<span class="ss">&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;</span><span class="op">,</span> <span class="va">all_hrefs</span>)</span></code></pre></div>
<pre><code>index_page = urlread(&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;);
all_hrefs = regexp(index_page, &#39;&lt;a href=&quot;([^&quot;]*\.csv)&quot;&gt;&#39;, &#39;tokens&#39;)&#39;;
all_hrefs = [all_hrefs{:}]&#39;;
all_links = strcat(&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;, all_hrefs)

all_links =

  40×1 cell array

    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1996.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1997.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1998.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1999.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2000.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2001.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2002.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2003.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2004.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2005.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2006.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2007.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2008.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2009.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2010.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2011.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2012.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2013.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2014.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2015.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1996.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1997.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1998.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1999.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2000.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2001.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2002.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2003.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2004.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2005.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2006.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2007.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2008.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2009.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2010.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2011.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2012.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2013.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2014.csv&#39;
    &#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2015.csv&#39;
&#39;org_babel_eoe&#39;

ans =

    &#39;org_babel_eoe&#39;</code></pre>
<ul>
<li>Python</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="im">from</span> lxml <span class="im">import</span> etree</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="im">import</span> requests</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a>index_text <span class="op">=</span> requests.get(<span class="st">&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;</span>).text</span>
<span id="cb23-5"><a href="#cb23-5"></a>index_page <span class="op">=</span> etree.HTML(index_text)</span>
<span id="cb23-6"><a href="#cb23-6"></a>all_hrefs <span class="op">=</span> [a.values() <span class="cf">for</span> a <span class="kw">in</span> index_page.findall(<span class="st">&quot;.//a&quot;</span>)]</span>
<span id="cb23-7"><a href="#cb23-7"></a>data_links <span class="op">=</span> [<span class="st">&#39;http://tutorials.iq.harvard.edu/example_data/baby_names/EW/&#39;</span> <span class="op">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>              href[<span class="dv">0</span>] <span class="cf">for</span> href <span class="kw">in</span> all_hrefs <span class="cf">if</span> <span class="st">&#39;csv&#39;</span> <span class="kw">in</span> href[<span class="dv">0</span>]]</span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="cf">for</span> link <span class="kw">in</span> data_links:</span>
<span id="cb23-10"><a href="#cb23-10"></a>    <span class="bu">print</span>(link)</span></code></pre></div>
<pre><code>http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1996.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1997.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1998.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_1999.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2000.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2001.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2002.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2003.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2004.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2005.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2006.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2007.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2008.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2009.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2010.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2011.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2012.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2013.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2014.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/boys_2015.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1996.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1997.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1998.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_1999.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2000.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2001.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2002.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2003.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2004.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2005.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2006.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2007.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2008.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2009.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2010.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2011.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2012.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2013.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2014.csv
http://tutorials.iq.harvard.edu/example_data/baby_names/EW/girls_2015.csv</code></pre>
</div>
</div>
<div id="creating-reports" class="section level2">
<h2>Creating reports</h2>
<p>Once you’ve analyzed your data you’ll most likely want to communicate your results. For short informal projects this might take the form of a blog post or an email to your colleagues. For larger more formal projects you’ll likely want to prepare a substantial report or manuscript for disseminating your findings via a journal publication or other means. Other common means of reporting research findings include posters or slides for a conference talk.</p>
<p>Regardless of the type of report, you may choose to use either a <em>markup language</em> or a WYSIWYG application like Microsoft Word/Powerpoint of a desktop publishing application such as Adobe InDesign.</p>
<div id="markup-languages" class="section level3">
<h3>Markup languages</h3>
<p>A markup language is a system for producing a formatted document from a text file using information by the markup. A major advantage of markup languages is that the formatting instructions can be easily generated by the program you use for analyzing your data.</p>
<p>Markup languages include <em>HTML</em>, <em>LaTeX</em>, <em>Markdown</em> and many others. <em>LaTeX</em> and <em>Markdown</em> are currently popular among data scientists, although others are used as well.</p>
<p><em>Markdown</em> is easy to write and designed to be human-readable. It is newer and somewhat less feature-full compared to LaTeX. It’s main advantage is simplicity. <em>LaTeX</em> is more verbose but provides for just about any feature you’ll ever need.</p>
<p>MARKDOWN DEMO LATEX DEMO</p>
</div>
<div id="word-processors" class="section level3">
<h3>Word processors</h3>
<p>Modern word processors are largely just graphical user interfaces that write a markup language (usually XML) for you. They are commonly used for creating reports, but care must be taken when doing so.</p>
<p>If you use a word processor to produce your reports you should</p>
<ul>
<li>use the structured outline feature,</li>
<li>link rather than embed external resources (figures, tables, etc.),</li>
<li>use cross-referencing features, and</li>
<li>use a bibliography management system.</li>
</ul>
<p>WORD PROCESSOR DEMO</p>
</div>
</div>
<div id="text-editors-integrated-development-environments" class="section level2">
<h2>Text editors &amp; Integrated Development Environments</h2>
<p>A text editor edits text obviously. But that is not all! At a minimum, a text editor will also have a mechanism for reading and writing text files. Most text editors do much more than this.</p>
<p>An IDE provides tools for working with code, such as syntax highlighting, code completion, jump-to-definition, execute/compile, package management, refactoring, etc. Of course an IDE includes a text editor.</p>
<p>Editors and IDE’s are not really separate categories; as you add features to a text editor it becomes more like an IDE, and a simple IDE may provide little more than a text editor. For example, Emacs is commonly referred to as a text editor, but it provides nearly every feature you would expect an IDE to have.</p>
<p>A more useful distinction is between language-specific editors/IDEs and general purpose editors/IDEs. The former are typically easier to set up since they come pre-configured for use with a specific language. General purpose editors/IDEs typically provide language support via <em>plugins</em> and may require extensive configuration for each language.</p>
<div id="language-specific-editors-ides" class="section level3">
<h3>Language specific editors &amp; IDEs</h3>
<table>
<thead>
<tr class="header">
<th align="left">Editor</th>
<th align="left">Features</th>
<th align="left">Ease of use</th>
<th align="left">Language</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">RStudio</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">R</td>
</tr>
<tr class="even">
<td align="left">Spyder</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Python</td>
</tr>
<tr class="odd">
<td align="left">Stata do file editor</td>
<td align="left">OK</td>
<td align="left">Easy</td>
<td align="left">Stata</td>
</tr>
<tr class="even">
<td align="left">SPSS syntax editor</td>
<td align="left">OK</td>
<td align="left">Easy</td>
<td align="left">SPSS</td>
</tr>
</tbody>
</table>
<p>LANGUAGE SPECIFIC IDE DEMO</p>
</div>
<div id="general-purpose-editors-ides" class="section level3">
<h3>General purpose editors &amp; IDEs</h3>
<table>
<thead>
<tr class="header">
<th align="left">Editor</th>
<th align="left">Features</th>
<th align="left">Ease of use</th>
<th align="left">Language support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Vim</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Good</td>
</tr>
<tr class="even">
<td align="left">Emacs</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Excellent</td>
</tr>
<tr class="odd">
<td align="left">VS code</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Very good</td>
</tr>
<tr class="even">
<td align="left">Atom</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Good</td>
</tr>
<tr class="odd">
<td align="left">Eclipse</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Good</td>
</tr>
<tr class="even">
<td align="left">Sublime Text</td>
<td align="left">Good</td>
<td align="left">Easy</td>
<td align="left">Good</td>
</tr>
<tr class="odd">
<td align="left">Notepad++</td>
<td align="left">OK</td>
<td align="left">Easy</td>
<td align="left">OK</td>
</tr>
<tr class="even">
<td align="left">Textmate</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Good</td>
</tr>
<tr class="odd">
<td align="left">Kate</td>
<td align="left">OK</td>
<td align="left">Easy</td>
<td align="left">Good</td>
</tr>
</tbody>
</table>
<p>GENERAL PURPOSE EDITOR DEMO</p>
</div>
</div>
<div id="literate-programming-notebooks" class="section level2">
<h2>Literate programming &amp; notebooks</h2>
<p>In one of the Early demos we say an example of embedding R code in a markdown document. A closely related approach is to create a <em>notebook</em> that includes the prose of the report, the code used for the analysis, and the results produced by that code.</p>
<div id="literate-programming" class="section level3">
<h3>Literate programming</h3>
<p>Literate programming is the practice of embedding computer code in a natural language document. For example, using <em>RMarkdown</em> we can embed R code in a report authored using Markdown. Python and Stata have their own versions of literate programming using Markdown.</p>
</div>
<div id="notebooks" class="section level3">
<h3>Notebooks</h3>
<p>Notebooks go one step farther, and include the output produced by the original program directly in the notebook. Examples include <em>Jupyter</em>, <em>Appache Zeppelin</em>, and <em>Emacs Org Mode</em>.</p>
<p>NOTEBOOKS DEMO</p>
</div>
</div>
<div id="big-data-annoying-data-computationally-intensive-methods" class="section level2">
<h2>Big data, annoying data, &amp; computationally intensive methods</h2>
<p>Thus far we’ve discussed popular programming languages, data storage and retrieval options, text editors, and reporting technology. These are the basic building blocks I recommend using just about any time you find yourself working with data. There are times however when more is needed. For example, you may wish to use distributed computing for large or resource intensive computations.</p>
<div id="computing-clusters-at-harvard" class="section level3">
<h3>Computing clusters at Harvard</h3>
<p>Harvard provides a number of computing clusters, including Odyssey and the Research Computing Environment. Using these systems will be much easier if you know the basic tools well. After all, you’re still going to need data storage/retrieval, you’ll still need a text editor write code, and a programming language to write it in. My advice is to master these basics, and learn the rest as you need it.</p>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2>Wrap up</h2>
<div id="feedback" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work-in-progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://dss.iq.harvard.edu/workshop-materials" class="uri">https://dss.iq.harvard.edu/workshop-materials</a></li>
<li>Data Science Services: <a href="https://dss.iq.harvard.edu/" class="uri">https://dss.iq.harvard.edu/</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
</div>



<div id="r-installation" class="section level1">
<h1>R Installation</h1>
<div class="alert alert-info">
<p><strong>Your professional conduct is greatly appreciated. Out of respect to your fellow workshop attendees and instructors, please arrive at your workshop on time, having pre-installed all necessary software and materials. This will likely take 15-20 minutes.</strong></p>
</div>
<p>Before starting any of our R workshops, it is necessary to complete 4 tasks. Please make sure all these tasks are completed <strong>before</strong> you attend your workshop, as, depending on your internet speed, they may take a long time.</p>
<ol style="list-style-type: decimal">
<li>download and unzip <strong>class materials</strong></li>
<li>download and install <strong>R</strong></li>
<li>download and install <strong>RStudio</strong></li>
<li>install the <code>tidyverse</code> suite of <strong>R packages</strong></li>
</ol>
<p><img src="R/Rinstall/images/install_software_R.png" /></p>
<div id="troubleshooting-session" class="section level2">
<h2>Troubleshooting session</h2>
<p>We will hold a troubleshooting session during the 20 minutes prior to the start of the workshop.
<strong>If you are unable to complete all of the tasks, please stop by the training room during this session.</strong>
Once the workshop starts we will <strong>NOT</strong> be able to give you one-to-one assistance with troubleshooting installation problems. Likewise, if you arrive late, please do <strong>NOT</strong> expect one-to-one assistance for anything covered at the beginning of the workshop.</p>
</div>
<div id="materials" class="section level2">
<h2>Materials</h2>
<p>Download class materials for your workshop:</p>
<ul>
<li>R Introduction: <a href="https://github.com/IQSS/dss-workshops/raw/master/R/Rintro.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/R/Rintro.zip</a></li>
<li>R Regression Models: <a href="https://github.com/IQSS/dss-workshops/raw/master/R/Rmodels.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/R/Rmodels.zip</a></li>
<li>R Graphics: <a href="https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/R/Rgraphics.zip</a></li>
<li>R Data Wrangling: <a href="https://github.com/IQSS/dss-workshops/raw/master/R/RDataWrangling.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/R/RDataWrangling.zip</a></li>
</ul>
<p>Extract materials from the zipped directory (Right-click -&gt; Extract All on Windows, double-click on Mac) and move them to your desktop.</p>
<p>It will be useful when you view the above materials for you to see the different file extensions on your computer. Here are instructions for enabling this:</p>
<ul>
<li><a href="https://support.apple.com/guide/mac-help/show-or-hide-filename-extensions-on-mac-mchlp2304/mac">Mac OS</a></li>
<li><a href="http://kb.winzip.com/kb/entry/26/">Windows OS</a></li>
</ul>
</div>
<div id="software" class="section level2">
<h2>Software</h2>
<p>You must install <strong>both R and RStudio</strong>; it is essential that you have these pre-installed so that we can start the workshop on time. It is also important that you have the <strong>latest versions</strong> of each software, which currently are:</p>
<ul>
<li>R version <strong>4.0.2</strong></li>
<li>RStudio version <strong>1.3.1073</strong></li>
</ul>
<p><strong>Mac OS X:</strong></p>
<ol style="list-style-type: decimal">
<li>Install R by downloading and running <a href="http://cran.r-project.org/bin/macosx/R-latest.pkg">this .pkg file</a> from <a href="http://cran.r-project.org/index.html">CRAN</a>.</li>
<li>Install the RStudio Desktop IDE by downloading and running <a href="https://download1.rstudio.org/desktop/macos/RStudio-1.3.1073.dmg">this .dmg file</a>.</li>
</ol>
<p><strong>Windows:</strong></p>
<ol style="list-style-type: decimal">
<li>Install R by downloading and running <a href="https://cran.r-project.org/bin/windows/base/release.htm">this .exe file</a> from <a href="http://cran.r-project.org/index.html">CRAN</a>.</li>
<li>Install the RStudio Desktop IDE by downloading and running <a href="https://download1.rstudio.org/desktop/windows/RStudio-1.3.1073.exe">this .exe file</a>.</li>
</ol>
<p><strong>Linux:</strong></p>
<ol style="list-style-type: decimal">
<li>Install R by downloading the binary files for your distribution from <a href="http://cran.r-project.org/index.html">CRAN</a>. Or you can use your package manager (e.g., for Debian/Ubuntu run <code>sudo apt-get install r-base</code> and for Fedora run <code>sudo yum install R</code>).</li>
<li>Install the RStudio Desktop IDE <a href="https://rstudio.com/products/rstudio/download/#download">for your distribution</a>.</li>
</ol>
<div class="alert alert-success">
<p><strong>Success? After both installations, please launch RStudio. If you were successful with the installations, you should see a window similar to this (note that the R version reported may be newer):</strong></p>
</div>
<p><img src="R/Rinstall/images/rstudio_successful_install.png" /></p>
<div class="alert alert-danger">
<p><strong>If you are having any difficulties with the installations or your RStudio screen does not look like this one, please stop by the training room 20 minutes prior to the start of the workshop.</strong></p>
</div>
</div>
<div id="installing-the-tidyverse" class="section level2">
<h2>Installing the <code>tidyverse</code></h2>
<p>We will use the <code>tidyverse</code> suite of packages throughout these R workshops.
Here are the steps for installation:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Launch an R session within RStudio</strong></p>
<p>On Windows, click the start button and search for RStudio then click on it. On Mac,
RStudio will be in your applications folder — double click on it.</p></li>
<li><p><strong>Install <code>tidyverse</code></strong></p>
<p>In the left-hand side window (called the <code>console</code>), at the command prompt (<code>&gt;</code>) type the following and press enter:</p>
<p><code>install.packages("tidyverse")</code></p>
<ul>
<li><p>If a choice appears that says something like:</p>
<p><code>Do you want to install from sources the package which needs compilation?</code></p>
<p>type <code>No</code> in the console.</p></li>
<li><p>If you are running Windows OS, you may see a message that says:</p>
<p><code>WARNING: Rtools is required to build R packages, but is not currently installed.</code></p>
<p>You can safely ignore this warning.</p></li>
</ul>
<p>A number of messages will scroll by, and there will be a long minute or two
pause where nothing appears to happen (but the installation is actually occurring).
At last, the output parade should end with a message like:</p>
<p><code>The downloaded source/binary packages are in....</code></p></li>
<li><p><strong>Check that installation was successful</strong></p>
<p>We can check that <code>tidyverse</code> has installed correctly by connecting it to our current R session.
Type the following in the console at the command prompt (<code>&gt;</code>) and press enter:</p>
<p><code>library(tidyverse)</code></p>
<div class="alert alert-success">
<p><strong>Success? If so, you should see the following message in the console (note that the version numbers reported may be newer):</strong></p>
</div>
<p><img src="R/Rinstall/images/tidyverse_install.png" /></p>
<div class="alert alert-danger">
<p><strong>If you do not see this message and encounter an error — try troubleshooting this in the next section.</strong></p>
</div></li>
</ol>
<div id="troubleshooting-tidyverse-installation" class="section level3">
<h3>Troubleshooting <code>tidyverse</code> installation</h3>
<p>Sometimes, you may run into problems installing the <code>tidyverse</code> suite of packages. Here are some commonly encountered errors and suggestions for how to fix them:</p>
<ol style="list-style-type: decimal">
<li><strong><code>tidyverse</code> is not available for R version…</strong>
<ul>
<li>Solution: make sure you have the latest versions of both R (4.0.2) and RStudio (1.3.1073).</li>
</ul></li>
<li><strong>there is no package <code>rlang</code>…</strong>
<ul>
<li>Solution: run this command in the console at the command prompt (<code>&gt;</code>):</li>
<li><code>install.packages("dplyr")</code></li>
<li>If a choice appears that says something like <code>Do you want to install from sources the package which needs compilation?</code>, type <code>No</code> in the console.</li>
</ul></li>
<li><strong>there is no package <code>broom</code>…</strong>
<ul>
<li>Solution: run these commands in the console at the command prompt (<code>&gt;</code>), <strong>in this order</strong>:</li>
<li><code>install.packages("backports")</code></li>
<li><code>install.packages("zeallot")</code></li>
<li><code>install.packages("broom")</code></li>
<li><code>install.packages("tidyverse")</code></li>
<li>If a choice appears at any point that says something like <code>Do you want to install from sources the package which needs compilation?</code>, type <code>No</code> in the console.</li>
</ul></li>
<li><strong>rlang and/or broom still do not work</strong>
<ul>
<li>Solution: load individual packages that we need from the <code>tidyverse</code> suite, by running the following commands in the console at the command prompt (<code>&gt;</code>):</li>
<li><code>library("dplyr")</code> for the pipe function <code>%&gt;%</code> and other SQL commands</li>
<li><code>library("ggplot2")</code> modern data visualization</li>
<li><code>library("readr")</code> to load CSV data files</li>
<li><code>library("tidyr")</code> to reshape data frames</li>
</ul></li>
</ol>
<div class="alert alert-danger">
<p><strong>If you have still not successfully installed <code>tidyverse</code> (or at least <code>dplyr</code>, <code>ggplot2</code>, <code>readr</code>, and <code>tidyr</code>) after troubleshooting, please stop by the training room 20 minutes before the start of your workshop so we can help you. Without these packages, you will not be able to follow along with the workshop materials.</strong></p>
</div>
</div>
</div>
<div id="installing-rmarkdown-optional" class="section level2">
<h2>Installing <code>rmarkdown</code> (optional)</h2>
<p>We can also install the <code>rmarkdown</code> package, which will allow us to
combine our text and code into a formatted document at the end of
the workshops. Installing this package is optional and will not affect
your ability to follow along with the workshop.</p>
<ol style="list-style-type: decimal">
<li><p><strong>Install <code>rmarkdown</code></strong></p>
<p>At the command prompt in the console (<code>&gt;</code>), please run the following command and press enter:</p>
<p><code>install.packages("rmarkdown")</code></p>
<p>then wait for the stream of messages to end with:</p>
<p><code>The downloaded source/binary packages are in....</code></p></li>
<li><p><strong>Check that installation was successful</strong></p>
<p>We can check that <code>rmarkdown</code> has installed correctly by connecting it to our R session.
Type the following in the console at the command prompt (<code>&gt;</code>) and press enter:</p>
<p><code>library(rmarkdown)</code></p>
<div class="alert alert-success">
<p><strong>Success? If so, in the console you should see just a command prompt (<code>&gt;</code>) with no messages to the right of it.</strong></p>
</div>
<div class="alert alert-danger">
<p><strong>If you see error or warning messages after the command prompt, the installation was not successful.</strong></p>
</div></li>
</ol>
<p>If all the above steps have been completed successfully, you should now
be ready to start your workshop. <strong>If you ran into any problems, please
stop by the training room 20 minutes before the start of your workshop.</strong></p>
</div>
<div id="resources-1" class="section level2">
<h2>Resources</h2>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
<div id="r-introduction" class="section level1">
<h1>R Introduction</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Objects</li>
<li>Assignment</li>
<li>Functions</li>
<li>Finding help</li>
<li>Importing packages</li>
<li>Basic data manipulation</li>
<li>Operations within groups of data</li>
<li>Saving data</li>
</ul>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./Rinstall.html">R Installation</a> instructions and ensure that you can successfully start RStudio.</p>
<p>A handy <a href="R/Rintro/base-r-cheat-sheet.pdf">base R cheat-sheet</a> is available to help you look up and remember basic syntax.
In addition, a <a href="R/Rintro/data-transformation-cheat-sheet.pdf">data transformation cheat-sheet</a> provides a convenient summary of data manipulation syntax.</p>
</div>
<div id="class-structure" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites" class="section level3">
<h3>Prerequisites</h3>
<p>This is an introductory R course:</p>
<ul>
<li>Assumes no prior knowledge of <strong>how to use</strong> R</li>
<li>We do assume you know <strong>why</strong> you want to learn R. If you don’t, and want a comparison of R to other statistical software, see our <a href="./DataScienceTools.html">Data Science Tools</a> workshop</li>
<li>Relatively slow-paced</li>
</ul>
</div>
<div id="goals" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the R language by analyzing a dataset of baby names.
In particular, our goals are to learn about:</p>
<ol style="list-style-type: decimal">
<li>What R is and how it works</li>
<li>How we can interact with R</li>
<li>Foundations of the language (objects, assignment, functions)</li>
<li>The <code>tidyverse</code> package ecosystem for data science</li>
<li>Basic data manipulation useful for cleaning datasets</li>
<li>Working with grouped data</li>
<li>Aggregating data to create summaries</li>
<li>Saving objects, data, and scripts</li>
</ol>
<p>This workshop will not cover how to iterate over collections of data, create
your own functions, produce publication quality graphics, or fit models to data.
These topics are covered in our <a href="./RDataWrangling.html">R Data Wrangling</a>,
<a href="./Rgraphics.html">R Graphics</a>, and <a href="./Rmodels.html">R Regression Models</a> workshops.</p>
</div>
</div>
</div>
<div id="r-basics" class="section level2">
<h2>R basics</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the foundations of the R language.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>What R is and how it works</li>
<li>R interfaces</li>
<li>Objects</li>
<li>Assignment</li>
<li>Functions</li>
<li>Getting help</li>
<li><code>tidyverse</code> package ecosystem for data science</li>
</ol>
</div>
<div id="what-is-r" class="section level3">
<h3>What is R?</h3>
<ul>
<li>R is a free language and environment for statistical computing and graphics</li>
<li>R is an interpreted language, not a compiled one, meaning that all commands
typed on the keyboard are directly executed without requiring to build a complete
program (this is like Python and unlike C, Fortran, Pascal, etc.)</li>
<li>R has existed for over 25 years</li>
<li>R is modular — most functionality is from add-on packages. So the language can
be thought of as a <em>platform</em> for creating and running a large number of useful packages.</li>
</ul>
</div>
<div id="why-use-r" class="section level3">
<h3>Why use R?</h3>
<ul>
<li>The most popular software for data analysis</li>
<li>Extremely flexible: can be used to manipulate, analyze, and visualize
any kind of data</li>
<li>Cutting edge statistical tools</li>
<li>Publication quality graphics</li>
<li>16,000+ add on packages covering all aspects of statistics and machine learning</li>
<li>Active community of users</li>
</ul>
</div>
<div id="how-does-r-work" class="section level3">
<h3>How does R work?</h3>
<p>While graphical-based statistical software (e.g., SPSS, GraphPad) immediately display
the results of an analysis, <strong>R stores results in an <code>object</code> (a data structure)</strong>,
so that an analysis can be done with no result displayed. Such a feature is very
useful, since a user can extract only that part of the results that is of interest
and can pass results into further analyses.</p>
<p>For example, if you run a series of 20 regressions and want to compare the
different regression coefficients, R can display only the estimated coefficients:
thus the results may take a single line, whereas graphical-based software could
open 20 results windows. In addition, these regression coefficients can be passed
directly into further analyses — such as generating predictions.</p>
<p><img src="R/Rintro/images/R_chain.png" /></p>
<p>When R is running, variables, data, functions, results, etc., are <strong>stored in memory</strong>
on the computer in the form of <code>objects</code> that have a name. The user can
<strong>perform actions</strong> on these objects with <code>operators</code> (arithmetic, logical,
comparison, etc.) and <code>functions</code> (which are themselves objects). Here’s a
schematic of how this all fits together:</p>
<p><img src="R/Rintro/images/R_works.png" /></p>
</div>
<div id="interfaces" class="section level3">
<h3>Interfaces</h3>
<div id="text-editors-ides-notebooks" class="section level4">
<h4>Text editors, IDEs, &amp; Notebooks</h4>
<p>There are different ways of interacting with R. The two main ways are through:</p>
<ol style="list-style-type: decimal">
<li><p><strong>text editors</strong> or <strong>Integrated Development Environments (IDEs):</strong> Text editors and IDEs are not really separate categories; as you add features to a text editor it becomes more like an IDE. Some editors/IDEs are language-specific while others are general purpose — typically providing language support via plugins. For these workshops we will use <a href="https://rstudio.com/">RStudio</a>; it is a good R-specific IDE with many useful features. Here are a few popular editors/IDEs that can be used with R:</p>
<table>
<thead>
<tr class="header">
<th align="left">Editor / IDE</th>
<th align="left">Features</th>
<th align="left">Ease of use</th>
<th align="left">Language support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">RStudio</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">R only</td>
</tr>
<tr class="even">
<td align="left">Jupyter Lab</td>
<td align="left">Good</td>
<td align="left">Easy</td>
<td align="left">Excellent</td>
</tr>
<tr class="odd">
<td align="left">VS code</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Very good</td>
</tr>
<tr class="even">
<td align="left">Atom</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Good</td>
</tr>
<tr class="odd">
<td align="left">Vim</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Good</td>
</tr>
<tr class="even">
<td align="left">Emacs</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Excellent</td>
</tr>
</tbody>
</table></li>
<li><p><strong>Notebooks:</strong> Web-based applications that allow you to create and share documents that contain live code, equations, visualizations, and narrative text. A popular notebook is the open source <a href="https://jupyter.org/">Jupyter Notebook</a> that has support for 40+ languages.</p></li>
</ol>
</div>
<div id="source-code-literate-programming" class="section level4">
<h4>Source code &amp; literate programming</h4>
<p>There are also several different <strong>formats</strong> available for writing code in R.
These basically boil down to a choice between:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Source code:</strong> the practice of writing code, and possibly comments, in a plain text document. In R this is done by writing code in a text file with a <code>.R</code> or <code>.r</code> extension. Writing source code has the great advantage of being simple. Source code is the format of choice if you intend to run your code as a complete script - for example, from the command line.</p></li>
<li><p><strong>Literate programming:</strong> the practice of embedding computer code in a natural language document. In R this is often done using <a href="https://rmarkdown.rstudio.com/"><strong>Rmarkdown</strong></a>, which involves embedding R code in a document that is authored using <em>Markdown</em> and which has a <code>.Rmd</code> extension. <em>Markdown</em> is easy to write and designed to be human-readable. Markdown is the format of choice if you intend to run your code interactively, by running small pieces of code and looking at each output. Many researchers use Markdown to write their journal papers, dissertations, and statistics/math class notes, since it is easy to convert into other formats later, such as HTML (for a webpage), MS Word, or PDF (via LaTeX).</p></li>
</ol>
<p>Here are some resources for learning more about RStudio and RMarkdown:</p>
<ul>
<li><a href="https://rmarkdown.rstudio.com/authoring_quick_tour.html" class="uri">https://rmarkdown.rstudio.com/authoring_quick_tour.html</a></li>
<li><a href="https://cran.r-project.org/web/packages/rmarkdown/vignettes/rmarkdown.html" class="uri">https://cran.r-project.org/web/packages/rmarkdown/vignettes/rmarkdown.html</a></li>
<li><a href="https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf" class="uri">https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf</a></li>
</ul>
</div>
</div>
<div id="launch-a-session" class="section level3">
<h3>Launch a session</h3>
<p>Start RStudio and create a new project:</p>
<ul>
<li>On Windows click the start button and search for RStudio. On Mac
RStudio will be in your applications folder.</li>
<li>In RStudio go to <code>File -&gt; New Project</code>.</li>
<li>Choose <code>Existing Directory</code> and browse to the workshop materials directory on your desktop.</li>
<li>Choose <code>File -&gt; Open File</code> and select the file with the word “BLANK” in the name.</li>
</ul>
</div>
<div id="exercise-0" class="section level3">
<h3>Exercise 0</h3>
<p>The purpose of this exercise is to give you an opportunity to explore
the interface provided by RStudio. You may not know how to do these things;
that’s fine! This is an opportunity to figure it out.</p>
<p>Also keep in mind that we are living in a golden age of tab completion.
If you don’t know the name of an R function, try guessing the first two
or three letters and pressing TAB. If you guessed correctly the function
you are looking for should appear in a pop up!</p>
<ol style="list-style-type: decimal">
<li><p>Try to get R to add 2 plus 2.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Try to calculate the square root of 10.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>R includes extensive documentation, including a manual named “An
introduction to R”. Use the RStudio help pane to locate this manual.</p></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>2 plus 2</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># or</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="kw">sum</span>(<span class="dv">2</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4</code></pre></li>
<li><p>square root of 10</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">sqrt</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 3.162278</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># or</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="dv">10</span><span class="op">^</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3.162278</code></pre></li>
<li><p>Find “An Introduction to R”.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Go to the main help page by running &#39;help.start() or using the GUI</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># menu, find and click on the link to &quot;An Introduction to R&quot;.</span></span></code></pre></div></li>
</ol>
</div>
</details>
</div>
<div id="syntax-rules" class="section level3">
<h3>Syntax rules</h3>
<ul>
<li>R is case sensitive</li>
<li>R ignores white space</li>
<li>Variable names should start with a letter (A-Z and a-z)
and can include letters, digits (0-9), dots (.), and underscores (_)</li>
<li>Comments can be inserted using a hash <code>#</code> symbol</li>
<li>Functions must be written with parentheses, even
if there is nothing within them; for example: <code>ls()</code></li>
</ul>
</div>
<div id="function-calls" class="section level3">
<h3>Function calls</h3>
<p><strong>Functions perform actions</strong> — they take some input, called <code>arguments</code> and return some
output (i.e., a result). Here’s a schematic of how a function works:</p>
<p><img src="R/Rintro/images/function.png" /></p>
<p>The general form for calling R functions is</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># FunctionName(arg.1 = value.1, arg.2 = value.2, ..., arg.n = value.n)</span></span></code></pre></div>
<p>The arguments in a function can be objects (data, formulae, expressions, etc.),
some of which could be defined by default in the function; these default values may
be modified by the user by specifying options.</p>
<p>Arguments can be <strong>matched by name</strong>; unnamed arguments will be <strong>matched by position</strong>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">round</span>(<span class="dt">x =</span> <span class="fl">2.34</span>, <span class="dt">digits =</span> <span class="dv">1</span>) <span class="co"># match by name</span></span></code></pre></div>
<pre><code>## [1] 2.3</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="kw">round</span>(<span class="fl">2.34</span>, <span class="dv">1</span>) <span class="co"># match by position</span></span></code></pre></div>
<pre><code>## [1] 2.3</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="kw">round</span>(<span class="dv">1</span>, <span class="fl">2.34</span>) <span class="co"># be careful when matching by position!</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">round</span>(<span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">x =</span> <span class="fl">2.34</span>) <span class="co"># matching by name is safer!</span></span></code></pre></div>
<pre><code>## [1] 2.3</code></pre>
</div>
<div id="assignment" class="section level3">
<h3>Assignment</h3>
<p>Objects (data structures) can be assigned names and used in subsequent operations:</p>
<ul>
<li>The <strong>gets</strong> <code>&lt;-</code> operator (less than followed by a dash) is used to save objects</li>
<li>The name on the left <strong>gets</strong> the object on the right</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw">sqrt</span>(<span class="dv">10</span>) <span class="co"># calculate square root of 10; result is not stored anywhere</span></span></code></pre></div>
<pre><code>## [1] 3.162278</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">10</span>) <span class="co"># assign result to a variable named x</span></span></code></pre></div>
<p>As mentioned in <strong>Syntax rules</strong> above, names should start with a letter, and contain only letters, numbers, underscores, and periods.</p>
</div>
<div id="asking-for-help" class="section level3">
<h3>Asking for help</h3>
<ol style="list-style-type: decimal">
<li><p>You can ask R for help using the <code>help</code> function, or the <code>?</code> shortcut.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">help</span>(help)</span>
<span id="cb48-2"><a href="#cb48-2"></a>?help</span>
<span id="cb48-3"><a href="#cb48-3"></a>?sqrt</span></code></pre></div>
<p>The <code>help</code> function can be used to look up the documentation for a function, or
to look up the documentation to a package. We can learn how to use the <code>stats</code>
package by reading its documentation like this:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">help</span>(<span class="dt">package =</span> <span class="st">&quot;stats&quot;</span>)</span></code></pre></div></li>
<li><p>If you know the name of the package you want to use, then Googling “R <em>package-name</em>” will
often get you to the documentation. Packages are hosted on several different repositories, including:</p>
<ul>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html" class="uri">https://cran.r-project.org/web/packages/available_packages_by_name.html</a></li>
<li>Bioconductor: <a href="https://www.bioconductor.org/packages/release/bioc/" class="uri">https://www.bioconductor.org/packages/release/bioc/</a></li>
<li>Github: <a href="http://rpkg.gepuro.net/" class="uri">http://rpkg.gepuro.net/</a></li>
<li>R-Forge: <a href="https://r-forge.r-project.org/R/?group_id=1326" class="uri">https://r-forge.r-project.org/R/?group_id=1326</a></li>
</ul></li>
<li><p>If you know the type of analysis you want to perform, you can Google “CRAN Task Views”,
where there are curated lists of packages <a href="https://cran.r-project.org/web/views/" class="uri">https://cran.r-project.org/web/views/</a>. If you want to
know which packages are popular, you can look at <a href="https://r-pkg.org" class="uri">https://r-pkg.org</a>.</p></li>
</ol>
</div>
<div id="reading-data" class="section level3">
<h3>Reading data</h3>
<p>R has data reading functionality built-in – see e.g.,
<code>help(read.table)</code>. However, faster and more robust tools are
available, and so to make things easier on ourselves we will use a
<em>contributed package</em> instead. This requires that we
learn a little bit about packages in R.</p>
</div>
<div id="installing-using-packages" class="section level3">
<h3>Installing &amp; using packages</h3>
<p>R is a modular environment that is extended by the use of <strong>packages</strong>.
Packages are collections of functions or commands that are designed to
perform specific tasks (e.g., fit a type of regression model). A large
number of contributed packages are available (&gt; 16,000).</p>
<p>Using an R package is a <strong>two step process</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Install the package onto your computer using the
<code>install.packages()</code> function. This only needs to
be done the <strong>first time</strong> you use the package.</p></li>
<li><p>Load the package into your R session’s search path
using the <code>library()</code> function. This needs to be done
<strong>each time</strong> you use the package.</p></li>
</ol>
</div>
<div id="the-tidyverse" class="section level3">
<h3>The <code>tidyverse</code></h3>
<p>While R’s built-in packages are powerful, in recent years there has
been a big surge in well-designed <em>contributed packages</em> for R. In
particular, a collection of R packages called
<a href="https://www.tidyverse.org/"><code>tidyverse</code></a> have been
designed specifically for data science. All packages included in
<code>tidyverse</code> share an underlying design philosophy, grammar, and
data structures. This philosophy is rooted in the idea of “tidy data”:</p>
<p><img src="R/Rintro/images/tidy_data.png" /></p>
<p>A typical workflow for using <code>tidyverse</code> packages looks like this:</p>
<p><img src="R/Rintro/images/tidy_workflow.png" /></p>
<p>You should have already installed the <code>tidyverse</code> and <code>rmarkdown</code>
packages onto your computer before the workshop
— see <a href="./Rinstall.html">R Installation</a>.
Now let’s load these packages into the search path of our R session.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Load packages tidyverse and rmarkdown using library() function</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="kw">library</span>(rmarkdown)</span></code></pre></div>
</div>
<div id="readers-for-common-file-types" class="section level3">
<h3>Readers for common file types</h3>
<p>To read data from a file, you have to know what kind of file
it is. The table below lists functions from the <code>readr</code> package, which
is part of <code>tidyverse</code>, that can import data from common plain-text formats.</p>
<table>
<thead>
<tr class="header">
<th align="left">Data Type</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">comma separated</td>
<td align="left"><code>read_csv()</code></td>
</tr>
<tr class="even">
<td align="left">tab separated</td>
<td align="left"><code>read_delim()</code></td>
</tr>
<tr class="odd">
<td align="left">other delimited formats</td>
<td align="left"><code>read_table()</code></td>
</tr>
<tr class="even">
<td align="left">fixed width</td>
<td align="left"><code>read_fwf()</code></td>
</tr>
</tbody>
</table>
<p><strong>Note</strong> You may notice that there exist similar functions
in one of the built-in packages in R called <code>utils</code>,
e.g., <code>read.csv</code> and <code>read.delim</code>. These are legacy functions that
tend to be slower and less robust than the <code>readr</code> functions. One way
to tell them apart is that the faster more robust versions use
underscores in their names (e.g., <code>read_csv</code>) while the older
functions use dots (e.g., <code>read.csv</code>). Our advice is to use the more
robust newer versions, i.e., the ones with underscores.</p>
</div>
<div id="baby-names-data" class="section level3">
<h3>Baby names data</h3>
<p>As an example project we will analyze the popularity of baby names in the US from 1960 through 2017. The data were retrieved from
<a href="https://catalog.data.gov/dataset/baby-names-from-social-security-card-applications-national-level-data" class="uri">https://catalog.data.gov/dataset/baby-names-from-social-security-card-applications-national-level-data</a>.</p>
<p>Here are the questions we will use R to answer:</p>
<ol style="list-style-type: decimal">
<li>In which year did your name (or another name) occur most frequently by <strong>count</strong>?</li>
<li>Which names have the highest popularity by <strong>proportion</strong> for each sex and year?</li>
<li>How does the percentage of babies given one of the top 10 names of the year change over time?</li>
</ol>
</div>
<div id="exercise-1" class="section level3">
<h3>Exercise 1</h3>
<p><strong>Reading the baby names data</strong></p>
<p>Make sure you have installed the <code>tidyverse</code> suite of packages and attached them with <code>library(tidyverse)</code>.</p>
<ol style="list-style-type: decimal">
<li><p>Open the <code>read_csv()</code> help page to determine how to use it to read in data.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Read the baby names data using the <code>read_csv()</code> function and assign the result
with the name <code>baby_names</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>BONUS (optional): Save the <code>baby_names</code> data as a Stata data set <code>babynames.dta</code>
and as an R data set <code>babynames.rds</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co">##</span></span></code></pre></div></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>Open the <code>read_csv()</code> help page to determine how to use it to read in data.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>?read_csv</span></code></pre></div></li>
<li><p>Read the baby names data using the <code>read_csv()</code> function and assign the result with the name <code>baby_names</code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>baby_names &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;babyNames.csv&quot;</span>)</span></code></pre></div></li>
<li><p>BONUS (optional): Save the <code>baby_names</code> data as a Stata data set <code>babynames.dta</code> and as an R data set <code>babynames.rds</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">write_dta</span>(baby_names, <span class="dt">version =</span> <span class="dv">15</span>, <span class="dt">path =</span> “babynames.dta”)</span>
<span id="cb56-2"><a href="#cb56-2"></a></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="kw">write_rds</span>(baby_names, <span class="dt">file =</span> “babynames.rds”)</span></code></pre></div></li>
</ol>
</div>
</details>
</div>
</div>
<div id="manipulating-data" class="section level2">
<h2>Manipulating data</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about basic data manipulation used to clean datasets.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Filtering data by choosing rows — using the <code>filter()</code> function</li>
<li>Selecting data by choosing columns — using the <code>select()</code> function</li>
<li>Arranging data by reordering rows — using the <code>arrange()</code> function</li>
<li>Using the pipe <code>%&gt;%</code> operator to simplify sequential operations</li>
</ol>
</div>
<p>In this section we will pull out specific names from the baby names data and
examine changes in their popularity over time.</p>
<p>The <code>baby_names</code> object we created in the last exercise is a <code>data.frame</code>.
There are many other data structures in R, but for now we’ll focus on
working with <code>data.frames</code>. Think of a <code>data.frame</code> as a spreadsheet.
If you want to know more about R data structures, you can see a summary
in our <a href="./RDataWrangling.html#data-types-and-structures">R Data Wrangling</a> workshop.</p>
<p>R has decent data manipulation tools built-in – see e.g.,
<code>help(Extract)</code>. But, <code>tidyverse</code> packages often provide
more intuitive syntax for accomplishing the same task. In
particular, we will use the <code>dplyr</code> package from <code>tidyverse</code>
to filter, select, and arrange data, as well as create new variables.</p>
<p><img src="R/Rintro/images/dplyr.png" /></p>
<div id="filter-select-arrange" class="section level3">
<h3>Filter, select, &amp; arrange</h3>
<p>One way to find the year in which your name was the most popular
is to filter out just the rows corresponding to your name, and
then arrange (sort) by <code>Count</code>.</p>
<p>To demonstrate these techniques we’ll try to determine whether
“Alex”" or “Mark” was more popular in 1992. We start by filtering the
data so that we keep only rows where Year is equal to <code>1992</code> and Name is
either “Alex” or “Mark”.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Read in the baby names data if you haven&#39;t already</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>baby_names &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;babyNames.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># Filter data, keeping &quot;Alex&quot; and &quot;Mark&quot; in year 1992, record in baby_names_alexmark</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="co"># Use logical operators to specify the filtering condition</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>baby_names_alexmark &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names, </span>
<span id="cb58-4"><a href="#cb58-4"></a>             Year <span class="op">==</span><span class="st"> </span><span class="dv">1992</span> <span class="op">&amp;</span><span class="st"> </span>(Name <span class="op">==</span><span class="st"> &quot;Alex&quot;</span> <span class="op">|</span><span class="st"> </span>Name <span class="op">==</span><span class="st"> &quot;Mark&quot;</span>))</span>
<span id="cb58-5"><a href="#cb58-5"></a></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="kw">print</span>(baby_names_alexmark) <span class="co"># explicit printing</span></span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Alex  Girls   366  1992
## 2 Mark  Girls    20  1992
## 3 Mark  Boys   8743  1992
## 4 Alex  Boys   7348  1992</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>baby_names_alexmark <span class="co"># implicit printing</span></span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Alex  Girls   366  1992
## 2 Mark  Girls    20  1992
## 3 Mark  Boys   8743  1992
## 4 Alex  Boys   7348  1992</code></pre>
<p>Notice that we can combine conditions using <code>&amp;</code> (AND)
and <code>|</code> (OR).</p>
<p>In this case it’s pretty easy to see that “Mark” is more popular,
but to make it even easier we can arrange the data so that the
most popular name is listed first.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># Arrange the data by Count to see the most popular name first</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="kw">arrange</span>(baby_names_alexmark, Count)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mark  Girls    20  1992
## 2 Alex  Girls   366  1992
## 3 Alex  Boys   7348  1992
## 4 Mark  Boys   8743  1992</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># Arrange the data in descending order instead</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="kw">arrange</span>(baby_names_alexmark, <span class="kw">desc</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mark  Boys   8743  1992
## 2 Alex  Boys   7348  1992
## 3 Alex  Girls   366  1992
## 4 Mark  Girls    20  1992</code></pre>
<p>We can also use the <code>select()</code> function to subset the <code>data.frame</code>
by columns. We can then assign the output to a new object. If we
would just like to glance at the first few lines we can use the
<code>head()</code> function:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># Select columns Name and Count and assign to a new object &quot;baby_names_subset&quot;</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>baby_names_subset &lt;-<span class="st"> </span><span class="kw">select</span>(baby_names, Name, Count)</span>
<span id="cb66-3"><a href="#cb66-3"></a></span>
<span id="cb66-4"><a href="#cb66-4"></a><span class="co"># Use head() to glance at the first few lines</span></span>
<span id="cb66-5"><a href="#cb66-5"></a><span class="kw">head</span>(baby_names_subset)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Name  Count
##   &lt;chr&gt; &lt;dbl&gt;
## 1 Mary  51474
## 2 Susan 39200
## 3 Linda 37314
## 4 Karen 36376
## 5 Donna 34133
## 6 Lisa  33702</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="kw">head</span>(baby_names_subset, <span class="dt">n =</span> <span class="dv">6</span>) <span class="co"># default is n = 6</span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   Name  Count
##   &lt;chr&gt; &lt;dbl&gt;
## 1 Mary  51474
## 2 Susan 39200
## 3 Linda 37314
## 4 Karen 36376
## 5 Donna 34133
## 6 Lisa  33702</code></pre>
</div>
<div id="logical-relational-operators" class="section level3">
<h3>Logical &amp; relational operators</h3>
<p>In a previous example we used <code>==</code> to filter rows.
Here’s a table of other commonly used relational operators:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>==</code></td>
<td align="left">equal to</td>
</tr>
<tr class="even">
<td align="left"><code>!=</code></td>
<td align="left">not equal to</td>
</tr>
<tr class="odd">
<td align="left"><code>&gt;</code></td>
<td align="left">greater than</td>
</tr>
<tr class="even">
<td align="left"><code>&gt;=</code></td>
<td align="left">greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left"><code>&lt;</code></td>
<td align="left">less than</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;=</code></td>
<td align="left">less than or equal to</td>
</tr>
<tr class="odd">
<td align="left"><code>%in%</code></td>
<td align="left">contained in</td>
</tr>
</tbody>
</table>
<p>These relational operators may be combined with logical operators, such as <code>&amp;</code> (and) or <code>|</code> (or).
For example, we can create a <strong>vector</strong> (a <strong>container for a collection of values</strong>) and demonstrate
some ways to combine operators:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Create a vector of consecutive values between 1 and 10</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="co"># a vector</span></span>
<span id="cb70-3"><a href="#cb70-3"></a>x</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Which elements of x are above 7</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">7</span> <span class="co"># a simple condition</span></span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Which elements of x are above 7 or below 3</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">7</span> <span class="op">|</span><span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="co"># two conditions combined</span></span></code></pre></div>
<pre><code>##  [1]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>If we want to match multiple elements from two vectors we can use the <code>%in%</code> operator:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># x %in% vector</span></span>
<span id="cb76-2"><a href="#cb76-2"></a><span class="co"># elements of x matching numbers 1, 5, or 10 </span></span>
<span id="cb76-3"><a href="#cb76-3"></a>x <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>) </span></code></pre></div>
<pre><code>##  [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE</code></pre>
<p>Notice that logical and relational operators return <strong>logical vectors</strong> of <code>TRUE</code> and <code>FALSE</code> values.
The logical vectors returned by these operators can themselves be operated on by functions:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co"># Count the number of elements of x above 7</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">7</span></span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="kw">sum</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="exercise-2.1" class="section level3">
<h3>Exercise 2.1</h3>
<p><strong>Peak popularity of your name</strong></p>
<p>In this exercise you will discover the year your name reached its maximum popularity.</p>
<p>Read in the “babyNames.csv” file if you have not already done so,
assigning the result to <code>baby_names</code>. Make sure you have installed
the <code>tidyverse</code> suite of packages and attached them with <code>library(tidyverse)</code>.</p>
<ol style="list-style-type: decimal">
<li><p>Use <code>filter</code> to extract data for your name (or another name of your choice).</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Arrange the data you produced in step 1 above by <code>Count</code>.
In which year was the name most popular?</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>BONUS (optional): Filter the data to extract <em>only</em> the
row containing the most popular boys name in 1999.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co">##</span></span></code></pre></div></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 2.1 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>Use <code>filter</code> to extract data for your name (or another name of your choice).</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>baby_names_george &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names, Name <span class="op">==</span><span class="st"> &quot;George&quot;</span>)</span></code></pre></div></li>
<li><p>Arrange the data you produced in step 1 above by <code>Count</code>. In which year was the name most popular?</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="kw">arrange</span>(baby_names_george, <span class="kw">desc</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 97 x 4
##    Name   Sex   Count  Year
##    &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 George Boys  14063  1960
##  2 George Boys  13638  1961
##  3 George Boys  12553  1962
##  4 George Boys  12084  1963
##  5 George Boys  11793  1964
##  6 George Boys  10683  1965
##  7 George Boys   9942  1966
##  8 George Boys   9702  1967
##  9 George Boys   9388  1968
## 10 George Boys   9203  1969
## # … with 87 more rows</code></pre></li>
<li><p>BONUS (optional): Filter the data to extract <em>only</em> the row containing the most popular boys name in 1999.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>baby_names_boys_<span class="dv">1999</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names,</span>
<span id="cb88-2"><a href="#cb88-2"></a>                               Year <span class="op">==</span><span class="st"> </span><span class="dv">1999</span> <span class="op">&amp;</span><span class="st"> </span>Sex <span class="op">==</span><span class="st"> &quot;Boys&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="kw">filter</span>(baby_names_boys_<span class="dv">1999</span>, Count <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Jacob Boys  35361  1999</code></pre></li>
</ol>
</div>
</details>
</div>
<div id="pipe-operator" class="section level3">
<h3>Pipe operator</h3>
<p>There is one very special operator in R called a <strong>pipe</strong> operator that
looks like this: <code>%&gt;%</code>. It allows us to “chain” several function calls and,
as each function returns an object, feed it into the next call in a single
statement, without needing extra variables to store the intermediate
results. The point of the pipe is to help you write code in a way that is
easier to read and understand as we will see below.</p>
<p><img src="R/Rintro/images/magrittr.png" /></p>
<p>There is no need to load any additional packages as the operator is made
available via the <code>magrittr</code> package installed as part of <code>tidyverse</code>. Let’s
rewrite the sequence of commands to output ordered counts for names
“Alex” or “Mark”.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Filter data keeping rows for &quot;Alex&quot; and &quot;Mark&quot; during year 1992, record in baby_names_alexmark</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="co"># Arrange the result in a descending order by Count</span></span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="co"># unpiped version</span></span>
<span id="cb91-4"><a href="#cb91-4"></a>baby_names_alexmark &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names, Year <span class="op">==</span><span class="st"> </span><span class="dv">1992</span> <span class="op">&amp;</span><span class="st"> </span>(Name <span class="op">==</span><span class="st"> &quot;Alex&quot;</span> <span class="op">|</span><span class="st"> </span>Name <span class="op">==</span><span class="st"> &quot;Mark&quot;</span>))</span>
<span id="cb91-5"><a href="#cb91-5"></a><span class="kw">arrange</span>(baby_names_alexmark, <span class="kw">desc</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mark  Boys   8743  1992
## 2 Alex  Boys   7348  1992
## 3 Alex  Girls   366  1992
## 4 Mark  Girls    20  1992</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># piped version</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>baby_names <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-3"><a href="#cb93-3"></a><span class="st">  </span><span class="kw">filter</span>(Year <span class="op">==</span><span class="st"> </span><span class="dv">1992</span> <span class="op">&amp;</span><span class="st"> </span>(Name <span class="op">==</span><span class="st"> &quot;Alex&quot;</span> <span class="op">|</span><span class="st"> </span>Name <span class="op">==</span><span class="st"> &quot;Mark&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb93-4"><a href="#cb93-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   Name  Sex   Count  Year
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Mark  Boys   8743  1992
## 2 Alex  Boys   7348  1992
## 3 Alex  Girls   366  1992
## 4 Mark  Girls    20  1992</code></pre>
<p>Hint: try pronouncing “then” whenever you see <code>%&gt;%</code>. Using pseudocode,
we can see what the pipe is doing:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># unpiped version</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="kw">filter</span>(dataset, condition)</span>
<span id="cb95-3"><a href="#cb95-3"></a></span>
<span id="cb95-4"><a href="#cb95-4"></a><span class="co"># piped version</span></span>
<span id="cb95-5"><a href="#cb95-5"></a>dataset <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(condition)</span>
<span id="cb95-6"><a href="#cb95-6"></a></span>
<span id="cb95-7"><a href="#cb95-7"></a><span class="co"># what the pipe is doing</span></span>
<span id="cb95-8"><a href="#cb95-8"></a>output_of_thing_on_left <span class="op">%&gt;%</span><span class="st"> </span>becomes_input_of_thing_on_right</span></code></pre></div>
<p>Advantages of using the pipe:</p>
<ol style="list-style-type: decimal">
<li>We can avoid creating intermediate variables, such as <code>baby_names_alexmark</code></li>
<li>Less to type</li>
<li>Easier to read and follow the logic (especially avoiding using nested functions)</li>
</ol>
</div>
<div id="exercise-2.2" class="section level3">
<h3>Exercise 2.2</h3>
<p>Rewrite the solution to Exercise 2.1 using pipes. Remember that we were looking
for the year your name reached its maximum popularity. For that, we filtered
the data and then arranged by <code>Count</code>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="co"># Use filter to extract data for your name (or another name of your choice)</span></span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="co"># Arrange the data by Count</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2.2 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Rewrite the solution to Exercise 2.1 using pipes.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Use filter to extract data for your name (or another name of your choice)</span></span>
<span id="cb97-2"><a href="#cb97-2"></a><span class="co"># Arrange the data by Count</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>baby_names <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb97-4"><a href="#cb97-4"></a><span class="st">    </span><span class="kw">filter</span>(Name <span class="op">==</span><span class="st"> &quot;George&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-5"><a href="#cb97-5"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Count))</span></code></pre></div>
<pre><code>## # A tibble: 97 x 4
##    Name   Sex   Count  Year
##    &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 George Boys  14063  1960
##  2 George Boys  13638  1961
##  3 George Boys  12553  1962
##  4 George Boys  12084  1963
##  5 George Boys  11793  1964
##  6 George Boys  10683  1965
##  7 George Boys   9942  1966
##  8 George Boys   9702  1967
##  9 George Boys   9388  1968
## 10 George Boys   9203  1969
## # … with 87 more rows</code></pre>
</div>
</details>
</div>
</div>
<div id="plotting-data" class="section level2">
<h2>Plotting data</h2>
<div class="alert alert-info">
<p><strong>GOAL: Plot baby name trends over time – using the <code>qplot()</code> function</strong></p>
</div>
<p>It can be difficult to spot trends when looking at summary tables.
Plotting the data makes it easier to identify interesting patterns.</p>
<p>R has decent plotting tools built-in – see e.g., <code>help(plot)</code>.
However, again, we will make use of a <em>contributed
package</em> from <code>tidyverse</code> called <code>ggplot2</code>.</p>
<p>For quick and simple plots we can use the <code>qplot()</code> function from <code>ggplot2</code>. For example,
we can plot the number of babies given the name “Diana” over time like this:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Filter data keeping rows for name &quot;Diana&quot; and assign to a new object called baby_names_diana</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>baby_names_diana &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names, Name <span class="op">==</span><span class="st"> &quot;Diana&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># Use qplot() function to plot Counts (y) by Year (x)</span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count,</span>
<span id="cb100-3"><a href="#cb100-3"></a>     <span class="dt">data =</span> baby_names_diana)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-42-1.png" width="672" /></p>
<p>Interestingly, there are usually some gender-atypical names, even for very strongly
gendered names like “Diana”. Splitting these trends out by <code>Sex</code> is very easy:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Use qplot() function to plot Counts (y) by Year (x). Split trends by Sex using color.</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count, <span class="dt">color =</span> Sex,</span>
<span id="cb101-3"><a href="#cb101-3"></a>      <span class="dt">data =</span> baby_names_diana)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-43-1.png" width="672" /></p>
<div id="exercise-3" class="section level3">
<h3>Exercise 3</h3>
<p><strong>Plot peak popularity of your name</strong></p>
<ol style="list-style-type: decimal">
<li><p>Use <code>filter</code> to extract data for your name (same as previous exercise)</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Plot the data you produced in step 1 above, with <code>Year</code> on the x-axis
and <code>Count</code> on the y-axis.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Adjust the plot so that is shows boys and girls in different colors.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>BONUS (Optional): Adjust the plot to use lines instead of points.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a><span class="co">##</span></span></code></pre></div></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>Use <code>filter()</code> to extract data for your name (same as previous exercise).</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>baby_names_george &lt;-<span class="st"> </span><span class="kw">filter</span>(baby_names, Name <span class="op">==</span><span class="st"> &quot;George&quot;</span>)</span></code></pre></div></li>
<li><p>Plot the data you produced in step 1 above, with <code>Year</code> on the x-axis and <code>Count</code> on the y-axis.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count, <span class="dt">data =</span> baby_names_george)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-49-1.png" width="672" /></p></li>
<li><p>Adjust the plot so that is shows boys and girls in different colors.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count, <span class="dt">color =</span> Sex, <span class="dt">data =</span> baby_names_george)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-50-1.png" width="672" /></p></li>
<li><p>BONUS (Optional): Adjust the plot to use lines instead of points.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count, <span class="dt">color =</span> Sex, <span class="dt">data =</span> baby_names_george, <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-51-1.png" width="672" /></p></li>
</ol>
</div>
</details>
</div>
</div>
<div id="creating-variables" class="section level2">
<h2>Creating variables</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to create new variables with and without grouped data.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Creating new variables (columns) — using the <code>mutate()</code> function</li>
<li>Creating new variables within groups — by combining the <code>mutate()</code> and <code>group_by()</code> functions</li>
<li>Recode existing variables — by combining the <code>mutate()</code> and <code>case_when()</code> functions</li>
</ol>
</div>
<p>We want to use these skills to find out which names have been the most popular.</p>
<div id="create-or-modify-columns" class="section level3">
<h3>Create or modify columns</h3>
<p>So far we’ve used <code>Count</code> as a measure of popularity. A better
approach is to use proportion to avoid confounding
popularity with the number of babies born in a given year.</p>
<p>The <code>mutate()</code> function makes it easy to add or modify the columns
of a <code>data.frame</code>. For example, we can use it to rescale the count
of each name in each year:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># Use piping to add a new column to the data, called Count_1k, that rescales counts to thousands</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>baby_names &lt;-<span class="st"> </span>baby_names <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Count_1k =</span> Count<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb110-3"><a href="#cb110-3"></a><span class="kw">head</span>(baby_names) </span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   Name  Sex   Count  Year Count_1k
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1 Mary  Girls 51474  1960     51.5
## 2 Susan Girls 39200  1960     39.2
## 3 Linda Girls 37314  1960     37.3
## 4 Karen Girls 36376  1960     36.4
## 5 Donna Girls 34133  1960     34.1
## 6 Lisa  Girls 33702  1960     33.7</code></pre>
</div>
<div id="operating-by-group" class="section level3">
<h3>Operating by group</h3>
<p>Because of the nested nature of our data, we want to compute proportion
or rank <strong>within</strong> each <code>Sex</code> by <code>Year</code> group. The <code>dplyr</code>
package has a <code>group_by()</code> function that makes this relatively
straightforward. Here’s the logic behind this process:</p>
<p><img src="R/Rintro/images/mutate_group_by.png" /></p>
<p>Note that the <code>group_by()</code> function converts a <strong>data frame</strong> into a
<strong>grouped data frame</strong> — that is, a data frame with metadata identifying
the groups. The data remain grouped until you change the groups by
running <code>group_by()</code> again or remove the grouping metadata using
<code>ungroup()</code>.</p>
<p>Here’s the code that implements the calculation:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># Group baby_names by Year and Sex and rank Count_1k within each group (calling the resulting new column &quot;Rank&quot;). </span></span>
<span id="cb112-2"><a href="#cb112-2"></a><span class="co"># Remember to ungroup at the end!</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>baby_names &lt;-</span>
<span id="cb112-4"><a href="#cb112-4"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb112-5"><a href="#cb112-5"></a><span class="st">  </span><span class="kw">group_by</span>(Year, Sex) <span class="op">%&gt;%</span></span>
<span id="cb112-6"><a href="#cb112-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Rank =</span> <span class="kw">rank</span>(Count_1k)) <span class="op">%&gt;%</span></span>
<span id="cb112-7"><a href="#cb112-7"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb112-8"><a href="#cb112-8"></a></span>
<span id="cb112-9"><a href="#cb112-9"></a><span class="kw">head</span>(baby_names)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   Name  Sex   Count  Year Count_1k  Rank
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 Mary  Girls 51474  1960     51.5  7331
## 2 Susan Girls 39200  1960     39.2  7330
## 3 Linda Girls 37314  1960     37.3  7329
## 4 Karen Girls 36376  1960     36.4  7328
## 5 Donna Girls 34133  1960     34.1  7327
## 6 Lisa  Girls 33702  1960     33.7  7326</code></pre>
</div>
<div id="recoding-variables" class="section level3">
<h3>Recoding variables</h3>
<p>It’s often necessary to create a new variable that is a recoded version of an existing variable.
For example, we might want to take our <code>Count_1k</code> variable and create a new variable that divides
it into <code>low</code>, <code>medium</code>, and <code>high</code> categories. To do this, we can use the <code>case_when()</code>
function within the <code>mutate()</code> function:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="co"># Use case_when() to recode the newly created Rank column into low (&lt;=10), high (&gt;40), and medium (all others).</span></span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="co"># Call the resulting column &quot;Count_levels&quot;.</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>baby_names &lt;-</span>
<span id="cb114-4"><a href="#cb114-4"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb114-5"><a href="#cb114-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Count_levels =</span> <span class="kw">case_when</span>(</span>
<span id="cb114-6"><a href="#cb114-6"></a>                            Count_1k <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>                  <span class="op">~</span><span class="st"> &quot;low&quot;</span>,</span>
<span id="cb114-7"><a href="#cb114-7"></a>                            Count_1k  <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>Count_1k <span class="op">&lt;=</span><span class="st"> </span><span class="dv">40</span> <span class="op">~</span><span class="st"> &quot;medium&quot;</span>,</span>
<span id="cb114-8"><a href="#cb114-8"></a>                            Count_1k  <span class="op">&gt;</span><span class="st"> </span><span class="dv">40</span>                  <span class="op">~</span><span class="st"> &quot;high&quot;</span></span>
<span id="cb114-9"><a href="#cb114-9"></a>                            ))</span>
<span id="cb114-10"><a href="#cb114-10"></a></span>
<span id="cb114-11"><a href="#cb114-11"></a><span class="kw">head</span>(baby_names)                            </span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   Name  Sex   Count  Year Count_1k  Rank Count_levels
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
## 1 Mary  Girls 51474  1960     51.5  7331 high        
## 2 Susan Girls 39200  1960     39.2  7330 medium      
## 3 Linda Girls 37314  1960     37.3  7329 medium      
## 4 Karen Girls 36376  1960     36.4  7328 medium      
## 5 Donna Girls 34133  1960     34.1  7327 medium      
## 6 Lisa  Girls 33702  1960     33.7  7326 medium</code></pre>
</div>
<div id="exercise-4" class="section level3">
<h3>Exercise 4</h3>
<p><strong>Most popular names</strong></p>
<p>In this exercise your goal is to identify the most popular names for each year.</p>
<ol style="list-style-type: decimal">
<li><p>Use <code>mutate()</code> and <code>group_by()</code> to create a column named <code>Proportion</code>
where <code>Proportion = Count/sum(Count)</code> for each <code>Year X Sex</code> group.
Use pipes wherever it makes sense.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Use <code>mutate()</code> and <code>group_by()</code> to create a column named <code>Rank</code> where
<code>Rank = rank(desc(Count))</code> for each <code>Year X Sex</code> group.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Filter the baby names data to display only the most popular name
for each <code>Year X Sex</code> group. Keep only the columns: <code>Year</code>, <code>Name</code>,
<code>Sex</code>, and <code>Proportion</code>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Plot the data produced in step 3, putting <code>Year</code> on the x-axis
and <code>Proportion</code> on the y-axis. How has the proportion of babies
given the most popular name changed over time?</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>BONUS (optional): Which names are the most popular for both boys and girls?</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co">##</span></span></code></pre></div></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 4 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>Use <code>mutate()</code> and <code>group_by()</code> to create a column named <code>Proportion</code> where <code>Proportion = Count/sum(Count)</code> for each <code>Year X Sex</code> group.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1"></a>baby_names &lt;-<span class="st"> </span></span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3"></a><span class="st">  </span><span class="kw">group_by</span>(Year, Sex) <span class="op">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Proportion =</span> Count<span class="op">/</span><span class="kw">sum</span>(Count)) <span class="op">%&gt;%</span></span>
<span id="cb121-5"><a href="#cb121-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb121-6"><a href="#cb121-6"></a></span>
<span id="cb121-7"><a href="#cb121-7"></a><span class="kw">head</span>(baby_names) </span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   Name  Sex   Count  Year Count_1k  Rank Count_levels Proportion
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
## 1 Mary  Girls 51474  1960     51.5  7331 high             0.0255
## 2 Susan Girls 39200  1960     39.2  7330 medium           0.0194
## 3 Linda Girls 37314  1960     37.3  7329 medium           0.0185
## 4 Karen Girls 36376  1960     36.4  7328 medium           0.0180
## 5 Donna Girls 34133  1960     34.1  7327 medium           0.0169
## 6 Lisa  Girls 33702  1960     33.7  7326 medium           0.0167</code></pre></li>
<li><p>Use <code>mutate()</code> and <code>group_by()</code> to create a column named <code>Rank</code> where <code>Rank = rank(desc(Count))</code> for each <code>Year X Sex</code> group.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1"></a>baby_names &lt;-<span class="st"> </span></span>
<span id="cb123-2"><a href="#cb123-2"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3"></a><span class="st">  </span><span class="kw">group_by</span>(Year, Sex) <span class="op">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Rank =</span> <span class="kw">rank</span>(<span class="kw">desc</span>(Count))) <span class="op">%&gt;%</span></span>
<span id="cb123-5"><a href="#cb123-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb123-6"><a href="#cb123-6"></a></span>
<span id="cb123-7"><a href="#cb123-7"></a><span class="kw">head</span>(baby_names)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   Name  Sex   Count  Year Count_1k  Rank Count_levels Proportion
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
## 1 Mary  Girls 51474  1960     51.5     1 high             0.0255
## 2 Susan Girls 39200  1960     39.2     2 medium           0.0194
## 3 Linda Girls 37314  1960     37.3     3 medium           0.0185
## 4 Karen Girls 36376  1960     36.4     4 medium           0.0180
## 5 Donna Girls 34133  1960     34.1     5 medium           0.0169
## 6 Lisa  Girls 33702  1960     33.7     6 medium           0.0167</code></pre></li>
<li><p>Filter the baby names data to display only the most popular name for each <code>Year X Sex</code> group.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1"></a>top1 &lt;-<span class="st"> </span></span>
<span id="cb125-2"><a href="#cb125-2"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="st">  </span><span class="kw">filter</span>(Rank <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb125-4"><a href="#cb125-4"></a><span class="st">  </span><span class="kw">select</span>(Year, Name, Sex, Proportion)</span>
<span id="cb125-5"><a href="#cb125-5"></a></span>
<span id="cb125-6"><a href="#cb125-6"></a><span class="kw">head</span>(top1)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##    Year Name    Sex   Proportion
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;
## 1  1960 Mary    Girls     0.0255
## 2  1960 David   Boys      0.0403
## 3  1961 Mary    Girls     0.0236
## 4  1961 Michael Boys      0.0409
## 5  1962 Lisa    Girls     0.0234
## 6  1962 Michael Boys      0.0411</code></pre></li>
<li><p>Plot the data produced in step 3, putting <code>Year</code> on the x-axis and <code>Proportion</code> on the y-axis. How has the proportion of babies given the most popular name changed over time?</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, </span>
<span id="cb127-2"><a href="#cb127-2"></a>      <span class="dt">y =</span> Proportion, </span>
<span id="cb127-3"><a href="#cb127-3"></a>      <span class="dt">color =</span> Sex, </span>
<span id="cb127-4"><a href="#cb127-4"></a>      <span class="dt">data =</span> top1, </span>
<span id="cb127-5"><a href="#cb127-5"></a>      <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-63-1.png" width="672" /></p></li>
<li><p>BONUS (optional): Which names are the most popular for both boys and girls?</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>girls_and_boys &lt;-<span class="st"> </span><span class="kw">inner_join</span>(<span class="kw">filter</span>(baby_names, Sex <span class="op">==</span><span class="st"> &quot;Boys&quot;</span>), </span>
<span id="cb128-2"><a href="#cb128-2"></a>                            <span class="kw">filter</span>(baby_names, Sex <span class="op">==</span><span class="st"> &quot;Girls&quot;</span>),</span>
<span id="cb128-3"><a href="#cb128-3"></a>                            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Name&quot;</span>))</span>
<span id="cb128-4"><a href="#cb128-4"></a></span>
<span id="cb128-5"><a href="#cb128-5"></a>girls_and_boys &lt;-<span class="st"> </span><span class="kw">mutate</span>(girls_and_boys,</span>
<span id="cb128-6"><a href="#cb128-6"></a>                        <span class="dt">Product =</span> Count.x <span class="op">*</span><span class="st"> </span>Count.y,</span>
<span id="cb128-7"><a href="#cb128-7"></a>                        <span class="dt">Rank =</span> <span class="kw">rank</span>(<span class="kw">desc</span>(Product)))</span>
<span id="cb128-8"><a href="#cb128-8"></a></span>
<span id="cb128-9"><a href="#cb128-9"></a><span class="kw">filter</span>(girls_and_boys, Rank <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 16
##   Name  Sex.x Count.x  Year Count_1k.x Rank.x Count_levels.x Proportion.x Sex.y
##   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;
## 1 Tayl… Boys     7688  1993       7.69     51 low                 0.00392 Girls
## # … with 7 more variables: Count.y &lt;dbl&gt;, Count_1k.y &lt;dbl&gt;, Rank.y &lt;dbl&gt;,
## #   Count_levels.y &lt;chr&gt;, Proportion.y &lt;dbl&gt;, Product &lt;dbl&gt;, Rank &lt;dbl&gt;</code></pre></li>
</ol>
</div>
</details>
</div>
</div>
<div id="aggregating-variables" class="section level2">
<h2>Aggregating variables</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to aggregate data to create summaries with and without grouped data.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Collapsing data into summaries — using the <code>summarize()</code> function</li>
<li>Creating summaries within groups — by combining the <code>summarize()</code> and <code>group_by()</code> functions</li>
</ol>
</div>
<p>You may have noticed that the percentage of babies given the most
popular name of the year appears to have decreased over time. We can
compute a more robust measure of the popularity of the most popular
names by calculating the number of babies given one of the top 10 girl
or boy names of the year.</p>
<p>To compute this measure we need to operate within groups, as
we did using <code>mutate()</code> above, but this time we need to collapse each
group into a single summary statistic. We can achieve this using the
<code>summarize()</code> function.</p>
<p>First, let’s see how this function works without grouping. The following
code outputs the total number of girls and boys in the data:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="co"># Use summarize() to output the total number of boys and girls in the sample</span></span>
<span id="cb130-2"><a href="#cb130-2"></a>baby_names <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Girls_n =</span> <span class="kw">sum</span>(Sex<span class="op">==</span><span class="st">&quot;Girls&quot;</span>),</span>
<span id="cb130-4"><a href="#cb130-4"></a>            <span class="dt">Boys_n =</span> <span class="kw">sum</span>(Sex<span class="op">==</span><span class="st">&quot;Boys&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   Girls_n Boys_n
##     &lt;int&gt;  &lt;int&gt;
## 1  641084 407491</code></pre>
<p>Next, using <code>group_by()</code> and <code>summarize()</code> together, we can calculate the
number of babies born each year. Here’s the logic behind this process:</p>
<p><img src="R/Rintro/images/summarize_group_by.png" /></p>
<p>Note that, unlike with the <code>mutate()</code> function, the <code>summarize()</code> function returns a data frame
with fewer rows than the original, because of aggregation.</p>
<p>Here’s the code that implements the calculation:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># Group baby_names by Year and calculate the sum of Count (record in a column called Total). </span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="co"># Assign the result to bn_by_year and remember to ungroup!</span></span>
<span id="cb132-3"><a href="#cb132-3"></a>bn_by_year &lt;-</span>
<span id="cb132-4"><a href="#cb132-4"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span></span>
<span id="cb132-5"><a href="#cb132-5"></a><span class="st">  </span><span class="kw">group_by</span>(Year) <span class="op">%&gt;%</span></span>
<span id="cb132-6"><a href="#cb132-6"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Total =</span> <span class="kw">sum</span>(Count)) <span class="op">%&gt;%</span></span>
<span id="cb132-7"><a href="#cb132-7"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb132-8"><a href="#cb132-8"></a></span>
<span id="cb132-9"><a href="#cb132-9"></a><span class="kw">head</span>(bn_by_year)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##    Year   Total
##   &lt;dbl&gt;   &lt;dbl&gt;
## 1  1960 4154377
## 2  1961 4140244
## 3  1962 4035234
## 4  1963 3958791
## 5  1964 3887800
## 6  1965 3626029</code></pre>
<div id="exercise-5" class="section level3">
<h3>Exercise 5</h3>
<p><strong>Popularity of the most popular names</strong></p>
<p>In this exercise we will plot trends in the proportion of boys and girls
given one of the 10 most popular names each year.</p>
<ol style="list-style-type: decimal">
<li><p>Filter the <code>baby_names</code> data, retaining only the 10 most popular girl
and boy names for each year.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Summarize the data produced in step one to calculate the total
Proportion of boys and girls given one of the top 10 names
each year.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="co">##</span></span></code></pre></div></li>
<li><p>Plot the data produced in step 2, with year on the x-axis
and total proportion on the y axis. Color by <code>Sex</code> and notice
the trend.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="co">##</span></span></code></pre></div></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 5 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li><p>Filter the baby_names data, retaining only the 10 most popular girl and boy names for each year.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>most_popular &lt;-<span class="st"> </span></span>
<span id="cb137-2"><a href="#cb137-2"></a><span class="st">  </span>baby_names <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb137-3"><a href="#cb137-3"></a><span class="st">  </span><span class="kw">group_by</span>(Year, Sex) <span class="op">%&gt;%</span></span>
<span id="cb137-4"><a href="#cb137-4"></a><span class="st">  </span><span class="kw">filter</span>(Rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</span>
<span id="cb137-5"><a href="#cb137-5"></a></span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="kw">head</span>(most_popular, <span class="dt">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 8
## # Groups:   Year, Sex [1]
##    Name     Sex   Count  Year Count_1k  Rank Count_levels Proportion
##    &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
##  1 Mary     Girls 51474  1960     51.5     1 high             0.0255
##  2 Susan    Girls 39200  1960     39.2     2 medium           0.0194
##  3 Linda    Girls 37314  1960     37.3     3 medium           0.0185
##  4 Karen    Girls 36376  1960     36.4     4 medium           0.0180
##  5 Donna    Girls 34133  1960     34.1     5 medium           0.0169
##  6 Lisa     Girls 33702  1960     33.7     6 medium           0.0167
##  7 Patricia Girls 32102  1960     32.1     7 medium           0.0159
##  8 Debra    Girls 26737  1960     26.7     8 medium           0.0132
##  9 Cynthia  Girls 26725  1960     26.7     9 medium           0.0132
## 10 Deborah  Girls 25264  1960     25.3    10 medium           0.0125</code></pre></li>
<li><p>Summarize the data produced in step one to calculate the total Proportion of boys and girls given one of the top 10 names each year.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1"></a>top10 &lt;-<span class="st"> </span></span>
<span id="cb139-2"><a href="#cb139-2"></a><span class="st">  </span>most_popular <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># it is already grouped by Year and Sex</span></span>
<span id="cb139-3"><a href="#cb139-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">TotalProportion =</span> <span class="kw">sum</span>(Proportion))</span></code></pre></div></li>
<li><p>Plot the data produced in step 2, with year on the x-axis and total proportion on the y axis. Color by <code>Sex</code> and notice
the trend.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="kw">qplot</span>(<span class="dt">x =</span> Year, </span>
<span id="cb140-2"><a href="#cb140-2"></a>      <span class="dt">y =</span> TotalProportion, </span>
<span id="cb140-3"><a href="#cb140-3"></a>      <span class="dt">color =</span> Sex,</span>
<span id="cb140-4"><a href="#cb140-4"></a>      <span class="dt">data =</span> top10,</span>
<span id="cb140-5"><a href="#cb140-5"></a>      <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<p><img src="R/Rintro/figures/unnamed-chunk-72-1.png" width="672" /></p></li>
</ol>
</div>
</details>
</div>
</div>
<div id="saving-work" class="section level2">
<h2>Saving work</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to save objects, data, and scripts for later use.</strong></p>
</div>
<p>Now that we have made some changes to our data set, we might want to
save those changes to a file.</p>
<div id="saving-individual-datasets" class="section level3">
<h3>Saving individual datasets</h3>
<p>You might find functions <code>write_csv()</code> and <code>write_rds()</code> from package
<code>readr</code> handy!</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># write baby_names to a .csv file</span></span>
<span id="cb141-2"><a href="#cb141-2"></a><span class="kw">write_csv</span>(baby_names, <span class="st">&quot;babyNames.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="co"># write baby_names to an R file</span></span>
<span id="cb142-2"><a href="#cb142-2"></a><span class="kw">write_rds</span>(baby_names, <span class="st">&quot;babyNames.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="saving-multiple-datasets" class="section level3">
<h3>Saving multiple datasets</h3>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1"></a><span class="kw">ls</span>() <span class="co"># list objects in our workspace</span></span>
<span id="cb143-2"><a href="#cb143-2"></a><span class="co"># Use save() function from the base R package to record some objects into a file named &quot;myDataFiles.RData&quot;</span></span>
<span id="cb143-3"><a href="#cb143-3"></a><span class="kw">save</span>(baby_names_diana, bn_by_year, baby_names_subset, <span class="dt">file=</span><span class="st">&quot;myDataFiles.RData&quot;</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="co"># Load the &quot;myDataFiles.RData&quot;</span></span>
<span id="cb144-2"><a href="#cb144-2"></a><span class="co"># load(&quot;myDataFiles.RData&quot;) </span></span></code></pre></div>
</div>
</div>
<div id="wrap-up-1" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-1" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work-in-progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-2" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Software (all free!):
<ul>
<li>R and R package download: <a href="http://cran.r-project.org" class="uri">http://cran.r-project.org</a></li>
<li>RStudio download: <a href="http://rstudio.org" class="uri">http://rstudio.org</a></li>
<li>ESS (Emacs R package): <a href="http://ess.r-project.org/" class="uri">http://ess.r-project.org/</a></li>
</ul></li>
<li>Cheatsheets
<ul>
<li><a href="https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf" class="uri">https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf</a></li>
</ul></li>
<li>Online tutorials
<ul>
<li><a href="https://swirlstats.com/" class="uri">https://swirlstats.com/</a></li>
<li><a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a></li>
<li><a href="https://hbs-rcs.github.io/R_Intro-gapminder/base-r/" class="uri">https://hbs-rcs.github.io/R_Intro-gapminder/base-r/</a></li>
<li><a href="https://www.pluralsight.com/search?q=R" class="uri">https://www.pluralsight.com/search?q=R</a></li>
<li><a href="https://www.datacamp.com/" class="uri">https://www.datacamp.com/</a></li>
<li><a href="https://rmarkdown.rstudio.com/lesson-1.html" class="uri">https://rmarkdown.rstudio.com/lesson-1.html</a></li>
</ul></li>
<li>Getting help:
<ul>
<li>Documentation and tutorials: <a href="http://cran.r-project.org/other-docs.html" class="uri">http://cran.r-project.org/other-docs.html</a></li>
<li>Recommended R packages by topic: <a href="http://cran.r-project.org/web/views/" class="uri">http://cran.r-project.org/web/views/</a></li>
<li>Mailing list: <a href="https://stat.ethz.ch/mailman/listinfo/r-help" class="uri">https://stat.ethz.ch/mailman/listinfo/r-help</a></li>
<li>StackOverflow: <a href="http://stackoverflow.com/questions/tagged/r" class="uri">http://stackoverflow.com/questions/tagged/r</a></li>
<li>R-Bloggers: <a href="https://www.r-bloggers.com/" class="uri">https://www.r-bloggers.com/</a></li>
</ul></li>
<li>Coming from …
<ul>
<li>Stata: <a href="http://www.princeton.edu/~otorres/RStata.pdf" class="uri">http://www.princeton.edu/~otorres/RStata.pdf</a></li>
<li>SAS/SPSS: <a href="http://r4stats.com/books/free-version/" class="uri">http://r4stats.com/books/free-version/</a></li>
<li>Matlab: <a href="http://www.math.umaine.edu/~hiebeler/comp/matlabR.pdf" class="uri">http://www.math.umaine.edu/~hiebeler/comp/matlabR.pdf</a></li>
<li>Python: <a href="http://mathesaurus.sourceforge.net/matlab-python-xref.pdf" class="uri">http://mathesaurus.sourceforge.net/matlab-python-xref.pdf</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="r-regression-models" class="section level1">
<h1>R Regression Models</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Formula interface for model specification</li>
<li>Function methods for extracting quantities of interest from models</li>
<li>Contrasts to test specific hypotheses</li>
<li>Model comparisons</li>
<li>Predicted marginal effects</li>
</ul>
<div id="setup-1" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials-1" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./Rinstall.html">R Installation</a> instructions and ensure that you can successfully start RStudio.</p>
</div>
<div id="class-structure-1" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites-1" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate R course:</p>
<ul>
<li>Assumes working knowledge of R</li>
<li>Relatively fast-paced</li>
<li>This is not a statistics course! We will teach you <em>how</em> to fit models in R,
but we assume you know the theory behind the models.</li>
</ul>
</div>
<div id="goals-1" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the R modeling ecosystem by fitting a variety of statistical models to
different datasets. In particular, our goals are to learn about:</p>
<ol style="list-style-type: decimal">
<li>Modeling workflow</li>
<li>Visualizing and summarizing data before modeling</li>
<li>Modeling continuous outcomes</li>
<li>Modeling binary outcomes</li>
<li>Modeling clustered data</li>
</ol>
<p>We will not spend much time <em>interpreting</em> the models we fit, since this is not a statistics workshop.
But, we will walk you through how model results are organized and orientate you to where you can find
typical quantities of interest.</p>
</div>
</div>
<div id="launch-an-r-session" class="section level3">
<h3>Launch an R session</h3>
<p>Start RStudio and create a new project:</p>
<ul>
<li>On Windows click the start button and search for RStudio. On Mac
RStudio will be in your applications folder.</li>
<li>In Rstudio go to <code>File -&gt; New Project</code>.</li>
<li>Choose <code>Existing Directory</code> and browse to the workshop materials directory on your desktop.</li>
<li>Choose <code>File -&gt; Open File</code> and select the file with the word “BLANK” in the name.</li>
</ul>
</div>
<div id="packages" class="section level3">
<h3>Packages</h3>
<p>You should have already installed the <code>tidyverse</code> and <code>rmarkdown</code>
packages onto your computer before the workshop
— see <a href="./Rinstall.html">R Installation</a>.
Now let’s load these packages into the search path of our R session.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb145-2"><a href="#cb145-2"></a><span class="kw">library</span>(rmarkdown)</span></code></pre></div>
<p>Finally, lets install some packages that will help with modeling:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="co"># install.packages(&quot;lme4&quot;)</span></span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="kw">library</span>(lme4)  <span class="co"># for mixed models</span></span>
<span id="cb146-3"><a href="#cb146-3"></a></span>
<span id="cb146-4"><a href="#cb146-4"></a><span class="co"># install.packages(&quot;emmeans&quot;)</span></span>
<span id="cb146-5"><a href="#cb146-5"></a><span class="kw">library</span>(emmeans)  <span class="co"># for marginal effects</span></span>
<span id="cb146-6"><a href="#cb146-6"></a></span>
<span id="cb146-7"><a href="#cb146-7"></a><span class="co"># install.packages(&quot;effects&quot;)</span></span>
<span id="cb146-8"><a href="#cb146-8"></a><span class="kw">library</span>(effects)  <span class="co"># for predicted marginal means</span></span></code></pre></div>
</div>
</div>
<div id="modeling-workflow" class="section level2">
<h2>Modeling workflow</h2>
<p>Before we delve into the details of how to fit models in R, it’s worth taking a step
back and thinking more broadly about the components of the modeling process. These
can roughly be divided into 3 stages:</p>
<ol style="list-style-type: decimal">
<li>Pre-estimation</li>
<li>Estimation</li>
<li>Post-estimaton</li>
</ol>
<p>At each stage, the goal is to complete a different task (e.g., to clean data, fit a model, test a hypothesis),
but the process is sequential — we move through the stages in order (though often many times in one project!)</p>
<p><img src="R/Rmodels/images/R_model_pipeline.png" /></p>
<p>Throughout this workshop we will go through these stages several times as we fit different types of model.</p>
</div>
<div id="r-modeling-ecosystem" class="section level2">
<h2>R modeling ecosystem</h2>
<p>There are literally hundreds of R packages that provide model fitting functionality.
We’re going to focus on just two during this workshop — <code>stats</code>, from Base R, and
<code>lme4</code>. It’s a good idea to look at <a href="https://cran.r-project.org/web/views/">CRAN Task Views</a>
when trying to find a modeling package for your needs, as they provide an extensive
curated list. But, here’s a more digestable table showing some of the most popular
packages for particular types of model.</p>
<table>
<thead>
<tr class="header">
<th align="left">Models</th>
<th align="left">Packages</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Generalized linear</td>
<td align="left"><code>stats</code>, <code>biglm</code>, <code>MASS</code>, <code>robustbase</code></td>
</tr>
<tr class="even">
<td align="left">Mixed effects</td>
<td align="left"><code>lme4</code>, <code>nlme</code>, <code>glmmTMB</code>, <code>MASS</code></td>
</tr>
<tr class="odd">
<td align="left">Econometric</td>
<td align="left"><code>pglm</code>, <code>VGAM</code>, <code>pscl</code>, <code>survival</code></td>
</tr>
<tr class="even">
<td align="left">Bayesian</td>
<td align="left"><code>brms</code>, <code>blme</code>, <code>MCMCglmm</code>, <code>rstan</code></td>
</tr>
<tr class="odd">
<td align="left">Machine learning</td>
<td align="left"><code>mlr</code>, <code>caret</code>, <code>h2o</code>, <code>tensorflow</code></td>
</tr>
</tbody>
</table>
</div>
<div id="before-fitting-a-model" class="section level2">
<h2>Before fitting a model</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the data by creating summaries and visualizations.</strong></p>
</div>
<p>One important part of the pre-estimation stage of model fitting, is gaining an understanding
of the data we wish to model by creating plots and summaries. Let’s do this now.</p>
<div id="load-the-data" class="section level3">
<h3>Load the data</h3>
<p>List the data files we’re going to work with:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="kw">list.files</span>(<span class="st">&quot;dataSets&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Exam.rds&quot;          &quot;NatHealth2008MI&quot;   &quot;NatHealth2011.rds&quot;
## [4] &quot;states.rds&quot;</code></pre>
<p>We’re going to use the <code>states</code> data first, which originally appeared in <em>Statistics with Stata</em> by Lawrence C. Hamilton.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a>  <span class="co"># read the states data</span></span>
<span id="cb149-2"><a href="#cb149-2"></a>  states_data &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;dataSets/states.rds&quot;</span>)</span>
<span id="cb149-3"><a href="#cb149-3"></a></span>
<span id="cb149-4"><a href="#cb149-4"></a>  <span class="co"># look at the last few rows</span></span>
<span id="cb149-5"><a href="#cb149-5"></a>  <span class="kw">tail</span>(states_data)</span></code></pre></div>
<pre><code>##            state  region     pop  area density metro waste energy miles toxic
## 46       Vermont N. East  563000  9249   60.87  23.4  0.69    232  10.4  1.81
## 47      Virginia   South 6187000 39598  156.25  72.5  1.45    306   9.7 12.87
## 48    Washington    West 4867000 66582   73.10  81.7  1.05    389   9.2  8.51
## 49 West Virginia   South 1793000 24087   74.44  36.4  0.95    415   8.6 21.30
##    green house senate csat vsat msat percent expense income high college
## 46 15.17    85     94  890  424  466      68    6738 34.717 80.8    24.3
## 47 18.72    33     54  890  424  466      60    4836 38.838 75.2    24.5
## 48 16.51    52     64  913  433  480      49    5000 36.338 83.8    22.9
## 49 51.14    48     57  926  441  485      17    4911 24.233 66.0    12.3
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2 rows ]</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">csat</td>
<td align="left">Mean composite SAT score</td>
</tr>
<tr class="even">
<td align="left">expense</td>
<td align="left">Per pupil expenditures</td>
</tr>
<tr class="odd">
<td align="left">percent</td>
<td align="left">% HS graduates taking SAT</td>
</tr>
<tr class="even">
<td align="left">income</td>
<td align="left">Median household income, $1,000</td>
</tr>
<tr class="odd">
<td align="left">region</td>
<td align="left">Geographic region: West, N. East, South, Midwest</td>
</tr>
<tr class="even">
<td align="left">house</td>
<td align="left">House ’91 environ. voting, %</td>
</tr>
<tr class="odd">
<td align="left">senate</td>
<td align="left">Senate ’91 environ. voting, %</td>
</tr>
<tr class="even">
<td align="left">energy</td>
<td align="left">Per capita energy consumed, Btu</td>
</tr>
<tr class="odd">
<td align="left">metro</td>
<td align="left">Metropolitan area population, %</td>
</tr>
<tr class="even">
<td align="left">waste</td>
<td align="left">Per capita solid waste, tons</td>
</tr>
</tbody>
</table>
</div>
<div id="examine-the-data" class="section level3">
<h3>Examine the data</h3>
<p>Start by examining the data to check for problems.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a>  <span class="co"># summary of expense and csat columns, all rows</span></span>
<span id="cb151-2"><a href="#cb151-2"></a>  sts_ex_sat &lt;-<span class="st"> </span></span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="st">      </span>states_data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb151-4"><a href="#cb151-4"></a><span class="st">      </span><span class="kw">select</span>(expense, csat)</span>
<span id="cb151-5"><a href="#cb151-5"></a>  </span>
<span id="cb151-6"><a href="#cb151-6"></a>  <span class="kw">summary</span>(sts_ex_sat)</span></code></pre></div>
<pre><code>##     expense          csat       
##  Min.   :2960   Min.   : 832.0  
##  1st Qu.:4352   1st Qu.: 888.0  
##  Median :5000   Median : 926.0  
##  Mean   :5236   Mean   : 944.1  
##  3rd Qu.:5794   3rd Qu.: 997.0  
##  Max.   :9259   Max.   :1093.0</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a>  <span class="co"># correlation between expense and csat</span></span>
<span id="cb153-2"><a href="#cb153-2"></a>  <span class="kw">cor</span>(sts_ex_sat, <span class="dt">use =</span> <span class="st">&quot;pairwise&quot;</span>) </span></code></pre></div>
<pre><code>##            expense       csat
## expense  1.0000000 -0.4662978
## csat    -0.4662978  1.0000000</code></pre>
</div>
<div id="plot-the-data" class="section level3">
<h3>Plot the data</h3>
<p>Plot the data to look for multivariate outliers, non-linear relationships etc.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a>  <span class="co"># scatter plot of expense vs csat</span></span>
<span id="cb155-2"><a href="#cb155-2"></a>  <span class="kw">plot</span>(sts_ex_sat)</span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-83-1.png" width="672" /></p>
<p>Obviously, in a real project, you would want to spend more time investigating the data,
but we’ll now move on to modeling.</p>
</div>
</div>
<div id="models-with-continuous-outcomes" class="section level2">
<h2>Models with continuous outcomes</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the R modeling ecosystem by fitting ordinary least squares (OLS) models.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Formula representation of a model specification</li>
<li>Model classes</li>
<li>Function methods</li>
<li>Model comparison</li>
</ol>
</div>
<p>Once the data have been inspected and cleaned, we can start estimating models.
The simplest models (but those with the most assumptions) are those for continuous and unbounded outcomes.
Typically, for these outcomes, we’d use a model estimated using Ordinary Least Lquares (OLS),
which in R can be fit with the <code>lm()</code> (linear model) function.</p>
<p>To fit a model in R, we first have to convert our theoretical model into
a <code>formula</code> — a symbolic representation of the model in R syntax:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a><span class="co"># formula for model specification</span></span>
<span id="cb156-2"><a href="#cb156-2"></a>outcome <span class="op">~</span><span class="st"> </span>pred1 <span class="op">+</span><span class="st"> </span>pred2 <span class="op">+</span><span class="st"> </span>pred3</span>
<span id="cb156-3"><a href="#cb156-3"></a></span>
<span id="cb156-4"><a href="#cb156-4"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> the ~ is a tilde</span></span></code></pre></div>
<p>For example, the following theoretical model predicts SAT scores based on per-pupil expenditures:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
SATscores_i = \beta_{0}1 + \beta_1expenditures_i + \epsilon_i
\]</span></p>
</div>
<p>We can use <code>lm()</code> to fit this model:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a>  <span class="co"># fit our regression model</span></span>
<span id="cb157-2"><a href="#cb157-2"></a>  sat_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expense, <span class="co"># regression formula</span></span>
<span id="cb157-3"><a href="#cb157-3"></a>                <span class="dt">data =</span> states_data) <span class="co"># data </span></span>
<span id="cb157-4"><a href="#cb157-4"></a></span>
<span id="cb157-5"><a href="#cb157-5"></a>  <span class="co"># look at the basic printed output</span></span>
<span id="cb157-6"><a href="#cb157-6"></a>  sat_mod</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = csat ~ 1 + expense, data = states_data)
## 
## Coefficients:
## (Intercept)      expense  
##  1060.73244     -0.02228</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a>  <span class="co"># get more informative summary information </span></span>
<span id="cb159-2"><a href="#cb159-2"></a>  <span class="co"># about coefficients and goodness-of-fit</span></span>
<span id="cb159-3"><a href="#cb159-3"></a>  <span class="kw">summary</span>(sat_mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = csat ~ 1 + expense, data = states_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -131.811  -38.085    5.607   37.852  136.495 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.061e+03  3.270e+01   32.44  &lt; 2e-16 ***
## expense     -2.228e-02  6.037e-03   -3.69 0.000563 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 59.81 on 49 degrees of freedom
## Multiple R-squared:  0.2174, Adjusted R-squared:  0.2015 
## F-statistic: 13.61 on 1 and 49 DF,  p-value: 0.0005631</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a>  <span class="co"># show only the regression coefficients table </span></span>
<span id="cb161-2"><a href="#cb161-2"></a>  <span class="kw">summary</span>(sat_mod) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>() </span></code></pre></div>
<pre><code>##                  Estimate   Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 1060.73244395 32.700896736 32.437412 8.878411e-35
## expense       -0.02227565  0.006037115 -3.689783 5.630902e-04</code></pre>
<div id="why-is-the-association-between-expense-sat-scores-negative" class="section level3">
<h3>Why is the association between expense &amp; SAT scores <em>negative</em>?</h3>
<p>Many people find it surprising that the per-capita expenditure on students is negatively related to SAT scores. The beauty of multiple regression is that we can try to pull these apart. What would the association between expense and SAT scores be if there were no difference among the states in the percentage of students taking the SAT?</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a>  <span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expense <span class="op">+</span><span class="st"> </span>percent, <span class="dt">data =</span> states_data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-2"><a href="#cb163-2"></a><span class="st">  </span><span class="kw">summary</span>() </span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = csat ~ 1 + expense + percent, data = states_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -62.921 -24.318   1.741  15.502  75.623 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 989.807403  18.395770  53.806  &lt; 2e-16 ***
## expense       0.008604   0.004204   2.046   0.0462 *  
## percent      -2.537700   0.224912 -11.283 4.21e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 31.62 on 48 degrees of freedom
## Multiple R-squared:  0.7857, Adjusted R-squared:  0.7768 
## F-statistic: 88.01 on 2 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="the-lm-class-methods" class="section level3">
<h3>The <code>lm</code> class &amp; methods</h3>
<p>Okay, we fitted our model. Now what? Typically, the main goal in the <strong>post-estimation stage</strong> of analysis
is to extract <strong>quantities of interest</strong> from our fitted model. These quantities could be things like:</p>
<ol style="list-style-type: decimal">
<li>Testing whether one group is different on average from another group</li>
<li>Generating average response values from the model for interesting combinations of predictor values</li>
<li>Calculating interval estimates for particular coefficients</li>
</ol>
<p>But before we can do any of that, we need to know more about <strong>what a fitted model actually is,</strong>
<strong>what information it contains, and how we can extract from it information that we want to report</strong>.</p>
<p>Let’s start by examining the model object:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1"></a>  <span class="kw">class</span>(sat_mod)</span></code></pre></div>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a>  <span class="kw">str</span>(sat_mod)</span></code></pre></div>
<pre><code>## List of 12
##  $ coefficients : Named num [1:2] 1060.7324 -0.0223
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;expense&quot;
##  $ residuals    : Named num [1:51] 11.1 44.8 -32.7 26.7 -63.7 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:51] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:51] -6742.2 220.7 -31.7 29.7 -63.2 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:51] &quot;(Intercept)&quot; &quot;expense&quot; &quot;&quot; &quot;&quot; ...
##  $ rank         : int 2
##  $ fitted.values: Named num [1:51] 980 875 965 978 961 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:51] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ assign       : int [1:2] 0 1
##  $ qr           :List of 5
##   ..$ qr   : num [1:51, 1:2] -7.14 0.14 0.14 0.14 0.14 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:51] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;expense&quot;
##   .. ..- attr(*, &quot;assign&quot;)= int [1:2] 0 1
##   ..$ qraux: num [1:2] 1.14 1.33
##   ..$ pivot: int [1:2] 1 2
##   ..$ tol  : num 1e-07
##   ..$ rank : int 2
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ df.residual  : int 49
##  $ xlevels      : Named list()
##  $ call         : language lm(formula = csat ~ 1 + expense, data = states_data)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language csat ~ 1 + expense
##   .. ..- attr(*, &quot;variables&quot;)= language list(csat, expense)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:2] &quot;csat&quot; &quot;expense&quot;
##   .. .. .. ..$ : chr &quot;expense&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;expense&quot;
##   .. ..- attr(*, &quot;order&quot;)= int 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(csat, expense)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;csat&quot; &quot;expense&quot;
##  $ model        :&#39;data.frame&#39;:   51 obs. of  2 variables:
##   ..$ csat   : int [1:51] 991 920 932 1005 897 959 897 892 840 882 ...
##   ..$ expense: int [1:51] 3627 8330 4309 3700 4491 5064 7602 5865 9259 5276 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language csat ~ 1 + expense
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(csat, expense)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:2] &quot;csat&quot; &quot;expense&quot;
##   .. .. .. .. ..$ : chr &quot;expense&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;expense&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(csat, expense)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;csat&quot; &quot;expense&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a>  <span class="kw">names</span>(sat_mod)</span></code></pre></div>
<pre><code>##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         
##  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  
##  [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;</code></pre>
<p>We can list all the functions that extract particular quantities of interest (called <code>extractor functions</code>) by using the <code>methods()</code> function with the <code>class</code> argument set to the class of the model object:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="kw">methods</span>(<span class="dt">class =</span> <span class="kw">class</span>(sat_mod))</span></code></pre></div>
<pre><code>##  [1] add1           alias          anova          case.names     coerce        
##  [6] confint        cooks.distance deviance       dfbeta         dfbetas       
## [11] drop1          dummy.coef     Effect         effects        emm_basis     
## [16] extractAIC     family         formula        fortify        hatvalues     
## [21] influence      initialize     kappa          labels         logLik        
## [26] model.frame    model.matrix   nobs           plot           predict       
## [31] print          proj           qqnorm         qr             recover_data  
## [36] residuals      rstandard      rstudent       show           simulate      
## [41] slotsFromS3    summary        variable.names vcov          
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>We can also use <code>function methods</code> to get more information about the fit:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1"></a>  <span class="kw">summary</span>(sat_mod) <span class="co"># summary table</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = csat ~ 1 + expense, data = states_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -131.811  -38.085    5.607   37.852  136.495 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.061e+03  3.270e+01   32.44  &lt; 2e-16 ***
## expense     -2.228e-02  6.037e-03   -3.69 0.000563 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 59.81 on 49 degrees of freedom
## Multiple R-squared:  0.2174, Adjusted R-squared:  0.2015 
## F-statistic: 13.61 on 1 and 49 DF,  p-value: 0.0005631</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a>  <span class="kw">confint</span>(sat_mod) <span class="co"># confidence intervals</span></span></code></pre></div>
<pre><code>##                    2.5 %        97.5 %
## (Intercept) 995.01753164 1126.44735626
## expense      -0.03440768   -0.01014361</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1"></a>  <span class="kw">anova</span>(sat_mod) <span class="co"># ANOVA table  </span></span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: csat
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## expense    1  48708   48708  13.614 0.0005631 ***
## Residuals 49 175306    3578                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>How does R know which method to call for a given object? R uses <code>generic functions</code>, which provide access to <code>methods</code>. Method dispatch takes place based on the <code>class</code> of the first argument to the generic function. For example, for the generic function <code>summary()</code> and an object of class <code>lm</code>, the method dispatched will be <code>summary.lm()</code>. Function methods always take the form <code>generic.method()</code>:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1"></a><span class="kw">methods</span>(<span class="st">&quot;summary&quot;</span>)</span></code></pre></div>
<pre><code>##   [1] summary,ANY-method             summary,DBIObject-method      
##   [3] summary,diagonalMatrix-method  summary,sparseMatrix-method   
##   [5] summary.aareg*                 summary.allFit*               
##   [7] summary.aov                    summary.aovlist*              
##   [9] summary.aspell*                summary.cch*                  
##  [11] summary.check_packages_in_dir* summary.connection            
##  [13] summary.corAR1*                summary.corARMA*              
##  [15] summary.corCAR1*               summary.corCompSymm*          
##  [17] summary.corExp*                summary.corGaus*              
##  [19] summary.corIdent*              summary.corLin*               
##  [21] summary.corNatural*            summary.corRatio*             
##  [23] summary.corSpher*              summary.corStruct*            
##  [25] summary.corSymm*               summary.coxph*                
##  [27] summary.coxph.penal*           summary.data.frame            
##  [29] summary.Date                   summary.DBIrepdesign*         
##  [31] summary.DBIsvydesign*          summary.default               
##  [33] summary.Duration*              summary.ecdf*                 
##  [35] summary.eff*                   summary.efflatent*            
##  [37] summary.efflist*               summary.effpoly*              
##  [39] summary.emm_list*              summary.emmGrid*              
##  [41] summary.factor                 summary.ggplot*               
##  [43] summary.glht*                  summary.glht_list*            
##  [45] summary.glm                    summary.gls*                  
##  [47] summary.haven_labelled*        summary.hcl_palettes*         
##  [49] summary.infl*                  summary.Interval*             
##  [51] summary.lm                     summary.lme*                  
##  [53] summary.lmList*                summary.lmList4*              
##  [55] summary.loess*                 summary.loglm*                
##  [57] summary.manova                 summary.matrix                
##  [59] summary.mcmc*                  summary.mcmc.list*            
##  [61] summary.merMod*                summary.MIresult*             
##  [63] summary.mlm*                   summary.mlm.efflist*          
##  [65] summary.modelStruct*           summary.multinom*             
##  [67] summary.negbin*                summary.nls*                  
##  [69] summary.nlsList*               summary.nnet*                 
##  [71] summary.packageStatus*         summary.pdBlocked*            
##  [73] summary.pdCompSymm*            summary.pdDiag*               
##  [75] summary.pdIdent*               summary.pdLogChol*            
##  [77] summary.pdMat*                 summary.pdNatural*            
##  [79] summary.pdSymm*                summary.Period*               
##  [81] summary.polr*                  summary.POSIXct               
##  [83] summary.POSIXlt                summary.ppr*                  
##  [85] summary.pps*                   summary.prcomp*               
##  [87] summary.prcomplist*            summary.predictorefflist*     
##  [89] summary.princomp*              summary.proc_time             
##  [91] summary.pyears*                summary.ratetable*            
##  [93] summary.reStruct*              summary.rlang_error*          
##  [95] summary.rlang_trace*           summary.rlm*                  
##  [97] summary.shingle*               summary.srcfile               
##  [99] summary.srcref                 summary.stepfun               
##  [ reached getOption(&quot;max.print&quot;) -- omitted 37 entries ]
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p><img src="R/Rmodels/images/methods.png" /></p>
<p>It’s always worth examining whether the class of model you’re fitting has a method for a particular extractor function.
Here’s a summary table of some of the most often used extractor functions, which have methods for a wide range of model classes. These are post-estimation tools you will want in your toolbox:</p>
<table>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Package</th>
<th align="left">Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>summary()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">standard errors, test statistics, p-values, GOF stats</td>
</tr>
<tr class="even">
<td align="left"><code>confint()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">confidence intervals</td>
</tr>
<tr class="odd">
<td align="left"><code>anova()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">anova table (one model), model comparison (&gt; one model)</td>
</tr>
<tr class="even">
<td align="left"><code>coef()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">point estimates</td>
</tr>
<tr class="odd">
<td align="left"><code>drop1()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">model comparison</td>
</tr>
<tr class="even">
<td align="left"><code>predict()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">predicted response values</td>
</tr>
<tr class="odd">
<td align="left"><code>fitted()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">predicted response values (for observed data)</td>
</tr>
<tr class="even">
<td align="left"><code>residuals()</code></td>
<td align="left"><code>stats</code></td>
<td align="left">residuals</td>
</tr>
<tr class="odd">
<td align="left"><code>fixef()</code></td>
<td align="left"><code>lme4</code></td>
<td align="left">fixed effect point estimates (mixed models only)</td>
</tr>
<tr class="even">
<td align="left"><code>ranef()</code></td>
<td align="left"><code>lme4</code></td>
<td align="left">random effect point estimates (mixed models only)</td>
</tr>
<tr class="odd">
<td align="left"><code>coef()</code></td>
<td align="left"><code>lme4</code></td>
<td align="left">empirical Bayes estimates (mixed models only)</td>
</tr>
<tr class="even">
<td align="left"><code>allEffects()</code></td>
<td align="left"><code>effects</code></td>
<td align="left">predicted marginal means</td>
</tr>
<tr class="odd">
<td align="left"><code>emmeans()</code></td>
<td align="left"><code>emmeans</code></td>
<td align="left">predicted marginal means &amp; marginal effects</td>
</tr>
<tr class="even">
<td align="left"><code>margins()</code></td>
<td align="left"><code>margins</code></td>
<td align="left">predicted marginal means &amp; marginal effects</td>
</tr>
</tbody>
</table>
</div>
<div id="ols-regression-assumptions" class="section level3">
<h3>OLS regression assumptions</h3>
<p>OLS regression relies on several assumptions, including:</p>
<ol style="list-style-type: decimal">
<li>The model includes all relevant variables (i.e., no omitted variable bias).</li>
<li>The model is linear in the parameters (i.e., the coefficients and error term).</li>
<li>The error term has an expected value of zero.</li>
<li>All right-hand-side variables are uncorrelated with the error term.</li>
<li>No right-hand-side variables are a perfect linear function of other RHS variables.</li>
<li>Observations of the error term are uncorrelated with each other.</li>
<li>The error term has constant variance (i.e., homoscedasticity).</li>
<li>(Optional - only needed for inference). The error term is normally distributed.</li>
</ol>
<p>Investigate assumptions #7 and #8 visually by plotting your model:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1"></a>  <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)) <span class="co"># splits the plotting window into 4 panels</span></span>
<span id="cb181-2"><a href="#cb181-2"></a>  <span class="kw">plot</span>(sat_mod)</span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-91-1.png" width="672" /></p>
</div>
<div id="comparing-models" class="section level3">
<h3>Comparing models</h3>
<p>Do congressional voting patterns predict SAT scores over and above expense? Fit two models and compare them:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a>  <span class="co"># fit another model, adding house and senate as predictors</span></span>
<span id="cb182-2"><a href="#cb182-2"></a>  sat_voting_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expense <span class="op">+</span><span class="st"> </span>house <span class="op">+</span><span class="st"> </span>senate,</span>
<span id="cb182-3"><a href="#cb182-3"></a>                        <span class="dt">data =</span> <span class="kw">na.omit</span>(states_data))</span>
<span id="cb182-4"><a href="#cb182-4"></a></span>
<span id="cb182-5"><a href="#cb182-5"></a>  <span class="kw">summary</span>(sat_voting_mod) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>()</span></code></pre></div>
<pre><code>##                  Estimate   Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 1082.93438041 38.633812740 28.0307405 1.067795e-29
## expense       -0.01870832  0.009691494 -1.9303852 6.001998e-02
## house         -1.44243754  0.600478382 -2.4021473 2.058666e-02
## senate         0.49817861  0.513561356  0.9700469 3.373256e-01</code></pre>
<p>Why are we using <code>na.omit()</code>? Let’s see what <code>na.omit()</code> does.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a><span class="co"># fake data</span></span>
<span id="cb184-2"><a href="#cb184-2"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb184-3"><a href="#cb184-3"></a>  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</span>
<span id="cb184-4"><a href="#cb184-4"></a>  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">5</span>),</span>
<span id="cb184-5"><a href="#cb184-5"></a>  <span class="dt">z =</span> <span class="kw">c</span>(<span class="dv">6</span>, <span class="ot">NA</span>, <span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">3</span>))</span>
<span id="cb184-6"><a href="#cb184-6"></a>dat</span></code></pre></div>
<pre><code>##   x  y  z
## 1 1  3  6
## 2 2  2 NA
## 3 3  1  2
## 4 4 NA  7
## 5 5  5  3</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a><span class="kw">na.omit</span>(dat) <span class="co"># listwise deletion of observations</span></span></code></pre></div>
<pre><code>##   x y z
## 1 1 3 6
## 3 3 1 2
## 5 5 5 3</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1"></a><span class="co"># also see</span></span>
<span id="cb188-2"><a href="#cb188-2"></a><span class="co"># ?complete.cases</span></span>
<span id="cb188-3"><a href="#cb188-3"></a>dat[<span class="kw">with</span>(dat, <span class="kw">complete.cases</span>(x, y, z)), ]</span></code></pre></div>
<pre><code>##   x y z
## 1 1 3 6
## 3 3 1 2
## 5 5 5 3</code></pre>
<p>To compare models, we must fit them to the same data. This is why we need <code>na.omit()</code>.
Now let’s update our first model using <code>na.omit()</code>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a>  sat_mod &lt;-<span class="st"> </span></span>
<span id="cb190-2"><a href="#cb190-2"></a><span class="st">      </span>sat_mod <span class="op">%&gt;%</span></span>
<span id="cb190-3"><a href="#cb190-3"></a><span class="st">      </span><span class="kw">update</span>(<span class="dt">data =</span> <span class="kw">na.omit</span>(states_data))</span>
<span id="cb190-4"><a href="#cb190-4"></a></span>
<span id="cb190-5"><a href="#cb190-5"></a>  <span class="co"># compare using an F-test with the anova() function</span></span>
<span id="cb190-6"><a href="#cb190-6"></a>  <span class="kw">anova</span>(sat_mod, sat_voting_mod)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: csat ~ 1 + expense
## Model 2: csat ~ 1 + expense + house + senate
##   Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1     46 169050                              
## 2     44 149284  2     19766 2.9128 0.06486 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="exercise-0-1" class="section level3">
<h3>Exercise 0</h3>
<p><strong>Ordinary least squares regression</strong></p>
<p>Use the <em>states.rds</em> data set. Fit a model predicting energy consumed per capita (energy) from the percentage of residents living in metropolitan areas (<code>metro</code>). Be sure to</p>
<ol style="list-style-type: decimal">
<li>Examine/plot the data before fitting the model</li>
</ol>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Print and interpret the model <code>summary()</code></li>
</ol>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><code>plot()</code> the model to look for deviations from modeling assumptions</li>
</ol>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Select one or more additional predictors to add to your model and repeat steps 1-3. Is this model significantly better than the model with <code>metro</code> as the only predictor?</li>
</ol>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Use the <em>states.rds</em> data set.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a>  states &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;dataSets/states.rds&quot;</span>)</span></code></pre></div>
<p>Fit a model predicting energy consumed per capita (energy) from the percentage of residents living in metropolitan areas (metro). Be sure to:</p>
<ol style="list-style-type: decimal">
<li>Examine/plot the data before fitting the model.</li>
</ol>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1"></a>  states_en_met &lt;-<span class="st"> </span></span>
<span id="cb197-2"><a href="#cb197-2"></a><span class="st">      </span>states <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb197-3"><a href="#cb197-3"></a><span class="st">      </span><span class="kw">select</span>(metro, energy)</span>
<span id="cb197-4"><a href="#cb197-4"></a></span>
<span id="cb197-5"><a href="#cb197-5"></a>  <span class="kw">summary</span>(states_en_met)</span></code></pre></div>
<pre><code>##      metro            energy     
##  Min.   : 20.40   Min.   :200.0  
##  1st Qu.: 46.98   1st Qu.:285.0  
##  Median : 67.55   Median :320.0  
##  Mean   : 64.07   Mean   :354.5  
##  3rd Qu.: 81.58   3rd Qu.:371.5  
##  Max.   :100.00   Max.   :991.0  
##  NA&#39;s   :1        NA&#39;s   :1</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1"></a>  <span class="kw">plot</span>(states_en_met)</span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-100-1.png" width="672" /></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a>  <span class="kw">cor</span>(states_en_met, <span class="dt">use =</span> <span class="st">&quot;pairwise&quot;</span>)</span></code></pre></div>
<pre><code>##             metro     energy
## metro   1.0000000 -0.3397445
## energy -0.3397445  1.0000000</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Print and interpret the model <code>summary()</code>.</li>
</ol>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a>  mod_en_met &lt;-<span class="st"> </span><span class="kw">lm</span>(energy <span class="op">~</span><span class="st"> </span>metro, <span class="dt">data =</span> states)</span>
<span id="cb202-2"><a href="#cb202-2"></a>  <span class="kw">summary</span>(mod_en_met)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = energy ~ metro, data = states)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -215.51  -64.54  -30.87   18.71  583.97 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 501.0292    61.8136   8.105 1.53e-10 ***
## metro        -2.2871     0.9139  -2.503   0.0158 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 140.2 on 48 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.1154, Adjusted R-squared:  0.097 
## F-statistic: 6.263 on 1 and 48 DF,  p-value: 0.01578</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>plot()</code> the model to look for deviations from modeling assumptions.</li>
</ol>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a>  <span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)) <span class="co"># splits the plotting window into 4 panels</span></span>
<span id="cb204-2"><a href="#cb204-2"></a>  <span class="kw">plot</span>(mod_en_met)</span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-102-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Select one or more additional predictors to add to your model and repeat steps 1-3. Is this model significantly better than the model with <em>metro</em> as the only predictor?</li>
</ol>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1"></a>  states_en_met_pop_wst &lt;-<span class="st"> </span></span>
<span id="cb205-2"><a href="#cb205-2"></a><span class="st">      </span>states <span class="op">%&gt;%</span></span>
<span id="cb205-3"><a href="#cb205-3"></a><span class="st">      </span><span class="kw">select</span>(energy, metro, pop, waste)</span>
<span id="cb205-4"><a href="#cb205-4"></a></span>
<span id="cb205-5"><a href="#cb205-5"></a>  <span class="kw">summary</span>(states_en_met_pop_wst)</span></code></pre></div>
<pre><code>##      energy          metro             pop               waste       
##  Min.   :200.0   Min.   : 20.40   Min.   :  454000   Min.   :0.5400  
##  1st Qu.:285.0   1st Qu.: 46.98   1st Qu.: 1299750   1st Qu.:0.8225  
##  Median :320.0   Median : 67.55   Median : 3390500   Median :0.9600  
##  Mean   :354.5   Mean   : 64.07   Mean   : 4962040   Mean   :0.9888  
##  3rd Qu.:371.5   3rd Qu.: 81.58   3rd Qu.: 5898000   3rd Qu.:1.1450  
##  Max.   :991.0   Max.   :100.00   Max.   :29760000   Max.   :1.5100  
##  NA&#39;s   :1       NA&#39;s   :1        NA&#39;s   :1          NA&#39;s   :1</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1"></a>  <span class="kw">plot</span>(states_en_met_pop_wst)</span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-103-1.png" width="672" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a>  <span class="kw">cor</span>(states_en_met_pop_wst, <span class="dt">use =</span> <span class="st">&quot;pairwise&quot;</span>)</span></code></pre></div>
<pre><code>##            energy      metro        pop      waste
## energy  1.0000000 -0.3397445 -0.1840357 -0.2526499
## metro  -0.3397445  1.0000000  0.5653562  0.4877881
## pop    -0.1840357  0.5653562  1.0000000  0.5255713
## waste  -0.2526499  0.4877881  0.5255713  1.0000000</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a>  mod_en_met_pop_waste &lt;-<span class="st"> </span><span class="kw">lm</span>(energy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>metro <span class="op">+</span><span class="st"> </span>pop <span class="op">+</span><span class="st"> </span>waste, <span class="dt">data =</span> states)</span>
<span id="cb210-2"><a href="#cb210-2"></a>  <span class="kw">summary</span>(mod_en_met_pop_waste)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = energy ~ 1 + metro + pop + waste, data = states)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -224.62  -67.48  -31.76   12.65  589.48 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  5.617e+02  9.905e+01   5.671    9e-07 ***
## metro       -2.079e+00  1.168e+00  -1.780   0.0816 .  
## pop          1.649e-06  4.809e-06   0.343   0.7332    
## waste       -8.307e+01  1.042e+02  -0.797   0.4295    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 142.2 on 46 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.1276, Adjusted R-squared:  0.07067 
## F-statistic: 2.242 on 3 and 46 DF,  p-value: 0.09599</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a>  <span class="kw">anova</span>(mod_en_met, mod_en_met_pop_waste)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: energy ~ metro
## Model 2: energy ~ 1 + metro + pop + waste
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     48 943103                           
## 2     46 930153  2     12949 0.3202 0.7276</code></pre>
</div>
</details>
</div>
</div>
<div id="interactions-factors" class="section level2">
<h2>Interactions &amp; factors</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to specify interaction effects and fit models with categorical predictors.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Formula syntax for interaction effects</li>
<li>Factor levels and labels</li>
<li>Contrasts and pairwise comparisons</li>
</ol>
</div>
<div id="modeling-interactions" class="section level3">
<h3>Modeling interactions</h3>
<p>Interactions allow us assess the extent to which the association between one predictor and the outcome depends on a second predictor. For example: Does the association between expense and SAT scores depend on the median income in the state?</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a>  <span class="co"># Add the interaction to the model</span></span>
<span id="cb214-2"><a href="#cb214-2"></a>  sat_expense_by_percent &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expense <span class="op">+</span><span class="st"> </span>income <span class="op">+</span><span class="st"> </span>expense <span class="op">:</span><span class="st"> </span>income, <span class="dt">data =</span> states_data)</span>
<span id="cb214-3"><a href="#cb214-3"></a></span>
<span id="cb214-4"><a href="#cb214-4"></a>  <span class="co"># same as above, but shorter syntax</span></span>
<span id="cb214-5"><a href="#cb214-5"></a>  sat_expense_by_percent &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expense <span class="op">*</span><span class="st"> </span>income, <span class="dt">data =</span> states_data) </span>
<span id="cb214-6"><a href="#cb214-6"></a></span>
<span id="cb214-7"><a href="#cb214-7"></a>  <span class="co"># show the regression coefficients table</span></span>
<span id="cb214-8"><a href="#cb214-8"></a>  <span class="kw">summary</span>(sat_expense_by_percent) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>() </span></code></pre></div>
<pre><code>##                     Estimate   Std. Error   t value     Pr(&gt;|t|)
## (Intercept)     1.380364e+03 1.720863e+02  8.021351 2.367069e-10
## expense        -6.384067e-02 3.270087e-02 -1.952262 5.687837e-02
## income         -1.049785e+01 4.991463e+00 -2.103161 4.083253e-02
## expense:income  1.384647e-03 8.635529e-04  1.603431 1.155395e-01</code></pre>
</div>
<div id="regression-with-categorical-predictors" class="section level3">
<h3>Regression with categorical predictors</h3>
<p>Let’s try to predict SAT scores from <code>region</code>, a categorical variable.
Note that you must make sure R does not think your categorical variable is numeric.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a>  <span class="co"># make sure R knows region is categorical</span></span>
<span id="cb216-2"><a href="#cb216-2"></a>  <span class="kw">str</span>(states_data<span class="op">$</span>region)</span></code></pre></div>
<pre><code>##  Factor w/ 4 levels &quot;West&quot;,&quot;N. East&quot;,..: 3 1 1 3 1 1 2 3 NA 3 ...</code></pre>
<p>Here, R is already treating <code>region</code> as categorical — that is, in R parlance, a “factor” variable. If <code>region</code> were not already a factor, we could make it so like this:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a>  states_data &lt;-<span class="st"> </span>states_data <span class="op">%&gt;%</span></span>
<span id="cb218-2"><a href="#cb218-2"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">factor</span>(region))</span>
<span id="cb218-3"><a href="#cb218-3"></a></span>
<span id="cb218-4"><a href="#cb218-4"></a>  <span class="co"># arguments to the factor() function</span></span>
<span id="cb218-5"><a href="#cb218-5"></a>  <span class="co"># factor(x, levels, labels)</span></span>
<span id="cb218-6"><a href="#cb218-6"></a></span>
<span id="cb218-7"><a href="#cb218-7"></a>  <span class="kw">levels</span>(states_data<span class="op">$</span>region)</span></code></pre></div>
<pre><code>## [1] &quot;West&quot;    &quot;N. East&quot; &quot;South&quot;   &quot;Midwest&quot;</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1"></a>  <span class="co"># add region to the model</span></span>
<span id="cb220-2"><a href="#cb220-2"></a>  sat_region &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>region, <span class="dt">data =</span> states_data) </span>
<span id="cb220-3"><a href="#cb220-3"></a></span>
<span id="cb220-4"><a href="#cb220-4"></a>  <span class="co"># show the results</span></span>
<span id="cb220-5"><a href="#cb220-5"></a>  <span class="kw">summary</span>(sat_region) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>() <span class="co"># show the regression coefficients table</span></span></code></pre></div>
<pre><code>##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)   946.30769   14.79582 63.9577807 1.352577e-46
## regionN. East -56.75214   23.13285 -2.4533141 1.800383e-02
## regionSouth   -16.30769   19.91948 -0.8186806 4.171898e-01
## regionMidwest  63.77564   21.35592  2.9863209 4.514152e-03</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a>  <span class="kw">anova</span>(sat_region) <span class="co"># show ANOVA table</span></span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: csat
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## region     3  82049 27349.8  9.6102 4.859e-05 ***
## Residuals 46 130912  2845.9                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>So, make sure to tell R which variables are categorical by converting them to factors!</p>
</div>
<div id="setting-factor-reference-groups-contrasts" class="section level3">
<h3>Setting factor reference groups &amp; contrasts</h3>
<p><strong>Contrasts</strong> is the umbrella term used to describe the process of testing linear combinations of parameters from regression models. All statistical sofware use contrasts, but each software has different defaults and their own way of overriding these.</p>
<p>The default contrasts in R are “treatment” contrasts (aka “dummy coding”), where each level within a factor is identified within a matrix of binary <code>0</code> / <code>1</code> variables, with the first level chosen as the reference category. They’re called “treatment” contrasts, because of the typical use case where there is one control group (the reference group) and one or more treatment groups that are to be compared to the controls. It is easy to change the default contrasts to something other than treatment contrasts, though this is rarely needed. More often, we may want to change the reference group in treatment contrasts or get all sets of pairwise contrasts between factor levels.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a>  <span class="co"># default treatment (dummy) contrasts</span></span>
<span id="cb224-2"><a href="#cb224-2"></a>  <span class="kw">contrasts</span>(states_data<span class="op">$</span>region)</span></code></pre></div>
<pre><code>##         N. East South Midwest
## West          0     0       0
## N. East       1     0       0
## South         0     1       0
## Midwest       0     0       1</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a>  <span class="co"># change the reference group</span></span>
<span id="cb226-2"><a href="#cb226-2"></a>  states_data &lt;-<span class="st"> </span>states_data <span class="op">%&gt;%</span></span>
<span id="cb226-3"><a href="#cb226-3"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">relevel</span>(region, <span class="dt">ref =</span> <span class="st">&quot;Midwest&quot;</span>))</span>
<span id="cb226-4"><a href="#cb226-4"></a></span>
<span id="cb226-5"><a href="#cb226-5"></a>  <span class="co"># check the reference group has changed</span></span>
<span id="cb226-6"><a href="#cb226-6"></a>  <span class="kw">contrasts</span>(states_data<span class="op">$</span>region)</span></code></pre></div>
<pre><code>##         West N. East South
## Midwest    0       0     0
## West       1       0     0
## N. East    0       1     0
## South      0       0     1</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a>  <span class="co"># refit the model</span></span>
<span id="cb228-2"><a href="#cb228-2"></a>  mod_region &lt;-<span class="st"> </span><span class="kw">lm</span>(csat <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>region, <span class="dt">data =</span> states_data)</span>
<span id="cb228-3"><a href="#cb228-3"></a>  <span class="kw">summary</span>(mod_region) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>()</span></code></pre></div>
<pre><code>##                 Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept)   1010.08333   15.39998 65.589930 4.296307e-47
## regionWest     -63.77564   21.35592 -2.986321 4.514152e-03
## regionN. East -120.52778   23.52385 -5.123641 5.798399e-06
## regionSouth    -80.08333   20.37225 -3.931000 2.826007e-04</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a>  <span class="co"># get all pairwise contrasts between means</span></span>
<span id="cb230-2"><a href="#cb230-2"></a>  mod_region <span class="op">%&gt;%</span></span>
<span id="cb230-3"><a href="#cb230-3"></a><span class="st">      </span><span class="kw">emmeans</span>(<span class="dt">specs =</span> pairwise <span class="op">~</span><span class="st"> </span>region)</span></code></pre></div>
<pre><code>## $emmeans
##  region  emmean   SE df lower.CL upper.CL
##  Midwest   1010 15.4 46      979     1041
##  West       946 14.8 46      917      976
##  N. East    890 17.8 46      854      925
##  South      930 13.3 46      903      957
## 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast          estimate   SE df t.ratio p.value
##  Midwest - West        63.8 21.4 46  2.986  0.0226 
##  Midwest - N. East    120.5 23.5 46  5.124  &lt;.0001 
##  Midwest - South       80.1 20.4 46  3.931  0.0016 
##  West - N. East        56.8 23.1 46  2.453  0.0812 
##  West - South          16.3 19.9 46  0.819  0.8453 
##  N. East - South      -40.4 22.2 46 -1.820  0.2774 
## 
## P value adjustment: tukey method for comparing a family of 4 estimates</code></pre>
</div>
<div id="exercise-1-1" class="section level3">
<h3>Exercise 1</h3>
<p><strong>Interactions &amp; factors</strong></p>
<p>Use the <code>states</code> data set.</p>
<ol style="list-style-type: decimal">
<li>Add on to the regression equation that you created in Exercise 1 by generating an interaction term and testing the interaction.</li>
</ol>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Try adding region to the model. Are there significant differences across the four regions?</li>
</ol>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Use the states data set.</p>
<ol style="list-style-type: decimal">
<li>Add on to the regression equation that you created in exercise 1 by generating an interaction term and testing the interaction.</li>
</ol>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a>  mod_en_metro_by_waste &lt;-<span class="st"> </span><span class="kw">lm</span>(energy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>metro <span class="op">*</span><span class="st"> </span>waste, <span class="dt">data =</span> states)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Try adding a region to the model. Are there significant differences across the four regions?</li>
</ol>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a>  mod_en_region &lt;-<span class="st"> </span><span class="kw">lm</span>(energy <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>metro <span class="op">*</span><span class="st"> </span>waste <span class="op">+</span><span class="st"> </span>region, <span class="dt">data =</span> states)</span>
<span id="cb235-2"><a href="#cb235-2"></a>  <span class="kw">anova</span>(mod_en_metro_by_waste, mod_en_region)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: energy ~ 1 + metro * waste
## Model 2: energy ~ 1 + metro * waste + region
##   Res.Df    RSS Df Sum of Sq    F Pr(&gt;F)
## 1     46 930683                         
## 2     43 821247  3    109436 1.91 0.1422</code></pre>
</div>
</details>
</div>
</div>
<div id="models-with-binary-outcomes" class="section level2">
<h2>Models with binary outcomes</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to use the <code>glm()</code> function to model binary outcomes.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>The <code>family</code> and <code>link</code> components of the <code>glm()</code> function call</li>
<li>Transforming model coefficients into odds ratios</li>
<li>Transforming model coefficients into predicted marginal means</li>
</ol>
</div>
<div id="logistic-regression" class="section level3">
<h3>Logistic regression</h3>
<p>This far we have used the <code>lm()</code> function to fit our regression models. <code>lm()</code> is great, but limited — in particular it only fits models for continuous dependent variables. For categorical dependent variables we can use the <code>glm()</code> function.</p>
<p>For these models we will use a different dataset, drawn from the National Health Interview Survey. From the <a href="http://www.cdc.gov/nchs/nhis.htm">CDC website</a>:</p>
<blockquote>
<p>The National Health Interview Survey (NHIS) has monitored the health of the nation since 1957. NHIS data on a broad range of health topics are collected through personal household interviews. For over 50 years, the U.S. Census Bureau has been the data collection agent for the National Health Interview Survey. Survey results have been instrumental in providing data to track health status, health care access, and progress toward achieving national health objectives.</p>
</blockquote>
<p>Load the National Health Interview Survey data:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a>  NH11 &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;dataSets/NatHealth2011.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="logistic-regression-example" class="section level3">
<h3>Logistic regression example</h3>
<p>Motivation for a logistic regression model — with a binary response:</p>
<ol style="list-style-type: decimal">
<li>Errors will not be normally distributed</li>
<li>Variance will not be homoskedastic</li>
<li>Predictions should be constrained to be on the interval [0, 1]</li>
</ol>
<p><img src="R/Rmodels/images/logistic.png" /></p>
<p>Anatomy of a generalized linear model:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1"></a>  <span class="co"># OLS model using lm()</span></span>
<span id="cb238-2"><a href="#cb238-2"></a>  <span class="kw">lm</span>(outcome <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>pred1 <span class="op">+</span><span class="st"> </span>pred2, </span>
<span id="cb238-3"><a href="#cb238-3"></a>     <span class="dt">data =</span> mydata)</span>
<span id="cb238-4"><a href="#cb238-4"></a></span>
<span id="cb238-5"><a href="#cb238-5"></a>  <span class="co"># OLS model using glm()</span></span>
<span id="cb238-6"><a href="#cb238-6"></a>  <span class="kw">glm</span>(outcome <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>pred1 <span class="op">+</span><span class="st"> </span>pred2, </span>
<span id="cb238-7"><a href="#cb238-7"></a>      <span class="dt">data =</span> mydata, </span>
<span id="cb238-8"><a href="#cb238-8"></a>      <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">&quot;identity&quot;</span>))</span>
<span id="cb238-9"><a href="#cb238-9"></a> </span>
<span id="cb238-10"><a href="#cb238-10"></a>  <span class="co"># logistic model using glm()</span></span>
<span id="cb238-11"><a href="#cb238-11"></a>  <span class="kw">glm</span>(outcome <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>pred1 <span class="op">+</span><span class="st"> </span>pred2, </span>
<span id="cb238-12"><a href="#cb238-12"></a>      <span class="dt">data =</span> mydata, </span>
<span id="cb238-13"><a href="#cb238-13"></a>      <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span></code></pre></div>
<p>The <code>family</code> argument sets the error distribution for the model, while the <code>link</code> function
argument relates the predictors to the expected value of the outcome.</p>
<p>Let’s predict the probability of being diagnosed with hypertension based on age, sex, sleep, and bmi.
Here’s the theoretical model:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
logit(p(hypertension_i = 1)) = \beta_{0}1 + \beta_1age_i + \beta_2sex_i + \beta_3sleep_i + \beta_4bmi_i 
\]</span></p>
</div>
<p>where <span class="math inline">\(logit(\cdot)\)</span> is the non-linear link function that relates a linear expression of the predictors to the expectation of the binary response:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
logit(p(hypertension_i = 1)) = ln \left( \frac{p(hypertension_i = 1)}{1-p(hypertension_i = 1)} \right) = ln \left( \frac{p(hypertension_i = 1)}{p(hypertension_i = 0)} \right)
\]</span></p>
</div>
<p>And here’s how we fit this model in R. First, let’s clean up the hypertension outcome by making it binary:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a>  <span class="kw">str</span>(NH11<span class="op">$</span>hypev) <span class="co"># check stucture of hypev</span></span></code></pre></div>
<pre><code>##  Factor w/ 5 levels &quot;1 Yes&quot;,&quot;2 No&quot;,..: 2 2 1 2 2 1 2 2 1 2 ...</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a>  <span class="kw">levels</span>(NH11<span class="op">$</span>hypev) <span class="co"># check levels of hypev</span></span></code></pre></div>
<pre><code>## [1] &quot;1 Yes&quot;             &quot;2 No&quot;              &quot;7 Refused&quot;        
## [4] &quot;8 Not ascertained&quot; &quot;9 Don&#39;t know&quot;</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a>  <span class="co"># collapse all missing values to NA</span></span>
<span id="cb243-2"><a href="#cb243-2"></a>  NH11 &lt;-<span class="st"> </span>NH11 <span class="op">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">hypev =</span> <span class="kw">factor</span>(hypev, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;2 No&quot;</span>, <span class="st">&quot;1 Yes&quot;</span>)))</span></code></pre></div>
<p>Now let’s use <code>glm()</code> to estimate the model:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1"></a>  <span class="co"># run our regression model</span></span>
<span id="cb244-2"><a href="#cb244-2"></a>  hyp_out &lt;-<span class="st"> </span><span class="kw">glm</span>(hypev <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_p <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>sleep <span class="op">+</span><span class="st"> </span>bmi,</span>
<span id="cb244-3"><a href="#cb244-3"></a>                 <span class="dt">data =</span> NH11, </span>
<span id="cb244-4"><a href="#cb244-4"></a>                 <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb244-5"><a href="#cb244-5"></a></span>
<span id="cb244-6"><a href="#cb244-6"></a>  <span class="kw">summary</span>(hyp_out) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">coef</span>()</span></code></pre></div>
<pre><code>##                 Estimate   Std. Error    z value     Pr(&gt;|z|)
## (Intercept) -4.269466028 0.0564947294 -75.572820 0.000000e+00
## age_p        0.060699303 0.0008227207  73.778743 0.000000e+00
## sex2 Female -0.144025092 0.0267976605  -5.374540 7.677854e-08
## sleep       -0.007035776 0.0016397197  -4.290841 1.779981e-05
## bmi          0.018571704 0.0009510828  19.526906 6.485172e-85</code></pre>
</div>
<div id="odds-ratios" class="section level3">
<h3>Odds ratios</h3>
<p>Generalized linear models use link functions to relate the average value of the response to the predictors,
so raw coefficients are difficult to interpret. For example, the <code>age</code> coefficient of .06 in the previous
model tells us that for every one unit increase in <code>age</code>, the log odds of hypertension diagnosis increases
by 0.06. Since most of us are not used to thinking in log odds this is not too helpful!</p>
<p>One solution is to transform the coefficients to make them easier to interpret.
Here we transform them into odds ratios by exponentiating:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1"></a>  <span class="co"># point estimates</span></span>
<span id="cb246-2"><a href="#cb246-2"></a>  <span class="kw">coef</span>(hyp_out) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</span></code></pre></div>
<pre><code>## (Intercept)       age_p sex2 Female       sleep         bmi 
##  0.01398925  1.06257935  0.86586602  0.99298892  1.01874523</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1"></a>  <span class="co"># confidence intervals</span></span>
<span id="cb248-2"><a href="#cb248-2"></a>  <span class="kw">confint</span>(hyp_out) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">exp</span>()</span></code></pre></div>
<pre><code>##                  2.5 %     97.5 %
## (Intercept) 0.01251677 0.01561971
## age_p       1.06087385 1.06430082
## sex2 Female 0.82155196 0.91255008
## sleep       0.98978755 0.99617465
## bmi         1.01685145 1.02065009</code></pre>
</div>
<div id="predicted-marginal-means" class="section level3">
<h3>Predicted marginal means</h3>
<p>Instead of reporting odds ratios, we may want to calculate predicted marginal means (sometimes called “least-squares means” or “estimated marginal means”). These are average values of the outcome at particular levels of the predictors. For ease of interpretation, we want these marginal means to be on the response scale (i.e., the probability scale). We can use the <code>effects</code> package to compute these quantities of interest for us (by default, the numerical output will be on the response scale).</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1"></a>  hyp_out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb250-2"><a href="#cb250-2"></a><span class="st">      </span><span class="kw">allEffects</span>() <span class="op">%&gt;%</span></span>
<span id="cb250-3"><a href="#cb250-3"></a><span class="st">      </span><span class="kw">plot</span>(<span class="dt">type =</span> <span class="st">&quot;response&quot;</span>) <span class="co"># &quot;response&quot; refers to the probability scale</span></span></code></pre></div>
<p><img src="R/Rmodels/figures/unnamed-chunk-118-1.png" width="672" /></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1"></a>  <span class="co"># generate a sequence of ages at which to get predictions of the outcome</span></span>
<span id="cb251-2"><a href="#cb251-2"></a>  age_years &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">20</span>, <span class="dv">80</span>, <span class="dt">by =</span> <span class="dv">5</span>)</span>
<span id="cb251-3"><a href="#cb251-3"></a>  age_years</span></code></pre></div>
<pre><code>##  [1] 20 25 30 35 40 45 50 55 60 65 70 75 80</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1"></a>  eff_df &lt;-<span class="st"> </span></span>
<span id="cb253-2"><a href="#cb253-2"></a><span class="st">      </span>hyp_out <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb253-3"><a href="#cb253-3"></a><span class="st">      </span><span class="kw">allEffects</span>(<span class="dt">xlevels =</span> <span class="kw">list</span>(<span class="dt">age_p =</span> age_years)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># override defaults for age</span></span>
<span id="cb253-4"><a href="#cb253-4"></a><span class="st">      </span><span class="kw">as.data.frame</span>() <span class="co"># get confidence intervals</span></span>
<span id="cb253-5"><a href="#cb253-5"></a>  </span>
<span id="cb253-6"><a href="#cb253-6"></a>  eff_df</span></code></pre></div>
<pre><code>## $age_p
##    age_p        fit          se      lower      upper
## 1     20 0.06690384 0.001915704 0.06324553 0.07075778
## 2     25 0.08852692 0.002181618 0.08434323 0.09289708
## 3     30 0.11626770 0.002418813 0.11161020 0.12109307
## 4     35 0.15125876 0.002603243 0.14622690 0.15643204
## 5     40 0.19446321 0.002722428 0.18918282 0.19985467
## 6     45 0.24642528 0.002796260 0.24098582 0.25194677
## 7     50 0.30698073 0.002895857 0.30133437 0.31268554
## 8     55 0.37501156 0.003124112 0.36890868 0.38115441
## 9     60 0.44836479 0.003531792 0.44145305 0.45529654
## 10    65 0.52403564 0.004052454 0.51608756 0.53197156
## 11    70 0.59861876 0.004545531 0.58967801 0.60749436
## 12    75 0.66889903 0.004880732 0.65926418 0.67839434
## 13    80 0.73237506 0.004986539 0.72248912 0.74203457
## 
## $sex
##        sex       fit          se     lower     upper
## 1   1 Male 0.2994186 0.004188707 0.2912739 0.3076922
## 2 2 Female 0.2701044 0.003715028 0.2628852 0.2774472
## 
## $sleep
##   sleep       fit          se     lower     upper
## 1     3 0.2899941 0.003276427 0.2836147 0.2964575
## 2    30 0.2524895 0.007427001 0.2382124 0.2673219
## 3    50 0.2268657 0.012446183 0.2034008 0.2521806
## 4    80 0.1919843 0.018549461 0.1582199 0.2309771
## 5   100 0.1710955 0.021584286 0.1328287 0.2176200
## 
## $bmi
##   bmi       fit          se     lower     upper
## 1  10 0.2144084 0.004121590 0.2064409 0.2225972
## 2  30 0.2835093 0.002849407 0.2779580 0.2891272
## 3  60 0.4085485 0.007450161 0.3940311 0.4232272
## 4  80 0.5003663 0.012139141 0.4765911 0.5241398
## 5 100 0.5921593 0.016180071 0.5601051 0.6234481</code></pre>
</div>
<div id="exercise-2" class="section level3">
<h3>Exercise 2</h3>
<p><strong>Logistic regression</strong></p>
<p>Use the <code>NH11</code> data set that we loaded earlier.</p>
<ol style="list-style-type: decimal">
<li>Use <code>glm()</code> to conduct a logistic regression to predict ever worked (<code>everwrk</code>) using age (<code>age_p</code>) and marital status (<code>r_maritl</code>). Make sure you only keep the following two levels for <code>everwrk</code> (<code>1 Yes</code> and <code>2 No</code>). Hint: use the <code>factor()</code> function. Also, make sure to drop any <code>r_maritl</code> levels that do not contain observations. Hint: see <code>?droplevels</code>.</li>
</ol>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Predict the probability of working for each level of marital status. Hint: use <code>allEffects()</code></li>
</ol>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1"></a><span class="co">## </span></span></code></pre></div>
<p>Note that the data are not perfectly clean and ready to be modeled. You will need to clean up at least some of the variables before fitting the model.</p>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Use the NH11 data set that we loaded earlier. Note that the data is not perfectly clean and ready to be modeled. You will need to clean up at least some of the variables before fitting the model.</p>
<ol style="list-style-type: decimal">
<li>Use <code>glm()</code> to conduct a logistic regression to predict ever worked (<code>everwrk</code>) using age (<code>age_p</code>) and marital status (<code>r_maritl</code>). Make sure you only keep the following two levels for <code>everwrk</code> (<code>1 Yes</code> and <code>2 No</code>). Hint: use the <code>factor()</code> function. Also, make sure to drop any <code>r_maritl</code> levels that do not contain observations. Hint: see <code>?droplevels</code>.</li>
</ol>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a>  NH11 &lt;-<span class="st"> </span></span>
<span id="cb257-2"><a href="#cb257-2"></a><span class="st">      </span>NH11 <span class="op">%&gt;%</span></span>
<span id="cb257-3"><a href="#cb257-3"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">everwrk =</span> <span class="kw">factor</span>(everwrk, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1 Yes&quot;</span>, <span class="st">&quot;2 No&quot;</span>)),</span>
<span id="cb257-4"><a href="#cb257-4"></a>             <span class="dt">r_maritl =</span> <span class="kw">droplevels</span>(r_maritl)</span>
<span id="cb257-5"><a href="#cb257-5"></a>             )</span>
<span id="cb257-6"><a href="#cb257-6"></a></span>
<span id="cb257-7"><a href="#cb257-7"></a>  mod_wk_age_mar &lt;-<span class="st"> </span><span class="kw">glm</span>(everwrk <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>age_p <span class="op">+</span><span class="st"> </span>r_maritl, </span>
<span id="cb257-8"><a href="#cb257-8"></a>                        <span class="dt">data =</span> NH11,</span>
<span id="cb257-9"><a href="#cb257-9"></a>                        <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb257-10"><a href="#cb257-10"></a></span>
<span id="cb257-11"><a href="#cb257-11"></a>  <span class="kw">summary</span>(mod_wk_age_mar)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = everwrk ~ 1 + age_p + r_maritl, family = binomial(link = &quot;logit&quot;), 
##     data = NH11)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0436  -0.5650  -0.4391  -0.3370   2.7308  
## 
## Coefficients:
##                                              Estimate Std. Error z value
## (Intercept)                                 -0.440248   0.093538  -4.707
## age_p                                       -0.029812   0.001645 -18.118
## r_maritl2 Married - spouse not in household  0.049675   0.217310   0.229
## r_maritl4 Widowed                            0.683618   0.084335   8.106
## r_maritl5 Divorced                          -0.730115   0.111681  -6.538
## r_maritl6 Separated                         -0.128091   0.151366  -0.846
## r_maritl7 Never married                      0.343611   0.069222   4.964
## r_maritl8 Living with partner               -0.443583   0.137770  -3.220
## r_maritl9 Unknown marital status             0.395480   0.492967   0.802
##                                             Pr(&gt;|z|)    
## (Intercept)                                 2.52e-06 ***
## age_p                                        &lt; 2e-16 ***
## r_maritl2 Married - spouse not in household  0.81919    
## r_maritl4 Widowed                           5.23e-16 ***
## r_maritl5 Divorced                          6.25e-11 ***
## r_maritl6 Separated                          0.39742    
## r_maritl7 Never married                     6.91e-07 ***
## r_maritl8 Living with partner                0.00128 ** 
## r_maritl9 Unknown marital status             0.42241    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 11082  on 14039  degrees of freedom
## Residual deviance: 10309  on 14031  degrees of freedom
##   (18974 observations deleted due to missingness)
## AIC: 10327
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Predict the probability of working for each level of marital status. Hint: use <code>allEffects()</code>.</li>
</ol>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1"></a>  mod_wk_age_mar <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb259-2"><a href="#cb259-2"></a><span class="st">      </span><span class="kw">allEffects</span>() <span class="op">%&gt;%</span></span>
<span id="cb259-3"><a href="#cb259-3"></a><span class="st">      </span><span class="kw">as.data.frame</span>()</span></code></pre></div>
<pre><code>## $age_p
##   age_p        fit          se      lower      upper
## 1    20 0.27587439 0.011448539 0.25400910 0.29886780
## 2    30 0.22043363 0.007483648 0.20611629 0.23545053
## 3    50 0.13477473 0.003183752 0.12865574 0.14113761
## 4    70 0.07902788 0.003053617 0.07324630 0.08522385
## 5    80 0.05987515 0.003123927 0.05403759 0.06629914
## 
## $r_maritl
##                              r_maritl        fit          se      lower
## 1     1 Married - spouse in household 0.10822000 0.004259644 0.10014980
## 2 2 Married - spouse not in household 0.11310823 0.021393167 0.07746061
## 3                           4 Widowed 0.19381087 0.010634762 0.17381358
## 4                          5 Divorced 0.05524394 0.005361664 0.04562877
## 5                         6 Separated 0.09646417 0.012707502 0.07426824
## 6                     7 Never married 0.14611000 0.007459212 0.13208775
## 7               8 Living with partner 0.07224958 0.008904955 0.05662466
## 8            9 Unknown marital status 0.15270076 0.063528455 0.06440837
##        upper
## 1 0.11685606
## 2 0.16227532
## 3 0.21550873
## 4 0.06674358
## 5 0.12440219
## 6 0.16134411
## 7 0.09176661
## 8 0.32055728</code></pre>
</div>
</details>
</div>
</div>
<div id="multilevel-modeling" class="section level2">
<h2>Multilevel modeling</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about how to use the <code>lmer()</code> function to model clustered data.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>The formula syntax for incorporating random effects into a model</li>
<li>Calculating the intraclass correlation (ICC)</li>
<li>Model comparison for fixed and random effects</li>
</ol>
</div>
<div id="multilevel-modeling-overview" class="section level3">
<h3>Multilevel modeling overview</h3>
<ul>
<li>Multi-level (AKA hierarchical) models are a type of <strong>mixed-effects</strong> model</li>
<li>They are used to model data that are clustered (i.e., non-independent)</li>
<li>Mixed-effects models include two types of predictors: <strong>fixed-effects</strong> and <strong>random effects</strong>
<ul>
<li><strong>Fixed-effects</strong> – observed levels are of direct interest (.e.g, sex, political party…)</li>
<li><strong>Random-effects</strong> – observed levels not of direct interest: goal is to make inferences to a population represented by observed levels</li>
<li>In R, the <code>lme4</code> package is the most popular for mixed effects models</li>
<li>Use the <code>lmer()</code> function for liner mixed models, <code>glmer()</code> for generalized linear mixed models</li>
</ul></li>
</ul>
</div>
<div id="the-exam-data" class="section level3">
<h3>The Exam data</h3>
<p>The Exam data set contains exam scores of 4,059 students from 65 schools in Inner London. The variable names are as follows:</p>
<table>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">school</td>
<td align="left">School ID - a factor.</td>
</tr>
<tr class="even">
<td align="left">normexam</td>
<td align="left">Normalized exam score.</td>
</tr>
<tr class="odd">
<td align="left">standLRT</td>
<td align="left">Standardized LR test score.</td>
</tr>
<tr class="even">
<td align="left">student</td>
<td align="left">Student id (within school) - a factor</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1"></a>  Exam &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;dataSets/Exam.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="the-null-model-icc" class="section level3">
<h3>The null model &amp; ICC</h3>
<p>Before we fit our first model, let’s take a look at the R syntax for multilevel models:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1"></a>  <span class="co"># anatomy of lmer() function</span></span>
<span id="cb262-2"><a href="#cb262-2"></a>  <span class="kw">lmer</span>(outcome <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>pred1 <span class="op">+</span><span class="st"> </span>pred2 <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>grouping_variable), </span>
<span id="cb262-3"><a href="#cb262-3"></a>       <span class="dt">data =</span> mydata)</span></code></pre></div>
<p>Notice the formula section within the brackets: <code>(1 | grouping_variable)</code>. This part of the formula tells R about the hierarchical structure of the model. In this case, it says we have a model with random intercepts (<code>1</code>) grouped by (<code>|</code>) a <code>grouping_variable</code>.</p>
<p>As a preliminary modeling step, it is often useful to partition the variance in the dependent variable into the various levels. This can be accomplished by running a null model (i.e., a model with a random effects grouping structure, but no fixed-effects predictors) and then calculating the intra-class correlation (ICC).</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1"></a>  <span class="co"># null model, grouping by school but not fixed effects.</span></span>
<span id="cb263-2"><a href="#cb263-2"></a>  Norm1 &lt;-<span class="kw">lmer</span>(normexam <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>school), </span>
<span id="cb263-3"><a href="#cb263-3"></a>              <span class="dt">data =</span> <span class="kw">na.omit</span>(Exam))</span>
<span id="cb263-4"><a href="#cb263-4"></a>  <span class="kw">summary</span>(Norm1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: normexam ~ 1 + (1 | school)
##    Data: na.omit(Exam)
## 
## REML criterion at convergence: 9962.9
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8749 -0.6452  0.0045  0.6888  3.6836 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  school   (Intercept) 0.1634   0.4042  
##  Residual             0.8520   0.9231  
## Number of obs: 3662, groups:  school, 65
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) -0.01310    0.05312  -0.247</code></pre>
<p>The ICC is calculated as .163/(.163 + .852) = .161, which means that ~16% of the variance is at the school level.</p>
<p>There is no consensus on how to calculate p-values for MLMs; hence why they are omitted from the <code>lme4</code> output. But, if you really need p-values, the <code>lmerTest</code> package will calculate p-values for you (using the Satterthwaite approximation).</p>
</div>
<div id="adding-fixed-effects-predictors" class="section level3">
<h3>Adding fixed-effects predictors</h3>
<p>Here’s a theoretical model that predicts exam scores from student’s standardized tests scores:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
examscores_{ij} = \mu1 + \beta_1testscores_{ij} + U_{0j} + \epsilon_{ij}
\]</span></p>
</div>
<p>where <span class="math inline">\(U_{0j}\)</span> is the random intercept for the <span class="math inline">\(j\)</span><sup>th</sup> <code>school</code>. Let’s implement this in R using <code>lmer()</code>:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1"></a>  Norm2 &lt;-<span class="kw">lmer</span>(normexam <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>standLRT <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>school),</span>
<span id="cb265-2"><a href="#cb265-2"></a>               <span class="dt">data =</span> <span class="kw">na.omit</span>(Exam)) </span>
<span id="cb265-3"><a href="#cb265-3"></a>  <span class="kw">summary</span>(Norm2) </span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: normexam ~ 1 + standLRT + (1 | school)
##    Data: na.omit(Exam)
## 
## REML criterion at convergence: 8483.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6725 -0.6300  0.0234  0.6777  3.3340 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  school   (Intercept) 0.09369  0.3061  
##  Residual             0.56924  0.7545  
## Number of obs: 3662, groups:  school, 65
## 
## Fixed effects:
##               Estimate Std. Error t value
## (Intercept) -4.313e-05  4.055e-02  -0.001
## standLRT     5.669e-01  1.324e-02  42.821
## 
## Correlation of Fixed Effects:
##          (Intr)
## standLRT 0.007</code></pre>
</div>
<div id="multiple-degree-of-freedom-comparisons" class="section level3">
<h3>Multiple degree of freedom comparisons</h3>
<p>As with <code>lm()</code> and <code>glm()</code> models, you can compare the two <code>lmer()</code> models using the <code>anova()</code> function. With mixed effects models, this will produce a likelihood ratio test.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1"></a>  <span class="kw">anova</span>(Norm1, Norm2)</span></code></pre></div>
<pre><code>## Data: na.omit(Exam)
## Models:
## Norm1: normexam ~ 1 + (1 | school)
## Norm2: normexam ~ 1 + standLRT + (1 | school)
##       npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
## Norm1    3 9964.9 9983.5 -4979.4   9958.9                         
## Norm2    4 8480.1 8505.0 -4236.1   8472.1 1486.8  1  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="random-slopes" class="section level3">
<h3>Random slopes</h3>
<p>Add a random effect of students’ standardized test scores as well. Now in addition to estimating the distribution of intercepts across schools, we also estimate the distribution of the slope of exam on standardized test.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1"></a>  Norm3 &lt;-<span class="st"> </span><span class="kw">lmer</span>(normexam <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>standLRT <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>standLRT <span class="op">|</span><span class="st"> </span>school), </span>
<span id="cb269-2"><a href="#cb269-2"></a>                <span class="dt">data =</span> <span class="kw">na.omit</span>(Exam)) </span>
<span id="cb269-3"><a href="#cb269-3"></a>  <span class="kw">summary</span>(Norm3) </span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: normexam ~ 1 + standLRT + (1 + standLRT | school)
##    Data: na.omit(Exam)
## 
## REML criterion at convergence: 8442.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.7904 -0.6246  0.0245  0.6734  3.4376 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  school   (Intercept) 0.09092  0.3015       
##           standLRT    0.01639  0.1280   0.49
##  Residual             0.55589  0.7456       
## Number of obs: 3662, groups:  school, 65
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) -0.01250    0.04011  -0.312
## standLRT     0.56094    0.02119  26.474
## 
## Correlation of Fixed Effects:
##          (Intr)
## standLRT 0.360</code></pre>
</div>
<div id="test-the-significance-of-the-random-slope" class="section level3">
<h3>Test the significance of the random slope</h3>
<p>To test the significance of a random slope just compare models with and without the random slope term using a likelihood ratio test:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1"></a>  <span class="kw">anova</span>(Norm2, Norm3) </span></code></pre></div>
<pre><code>## Data: na.omit(Exam)
## Models:
## Norm2: normexam ~ 1 + standLRT + (1 | school)
## Norm3: normexam ~ 1 + standLRT + (1 + standLRT | school)
##       npar    AIC    BIC  logLik deviance Chisq Df Pr(&gt;Chisq)    
## Norm2    4 8480.1 8505.0 -4236.1   8472.1                        
## Norm3    6 8444.1 8481.4 -4216.1   8432.1 40.01  2  2.051e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="exercise-3-1" class="section level3">
<h3>Exercise 3</h3>
<p><strong>Multilevel modeling</strong></p>
<p>Use the <code>bh1996</code> dataset:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1"></a><span class="co">## install.packages(&quot;multilevel&quot;)</span></span>
<span id="cb273-2"><a href="#cb273-2"></a><span class="kw">data</span>(bh1996, <span class="dt">package=</span><span class="st">&quot;multilevel&quot;</span>)</span></code></pre></div>
<p>From the data documentation:</p>
<blockquote>
<p>Variables are Leadership Climate (<code>LEAD</code>), Well-Being (<code>WBEING</code>), and Work Hours (<code>HRS</code>). The group identifier is named <code>GRP</code>.</p>
</blockquote>
<ol style="list-style-type: decimal">
<li>Create a null model predicting wellbeing (<code>WBEING</code>)</li>
</ol>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the ICC for your null model</li>
</ol>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Run a second multi-level model that adds two individual-level predictors, average number of hours worked (<code>HRS</code>) and leadership skills (<code>LEAD</code>) to the model and interpret your output.</li>
</ol>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Now, add a random effect of average number of hours worked (<code>HRS</code>) to the model and interpret your output. Test the significance of this random term.</li>
</ol>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Use the dataset, bh1996:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1"></a>  <span class="co"># install.packages(&quot;multilevel&quot;)</span></span>
<span id="cb278-2"><a href="#cb278-2"></a>  <span class="kw">data</span>(bh1996, <span class="dt">package=</span><span class="st">&quot;multilevel&quot;</span>)</span></code></pre></div>
<p>From the data documentation:</p>
<blockquote>
<p>Variables are Leadership Climate (<code>LEAD</code>), Well-Being (<code>WBEING</code>), and Work Hours (<code>HRS</code>). The group identifier is named <code>GRP</code>.</p>
</blockquote>
<ol style="list-style-type: decimal">
<li>Create a null model predicting wellbeing (<code>WBEING</code>).</li>
</ol>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a>  mod_grp0 &lt;-<span class="st"> </span><span class="kw">lmer</span>(WBEING <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>GRP), <span class="dt">data =</span> <span class="kw">na.omit</span>(bh1996))</span>
<span id="cb279-2"><a href="#cb279-2"></a>  <span class="kw">summary</span>(mod_grp0)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: WBEING ~ 1 + (1 | GRP)
##    Data: na.omit(bh1996)
## 
## REML criterion at convergence: 19347.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.3217 -0.6475  0.0311  0.7182  2.6674 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  GRP      (Intercept) 0.0358   0.1892  
##  Residual             0.7895   0.8885  
## Number of obs: 7382, groups:  GRP, 99
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   2.7743     0.0222   124.9</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Run a second multi-level model that adds two individual-level predictors, average number of hours worked (<code>HRS</code>) and leadership skills (<code>LEAD</code>) to the model and interpret your output.</li>
</ol>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a>  mod_grp1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(WBEING <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>HRS <span class="op">+</span><span class="st"> </span>LEAD <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>GRP), <span class="dt">data =</span> <span class="kw">na.omit</span>(bh1996))</span>
<span id="cb281-2"><a href="#cb281-2"></a>  <span class="kw">summary</span>(mod_grp1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: WBEING ~ 1 + HRS + LEAD + (1 | GRP)
##    Data: na.omit(bh1996)
## 
## REML criterion at convergence: 17860
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.9188 -0.6588  0.0382  0.7040  3.6440 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  GRP      (Intercept) 0.01929  0.1389  
##  Residual             0.64668  0.8042  
## Number of obs: 7382, groups:  GRP, 99
## 
## Fixed effects:
##              Estimate Std. Error t value
## (Intercept)  1.686160   0.067702  24.906
## HRS         -0.031617   0.004378  -7.221
## LEAD         0.500743   0.012811  39.087
## 
## Correlation of Fixed Effects:
##      (Intr) HRS   
## HRS  -0.800       
## LEAD -0.635  0.121</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Now, add a random effect of average number of hours worked (<code>HRS</code>) to the model and interpret your output. Test the significance of this random term.</li>
</ol>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1"></a>  mod_grp2 &lt;-<span class="st"> </span><span class="kw">lmer</span>(WBEING <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>HRS <span class="op">+</span><span class="st"> </span>LEAD <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>HRS <span class="op">|</span><span class="st"> </span>GRP), <span class="dt">data =</span> <span class="kw">na.omit</span>(bh1996))</span>
<span id="cb283-2"><a href="#cb283-2"></a>  <span class="kw">anova</span>(mod_grp1, mod_grp2)</span></code></pre></div>
<pre><code>## Data: na.omit(bh1996)
## Models:
## mod_grp1: WBEING ~ 1 + HRS + LEAD + (1 | GRP)
## mod_grp2: WBEING ~ 1 + HRS + LEAD + (1 + HRS | GRP)
##          npar   AIC   BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
## mod_grp1    5 17848 17882 -8918.9    17838                     
## mod_grp2    7 17851 17899 -8918.3    17837 1.2202  2     0.5433</code></pre>
</div>
</details>
</div>
</div>
<div id="wrap-up-2" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-2" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-3" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="r-graphics" class="section level1">
<h1>R Graphics</h1>
<p><strong>Topics</strong></p>
<ul>
<li>R <code>ggplot2</code> package</li>
<li>Geometric objects and aesthetics</li>
<li>Setup basic plots</li>
<li>Add and modify scales and legends</li>
<li>Manipulate plot labels</li>
<li>Change and create plot themes</li>
</ul>
<div id="setup-2" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials-2" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./Rinstall.html">R Installation</a> instructions and ensure that you can successfully start RStudio.</p>
</div>
<div id="class-structure-2" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites-2" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate R course:</p>
<ul>
<li>Assumes working knowledge of R</li>
<li>Relatively fast-paced</li>
</ul>
</div>
<div id="launch-an-r-session-1" class="section level3">
<h3>Launch an R session</h3>
<p>Start RStudio and create a new project:</p>
<ul>
<li>On Windows click the start button and search for RStudio. On Mac
RStudio will be in your applications folder.</li>
<li>In Rstudio go to <code>File -&gt; New Project</code>.</li>
<li>Choose <code>Existing Directory</code> and browse to the workshop materials directory on your desktop.</li>
<li>Choose <code>File -&gt; Open File</code> and select the file with the word “BLANK” in the name.</li>
</ul>
</div>
<div id="packages-1" class="section level3">
<h3>Packages</h3>
<p>You should have already installed the <code>tidyverse</code> and <code>rmarkdown</code>
packages onto your computer before the workshop
— see <a href="./Rinstall.html">R Installation</a>.
Now let’s load these packages into the search path of our R session.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb285-2"><a href="#cb285-2"></a><span class="kw">library</span>(rmarkdown)</span></code></pre></div>
<p>The <code>ggplot2</code> package is contained within <code>tidyverse</code>, but we also want to
install two additional packages, <code>scales</code> and <code>ggrepel</code>, which provide
additional functionality.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1"></a><span class="co"># install.packages(&quot;scales&quot;)</span></span>
<span id="cb286-2"><a href="#cb286-2"></a><span class="kw">library</span>(scales)</span>
<span id="cb286-3"><a href="#cb286-3"></a></span>
<span id="cb286-4"><a href="#cb286-4"></a><span class="co"># install.packages(&quot;ggrepel&quot;) </span></span>
<span id="cb286-5"><a href="#cb286-5"></a><span class="kw">library</span>(ggrepel)</span></code></pre></div>
</div>
<div id="goals-2" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the <code>grammar of graphics</code> — a system for understanding
the building blocks of a graph — using the <code>ggplot2</code> package. In particular,
we’ll learn about:</p>
<ol style="list-style-type: decimal">
<li>Basic plots, <strong>aesthetic mapping and inheritance</strong></li>
<li>Tailoring <strong>statistical transformations</strong> to particular plots</li>
<li><strong>Modifying scales</strong> to change axes and add labels</li>
<li><strong>Faceting</strong> to create many small plots</li>
<li>Changing plot <strong>themes</strong></li>
</ol>
</div>
</div>
</div>
<div id="why-ggplot2" class="section level2">
<h2>Why <code>ggplot2</code>?</h2>
<p><code>ggplot2</code> is a package within in the <code>tidyverse</code> suite of packages. Advantages of <code>ggplot2</code> include:</p>
<ul>
<li>consistent underlying <code>grammar of graphics</code> (Wilkinson, 2005)</li>
<li>very flexible — plot specification at a high level of abstraction</li>
<li>theme system for polishing plot appearance</li>
<li>many users, active mailing list</li>
</ul>
<p>That said, there are some things you cannot (or should not) do with <code>ggplot2</code>:</p>
<ul>
<li>3-dimensional graphics (see the <code>rgl</code> package)</li>
<li>Graph-theory type graphs (nodes/edges layout; see the <code>igraph</code> package)</li>
<li>Interactive graphics (see the <code>ggvis</code> package)</li>
</ul>
<div id="what-is-the-grammar-of-graphics" class="section level3">
<h3>What is the Grammar Of Graphics?</h3>
<p>The basic idea: independently specify plot building blocks and combine them to create just
about any kind of graphical display you want. Building blocks of a graph include the
following (<strong>bold denotes essential elements</strong>):</p>
<ul>
<li><strong>data</strong></li>
<li><strong>aesthetic mapping</strong></li>
<li><strong>geometric object</strong></li>
<li>statistical transformations</li>
<li>scales</li>
<li>coordinate system</li>
<li>position adjustments</li>
<li>faceting</li>
<li>themes</li>
</ul>
<p>By the end of this workshop, you should understand what these building blocks do and
how to use them to create the following plot:</p>
<p><img src="R/Rgraphics/images/final_plot.png" /></p>
</div>
<div id="ggplot2-vs-base-graphics" class="section level3">
<h3><code>ggplot2</code> VS base graphics</h3>
<p>Compared to base graphics, <code>ggplot2</code></p>
<ul>
<li>is more verbose for simple / canned graphics</li>
<li>is less verbose for complex / custom graphics</li>
<li>does not have methods (data should always be in a <code>data.frame</code>)</li>
<li>has sensible defaults for generating legends</li>
</ul>
</div>
</div>
<div id="geometric-objects-aesthetics" class="section level2">
<h2>Geometric objects &amp; aesthetics</h2>
<div id="aesthetic-mapping" class="section level3">
<h3>Aesthetic mapping</h3>
<p>In ggplot land <em>aesthetic</em> means “something you can see”. Examples include:</p>
<ul>
<li>position (i.e., on the x and y axes)</li>
<li>color (“outside” color)</li>
<li>fill (“inside” color)</li>
<li>shape (of points)</li>
<li>linetype</li>
<li>size</li>
</ul>
<p>Each type of geom accepts only a subset of all aesthetics; refer to the geom help pages to see what mappings each geom accepts. Aesthetic mappings are set with the <code>aes()</code> function.</p>
</div>
<div id="geometric-objects-geom" class="section level3">
<h3>Geometric objects (<code>geom</code>)</h3>
<p>Geometric objects are the actual marks we put on a plot. Examples include:</p>
<ul>
<li>points (<code>geom_point()</code>, for scatter plots, dot plots, etc.)</li>
<li>lines (<code>geom_line()</code>, for time series, trend lines, etc.)</li>
<li>boxplot (<code>geom_boxplot()</code>, for boxplots!)</li>
</ul>
<p>A plot <strong>must have at least one geom</strong>; there is no upper limit. You can add a geom to a plot using the <code>+</code> operator.</p>
<p>Each <code>geom_</code> has a particular set of aesthetic mappings associated with it. Some examples are provided below,
with required aesthetics in <strong>bold</strong> and optional aesthetics in plain text:</p>
<table>
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><code>geom_</code></th>
<th align="left">Usage</th>
<th align="left">Aesthetics</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>geom_point()</code></td>
<td align="left">Scatter plot</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<code>alpha</code>,<code>color</code>,<code>fill</code>,<code>group</code>,<code>shape</code>,<code>size</code>,<code>stroke</code></td>
</tr>
<tr class="even">
<td align="left"><code>geom_line()</code></td>
<td align="left">Line plot</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<code>alpha</code>,<code>color</code>,<code>linetype</code>,<code>size</code></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_bar()</code></td>
<td align="left">Bar chart</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<code>alpha</code>,<code>color</code>,<code>fill</code>,<code>group</code>,<code>linetype</code>,<code>size</code></td>
</tr>
<tr class="even">
<td align="left"><code>geom_boxplot()</code></td>
<td align="left">Boxplot</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>lower</code></strong>,<strong><code>upper</code></strong>,<strong><code>middle</code></strong>,<strong><code>ymin</code></strong>,<strong><code>ymax</code></strong>,<code>alpha</code>,<code>color</code>,<code>fill</code></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_density()</code></td>
<td align="left">Density plot</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<code>alpha</code>,<code>color</code>,<code>fill</code>,<code>group</code>,<code>linetype</code>,<code>size</code>,<code>weight</code></td>
</tr>
<tr class="even">
<td align="left"><code>geom_smooth()</code></td>
<td align="left">Conditional means</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<code>alpha</code>,<code>color</code>,<code>fill</code>,<code>group</code>,<code>linetype</code>,<code>size</code>,<code>weight</code></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_label()</code></td>
<td align="left">Text</td>
<td align="left"><strong><code>x</code></strong>,<strong><code>y</code></strong>,<strong><code>label</code></strong>,<code>alpha</code>,<code>angle</code>,<code>color</code>,<code>family</code>,<code>fontface</code>,<code>size</code></td>
</tr>
</tbody>
</table>
<p>You can get a list of all available geometric objects and their associated aesthetics at <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a>. Or, simply type <code>geom_&lt;tab&gt;</code> in any good R IDE (such as Rstudio) to see a list of functions starting with <code>geom_</code>.</p>
<div id="points-scatterplot" class="section level4">
<h4>Points (scatterplot)</h4>
<p>Now that we know about geometric objects and aesthetic mapping, we can make a <code>ggplot()</code>. <code>geom_point()</code> requires mappings for x and y, all others are optional.</p>
<p><strong>Example data: housing prices</strong></p>
<p>Let’s look at housing prices.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1"></a>housing &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;dataSets/landdata-states.csv&quot;</span>)</span>
<span id="cb287-2"><a href="#cb287-2"></a><span class="kw">head</span>(housing[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]) <span class="co"># view first 5 columns</span></span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   State region  Date Home_Value Structure_Cost
##   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
## 1 AK    West   2010.     224952         160599
## 2 AK    West   2010.     225511         160252
## 3 AK    West   2010.     225820         163791
## 4 AK    West   2010      224994         161787
## 5 AK    West   2008      234590         155400
## 6 AK    West   2008.     233714         157458</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1"></a><span class="co"># create a subset for 1st quarter 2001</span></span>
<span id="cb289-2"><a href="#cb289-2"></a>hp2001Q1 &lt;-<span class="st"> </span>housing <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Date <span class="op">==</span><span class="st"> </span><span class="fl">2001.25</span>)</span></code></pre></div>
<p><strong>Step 1:</strong> create a blank canvas by specifying data:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> hp2001Q1)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-143-1.png" width="672" /></p>
<p><strong>Step 2:</strong> specify aesthetic mappings (how you want to map variables to visual aspects):</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1"></a><span class="co"># here we map &quot;Land_Value&quot; and &quot;Structure_Cost&quot; to the x- and y-axes.</span></span>
<span id="cb291-2"><a href="#cb291-2"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> hp2001Q1, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Land_Value, <span class="dt">y =</span> Structure_Cost))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-144-1.png" width="672" /></p>
<p><strong>Step 3:</strong> add new layers of geometric objects that will show up on the plot:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1"></a><span class="co"># here we use geom_point() to add a layer with point (dot) elements </span></span>
<span id="cb292-2"><a href="#cb292-2"></a><span class="co"># as the geometric shapes to represent the data.</span></span>
<span id="cb292-3"><a href="#cb292-3"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> hp2001Q1, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> Land_Value, <span class="dt">y =</span> Structure_Cost)) <span class="op">+</span></span>
<span id="cb292-4"><a href="#cb292-4"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-145-1.png" width="672" /></p>
</div>
<div id="lines-prediction-line" class="section level4">
<h4>Lines (prediction line)</h4>
<p>A plot constructed with <code>ggplot()</code> can have more than one geom. In that case the mappings established in the <code>ggplot()</code> call are plot defaults that can be added to or overridden — this is referred to as <strong>aesthetic inheritance</strong>. Our plot could use a regression line:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1"></a><span class="co"># get predicted values from a linear regression</span></span>
<span id="cb293-2"><a href="#cb293-2"></a>hp2001Q1<span class="op">$</span>pred_SC &lt;-<span class="st"> </span><span class="kw">lm</span>(Structure_Cost <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(Land_Value), <span class="dt">data =</span> hp2001Q1) <span class="op">%&gt;%</span></span>
<span id="cb293-3"><a href="#cb293-3"></a><span class="st">  </span><span class="kw">predict</span>()</span>
<span id="cb293-4"><a href="#cb293-4"></a></span>
<span id="cb293-5"><a href="#cb293-5"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(hp2001Q1, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">log</span>(Land_Value), <span class="dt">y =</span> Structure_Cost))</span>
<span id="cb293-6"><a href="#cb293-6"></a></span>
<span id="cb293-7"><a href="#cb293-7"></a>p1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Home_Value)) <span class="op">+</span><span class="st"> </span><span class="co"># values for x and y are inherited from the ggplot() call above</span></span>
<span id="cb293-8"><a href="#cb293-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_SC)) <span class="co"># add predicted values to the plot overriding the y values from the ggplot() call above</span></span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-146-1.png" width="672" /></p>
</div>
<div id="smoothers" class="section level4">
<h4>Smoothers</h4>
<p>Not all geometric objects are simple shapes; the smooth geom includes a line and a ribbon.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1"></a>p1 <span class="op">+</span></span>
<span id="cb294-2"><a href="#cb294-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Home_Value)) <span class="op">+</span></span>
<span id="cb294-3"><a href="#cb294-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-147-1.png" width="672" /></p>
</div>
<div id="text-label-points" class="section level4">
<h4>Text (label points)</h4>
<p>Each geom accepts a particular set of mappings; for example <code>geom_text()</code> accepts a <code>label</code> mapping.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1"></a>p1 <span class="op">+</span><span class="st"> </span></span>
<span id="cb295-2"><a href="#cb295-2"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> State), <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-148-1.png" width="672" /></p>
<p>But what if we want to include points and labels? We can use <code>geom_text_repel()</code> to keep labels from overlapping the points and each other.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1"></a>p1 <span class="op">+</span><span class="st"> </span></span>
<span id="cb296-2"><a href="#cb296-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb296-3"><a href="#cb296-3"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> State), <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-149-1.png" width="672" /></p>
</div>
</div>
<div id="aesthetic-mapping-vs-assignment" class="section level3">
<h3>Aesthetic mapping VS assignment</h3>
<ol style="list-style-type: decimal">
<li>Variables are <strong>mapped</strong> to aesthetics inside the <code>aes()</code> function.</li>
</ol>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1"></a>p1 <span class="op">+</span></span>
<span id="cb297-2"><a href="#cb297-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> Home_Value))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-150-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Constants are <strong>assigned</strong> to aesthetics outside the <code>aes()</code> call</li>
</ol>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1"></a>p1 <span class="op">+</span></span>
<span id="cb298-2"><a href="#cb298-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-151-1.png" width="672" /></p>
<p>This sometimes leads to confusion, as in this example:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1"></a>p1 <span class="op">+</span></span>
<span id="cb299-2"><a href="#cb299-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> <span class="dv">2</span>),<span class="co"># incorrect! 2 is not a variable</span></span>
<span id="cb299-3"><a href="#cb299-3"></a>             <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="co"># this is fine -- all points red</span></span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-152-1.png" width="672" /></p>
</div>
<div id="mapping-variables-to-other-aesthetics" class="section level3">
<h3>Mapping variables to other aesthetics</h3>
<p>Other aesthetics are mapped in the same way as x and y in the previous example.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1"></a>p1 <span class="op">+</span></span>
<span id="cb300-2"><a href="#cb300-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Home_Value, <span class="dt">shape =</span> region))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-153-1.png" width="672" /></p>
</div>
<div id="exercise-0-2" class="section level3">
<h3>Exercise 0</h3>
<p>The data for the exercises is available in the <code>dataSets/EconomistData.csv</code> file. Read it in with</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1"></a>dat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;dataSets/EconomistData.csv&quot;</span>)</span></code></pre></div>
<p>Original sources for these data are <a href="http://www.transparency.org/content/download/64476/1031428" class="uri">http://www.transparency.org/content/download/64476/1031428</a> <a href="http://hdrstats.undp.org/en/indicators/display_cf_xls_indicator.cfm?indicator_id=103106&amp;lang=en" class="uri">http://hdrstats.undp.org/en/indicators/display_cf_xls_indicator.cfm?indicator_id=103106&amp;lang=en</a></p>
<p>These data consist of <em>Human Development Index</em> and <em>Corruption Perception Index</em> scores for several countries.</p>
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis.</li>
</ol>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Color the points in the previous plot blue.</li>
</ol>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Map the color of the the points to <code>Region</code>.</li>
</ol>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Keeping color mapped to <code>Region</code>, make the points bigger by setting size to 2</li>
</ol>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Keeping color mapped to <code>Region</code>, map the size of the points to <code>HDI_Rank</code></li>
</ol>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis.</li>
</ol>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb307-2"><a href="#cb307-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-160-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Color the points in the previous plot blue.</li>
</ol>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb308-2"><a href="#cb308-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-161-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Map the color of the the points to <code>Region</code>.</li>
</ol>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb309-2"><a href="#cb309-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Region))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-162-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Keeping color mapped to <code>Region</code>, make the points bigger by setting size to 2.</li>
</ol>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb310-2"><a href="#cb310-2"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Region), <span class="dt">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-163-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Keeping color mapped to <code>Region</code>, map the size of the points to <code>HDI_Rank</code>.</li>
</ol>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb311-2"><a href="#cb311-2"></a><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Region, <span class="dt">size =</span>  HDI_Rank))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-164-1.png" width="672" /></p>
</div>
</details>
</div>
</div>
<div id="statistical-transformations" class="section level2">
<h2>Statistical transformations</h2>
<div id="why-transform-data" class="section level3">
<h3>Why transform data?</h3>
<p>Some plot types (such as scatterplots) do not require transformations; each point is plotted at x and y coordinates equal to the original value. Other plots, such as boxplots, histograms, prediction lines etc. require statistical transformations:</p>
<ul>
<li>for a boxplot the y values must be transformed to the median and 1.5(IQR)</li>
<li>for a smoother the y values must be transformed into predicted values</li>
</ul>
<p>Each geom has a default statistic, but these can be changed. For example, the default statistic for <code>geom_histogram()</code> is <code>stat_bin()</code>:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1"></a><span class="kw">args</span>(geom_histogram)</span></code></pre></div>
<pre><code>## function (mapping = NULL, data = NULL, stat = &quot;bin&quot;, position = &quot;stack&quot;, 
##     ..., binwidth = NULL, bins = NULL, na.rm = FALSE, orientation = NA, 
##     show.legend = NA, inherit.aes = TRUE) 
## NULL</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1"></a><span class="kw">args</span>(stat_bin)</span></code></pre></div>
<pre><code>## function (mapping = NULL, data = NULL, geom = &quot;bar&quot;, position = &quot;stack&quot;, 
##     ..., binwidth = NULL, bins = NULL, center = NULL, boundary = NULL, 
##     breaks = NULL, closed = c(&quot;right&quot;, &quot;left&quot;), pad = FALSE, 
##     na.rm = FALSE, orientation = NA, show.legend = NA, inherit.aes = TRUE) 
## NULL</code></pre>
<p>Here is a list of geoms and their default statistics <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a></p>
</div>
<div id="setting-arguments" class="section level3">
<h3>Setting arguments</h3>
<p>Arguments to <code>stat_</code> functions can be passed through <code>geom_</code> functions. This can be slightly annoying because in order to change them you have to first determine which stat the geom uses, then determine the arguments to that stat.</p>
<p>For example, here is the default histogram of <code>Home_Value</code>:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(housing, <span class="kw">aes</span>(<span class="dt">x =</span> Home_Value))</span>
<span id="cb316-2"><a href="#cb316-2"></a>p2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-166-1.png" width="672" /></p>
<p>We can change the binning scheme by passing the <code>binwidth</code> argument to the <code>stat_bin()</code> function:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1"></a>p2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">stat =</span> <span class="st">&quot;bin&quot;</span>, <span class="dt">binwidth =</span> <span class="dv">4000</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-167-1.png" width="672" /></p>
</div>
<div id="changing-the-transformation" class="section level3">
<h3>Changing the transformation</h3>
<p>Sometimes the default statistical transformation is not what you need. This is often the case with pre-summarized data:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1"></a>housing_sum &lt;-<span class="st"> </span></span>
<span id="cb318-2"><a href="#cb318-2"></a><span class="st">  </span>housing <span class="op">%&gt;%</span></span>
<span id="cb318-3"><a href="#cb318-3"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb318-4"><a href="#cb318-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Home_Value_Mean =</span> <span class="kw">mean</span>(Home_Value)) <span class="op">%&gt;%</span></span>
<span id="cb318-5"><a href="#cb318-5"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb318-6"><a href="#cb318-6"></a></span>
<span id="cb318-7"><a href="#cb318-7"></a><span class="kw">head</span>(housing_sum)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   State Home_Value_Mean
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 AK            147385.
## 2 AL             92545.
## 3 AR             82077.
## 4 AZ            140756.
## 5 CA            282808.
## 6 CO            158176.</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1"></a><span class="kw">ggplot</span>(housing_sum, <span class="kw">aes</span>(<span class="dt">x =</span> State, <span class="dt">y =</span> Home_Value_Mean)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb320-2"><a href="#cb320-2"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span>
<span id="cb320-3"><a href="#cb320-3"></a></span>
<span id="cb320-4"><a href="#cb320-4"></a><span class="co">## Error: stat_count() must not be used with a y aesthetic.  </span></span></code></pre></div>
<p>What is the problem with the previous plot? Basically we take binned and summarized data and ask ggplot to bin and summarize it again (remember, <code>geom_bar()</code> defaults to <code>stat = stat_count</code>; obviously this will not work. We can fix it by telling <code>geom_bar()</code> to use a different statistical transformation function. The <code>identity</code> function returns the same output as the input.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1"></a><span class="kw">ggplot</span>(housing_sum, <span class="kw">aes</span>(<span class="dt">x =</span> State, <span class="dt">y =</span> Home_Value_Mean)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb321-2"><a href="#cb321-2"></a><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-170-1.png" width="672" /></p>
</div>
<div id="exercise-1-2" class="section level3">
<h3>Exercise 1</h3>
<ol style="list-style-type: decimal">
<li>Re-create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis (as you did in the previous exercise).</li>
</ol>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Overlay a smoothing line on top of the scatter plot using <code>geom_smooth()</code>.</li>
</ol>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Make the smoothing line in <code>geom_smooth()</code> less smooth. Hint: see <code>?loess</code>.</li>
</ol>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Change the smoothing line in <code>geom_smooth()</code> to use a linear model for the predictions. Hint: see <code>?stat_smooth</code>.</li>
</ol>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>BONUS 1: Allow the smoothing line created in the last plot to vary across the levels of <code>Region</code>. Hint: map <code>Region</code> to the color and fill aesthetics.</li>
</ol>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>BONUS 2: Overlay a loess <code>(method = "loess")</code> smoothing line on top of the scatter plot using <code>geom_line()</code>. Hint: change the statistical transformation.</li>
</ol>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Re-create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis (as you did in the previous exercise).</li>
</ol>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb328-2"><a href="#cb328-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-177-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Overlay a smoothing line on top of the scatter plot using <code>geom_smooth()</code>.</li>
</ol>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb329-2"><a href="#cb329-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb329-3"><a href="#cb329-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-178-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Make the smoothing line in <code>geom_smooth()</code> less smooth. Hint: see <code>?loess</code>.</li>
</ol>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb330-2"><a href="#cb330-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb330-3"><a href="#cb330-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">span =</span> <span class="fl">.4</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-179-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Change the smoothing line in <code>geom_smooth()</code> to use a linear model for the predictions. Hint: see <code>?stat_smooth</code>.</li>
</ol>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb331-2"><a href="#cb331-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb331-3"><a href="#cb331-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-180-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>BONUS 1: Allow the smoothing line created in the last plot to vary across the levels of <code>Region</code>. Hint: map <code>Region</code> to the color and fill aesthetics.</li>
</ol>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI, <span class="dt">color =</span> Region, <span class="dt">fill =</span> Region)) <span class="op">+</span></span>
<span id="cb332-2"><a href="#cb332-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb332-3"><a href="#cb332-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-181-1.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>BONUS 2: Overlay a loess <code>(method = "loess")</code> smoothing line on top of the scatter plot using <code>geom_line()</code>. Hint: change the statistical transformation.</li>
</ol>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI)) <span class="op">+</span></span>
<span id="cb333-2"><a href="#cb333-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb333-3"><a href="#cb333-3"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&quot;smooth&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-182-1.png" width="672" /></p>
</div>
</details>
</div>
</div>
<div id="scales" class="section level2">
<h2>Scales</h2>
<div id="controlling-aesthetic-mapping" class="section level3">
<h3>Controlling aesthetic mapping</h3>
<p>Aesthetic mapping (i.e., with <code>aes()</code>) only says that a variable should be mapped to an aesthetic. It doesn’t say <em>how</em> that should happen. For example, when mapping a variable to <em>shape</em> with <code>aes(shape = x)</code> you don’t say <em>what</em> shapes should be used. Similarly, <code>aes(color = y)</code> doesn’t say <em>what</em> colors should be used. Also, <code>aes(size = z)</code> doesn’t say <em>what</em> sizes should be used. Describing what colors/shapes/sizes etc. to use is done by modifying the corresponding <em>scale</em>. In <code>ggplot2</code> scales include</p>
<ul>
<li>position</li>
<li>color and fill</li>
<li>size</li>
<li>shape</li>
<li>line type</li>
</ul>
<p>Scales are modified with a series of functions using a <code>scale_&lt;aesthetic&gt;_&lt;type&gt;</code> naming scheme. Try typing <code>scale_&lt;tab&gt;</code> to see a list of scale modification functions.</p>
</div>
<div id="common-scale-arguments" class="section level3">
<h3>Common scale arguments</h3>
<p>The following arguments are common to most scales in <code>ggplot2</code>:</p>
<ul>
<li><strong>name:</strong> the axis or legend title</li>
<li><strong>limits:</strong> the minimum and maximum of the scale</li>
<li><strong>breaks:</strong> the points along the scale where labels should appear</li>
<li><strong>labels:</strong> the labels that appear at each break</li>
</ul>
<p>Specific scale functions may have additional arguments; for example, the <code>scale_color_continuous()</code> function has arguments <code>low</code> and <code>high</code> for setting the colors at the low and high end of the scale.</p>
</div>
<div id="scale-modification-examples" class="section level3">
<h3>Scale modification examples</h3>
<p>Start by constructing a dotplot showing the distribution of home values by <code>Date</code> and <code>State</code>.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1"></a>p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(housing, <span class="kw">aes</span>(<span class="dt">x =</span> State, <span class="dt">y =</span> Home_Price_Index)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb334-2"><a href="#cb334-2"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Date), <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb334-3"><a href="#cb334-3"></a>               <span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> <span class="fl">0.25</span>, <span class="dt">height =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>Now modify the breaks for the color scales</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1"></a>p4 <span class="op">+</span><span class="st"> </span></span>
<span id="cb335-2"><a href="#cb335-2"></a><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">name=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb335-3"><a href="#cb335-3"></a>                         <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1976</span>, <span class="dv">1994</span>, <span class="dv">2013</span>),</span>
<span id="cb335-4"><a href="#cb335-4"></a>                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&#39;76&quot;</span>, <span class="st">&quot;&#39;94&quot;</span>, <span class="st">&quot;&#39;13&quot;</span>))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-184-1.png" width="672" /></p>
<p>Next change the low and high values to blue and red:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1"></a>p4 <span class="op">+</span></span>
<span id="cb336-2"><a href="#cb336-2"></a><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">name=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb336-3"><a href="#cb336-3"></a>                         <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1976</span>, <span class="dv">1994</span>, <span class="dv">2013</span>),</span>
<span id="cb336-4"><a href="#cb336-4"></a>                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&#39;76&quot;</span>, <span class="st">&quot;&#39;94&quot;</span>, <span class="st">&quot;&#39;13&quot;</span>),</span>
<span id="cb336-5"><a href="#cb336-5"></a>                         <span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-185-1.png" width="672" /></p>
</div>
<div id="using-different-color-scales" class="section level3">
<h3>Using different color scales</h3>
<p><code>ggplot2</code> has a wide variety of color scales; here is an example using <code>scale_color_gradient2()</code> to interpolate between three different colors.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1"></a>p4 <span class="op">+</span></span>
<span id="cb337-2"><a href="#cb337-2"></a><span class="st">  </span><span class="kw">scale_color_gradient2</span>(<span class="dt">name=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb337-3"><a href="#cb337-3"></a>                        <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1976</span>, <span class="dv">1994</span>, <span class="dv">2013</span>),</span>
<span id="cb337-4"><a href="#cb337-4"></a>                        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&#39;76&quot;</span>, <span class="st">&quot;&#39;94&quot;</span>, <span class="st">&quot;&#39;13&quot;</span>),</span>
<span id="cb337-5"><a href="#cb337-5"></a>                        <span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb337-6"><a href="#cb337-6"></a>                        <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb337-7"><a href="#cb337-7"></a>                        <span class="dt">mid =</span> <span class="st">&quot;gray60&quot;</span>,</span>
<span id="cb337-8"><a href="#cb337-8"></a>                        <span class="dt">midpoint =</span> <span class="dv">1994</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-186-1.png" width="672" /></p>
</div>
<div id="available-scales" class="section level3">
<h3>Available scales</h3>
<ul>
<li>Partial combination matrix of available scales</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left"><code>scale_</code></th>
<th align="left">Types</th>
<th align="left">Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>scale_color_</code></td>
<td align="left"><code>identity</code></td>
<td align="left"><code>scale_fill_continuous()</code></td>
</tr>
<tr class="even">
<td align="left"><code>scale_fill_</code></td>
<td align="left"><code>manual</code></td>
<td align="left"><code>scale_color_discrete()</code></td>
</tr>
<tr class="odd">
<td align="left"><code>scale_size_</code></td>
<td align="left"><code>continuous</code></td>
<td align="left"><code>scale_size_manual()</code></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>discrete</code></td>
<td align="left"><code>scale_size_discrete()</code></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>scale_shape_</code></td>
<td align="left"><code>discrete</code></td>
<td align="left"><code>scale_shape_discrete()</code></td>
</tr>
<tr class="odd">
<td align="left"><code>scale_linetype_</code></td>
<td align="left"><code>identity</code></td>
<td align="left"><code>scale_shape_manual()</code></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>manual</code></td>
<td align="left"><code>scale_linetype_discrete()</code></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>scale_x_</code></td>
<td align="left"><code>continuous</code></td>
<td align="left"><code>scale_x_continuous()</code></td>
</tr>
<tr class="odd">
<td align="left"><code>scale_y_</code></td>
<td align="left"><code>discrete</code></td>
<td align="left"><code>scale_y_discrete()</code></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>reverse</code></td>
<td align="left"><code>scale_x_log()</code></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><code>log</code></td>
<td align="left"><code>scale_y_reverse()</code></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>date</code></td>
<td align="left"><code>scale_x_date()</code></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><code>datetime</code></td>
<td align="left"><code>scale_y_datetime()</code></td>
</tr>
</tbody>
</table>
<p>Note that in RStudio you can type <code>scale_</code> followed by <code>tab</code> to get the whole list of available scales. For a complete list of available scales see <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a></p>
</div>
<div id="exercise-2-1" class="section level3">
<h3>Exercise 2</h3>
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis. Color the points to indicate <code>Region</code>.</li>
</ol>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Modify the x, y, and color scales so that they have more easily-understood names (e.g., spell out “Human development Index” instead of <code>HDI</code>). Hint: see <code>?scale_x_continous</code>, <code>?scale_y_continuous</code>, and <code>?scale_color_discrete</code>.</li>
</ol>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Modify the color scale to use specific values of your choosing. Hint: see <code>?scale_color_manual</code>. NOTE: you can specify color by name (e.g., “blue”) or by “Hex value” — see <a href="https://www.color-hex.com/" class="uri">https://www.color-hex.com/</a>.</li>
</ol>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>CPI</code> on the x axis and <code>HDI</code> on the y axis. Color the points to indicate <code>Region</code>.</li>
</ol>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI, <span class="dt">color =</span> Region)) <span class="op">+</span></span>
<span id="cb341-2"><a href="#cb341-2"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-190-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Modify the x, y, and color scales so that they have more easily-understood names (e.g., spell out “Human development Index” instead of <code>HDI</code>).</li>
</ol>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI, <span class="dt">color =</span> Region)) <span class="op">+</span></span>
<span id="cb342-2"><a href="#cb342-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb342-3"><a href="#cb342-3"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Corruption Perception Index&quot;</span>) <span class="op">+</span></span>
<span id="cb342-4"><a href="#cb342-4"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Human Development Index&quot;</span>) <span class="op">+</span></span>
<span id="cb342-5"><a href="#cb342-5"></a><span class="st">  </span><span class="kw">scale_color_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Region of the world&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-191-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Modify the color scale to use specific values of your choosing. Hint: see <code>?scale_color_manual</code>. NOTE: you can specify color by name (e.g., “blue”) or by “Hex value” — see <a href="https://www.color-hex.com/" class="uri">https://www.color-hex.com/</a>.</li>
</ol>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1"></a><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> CPI, <span class="dt">y =</span> HDI, <span class="dt">color =</span> Region)) <span class="op">+</span></span>
<span id="cb343-2"><a href="#cb343-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb343-3"><a href="#cb343-3"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Corruption Perception Index&quot;</span>) <span class="op">+</span></span>
<span id="cb343-4"><a href="#cb343-4"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Human Development Index&quot;</span>) <span class="op">+</span></span>
<span id="cb343-5"><a href="#cb343-5"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">&quot;Region of the world&quot;</span>,</span>
<span id="cb343-6"><a href="#cb343-6"></a>                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;brown&quot;</span>))</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-192-1.png" width="672" /></p>
</div>
</details>
</div>
</div>
<div id="faceting" class="section level2">
<h2>Faceting</h2>
<div id="what-is-faceting" class="section level3">
<h3>What is faceting?</h3>
<ul>
<li>Faceting is <code>ggplot2</code> parlance for <strong>small multiples</strong></li>
<li>The idea is to create separate graphs for subsets of data</li>
<li><code>ggplot2</code> offers two functions for creating small multiples:
<ol style="list-style-type: decimal">
<li><code>facet_wrap()</code>: define subsets as the levels of a single grouping variable</li>
<li><code>facet_grid()</code>: define subsets as the crossing of two grouping variables</li>
</ol></li>
<li>Facilitates comparison among plots, not just of geoms within a plot</li>
</ul>
</div>
<div id="what-is-the-trend-in-housing-prices-in-each-state" class="section level3">
<h3>What is the trend in housing prices in each state?</h3>
<p>Start by using a technique we already know; map <code>State</code> to color:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1"></a>p5 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(housing, <span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> Home_Value))</span>
<span id="cb344-2"><a href="#cb344-2"></a>p5 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> State))  </span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-193-1.png" width="672" /></p>
<p>There are two problems here; there are too many states to distinguish each one by color, and the lines obscure one another.</p>
</div>
<div id="faceting-to-the-rescue" class="section level3">
<h3>Faceting to the rescue</h3>
<p>We can remedy the deficiencies of the previous plot by faceting by <code>State</code> rather than mapping <code>State</code> to color.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="#cb345-1"></a>p5 &lt;-<span class="st"> </span>p5 <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb345-2"><a href="#cb345-2"></a><span class="st">   </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>State, <span class="dt">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb345-3"><a href="#cb345-3"></a>p5</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-194-1.png" width="672" /></p>
</div>
</div>
<div id="themes" class="section level2">
<h2>Themes</h2>
<div id="what-are-themes" class="section level3">
<h3>What are themes?</h3>
<p>The <code>ggplot2</code> theme system handles non-data plot elements such as:</p>
<ul>
<li>Axis label properties (e.g., font, size, color, etc.)</li>
<li>Plot background</li>
<li>Facet label background</li>
<li>Legend appearance</li>
</ul>
<p>Built-in themes include:</p>
<ul>
<li><code>theme_gray()</code> (default)</li>
<li><code>theme_bw()</code></li>
<li><code>theme_classic()</code></li>
</ul>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1"></a>p5 <span class="op">+</span><span class="st"> </span><span class="kw">theme_linedraw</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-195-1.png" width="672" /></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1"></a>p5 <span class="op">+</span><span class="st"> </span><span class="kw">theme_light</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-196-1.png" width="672" />
You can see a list of available built-in themes here <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a></p>
</div>
<div id="overriding-theme-defaults" class="section level3">
<h3>Overriding theme defaults</h3>
<p>Specific theme elements can be overridden using <code>theme()</code>. For example:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1"></a><span class="co"># theme(thing_to_modify = modifying_function(arg1, arg2))</span></span>
<span id="cb348-2"><a href="#cb348-2"></a></span>
<span id="cb348-3"><a href="#cb348-3"></a>p5 <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb348-4"><a href="#cb348-4"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>))  </span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-197-1.png" width="672" /></p>
<p>All theme options are documented in <code>?theme</code>. We can also see the
existing default values using:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1"></a><span class="kw">theme_get</span>()</span></code></pre></div>
</div>
<div id="creating-saving-new-themes" class="section level3">
<h3>Creating &amp; saving new themes</h3>
<p>You can create new themes, as in the following example:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1"></a>theme_new &lt;-<span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb350-2"><a href="#cb350-2"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb350-3"><a href="#cb350-3"></a>        <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">color =</span> <span class="st">&quot;ivory&quot;</span>),</span>
<span id="cb350-4"><a href="#cb350-4"></a>        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;purple&quot;</span>),</span>
<span id="cb350-5"><a href="#cb350-5"></a>        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>),</span>
<span id="cb350-6"><a href="#cb350-6"></a>        <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;pink&quot;</span>),</span>
<span id="cb350-7"><a href="#cb350-7"></a>        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="kw">muted</span>(<span class="st">&quot;orange&quot;</span>)))</span>
<span id="cb350-8"><a href="#cb350-8"></a></span>
<span id="cb350-9"><a href="#cb350-9"></a>p5 <span class="op">+</span><span class="st"> </span>theme_new</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-199-1.png" width="672" /></p>
</div>
</div>
<div id="saving-plots" class="section level2">
<h2>Saving plots</h2>
<p>We can save a plot to either a vector (e.g., pdf, eps, ps, svg)
or raster (e.g., jpg, png, tiff, bmp, wmf) graphics file using
the <code>ggsave()</code> function:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1"></a><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;myplot.pdf&quot;</span>, <span class="dt">plot =</span> p5, <span class="dt">device =</span> <span class="st">&quot;pdf&quot;</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="the-1-faq" class="section level2">
<h2>The #1 FAQ</h2>
<div id="map-aesthetic-to-different-columns" class="section level3">
<h3>Map aesthetic to different columns</h3>
<p>The most frequently asked question goes something like this: <em>I have two variables in my data.frame, and I’d like to plot them as separate points, with different color depending on which variable it is. How do I do that?</em></p>
<p><strong>Wrong</strong></p>
<p>Fixing, rather than mapping, the color aesthetic:</p>
<ol style="list-style-type: decimal">
<li>Produces verbose code when using many colors</li>
<li>Results in no legend being produced</li>
<li>Means you cannot change color scales</li>
</ol>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="#cb352-1"></a>housing_byyear &lt;-<span class="st"> </span></span>
<span id="cb352-2"><a href="#cb352-2"></a><span class="st">  </span>housing <span class="op">%&gt;%</span></span>
<span id="cb352-3"><a href="#cb352-3"></a><span class="st">  </span><span class="kw">group_by</span>(Date) <span class="op">%&gt;%</span></span>
<span id="cb352-4"><a href="#cb352-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Home_Value_Mean =</span> <span class="kw">mean</span>(Home_Value),</span>
<span id="cb352-5"><a href="#cb352-5"></a>            <span class="dt">Land_Value_Mean =</span> <span class="kw">mean</span>(Land_Value)) <span class="op">%&gt;%</span></span>
<span id="cb352-6"><a href="#cb352-6"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb352-7"><a href="#cb352-7"></a></span>
<span id="cb352-8"><a href="#cb352-8"></a><span class="kw">ggplot</span>(housing_byyear, <span class="kw">aes</span>(<span class="dt">x=</span>Date)) <span class="op">+</span></span>
<span id="cb352-9"><a href="#cb352-9"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>Home_Value_Mean), <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb352-10"><a href="#cb352-10"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>Land_Value_Mean), <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-201-1.png" width="672" /></p>
<p><strong>Right</strong></p>
<p>To avoid these pitfalls, we need to <strong>map</strong> our data to the color aesthetic.
We can do this by <strong>reshaping</strong> our data from <strong>wide format</strong> to <strong>long format</strong>.
Here is the logic behind this process:</p>
<center>
<img src="R/Rgraphics/images/wide_vs_long.png" />
</center>
<p>Here’s the code that implements this transformation:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1"></a>home_land_byyear &lt;-<span class="st"> </span></span>
<span id="cb353-2"><a href="#cb353-2"></a><span class="st">    </span>housing_byyear <span class="op">%&gt;%</span></span>
<span id="cb353-3"><a href="#cb353-3"></a><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">c</span>(Home_Value_Mean, Land_Value_Mean),</span>
<span id="cb353-4"><a href="#cb353-4"></a>                 <span class="dt">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb353-5"><a href="#cb353-5"></a>                 <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb353-6"><a href="#cb353-6"></a>                          </span>
<span id="cb353-7"><a href="#cb353-7"></a><span class="kw">ggplot</span>(home_land_byyear, <span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> value, <span class="dt">color =</span> type)) <span class="op">+</span></span>
<span id="cb353-8"><a href="#cb353-8"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-202-1.png" width="672" /></p>
</div>
<div id="exercise-3-2" class="section level3">
<h3>Exercise 3</h3>
<p>For this exercise, we’re going to use the built-in <code>midwest</code> dataset:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="#cb354-1"></a><span class="kw">data</span>(<span class="st">&quot;midwest&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb354-2"><a href="#cb354-2"></a><span class="kw">head</span>(midwest)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 28
##     PID county state  area poptotal popdensity popwhite popblack popamerindian
##   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;         &lt;int&gt;
## 1   561 ADAMS  IL    0.052    66090      1271.    63917     1702            98
## 2   562 ALEXA… IL    0.014    10626       759      7054     3496            19
## 3   563 BOND   IL    0.022    14991       681.    14477      429            35
## 4   564 BOONE  IL    0.017    30806      1812.    29344      127            46
## 5   565 BROWN  IL    0.018     5836       324.     5264      547            14
## 6   566 BUREAU IL    0.05     35688       714.    35157       50            65
## # … with 19 more variables: popasian &lt;int&gt;, popother &lt;int&gt;, percwhite &lt;dbl&gt;,
## #   percblack &lt;dbl&gt;, percamerindan &lt;dbl&gt;, percasian &lt;dbl&gt;, percother &lt;dbl&gt;,
## #   popadults &lt;int&gt;, perchsd &lt;dbl&gt;, percollege &lt;dbl&gt;, percprof &lt;dbl&gt;,
## #   poppovertyknown &lt;int&gt;, percpovertyknown &lt;dbl&gt;, percbelowpoverty &lt;dbl&gt;,
## #   percchildbelowpovert &lt;dbl&gt;, percadultpoverty &lt;dbl&gt;,
## #   percelderlypoverty &lt;dbl&gt;, inmetro &lt;int&gt;, category &lt;chr&gt;</code></pre>
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>area</code> on the x axis and the log of <code>poptotal</code> on the y axis.</li>
</ol>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Within the <code>geom_point()</code> call, map color to <code>state</code>, map size to the log of <code>popdensity</code>, and fix transparency (<code>alpha</code>) to 0.3.</li>
</ol>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Add a smoother and turn off plotting the confidence interval. Hint: see the <code>se</code> argument to <code>geom_smooth()</code>.</li>
</ol>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Facet the plot by <code>state</code>. Set the <code>scales</code> argument to <code>facet_wrap()</code> to allow separate ranges for the x-axis.</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Change the default color scale to use the discrete <code>RColorBrewer</code> palette called <code>Set1</code>. Hint: see <code>?scale_color_brewer</code>.</li>
</ol>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>BONUS: Change the default theme to <code>theme_bw()</code> and modify it so that the axis text and facet label background are blue. Hint: see <code>?theme</code> and especially <code>axis.text</code> and <code>strip.background</code>.</li>
</ol>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Create a scatter plot with <code>area</code> on the x axis and the log of <code>poptotal</code> on the y axis.</li>
</ol>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1"></a>p6 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(midwest, <span class="kw">aes</span>(<span class="dt">x =</span> area, <span class="dt">y =</span> <span class="kw">log</span>(poptotal))) </span>
<span id="cb362-2"><a href="#cb362-2"></a>p6 <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() </span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-210-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Within the <code>geom_point()</code> call, map color to <code>state</code>, map size to the log of <code>popdensity</code>, and fix transparency (<code>alpha</code>) to 0.3.</li>
</ol>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="#cb363-1"></a>p6 &lt;-<span class="st"> </span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> state, <span class="dt">size =</span> <span class="kw">log</span>(popdensity)), <span class="dt">alpha =</span> <span class="fl">0.3</span>) </span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Add a smoother and turn off plotting the confidence interval. Hint: see the <code>se</code> argument to <code>geom_smooth()</code>.</li>
</ol>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1"></a>p6 &lt;-<span class="st"> </span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) </span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Facet the plot by <code>state</code>. Set the <code>scales</code> argument to <code>facet_wrap()</code> to allow separate ranges for the x-axis.</li>
</ol>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="#cb365-1"></a>p6 &lt;-<span class="st"> </span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>state, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Change the default color scale to use the discrete <code>RColorBrewer</code> palette called <code>Set1</code>. Hint: see <code>?scale_color_brewer</code>.</li>
</ol>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1"></a>p6 &lt;-<span class="st"> </span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>BONUS: Change the default theme to <code>theme_bw()</code> and modify it so that the axis text and facet label background are blue. Hint: see <code>?theme</code> and especially <code>axis.text</code> and <code>strip.background</code>.</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="#cb367-1"></a>p6 &lt;-<span class="st"> </span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb367-2"><a href="#cb367-2"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb367-3"><a href="#cb367-3"></a>          <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;yellow&quot;</span>))</span></code></pre></div>
<p>Here’s the complete code for the Exercise 3 plot:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1"></a>p6 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(midwest, <span class="kw">aes</span>(<span class="dt">x =</span> area, <span class="dt">y =</span> <span class="kw">log</span>(poptotal))) <span class="op">+</span></span>
<span id="cb368-2"><a href="#cb368-2"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> state, <span class="dt">size =</span> <span class="kw">log</span>(popdensity)), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></span>
<span id="cb368-3"><a href="#cb368-3"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb368-4"><a href="#cb368-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>state, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span></span>
<span id="cb368-5"><a href="#cb368-5"></a><span class="st">    </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="op">+</span></span>
<span id="cb368-6"><a href="#cb368-6"></a><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb368-7"><a href="#cb368-7"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb368-8"><a href="#cb368-8"></a>         <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;yellow&quot;</span>))</span>
<span id="cb368-9"><a href="#cb368-9"></a></span>
<span id="cb368-10"><a href="#cb368-10"></a>p6         </span></code></pre></div>
<p><img src="R/Rgraphics/figures/unnamed-chunk-216-1.png" width="672" /></p>
</div>
</details>
</div>
</div>
<div id="wrap-up-3" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-3" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-4" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>ggplot2
<ul>
<li>Reference: <a href="https://ggplot2.tidyverse.org/reference/" class="uri">https://ggplot2.tidyverse.org/reference/</a></li>
<li>Cheatsheets: <a href="https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf" class="uri">https://rstudio.com/wp-content/uploads/2019/01/Cheatsheets_2019.pdf</a></li>
<li>Examples: <a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html" class="uri">http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html</a></li>
<li>Tutorial: <a href="https://uc-r.github.io/ggplot_intro" class="uri">https://uc-r.github.io/ggplot_intro</a></li>
<li>Mailing list: <a href="http://groups.google.com/group/ggplot2" class="uri">http://groups.google.com/group/ggplot2</a></li>
<li>Wiki: <a href="https://github.com/hadley/ggplot2/wiki" class="uri">https://github.com/hadley/ggplot2/wiki</a></li>
<li>Website: <a href="http://had.co.nz/ggplot2/" class="uri">http://had.co.nz/ggplot2/</a></li>
<li>StackOverflow: <a href="http://stackoverflow.com/questions/tagged/ggplot" class="uri">http://stackoverflow.com/questions/tagged/ggplot</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="r-data-wrangling" class="section level1">
<h1>R Data Wrangling</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Loading Excel worksheets</li>
<li>Iterating over files</li>
<li>Writing your own functions</li>
<li>Filtering with regular expressions (regex)</li>
<li>Reshaping data</li>
</ul>
<div id="setup-3" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials-3" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./Rinstall.html">R Installation</a> instructions and ensure that you can successfully start RStudio.</p>
</div>
<div id="class-structure-3" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites-3" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate / advanced R course:</p>
<ul>
<li>Assumes intermediate knowledge of R</li>
<li>Relatively fast-paced</li>
</ul>
</div>
<div id="launch-an-r-session-2" class="section level3">
<h3>Launch an R session</h3>
<p>Start RStudio and create a new project:</p>
<ul>
<li>On Windows click the start button and search for RStudio. On Mac
RStudio will be in your applications folder.</li>
<li>In Rstudio go to <code>File -&gt; New Project</code>.</li>
<li>Choose <code>Existing Directory</code> and browse to the workshop materials directory on your desktop.</li>
<li>Choose <code>File -&gt; Open File</code> and select the file with the word “BLANK” in the name.</li>
</ul>
</div>
<div id="packages-2" class="section level3">
<h3>Packages</h3>
<p>You should have already installed the <code>tidyverse</code> and <code>rmarkdown</code>
packages onto your computer before the workshop
— see <a href="./Rinstall.html">R Installation</a>.
Now let’s load these packages into the search path of our R session.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb369-2"><a href="#cb369-2"></a><span class="kw">library</span>(rmarkdown)</span>
<span id="cb369-3"><a href="#cb369-3"></a><span class="kw">library</span>(readxl) <span class="co"># installed with tidyverse, but not loaded into R session</span></span></code></pre></div>
</div>
<div id="workshop-outline" class="section level3">
<h3>Workshop Outline</h3>
<p><strong>Example data</strong></p>
<p>The UK <a href="https://www.ons.gov.uk">Office for National Statistics</a> provides yearly
data on the most popular boys names going back to 1996. The data is provided
separately for boys and girls and is stored in Excel spreadsheets.</p>
<p><strong>Overall Goal</strong></p>
<p>Our mission is to extract and graph the <strong>top 100</strong> boys names in England and Wales for every year since 1996.</p>
<center>
<img src="R/RDataWrangling/images/goal.png" title="fig:" alt="goal" />
</center>
<p><strong>Exercise 0: Problems with the data</strong></p>
<p>There are several things that make our goal challenging. Let’s take a look at the data:</p>
<ol style="list-style-type: decimal">
<li><p>Locate the files named <code>1996boys_tcm77-254026.xlsx</code> and
<code>2015boysnamesfinal.xlsx</code> and open them separately in a
spreadsheet program.</p>
<p>(If you don’t have a spreadsheet program installed on
your computer you can download one from
<a href="https://www.libreoffice.org/download/download/" class="uri">https://www.libreoffice.org/download/download/</a>).</p>
<p>What issues can you identify that might make working
with these data difficult?</p>
<p>In what ways is the format different between the two files?</p></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Multiple Excel sheets in each file, each with a different name, but each file contains a <code>Table 1</code>.</li>
<li>The data does not start on row one. Headers are on row 7, followed by a blank line, followed by the actual data.</li>
<li>The data is stored in an inconvenient way, with ranks 1-50 in the first set of columns and ranks 51-100 in a second set of columns.</li>
<li>The second worksheet <code>2015boysnamesfinal.xlsx</code> contains extra columns between the data of interest, resulting in the second set of columns (ranks 51-100) being placed in a different position.</li>
<li>The year from which the data comes is only reported in the Excel file name, not within the data itself.</li>
<li>There are notes below the data.</li>
</ol>
<p>These differences will make it more difficult to automate re-arranging the data since we have to write code that can handle different input formats.</p>
</div>
</details>
<div class="alert alert-success">
<p><strong>Steps to accomplish the goal of extracting and graphing the <em>top 100</em> boys names in England and Wales for every year since 1996:</strong></p>
<ol start="0" style="list-style-type: decimal">
<li><p><strong>Explore example data to highlight problems (already done!)</strong></p></li>
<li><p><strong>Reading data from multiple Excel worksheets into R data frames</strong></p>
<ul>
<li>list Excel file names in a character vector</li>
<li>read Excel sheetnames into a list of character vectors</li>
<li>read Excel data for “Table 1” only into a list of data frames</li>
</ul></li>
<li><p><strong>Clean up data within each R data frame</strong></p>
<ul>
<li>sort and merge columns within each data frame inside the list</li>
<li>drop missing values from each data frame</li>
<li>reshape data format from wide to long</li>
</ul></li>
<li><p><strong>Organize the data into one large data frame and store it</strong></p>
<ul>
<li>create a year column within each data frame within the list</li>
<li>append all the data frames in the list into one large data frame</li>
</ul></li>
</ol>
</div>
<p>NOTE: please make sure you close the Excel files before continuing with the
workshop, otherwise you may encounter issues with file paths when reading
the data into R.</p>
</div>
</div>
<div id="working-with-excel-worksheets" class="section level2">
<h2>Working with Excel worksheets</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to read data from multiple Excel worksheets into R data frames.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>List Excel file names in a character vector</li>
<li>Read Excel sheetnames into a list of character vectors</li>
<li>Read Excel data for “Table 1” only into a list of data frames</li>
</ol>
</div>
<p>As you can see, the data is in quite a messy state. Note that this is
not a contrived example; this is exactly the way the data came to us
from the UK government website! Let’s start cleaning and organizing
it.</p>
<p>Each Excel file contains a worksheet with the boy names data we want.
Each file also contains additional supplemental worksheets that we are
not currently interested in. As noted above, the worksheet of interest
differs from year to year, but always has “Table 1” in the sheet name.</p>
<p>The first step is to get a character vector of file names.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1"></a>boy_file_names &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;dataSets/boys&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Now that we’ve told R the names of the data files, we can start working
with them. For example, the first file is</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1"></a>boy_file_names[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;dataSets/boys/1996boys_tcm77-254026.xlsx&quot;</code></pre>
<p>and we can use the <code>excel_sheets()</code> function from the <code>readxl</code> package
within <code>tidyverse</code> to list the worksheet names from this file.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="#cb373-1"></a><span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Contents&quot;                     &quot;Table 1 - Top 100 boys, E&amp;W&quot; 
## [3] &quot;Table 2-Top 10 boys by month&quot; &quot;Table 3 - Boys names - E&amp;W&quot;</code></pre>
<div id="iterating-with-map" class="section level3">
<h3>Iterating with <code>map()</code></h3>
<p>Now that we know how to retrieve the names of the worksheets in an
Excel file, we could start writing code to extract the sheet names from
each file, e.g.,</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="#cb375-1"></a><span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Contents&quot;                     &quot;Table 1 - Top 100 boys, E&amp;W&quot; 
## [3] &quot;Table 2-Top 10 boys by month&quot; &quot;Table 3 - Boys names - E&amp;W&quot;</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1"></a><span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="#cb379-1"></a><span class="co">## ...</span></span>
<span id="cb379-2"><a href="#cb379-2"></a><span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">20</span>])</span></code></pre></div>
<pre><code>##  [1] &quot;Contents&quot;             &quot;Metadata&quot;             &quot;Terms and Conditions&quot;
##  [4] &quot;Table 1&quot;              &quot;Table 2&quot;              &quot;Table 3&quot;             
##  [7] &quot;Table 4&quot;              &quot;Table 5&quot;              &quot;Table 6&quot;             
## [10] &quot;Related Publications&quot;</code></pre>
<p>This is not a terrible idea for a small number of files, but it is
more convenient to let R do the iteration for us. We could use a <code>for loop</code>,
or <code>sapply()</code>, but the <code>map()</code> family of functions from the <code>purrr</code>
package within <code>tidyverse</code> gives us a more consistent alternative,
so we’ll use that.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1"></a><span class="co"># map(object to iterate over, function that does task within each iteration)</span></span>
<span id="cb381-2"><a href="#cb381-2"></a></span>
<span id="cb381-3"><a href="#cb381-3"></a><span class="kw">map</span>(boy_file_names, excel_sheets)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Contents&quot;                     &quot;Table 1 - Top 100 boys, E&amp;W&quot; 
## [3] &quot;Table 2-Top 10 boys by month&quot; &quot;Table 3 - Boys names - E&amp;W&quot;  
## 
## [[2]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[3]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys&#39; names&quot;  
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[4]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys&#39; names&quot;  
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[5]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[6]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[7]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[8]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[9]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[10]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[11]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[12]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[13]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys&#39; names&quot;  
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[14]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys&#39; names&quot;  
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[15]]
## [1] &quot;Contents&quot;                        &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
## [3] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
## [5] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
## [7] &quot;Table 6 - Boys names - E&amp;W&quot;     
## 
## [[16]]
##  [1] &quot;Contents&quot;                        &quot;Metadata&quot;                       
##  [3] &quot;Terms and Conditions&quot;            &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
##  [5] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
##  [7] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
##  [9] &quot;Table 6 - Boys names - E&amp;W&quot;      &quot;Related Publications&quot;           
## 
## [[17]]
##  [1] &quot;Contents&quot;                        &quot;Metadata&quot;                       
##  [3] &quot;Terms and Conditions&quot;            &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
##  [5] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
##  [7] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
##  [9] &quot;Table 6 - Boys names - E&amp;W&quot;      &quot;Related Publications&quot;           
## 
## [[18]]
##  [1] &quot;Contents&quot;                        &quot;Metadata&quot;                       
##  [3] &quot;Terms and Conditions&quot;            &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
##  [5] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
##  [7] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
##  [9] &quot;Table 6 - Boys names - E&amp;W&quot;      &quot;Related Publications&quot;           
## 
## [[19]]
##  [1] &quot;Contents&quot;                        &quot;Metadata&quot;                       
##  [3] &quot;Terms and Conditions&quot;            &quot;Table 1 - Top 100 boys, E&amp;W&quot;    
##  [5] &quot;Table 2 - Top 100 boys, England&quot; &quot;Table 3 - Top 100 boys, Wales&quot;  
##  [7] &quot;Table 4 - Top 10 boys by region&quot; &quot;Table 5 - Top 10 boys by month&quot; 
##  [9] &quot;Table 6 - Boys names - E&amp;W&quot;      &quot;Related Publications&quot;           
## 
## [[20]]
##  [1] &quot;Contents&quot;             &quot;Metadata&quot;             &quot;Terms and Conditions&quot;
##  [4] &quot;Table 1&quot;              &quot;Table 2&quot;              &quot;Table 3&quot;             
##  [7] &quot;Table 4&quot;              &quot;Table 5&quot;              &quot;Table 6&quot;             
## [10] &quot;Related Publications&quot;</code></pre>
</div>
<div id="filtering-strings-using-regex" class="section level3">
<h3>Filtering strings using regex</h3>
<p>To extract the correct worksheet names we need a way to extract
strings containing “Table 1”.</p>
<p>Base R provides some string manipulation capabilities
(see <code>?regex</code>, <code>?sub</code> and <code>?grep</code>), but we will use the
<code>stringr</code> package within <code>tidyverse</code> because it is more
user-friendly. <code>stringr</code> provides functions to:</p>
<ol style="list-style-type: decimal">
<li>detect</li>
<li>locate</li>
<li>extract</li>
<li>match</li>
<li>replace</li>
<li>combine</li>
<li>split</li>
</ol>
<p>strings. Here we want to detect the pattern “Table 1”, and only
return elements with this pattern. We can do that using the
<code>str_subset()</code> function:</p>
<ol style="list-style-type: decimal">
<li>The first argument to <code>str_subset()</code> is character vector we want to search in.</li>
<li>The second argument is a <em>regular expression</em> matching the pattern we want to retain.</li>
</ol>
<p>If you are not familiar with regular expressions (regex),
<a href="http://www.regexr.com/" class="uri">http://www.regexr.com/</a> is a good place to start. Regex is essentially
just a programmatic way of doing operations like “find” or “find and replace”
in MS Word or Excel.</p>
<p>Now that we know how to filter character vectors using <code>str_subset()</code> we can
identify the correct sheet in a particular Excel file. For example,</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="#cb383-1"></a><span class="co"># str_subset(character_vector, regex_pattern)</span></span>
<span id="cb383-2"><a href="#cb383-2"></a></span>
<span id="cb383-3"><a href="#cb383-3"></a><span class="co"># nesting functions</span></span>
<span id="cb383-4"><a href="#cb383-4"></a><span class="kw">str_subset</span>(<span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">1</span>]), <span class="dt">pattern =</span> <span class="st">&quot;Table 1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="#cb385-1"></a><span class="co"># piping functions</span></span>
<span id="cb385-2"><a href="#cb385-2"></a><span class="kw">excel_sheets</span>(boy_file_names[<span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_subset</span>(<span class="dt">pattern =</span> <span class="st">&quot;Table 1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;</code></pre>
</div>
<div id="writing-your-own-functions" class="section level3">
<h3>Writing your own functions</h3>
<p>The next step is to retrieve worksheet names and subset them.</p>
<p>The <code>map*</code> functions are useful when you want to apply a function to a
vector of inputs and obtain the return values for each input. This
is very convenient when a function already exists that does exactly what you
want. In the examples above we mapped the <code>excel_sheets()</code> function to
the elements of a character vector containing file names.</p>
<p>However, there is no function that both:</p>
<ol style="list-style-type: decimal">
<li>Retrieves worksheet names, and</li>
<li>Subsets the names</li>
</ol>
<p>So, we will have to write one. Fortunately, writing functions in R is easy.
Functions require 3 elements:</p>
<ol style="list-style-type: decimal">
<li>A <strong>name</strong></li>
<li>One or more <strong>arguments</strong></li>
<li>A <strong>body</strong> containing computations</li>
</ol>
<p>Anatomy of a function:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1"></a>function_name &lt;-<span class="st"> </span><span class="cf">function</span>(arg1, arg2, ....) {</span>
<span id="cb387-2"><a href="#cb387-2"></a>  </span>
<span id="cb387-3"><a href="#cb387-3"></a>    body of <span class="cf">function</span> <span class="co"># where stuff happens </span></span>
<span id="cb387-4"><a href="#cb387-4"></a></span>
<span id="cb387-5"><a href="#cb387-5"></a>    <span class="kw">return</span>( results ) </span>
<span id="cb387-6"><a href="#cb387-6"></a>}</span></code></pre></div>
<p>Simple examples:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1"></a>myfun &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb388-2"><a href="#cb388-2"></a>  x<span class="op">^</span><span class="dv">2</span></span>
<span id="cb388-3"><a href="#cb388-3"></a>}</span>
<span id="cb388-4"><a href="#cb388-4"></a></span>
<span id="cb388-5"><a href="#cb388-5"></a><span class="kw">myfun</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]   1   4   9  16  25  36  49  64  81 100</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1"></a>myfun2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</span>
<span id="cb390-2"><a href="#cb390-2"></a>  z &lt;-<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb390-3"><a href="#cb390-3"></a>  <span class="kw">return</span>(z)</span>
<span id="cb390-4"><a href="#cb390-4"></a>}</span>
<span id="cb390-5"><a href="#cb390-5"></a></span>
<span id="cb390-6"><a href="#cb390-6"></a><span class="kw">myfun2</span>(<span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y=</span><span class="dv">42</span>)</span></code></pre></div>
<pre><code>##  [1]  43  46  51  58  67  78  91 106 123 142</code></pre>
<p>Examples using the Excel data:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1"></a>get_data_sheet_name &lt;-<span class="st"> </span><span class="cf">function</span>(file, term){</span>
<span id="cb392-2"><a href="#cb392-2"></a>  <span class="kw">excel_sheets</span>(file) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_subset</span>(<span class="dt">pattern =</span> term)</span>
<span id="cb392-3"><a href="#cb392-3"></a>}</span>
<span id="cb392-4"><a href="#cb392-4"></a></span>
<span id="cb392-5"><a href="#cb392-5"></a><span class="co"># the goal is generalization </span></span>
<span id="cb392-6"><a href="#cb392-6"></a><span class="kw">get_data_sheet_name</span>(boy_file_names[<span class="dv">1</span>], <span class="dt">term =</span> <span class="st">&quot;Table 1&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1"></a><span class="kw">get_data_sheet_name</span>(boy_file_names[<span class="dv">1</span>], <span class="dt">term =</span> <span class="st">&quot;Table 2&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Table 2-Top 10 boys by month&quot;</code></pre>
<p>Now we can map this new function over our vector of file names.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1"></a><span class="co"># map(object to iterate over, </span></span>
<span id="cb396-2"><a href="#cb396-2"></a><span class="co">#     function that does task within each iteration, </span></span>
<span id="cb396-3"><a href="#cb396-3"></a><span class="co">#     arguments to previous function)</span></span>
<span id="cb396-4"><a href="#cb396-4"></a> </span>
<span id="cb396-5"><a href="#cb396-5"></a><span class="kw">map</span>(boy_file_names,      <span class="co"># list object</span></span>
<span id="cb396-6"><a href="#cb396-6"></a>    get_data_sheet_name, <span class="co"># function</span></span>
<span id="cb396-7"><a href="#cb396-7"></a>    <span class="dt">term =</span> <span class="st">&quot;Table 1&quot;</span>)    <span class="co"># argument to previous function</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[2]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[3]]
## [1] &quot;Table 1 - Top 100 boys&#39; names&quot;
## 
## [[4]]
## [1] &quot;Table 1 - Top 100 boys&#39; names&quot;
## 
## [[5]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[6]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[7]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[8]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[9]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[10]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[11]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[12]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[13]]
## [1] &quot;Table 1 - Top 100 boys&#39; names&quot;
## 
## [[14]]
## [1] &quot;Table 1 - Top 100 boys&#39; names&quot;
## 
## [[15]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[16]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[17]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[18]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[19]]
## [1] &quot;Table 1 - Top 100 boys, E&amp;W&quot;
## 
## [[20]]
## [1] &quot;Table 1&quot;</code></pre>
</div>
</div>
<div id="reading-excel-data-files" class="section level2">
<h2>Reading Excel data files</h2>
<p>Now that we know the correct worksheet from each file, we can actually
read those data into R. We can do that using the <code>read_excel()</code> function.</p>
<p>We’ll start by reading the data from the first file, just to check
that it works. Recall that the actual data starts on row 7, so we want
to skip the first 6 rows. We can use the <code>glimpse()</code> function from
the <code>dplyr</code> package within <code>tidyverse</code> to view the output.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1"></a>temp &lt;-<span class="st"> </span><span class="kw">read_excel</span>(</span>
<span id="cb398-2"><a href="#cb398-2"></a>  <span class="dt">path =</span> boy_file_names[<span class="dv">1</span>],</span>
<span id="cb398-3"><a href="#cb398-3"></a>  <span class="dt">sheet =</span> <span class="kw">get_data_sheet_name</span>(boy_file_names[<span class="dv">1</span>], <span class="dt">term =</span> <span class="st">&quot;Table 1&quot;</span>),</span>
<span id="cb398-4"><a href="#cb398-4"></a>  <span class="dt">skip =</span> <span class="dv">6</span></span>
<span id="cb398-5"><a href="#cb398-5"></a>)</span>
<span id="cb398-6"><a href="#cb398-6"></a></span>
<span id="cb398-7"><a href="#cb398-7"></a><span class="kw">glimpse</span>(temp)</span></code></pre></div>
<pre><code>## Rows: 59
## Columns: 7
## $ ...1      &lt;chr&gt; NA, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;…
## $ Name...2  &lt;chr&gt; NA, &quot;JACK&quot;, &quot;DANIEL&quot;, &quot;THOMAS&quot;, &quot;JAMES&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW…
## $ Count...3 &lt;dbl&gt; NA, 10779, 10338, 9603, 9385, 7887, 7426, 6496, 6193, 6161,…
## $ ...4      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ ...5      &lt;dbl&gt; NA, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64,…
## $ Name...6  &lt;chr&gt; NA, &quot;DOMINIC&quot;, &quot;NICHOLAS&quot;, &quot;BRANDON&quot;, &quot;RHYS&quot;, &quot;MARK&quot;, &quot;MAX&quot;…
## $ Count...7 &lt;dbl&gt; NA, 1519, 1385, 1337, 1259, 1222, 1192, 1186, 1135, 1128, 1…</code></pre>
<p>Note that R has added a suffix to each column name <code>...1</code>, <code>...2</code>,
<code>...3</code>, etc. because duplicate names are not allowed, so the suffix serves
to disambiguate. The trailing number represents the index of the column.</p>
<div id="exercise-1-3" class="section level3">
<h3>Exercise 1</h3>
<ol style="list-style-type: decimal">
<li>Write a function called <code>read_boys_names</code> that takes a file name as an argument
and reads the worksheet containing “Table 1” from that file. Don’t forget
to skip the first 6 rows.</li>
</ol>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Test your function by using it to read <em>one</em> of the boys names
Excel files.</li>
</ol>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="#cb401-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Use the <code>map()</code> function to create a list of data frames called <code>boysNames</code><br />
from all the Excel files, using the function you wrote in step 1.</li>
</ol>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Write a function that takes a file name as an argument and reads the worksheet containing “Table 1” from that file.</li>
</ol>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="#cb403-1"></a>read_boys_names &lt;-<span class="st"> </span><span class="cf">function</span>(file, sheet_name) {</span>
<span id="cb403-2"><a href="#cb403-2"></a>  <span class="kw">read_excel</span>(</span>
<span id="cb403-3"><a href="#cb403-3"></a>    <span class="dt">path =</span> file,</span>
<span id="cb403-4"><a href="#cb403-4"></a>    <span class="dt">sheet =</span> <span class="kw">get_data_sheet_name</span>(file, <span class="dt">term =</span> sheet_name),</span>
<span id="cb403-5"><a href="#cb403-5"></a>    <span class="dt">skip =</span> <span class="dv">6</span></span>
<span id="cb403-6"><a href="#cb403-6"></a>  )</span>
<span id="cb403-7"><a href="#cb403-7"></a>}</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Test your function by using it to read <em>one</em> of the boys names Excel files.</li>
</ol>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1"></a><span class="kw">read_boys_names</span>(boy_file_names[<span class="dv">1</span>], <span class="dt">sheet_name =</span> <span class="st">&quot;Table 1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 59
## Columns: 7
## $ ...1      &lt;chr&gt; NA, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;…
## $ Name...2  &lt;chr&gt; NA, &quot;JACK&quot;, &quot;DANIEL&quot;, &quot;THOMAS&quot;, &quot;JAMES&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW…
## $ Count...3 &lt;dbl&gt; NA, 10779, 10338, 9603, 9385, 7887, 7426, 6496, 6193, 6161,…
## $ ...4      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ ...5      &lt;dbl&gt; NA, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64,…
## $ Name...6  &lt;chr&gt; NA, &quot;DOMINIC&quot;, &quot;NICHOLAS&quot;, &quot;BRANDON&quot;, &quot;RHYS&quot;, &quot;MARK&quot;, &quot;MAX&quot;…
## $ Count...7 &lt;dbl&gt; NA, 1519, 1385, 1337, 1259, 1222, 1192, 1186, 1135, 1128, 1…</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Use the <code>map()</code> function to read data from all the Excel files, using the function you wrote in step 1.</li>
</ol>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1"></a>boysNames &lt;-<span class="st"> </span><span class="kw">map</span>(boy_file_names, read_boys_names, <span class="dt">sheet_name =</span> <span class="st">&quot;Table 1&quot;</span>)</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="data-cleanup" class="section level2">
<h2>Data cleanup</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to clean up data within each R data frame.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Sort and merge columns within each data frame inside the list</li>
<li>Drop missing values from each data frame</li>
<li>Reshape data format from wide to long</li>
</ol>
</div>
<p>Now that we’ve read in the data, we can see that there are some
problems we need to fix. Specifically, we need to:</p>
<ol style="list-style-type: decimal">
<li>fix column names</li>
<li>get rid of blank row at the top and the notes at the bottom</li>
<li>get rid of extraneous “changes in rank” columns if they exist</li>
<li>transform the side-by-side tables layout to a single table</li>
</ol>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1"></a><span class="co"># Rank 1:50 --- Names / Counts are in columns 2 and 3 </span></span>
<span id="cb407-2"><a href="#cb407-2"></a><span class="co"># Rank 51:100 --- Names / Counts are in columns 6 and 7</span></span>
<span id="cb407-3"><a href="#cb407-3"></a><span class="kw">glimpse</span>(boysNames[[<span class="dv">1</span>]]) </span></code></pre></div>
<pre><code>## Rows: 59
## Columns: 7
## $ ...1      &lt;chr&gt; NA, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;…
## $ Name...2  &lt;chr&gt; NA, &quot;JACK&quot;, &quot;DANIEL&quot;, &quot;THOMAS&quot;, &quot;JAMES&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW…
## $ Count...3 &lt;dbl&gt; NA, 10779, 10338, 9603, 9385, 7887, 7426, 6496, 6193, 6161,…
## $ ...4      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ ...5      &lt;dbl&gt; NA, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64,…
## $ Name...6  &lt;chr&gt; NA, &quot;DOMINIC&quot;, &quot;NICHOLAS&quot;, &quot;BRANDON&quot;, &quot;RHYS&quot;, &quot;MARK&quot;, &quot;MAX&quot;…
## $ Count...7 &lt;dbl&gt; NA, 1519, 1385, 1337, 1259, 1222, 1192, 1186, 1135, 1128, 1…</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1"></a><span class="co"># Rank 1:50 --- Names / Counts are in columns 2 and 3 </span></span>
<span id="cb409-2"><a href="#cb409-2"></a><span class="co"># Rank 51:100 --- Names / Counts are in columns 7 and 8</span></span>
<span id="cb409-3"><a href="#cb409-3"></a><span class="kw">glimpse</span>(boysNames[[<span class="dv">10</span>]]) </span></code></pre></div>
<pre><code>## Rows: 61
## Columns: 9
## $ ...1             &lt;chr&gt; NA, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10…
## $ Name...2         &lt;chr&gt; NA, &quot;JACK&quot;, &quot;JOSHUA&quot;, &quot;THOMAS&quot;, &quot;JAMES&quot;, &quot;OLIVER&quot;, &quot;…
## $ Count...3        &lt;dbl&gt; NA, 7434, 7167, 6792, 5654, 5516, 5270, 5219, 5106, …
## $ `since 2004...4` &lt;chr&gt; NA, &quot;-&quot;, &quot;-&quot;, &quot;-&quot;, &quot;-&quot;, &quot;+2&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-&quot;, &quot;+2&quot;,…
## $ ...5             &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ ...6             &lt;dbl&gt; NA, 51, 52, 53, 53, 55, 56, 57, 58, 59, 60, 61, 62, …
## $ Name...7         &lt;chr&gt; NA, &quot;NOAH&quot;, &quot;MUHAMMAD&quot;, &quot;ALEX&quot;, &quot;ISAAC&quot;, &quot;OSCAR&quot;, &quot;R…
## $ Count...8        &lt;dbl&gt; NA, 1346, 1318, 1302, 1302, 1262, 1256, 1172, 1126, …
## $ `since 2004...9` &lt;chr&gt; NA, &quot;+23&quot;, &quot;-1&quot;, &quot;-7&quot;, &quot;+5&quot;, &quot;+4&quot;, &quot;-4&quot;, &quot;+6&quot;, &quot;+17&quot;…</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1"></a><span class="co"># Rank 1:50 --- Names / Counts are in columns 2 and 3 </span></span>
<span id="cb411-2"><a href="#cb411-2"></a><span class="co"># Rank 51:100 --- Names / Counts are in columns 8 and 9</span></span>
<span id="cb411-3"><a href="#cb411-3"></a><span class="kw">glimpse</span>(boysNames[[<span class="dv">20</span>]]) </span></code></pre></div>
<pre><code>## Rows: 61
## Columns: 11
## $ Rank...1          &lt;chr&gt; NA, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;1…
## $ Name...2          &lt;chr&gt; NA, &quot;OLIVER&quot;, &quot;JACK&quot;, &quot;HARRY&quot;, &quot;GEORGE&quot;, &quot;JACOB&quot;, &quot;…
## $ Count...3         &lt;dbl&gt; NA, 6941, 5371, 5308, 4869, 4850, 4831, 4148, 4083,…
## $ `since 2014...4`  &lt;chr&gt; NA, &quot;­ &quot;, &quot;­ &quot;, &quot;­ &quot;, &quot;+3 &quot;, &quot;-1 &quot;, &quot;-1 &quot;, &quot;+4 &quot;, &quot;…
## $ `since 2005...5`  &lt;chr&gt; NA, &quot;+4 &quot;, &quot;-1 &quot;, &quot;+6 &quot;, &quot;+13 &quot;, &quot;+16 &quot;, &quot;+6 &quot;, &quot;+4…
## $ ...6              &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ Rank...7          &lt;chr&gt; NA, &quot;51&quot;, &quot;52&quot;, &quot;53&quot;, &quot;54&quot;, &quot;55&quot;, &quot;56&quot;, &quot;57&quot;, &quot;58&quot;,…
## $ Name...8          &lt;chr&gt; NA, &quot;REUBEN&quot;, &quot;HARLEY&quot;, &quot;LUCA&quot;, &quot;MICHAEL&quot;, &quot;HUGO&quot;, …
## $ Count...9         &lt;dbl&gt; NA, 1188, 1175, 1167, 1165, 1153, 1148, 1112, 1095,…
## $ `since 2014...10` &lt;chr&gt; NA, &quot;­ &quot;, &quot;-7 &quot;, &quot;+5 &quot;, &quot;-2 &quot;, &quot;+15 &quot;, &quot;-10 &quot;, &quot;+7 …
## $ `since 2005...11` &lt;chr&gt; NA, &quot;+51* &quot;, &quot;+18 &quot;, &quot;+30 &quot;, &quot;-12 &quot;, &quot;+124* &quot;, &quot;-37…</code></pre>
<p>In short, we want to go from this:</p>
<center>
<img src="R/RDataWrangling/images/messy.png" title="fig:" alt="messy" />
</center>
<p>to this:</p>
<center>
<img src="R/RDataWrangling/images/clean.png" title="fig:" alt="tidy" />
</center>
<p>There are many ways to do this kind of data manipulation in R. We’re
going to use the <code>dplyr</code> and <code>tidyr</code> packages from within <code>tidyverse</code>
to make our lives easier.</p>
<div id="selecting-columns" class="section level3">
<h3>Selecting columns</h3>
<p>Next we want to retain just the <code>Name...2</code>, <code>Name...6</code>, <code>Count...3</code> and <code>Count...7</code> columns.
We can do that using the <code>select()</code> function:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1"></a>boysNames[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 59 x 7
##    ...1  Name...2 Count...3 ...4   ...5 Name...6 Count...7
##    &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1 &lt;NA&gt;  &lt;NA&gt;            NA NA       NA &lt;NA&gt;            NA
##  2 1     JACK         10779 NA       51 DOMINIC       1519
##  3 2     DANIEL       10338 NA       52 NICHOLAS      1385
##  4 3     THOMAS        9603 NA       53 BRANDON       1337
##  5 4     JAMES         9385 NA       54 RHYS          1259
##  6 5     JOSHUA        7887 NA       55 MARK          1222
##  7 6     MATTHEW       7426 NA       56 MAX           1192
##  8 7     RYAN          6496 NA       57 DYLAN         1186
##  9 8     JOSEPH        6193 NA       58 HENRY         1135
## 10 9     SAMUEL        6161 NA       59 PETER         1128
## # … with 49 more rows</code></pre>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="#cb415-1"></a>boysNames[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">select</span>(boysNames[[<span class="dv">1</span>]], Name...<span class="dv">2</span>, Name...<span class="dv">6</span>, Count...<span class="dv">3</span>, Count...<span class="dv">7</span>)</span>
<span id="cb415-2"><a href="#cb415-2"></a>boysNames[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 59 x 4
##    Name...2 Name...6 Count...3 Count...7
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1 &lt;NA&gt;     &lt;NA&gt;            NA        NA
##  2 JACK     DOMINIC      10779      1519
##  3 DANIEL   NICHOLAS     10338      1385
##  4 THOMAS   BRANDON       9603      1337
##  5 JAMES    RHYS          9385      1259
##  6 JOSHUA   MARK          7887      1222
##  7 MATTHEW  MAX           7426      1192
##  8 RYAN     DYLAN         6496      1186
##  9 JOSEPH   HENRY         6193      1135
## 10 SAMUEL   PETER         6161      1128
## # … with 49 more rows</code></pre>
</div>
<div id="data-types-and-structures" class="section level3">
<h3>Data types and structures</h3>
<p>We’ve now encountered several different data types and data structures. Let’s take a step back and survey the options available in R.</p>
<p><strong>Data structures:</strong></p>
<p>In R, the most foundational data structure is the <strong>vector</strong>. Vectors are <em>containers</em> that
can hold a <em>collection</em> of values. Vectors come in two basic forms:</p>
<ol style="list-style-type: decimal">
<li><strong>atomic</strong>: only hold elements of the same type; they are <strong>homogeneous</strong>. The <code>c()</code> function can be used to create atomic vectors.</li>
<li><strong>list</strong>: can hold elements of different types; they are <strong>heterogeneous</strong>. The <code>list()</code> function can be used to create list vectors.</li>
</ol>
<p><code>NULL</code> is closely related to vectors and often serves the role of a zero length vector.</p>
<center>
<img src="R/RDataWrangling/images/summary_tree.png" title="fig:" alt="vector tree" />
</center>
<p>From these two basic forms, the following six structures are derived:</p>
<table>
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="78%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Elements</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">atomic vector</td>
<td align="left">homogeneous</td>
<td align="left">contains elements of the same <strong>type</strong>, one of: character, integer, double, logical</td>
</tr>
<tr class="even">
<td align="left">array</td>
<td align="left">homogeneous</td>
<td align="left">an atomic vector with attributes giving dimensions (1, 2, or &gt;2)</td>
</tr>
<tr class="odd">
<td align="left">matrix</td>
<td align="left">homogeneous</td>
<td align="left">an array with 2 dimensions</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">homogeneous</td>
<td align="left">an atomic integer vector containing only predefined values, storing categorical data</td>
</tr>
<tr class="odd">
<td align="left">list</td>
<td align="left">heterogeneous</td>
<td align="left">a container whose elements can encompass any mixture of data types</td>
</tr>
<tr class="even">
<td align="left">data.frame</td>
<td align="left">heterogeneous</td>
<td align="left">a rectangular list with elements (columns) containing atomic vectors of equal length</td>
</tr>
</tbody>
</table>
<p>Each vector can have <strong>attributes</strong>, which are a named list of metadata that can include the vector’s <strong>dimensions</strong> and its <strong>class</strong>. The latter is a property assigned to an object that determines how <strong>generic functions</strong> operate with it, and thus which <strong>methods</strong> are available for it. The class of an object can be queried using the <code>class()</code> function. You can learn more details about R data structures here: <a href="https://adv-r.hadley.nz/vectors-chap.html" class="uri">https://adv-r.hadley.nz/vectors-chap.html</a></p>
<p><strong>Data types:</strong></p>
<p>There are four primary types of atomic vectors. Collectively, integer and double vectors are known as numeric vectors. You can query the <strong>type</strong> of an object using the <code>typeof()</code> function.</p>
<center>
<img src="R/RDataWrangling/images/summary_tree_atomic.png" title="fig:" alt="atomic tree" />
</center>
<table>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">character</td>
<td align="left">“a”, “swc”</td>
</tr>
<tr class="even">
<td align="left">integer</td>
<td align="left">2L (the L tells R to store this as an integer)</td>
</tr>
<tr class="odd">
<td align="left">double (floating point)</td>
<td align="left">2, 15.5</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">TRUE, FALSE</td>
</tr>
</tbody>
</table>
<p><strong>Coercion:</strong></p>
<p>If heterogeneous elements are stored in an atomic vector, R will <strong>coerce</strong> the vector to the simplest type required to store all the information. The order of coercion is roughly: logical -&gt; integer -&gt; double -&gt; character -&gt; list. For example:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="#cb417-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.7</span>, <span class="fl">3.9</span>)</span>
<span id="cb417-2"><a href="#cb417-2"></a><span class="kw">typeof</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="#cb419-1"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.7</span>, <span class="fl">3.9</span>, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb419-2"><a href="#cb419-2"></a><span class="kw">typeof</span>(y)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="list-indexing" class="section level3">
<h3>List indexing</h3>
<p>Now that we know about data structures more generally, let’s focus on the <em>list</em> structure we created for <code>boysNames</code>.
Why are we using <strong>double brackets</strong> <code>[[</code> to index this list object, instead of the single brackets <code>[</code> we used to index atomic vectors?</p>
<center>
<img src="R/RDataWrangling/images/indexing_lists.png" title="fig:" alt="list indexing" />
</center>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="#cb421-1"></a><span class="co"># various data structures</span></span>
<span id="cb421-2"><a href="#cb421-2"></a>numbers &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></span>
<span id="cb421-3"><a href="#cb421-3"></a>letters &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb421-4"><a href="#cb421-4"></a>dat &lt;-<span class="st"> </span><span class="kw">head</span>(mtcars)</span>
<span id="cb421-5"><a href="#cb421-5"></a>x &lt;-<span class="st"> </span>237L</span>
<span id="cb421-6"><a href="#cb421-6"></a></span>
<span id="cb421-7"><a href="#cb421-7"></a><span class="co"># combine in a list</span></span>
<span id="cb421-8"><a href="#cb421-8"></a>mylist &lt;-<span class="st"> </span><span class="kw">list</span>(numbers, letters, dat, x)</span>
<span id="cb421-9"><a href="#cb421-9"></a></span>
<span id="cb421-10"><a href="#cb421-10"></a><span class="co"># indexing the list</span></span>
<span id="cb421-11"><a href="#cb421-11"></a>mylist[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="#cb423-1"></a><span class="kw">class</span>(mylist[<span class="dv">2</span>]) <span class="co"># a list</span></span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="#cb425-1"></a>mylist[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</code></pre>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="#cb427-1"></a><span class="kw">class</span>(mylist[[<span class="dv">2</span>]]) <span class="co"># a character vector</span></span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="dropping-missing-values" class="section level3">
<h3>Dropping missing values</h3>
<p>Next we want to remove blank rows and rows used for notes. An easy way
to do that is to use <code>drop_na()</code> from the <code>tidyr</code> package within <code>tidyverse</code>
to remove rows with missing values.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1"></a>boysNames[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 59 x 4
##    Name...2 Name...6 Count...3 Count...7
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1 &lt;NA&gt;     &lt;NA&gt;            NA        NA
##  2 JACK     DOMINIC      10779      1519
##  3 DANIEL   NICHOLAS     10338      1385
##  4 THOMAS   BRANDON       9603      1337
##  5 JAMES    RHYS          9385      1259
##  6 JOSHUA   MARK          7887      1222
##  7 MATTHEW  MAX           7426      1192
##  8 RYAN     DYLAN         6496      1186
##  9 JOSEPH   HENRY         6193      1135
## 10 SAMUEL   PETER         6161      1128
## # … with 49 more rows</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="#cb431-1"></a>boysNames[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>boysNames[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()</span>
<span id="cb431-2"><a href="#cb431-2"></a></span>
<span id="cb431-3"><a href="#cb431-3"></a>boysNames[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    Name...2 Name...6 Count...3 Count...7
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1 JACK     DOMINIC      10779      1519
##  2 DANIEL   NICHOLAS     10338      1385
##  3 THOMAS   BRANDON       9603      1337
##  4 JAMES    RHYS          9385      1259
##  5 JOSHUA   MARK          7887      1222
##  6 MATTHEW  MAX           7426      1192
##  7 RYAN     DYLAN         6496      1186
##  8 JOSEPH   HENRY         6193      1135
##  9 SAMUEL   PETER         6161      1128
## 10 LIAM     STEPHEN       5802      1122
## # … with 40 more rows</code></pre>
</div>
<div id="exercise-2-2" class="section level3">
<h3>Exercise 2</h3>
<ol style="list-style-type: decimal">
<li>Write a function called <code>namecount</code> that takes a data frame as an
argument and returns a modified version, which keeps only columns that
include the strings <code>Name</code> and <code>Count</code> in the column names.
HINT: see the <code>?matches</code> function.</li>
</ol>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Test your function on the first data frame in the list of boys
names data.</li>
</ol>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Use the <code>map()</code> function to each data frame in the list of boys
names data and save it to the list called <code>boysNames</code>.</li>
</ol>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="#cb435-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Write a function that takes a data frame as an argument and returns a modified version, which keeps only columns that include the strings <code>Name</code> and <code>Count</code> in the column names. HINT: see the <code>?matches</code> function.</li>
</ol>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1"></a>  namecount &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</span>
<span id="cb436-2"><a href="#cb436-2"></a>      <span class="kw">select</span>(data, <span class="kw">matches</span>(<span class="st">&quot;Name|Count&quot;</span>))</span>
<span id="cb436-3"><a href="#cb436-3"></a>  }</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Test your function on the first data frame in the list of boys names data.</li>
</ol>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1"></a>  <span class="kw">namecount</span>(boysNames[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    Name...2 Name...6 Count...3 Count...7
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1 JACK     DOMINIC      10779      1519
##  2 DANIEL   NICHOLAS     10338      1385
##  3 THOMAS   BRANDON       9603      1337
##  4 JAMES    RHYS          9385      1259
##  5 JOSHUA   MARK          7887      1222
##  6 MATTHEW  MAX           7426      1192
##  7 RYAN     DYLAN         6496      1186
##  8 JOSEPH   HENRY         6193      1135
##  9 SAMUEL   PETER         6161      1128
## 10 LIAM     STEPHEN       5802      1122
## # … with 40 more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Use the <code>map()</code> function to each data frame in the list of boys names data.</li>
</ol>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1"></a>  boysNames &lt;-<span class="st"> </span><span class="kw">map</span>(boysNames, namecount)</span></code></pre></div>
</div>
</details>
</div>
<div id="reshaping-from-wide-to-long" class="section level3">
<h3>Reshaping from wide to long</h3>
<p>Our final task is to re-arrange the data so that it is all in a single
table instead of in two side-by-side tables. For many similar tasks
the <code>gather()</code> function in the <code>tidyr</code> package is useful, but in this
case we will be better off using a combination of <code>select()</code> and
<code>bind_rows()</code>. Here’s the logic behind this step:</p>
<center>
<img src="R/RDataWrangling/images/wide_vs_long.png" />
</center>
<p>Here’s the code that implements the transformation:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1"></a>boysNames[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    Name...2 Name...6 Count...3 Count...7
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1 JACK     DOMINIC      10779      1519
##  2 DANIEL   NICHOLAS     10338      1385
##  3 THOMAS   BRANDON       9603      1337
##  4 JAMES    RHYS          9385      1259
##  5 JOSHUA   MARK          7887      1222
##  6 MATTHEW  MAX           7426      1192
##  7 RYAN     DYLAN         6496      1186
##  8 JOSEPH   HENRY         6193      1135
##  9 SAMUEL   PETER         6161      1128
## 10 LIAM     STEPHEN       5802      1122
## # … with 40 more rows</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1"></a>first_columns &lt;-<span class="st"> </span><span class="kw">select</span>(boysNames[[<span class="dv">1</span>]], <span class="dt">Name =</span> Name...<span class="dv">2</span>, <span class="dt">Count =</span> Count...<span class="dv">3</span>)</span>
<span id="cb442-2"><a href="#cb442-2"></a>second_columns &lt;-<span class="st"> </span><span class="kw">select</span>(boysNames[[<span class="dv">1</span>]], <span class="dt">Name =</span> Name...<span class="dv">6</span>, <span class="dt">Count =</span> Count...<span class="dv">7</span>)</span>
<span id="cb442-3"><a href="#cb442-3"></a></span>
<span id="cb442-4"><a href="#cb442-4"></a><span class="kw">bind_rows</span>(first_columns, second_columns)</span></code></pre></div>
<pre><code>## # A tibble: 100 x 2
##    Name    Count
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 JACK    10779
##  2 DANIEL  10338
##  3 THOMAS   9603
##  4 JAMES    9385
##  5 JOSHUA   7887
##  6 MATTHEW  7426
##  7 RYAN     6496
##  8 JOSEPH   6193
##  9 SAMUEL   6161
## 10 LIAM     5802
## # … with 90 more rows</code></pre>
</div>
<div id="exercise-3-3" class="section level3">
<h3>Exercise 3</h3>
<p><strong>Cleanup all the data</strong></p>
<p>In the previous examples we learned how to drop empty rows with
<code>drop_na()</code>, select only relevant columns with <code>select()</code>, and re-arrange
our data with <code>select()</code> and <code>bind_rows()</code>. In each case we applied the
changes only to the first element of our <code>boysNames</code> list.</p>
<p>NOTE: some Excel files include extra blank columns between the first and second
set of <code>Name</code> and <code>Count</code> columns, resulting in different numeric suffixes
for the second set of columns. You will need to use a regular expression
to match each of these different column names. HINT: see the <code>?matches</code>
function.</p>
<ol style="list-style-type: decimal">
<li>Create a new function called <code>cleanupNamesData</code> that:</li>
</ol>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1"></a><span class="co"># 1) subsets data to include only those columns that include the term `Name` and `Count` and apply listwise deletion</span></span>
<span id="cb444-2"><a href="#cb444-2"></a></span>
<span id="cb444-3"><a href="#cb444-3"></a><span class="co"># 2) subset two separate data frames, with first and second set of `Name` and `Count` columns</span></span>
<span id="cb444-4"><a href="#cb444-4"></a></span>
<span id="cb444-5"><a href="#cb444-5"></a><span class="co"># 3) append the two datasets</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Your task now is to use the <code>map()</code> function to apply each of these
transformations to all the elements in <code>boysNames</code>.</li>
</ol>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="#cb445-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Create a new function called <code>cleanupNamesData</code> that:</li>
</ol>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1"></a>cleanupNamesData &lt;-<span class="st"> </span><span class="cf">function</span>(file){</span>
<span id="cb446-2"><a href="#cb446-2"></a></span>
<span id="cb446-3"><a href="#cb446-3"></a>  <span class="co"># subset data to include only those columns that include the term `Name` and `Count`</span></span>
<span id="cb446-4"><a href="#cb446-4"></a>  subsetted_file &lt;-<span class="st"> </span>file <span class="op">%&gt;%</span></span>
<span id="cb446-5"><a href="#cb446-5"></a><span class="st">    </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;Name|Count&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb446-6"><a href="#cb446-6"></a><span class="st">    </span><span class="kw">drop_na</span>()</span>
<span id="cb446-7"><a href="#cb446-7"></a></span>
<span id="cb446-8"><a href="#cb446-8"></a>  <span class="co"># subset two separate data frames, with first and second set of `Name` and `Count` columns </span></span>
<span id="cb446-9"><a href="#cb446-9"></a>  first_columns &lt;-<span class="st"> </span><span class="kw">select</span>(subsetted_file, <span class="dt">Name =</span> Name...<span class="dv">2</span>, <span class="dt">Count =</span> Count...<span class="dv">3</span>) </span>
<span id="cb446-10"><a href="#cb446-10"></a></span>
<span id="cb446-11"><a href="#cb446-11"></a>  second_columns &lt;-<span class="st"> </span><span class="kw">select</span>(subsetted_file, <span class="dt">Name =</span> <span class="kw">matches</span>(<span class="st">&quot;Name...6|Name...7|Name...8&quot;</span>),</span>
<span id="cb446-12"><a href="#cb446-12"></a>                                           <span class="dt">Count =</span> <span class="kw">matches</span>(<span class="st">&quot;Count...7|Count...8|Count...9&quot;</span>))</span>
<span id="cb446-13"><a href="#cb446-13"></a></span>
<span id="cb446-14"><a href="#cb446-14"></a>  <span class="co"># append the two datasets</span></span>
<span id="cb446-15"><a href="#cb446-15"></a>  <span class="kw">bind_rows</span>(first_columns, second_columns)</span>
<span id="cb446-16"><a href="#cb446-16"></a>}</span>
<span id="cb446-17"><a href="#cb446-17"></a></span>
<span id="cb446-18"><a href="#cb446-18"></a></span>
<span id="cb446-19"><a href="#cb446-19"></a><span class="co">## test it out on the second data frame in the list</span></span>
<span id="cb446-20"><a href="#cb446-20"></a>boysNames[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>() <span class="co"># before cleanup</span></span></code></pre></div>
<pre><code>## Rows: 61
## Columns: 4
## $ Name...2  &lt;chr&gt; NA, &quot;JACK&quot;, &quot;JAMES&quot;, &quot;THOMAS&quot;, &quot;DANIEL&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW…
## $ Count...3 &lt;dbl&gt; NA, 10145, 9853, 9479, 9047, 7698, 7443, 6367, 5809, 5631, …
## $ Name...7  &lt;chr&gt; NA, &quot;SEAN&quot;, &quot;DYLAN&quot;, &quot;DOMINIC&quot;, &quot;LOUIS&quot;, &quot;RHYS&quot;, &quot;NICHOLAS&quot;…
## $ Count...8 &lt;dbl&gt; NA, 1388, 1380, 1359, 1325, 1291, 1274, 1244, 1241, 1158, 1…</code></pre>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1"></a>boysNames[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cleanupNamesData</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>() <span class="co"># after cleanup</span></span></code></pre></div>
<pre><code>## Rows: 100
## Columns: 2
## $ Name  &lt;chr&gt; &quot;JACK&quot;, &quot;JAMES&quot;, &quot;THOMAS&quot;, &quot;DANIEL&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW&quot;, &quot;SAMU…
## $ Count &lt;dbl&gt; 10145, 9853, 9479, 9047, 7698, 7443, 6367, 5809, 5631, 5404, 51…</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Your task now is to use the <code>map()</code> function to apply each of these transformations to all the elements in <code>boysNames</code>.</li>
</ol>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1"></a>boysNames &lt;-<span class="st"> </span><span class="kw">map</span>(boysNames, cleanupNamesData)</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="data-organization-storage" class="section level2">
<h2>Data organization &amp; storage</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to organize the data into one large data frame and store it.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Create a year column within each data frame within the list</li>
<li>Append all the data frames in the list into one large data frame</li>
</ol>
</div>
<p>Now that we have the data cleaned up and augmented, we can turn our attention to organizing and storing the data.</p>
<div id="a-list-of-data-frames" class="section level3">
<h3>A list of data frames</h3>
<p>Right now we have a list of data frames; one for each year. This is not a bad way to go. It has the advantage of making it easy to work with individual years; it has the disadvantage of making it more difficult to examine questions that require data from multiple years. To make the arrangement of the data clearer it helps to name each element of the list with the year it corresponds to.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="#cb451-1"></a><span class="kw">head</span>(boysNames) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## List of 6
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;DANIEL&quot; &quot;THOMAS&quot; &quot;JAMES&quot; ...
##   ..$ Count: num [1:100] 10779 10338 9603 9385 7887 ...
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;JAMES&quot; &quot;THOMAS&quot; &quot;DANIEL&quot; ...
##   ..$ Count: num [1:100] 10145 9853 9479 9047 7698 ...
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;DANIEL&quot; ...
##   ..$ Count: num [1:100] 9845 9468 9197 7732 7672 ...
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;JOSHUA&quot; ...
##   ..$ Count: num [1:100] 9785 9454 8748 7275 6935 ...
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;JOSHUA&quot; ...
##   ..$ Count: num [1:100] 9079 8672 7489 7097 6229 ...
##  $ : tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JOSHUA&quot; &quot;JAMES&quot; ...
##   ..$ Count: num [1:100] 9000 8337 7182 7026 5759 ...</code></pre>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1"></a><span class="kw">head</span>(boy_file_names)</span></code></pre></div>
<pre><code>## [1] &quot;dataSets/boys/1996boys_tcm77-254026.xlsx&quot;
## [2] &quot;dataSets/boys/1997boys_tcm77-254022.xlsx&quot;
## [3] &quot;dataSets/boys/1998boys_tcm77-254018.xlsx&quot;
## [4] &quot;dataSets/boys/1999boys_tcm77-254014.xlsx&quot;
## [5] &quot;dataSets/boys/2000boys_tcm77-254008.xlsx&quot;
## [6] &quot;dataSets/boys/2001boys_tcm77-254000.xlsx&quot;</code></pre>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1"></a><span class="co"># use regex to extract years from file names</span></span>
<span id="cb455-2"><a href="#cb455-2"></a>Years &lt;-<span class="st"> </span><span class="kw">str_extract</span>(boy_file_names, <span class="dt">pattern =</span> <span class="st">&quot;[0-9]{4}&quot;</span>)</span>
<span id="cb455-3"><a href="#cb455-3"></a>Years</span></code></pre></div>
<pre><code>##  [1] &quot;1996&quot; &quot;1997&quot; &quot;1998&quot; &quot;1999&quot; &quot;2000&quot; &quot;2001&quot; &quot;2002&quot; &quot;2003&quot; &quot;2004&quot; &quot;2005&quot;
## [11] &quot;2006&quot; &quot;2007&quot; &quot;2008&quot; &quot;2009&quot; &quot;2010&quot; &quot;2011&quot; &quot;2012&quot; &quot;2013&quot; &quot;2014&quot; &quot;2015&quot;</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1"></a><span class="kw">names</span>(boysNames) <span class="co"># returns NULL - no names in the list</span></span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1"></a><span class="co"># assign years to list names</span></span>
<span id="cb459-2"><a href="#cb459-2"></a><span class="kw">names</span>(boysNames) &lt;-<span class="st"> </span>Years </span>
<span id="cb459-3"><a href="#cb459-3"></a></span>
<span id="cb459-4"><a href="#cb459-4"></a><span class="kw">names</span>(boysNames) <span class="co"># returns the years as list names</span></span></code></pre></div>
<pre><code>##  [1] &quot;1996&quot; &quot;1997&quot; &quot;1998&quot; &quot;1999&quot; &quot;2000&quot; &quot;2001&quot; &quot;2002&quot; &quot;2003&quot; &quot;2004&quot; &quot;2005&quot;
## [11] &quot;2006&quot; &quot;2007&quot; &quot;2008&quot; &quot;2009&quot; &quot;2010&quot; &quot;2011&quot; &quot;2012&quot; &quot;2013&quot; &quot;2014&quot; &quot;2015&quot;</code></pre>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1"></a><span class="kw">head</span>(boysNames) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>() </span></code></pre></div>
<pre><code>## List of 6
##  $ 1996: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;DANIEL&quot; &quot;THOMAS&quot; &quot;JAMES&quot; ...
##   ..$ Count: num [1:100] 10779 10338 9603 9385 7887 ...
##  $ 1997: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;JAMES&quot; &quot;THOMAS&quot; &quot;DANIEL&quot; ...
##   ..$ Count: num [1:100] 10145 9853 9479 9047 7698 ...
##  $ 1998: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;DANIEL&quot; ...
##   ..$ Count: num [1:100] 9845 9468 9197 7732 7672 ...
##  $ 1999: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;JOSHUA&quot; ...
##   ..$ Count: num [1:100] 9785 9454 8748 7275 6935 ...
##  $ 2000: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JAMES&quot; &quot;JOSHUA&quot; ...
##   ..$ Count: num [1:100] 9079 8672 7489 7097 6229 ...
##  $ 2001: tibble [100 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Name : chr [1:100] &quot;JACK&quot; &quot;THOMAS&quot; &quot;JOSHUA&quot; &quot;JAMES&quot; ...
##   ..$ Count: num [1:100] 9000 8337 7182 7026 5759 ...</code></pre>
</div>
<div id="one-big-data-frame" class="section level3">
<h3>One big data frame</h3>
<p>While storing the data in separate data frames by year makes some sense,
many operations will be easier if the data is simply stored in one big
data frame. We’ve already seen how to turn a list of data frames into a
single data.frame using <code>bind_rows()</code>, but there is a problem; The year
information is stored in the names of the list elements, and so
flattening the data.frames into one will result in losing the year
information! Fortunately it is not too much trouble to add the year
information to each data frame before flattening.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1"></a><span class="co"># apply name of the list element (.y) as a new column in the data.frame (.x)</span></span>
<span id="cb463-2"><a href="#cb463-2"></a>boysNames &lt;-<span class="st"> </span><span class="kw">imap</span>(boysNames, <span class="op">~</span><span class="st"> </span><span class="kw">mutate</span>(.x, <span class="dt">Year =</span> <span class="kw">as.integer</span>(.y)))</span>
<span id="cb463-3"><a href="#cb463-3"></a></span>
<span id="cb463-4"><a href="#cb463-4"></a>boysNames[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## $`1996`
## # A tibble: 100 x 3
##    Name    Count  Year
##    &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
##  1 JACK    10779  1996
##  2 DANIEL  10338  1996
##  3 THOMAS   9603  1996
##  4 JAMES    9385  1996
##  5 JOSHUA   7887  1996
##  6 MATTHEW  7426  1996
##  7 RYAN     6496  1996
##  8 JOSEPH   6193  1996
##  9 SAMUEL   6161  1996
## 10 LIAM     5802  1996
## # … with 90 more rows</code></pre>
</div>
<div id="exercise-4-1" class="section level3">
<h3>Exercise 4</h3>
<p><strong>Make one big <code>data.frame</code></strong></p>
<ol style="list-style-type: decimal">
<li>Turn the list of boys names data frames into a single data frame. HINT: see <code>?bind_rows</code>.</li>
</ol>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create a new directory called <code>all</code> within <code>dataSets</code> and write the data to a <code>.csv</code> file.
HINT: see the <code>?dir.create</code> and <code>?write_csv</code> functions.</li>
</ol>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>What were the five most popular names in 2013?</li>
</ol>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1"></a><span class="co">## </span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>How has the popularity of the name “ANDREW” changed over time?</li>
</ol>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1"></a><span class="co">## </span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 4 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Turn the list of boys names data frames into a single data frame.</li>
</ol>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="#cb469-1"></a>boysNames &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(boysNames)</span>
<span id="cb469-2"><a href="#cb469-2"></a><span class="kw">glimpse</span>(boysNames)</span></code></pre></div>
<pre><code>## Rows: 2,000
## Columns: 3
## $ Name  &lt;chr&gt; &quot;JACK&quot;, &quot;DANIEL&quot;, &quot;THOMAS&quot;, &quot;JAMES&quot;, &quot;JOSHUA&quot;, &quot;MATTHEW&quot;, &quot;RYAN…
## $ Count &lt;dbl&gt; 10779, 10338, 9603, 9385, 7887, 7426, 6496, 6193, 6161, 5802, 5…
## $ Year  &lt;int&gt; 1996, 1996, 1996, 1996, 1996, 1996, 1996, 1996, 1996, 1996, 199…</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Create a new directory called <code>all</code> within <code>dataSets</code> and write the data to a <code>.csv</code> file. HINT: see the <code>?dir.create</code> and <code>?write_csv</code> functions.</li>
</ol>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1"></a><span class="kw">dir.create</span>(<span class="st">&quot;dataSets/all&quot;</span>)</span>
<span id="cb471-2"><a href="#cb471-2"></a></span>
<span id="cb471-3"><a href="#cb471-3"></a><span class="kw">write_csv</span>(boysNames, <span class="st">&quot;dataSets/all/boys_names.csv&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>What were the five most popular names in 2013?</li>
</ol>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="#cb472-1"></a>boysNames <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb472-2"><a href="#cb472-2"></a><span class="st">  </span><span class="kw">filter</span>(Year <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>) <span class="op">%&gt;%</span></span>
<span id="cb472-3"><a href="#cb472-3"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Count)) <span class="op">%&gt;%</span></span>
<span id="cb472-4"><a href="#cb472-4"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   Name    Count  Year
##   &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;
## 1 OLIVER   6949  2013
## 2 JACK     6212  2013
## 3 HARRY    5888  2013
## 4 JACOB    5126  2013
## 5 CHARLIE  5039  2013
## 6 THOMAS   4591  2013</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>How has the popularity of the name “ANDREW” changed over time?</li>
</ol>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="#cb474-1"></a>andrew &lt;-<span class="st"> </span><span class="kw">filter</span>(boysNames, Name <span class="op">==</span><span class="st"> &quot;ANDREW&quot;</span>)</span>
<span id="cb474-2"><a href="#cb474-2"></a></span>
<span id="cb474-3"><a href="#cb474-3"></a><span class="kw">ggplot</span>(andrew, <span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> Count)) <span class="op">+</span></span>
<span id="cb474-4"><a href="#cb474-4"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb474-5"><a href="#cb474-5"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Popularity of Andrew, over time&quot;</span>)</span></code></pre></div>
<p><img src="R/RDataWrangling/figures/unnamed-chunk-261-1.png" width="672" /></p>
</div>
</details>
</div>
</div>
<div id="complete-code" class="section level2">
<h2>Complete code</h2>
<ol style="list-style-type: decimal">
<li>Code for Section 1: Reading data from multiple Excel worksheets into R data frames</li>
</ol>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1"></a>boy_file_names &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;dataSets/boys&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</span>
<span id="cb475-2"><a href="#cb475-2"></a></span>
<span id="cb475-3"><a href="#cb475-3"></a>get_data_sheet_name &lt;-<span class="st"> </span><span class="cf">function</span>(file, term){</span>
<span id="cb475-4"><a href="#cb475-4"></a>  <span class="kw">excel_sheets</span>(file) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_subset</span>(<span class="dt">pattern =</span> term)</span>
<span id="cb475-5"><a href="#cb475-5"></a>}</span>
<span id="cb475-6"><a href="#cb475-6"></a></span>
<span id="cb475-7"><a href="#cb475-7"></a>read_boys_names &lt;-<span class="st"> </span><span class="cf">function</span>(file, sheet_name) {</span>
<span id="cb475-8"><a href="#cb475-8"></a>  <span class="kw">read_excel</span>(</span>
<span id="cb475-9"><a href="#cb475-9"></a>    <span class="dt">path =</span> file,</span>
<span id="cb475-10"><a href="#cb475-10"></a>    <span class="dt">sheet =</span> <span class="kw">get_data_sheet_name</span>(file, <span class="dt">term =</span> sheet_name),</span>
<span id="cb475-11"><a href="#cb475-11"></a>    <span class="dt">skip =</span> <span class="dv">6</span></span>
<span id="cb475-12"><a href="#cb475-12"></a>  )</span>
<span id="cb475-13"><a href="#cb475-13"></a>}</span>
<span id="cb475-14"><a href="#cb475-14"></a></span>
<span id="cb475-15"><a href="#cb475-15"></a>boysNames &lt;-<span class="st"> </span><span class="kw">map</span>(boy_file_names, read_boys_names, <span class="dt">sheet_name =</span> <span class="st">&quot;Table 1&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Code for Section 2: Clean up data within each R data frame</li>
</ol>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="#cb476-1"></a>cleanupNamesData &lt;-<span class="st"> </span><span class="cf">function</span>(file){</span>
<span id="cb476-2"><a href="#cb476-2"></a>  <span class="co"># subset data to include only those columns that include the term `Name` and `Count`</span></span>
<span id="cb476-3"><a href="#cb476-3"></a>  subsetted_file &lt;-<span class="st"> </span>file <span class="op">%&gt;%</span></span>
<span id="cb476-4"><a href="#cb476-4"></a><span class="st">    </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;Name|Count&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb476-5"><a href="#cb476-5"></a><span class="st">    </span><span class="kw">drop_na</span>()</span>
<span id="cb476-6"><a href="#cb476-6"></a>  <span class="co"># subset two separate data frames, with first and second set of `Name` and `Count` columns </span></span>
<span id="cb476-7"><a href="#cb476-7"></a>  first_columns &lt;-<span class="st"> </span><span class="kw">select</span>(subsetted_file, <span class="dt">Name =</span> Name...<span class="dv">2</span>, <span class="dt">Count =</span> Count...<span class="dv">3</span>) </span>
<span id="cb476-8"><a href="#cb476-8"></a>  second_columns &lt;-<span class="st"> </span><span class="kw">select</span>(subsetted_file, <span class="dt">Name =</span> <span class="kw">matches</span>(<span class="st">&quot;Name...6|Name...7|Name...8&quot;</span>),</span>
<span id="cb476-9"><a href="#cb476-9"></a>                                           <span class="dt">Count =</span> <span class="kw">matches</span>(<span class="st">&quot;Count...7|Count...8|Count...9&quot;</span>))</span>
<span id="cb476-10"><a href="#cb476-10"></a>  <span class="co"># append the two datasets</span></span>
<span id="cb476-11"><a href="#cb476-11"></a>  <span class="kw">bind_rows</span>(first_columns, second_columns)</span>
<span id="cb476-12"><a href="#cb476-12"></a>}</span>
<span id="cb476-13"><a href="#cb476-13"></a></span>
<span id="cb476-14"><a href="#cb476-14"></a>boysNames &lt;-<span class="st"> </span><span class="kw">map</span>(boysNames, cleanupNamesData)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Code for Section 3: Organize the data into one large data frame and store it</li>
</ol>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1"></a>Years &lt;-<span class="st"> </span><span class="kw">str_extract</span>(boy_file_names, <span class="dt">pattern =</span> <span class="st">&quot;[0-9]{4}&quot;</span>)</span>
<span id="cb477-2"><a href="#cb477-2"></a></span>
<span id="cb477-3"><a href="#cb477-3"></a><span class="kw">names</span>(boysNames) &lt;-<span class="st"> </span>Years</span>
<span id="cb477-4"><a href="#cb477-4"></a></span>
<span id="cb477-5"><a href="#cb477-5"></a>boysNames &lt;-<span class="st"> </span><span class="kw">imap</span>(boysNames, <span class="op">~</span><span class="st"> </span><span class="kw">mutate</span>(.x, <span class="dt">Year =</span> <span class="kw">as.integer</span>(.y)))</span>
<span id="cb477-6"><a href="#cb477-6"></a></span>
<span id="cb477-7"><a href="#cb477-7"></a>boysNames &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(boysNames)</span></code></pre></div>
</div>
<div id="wrap-up-4" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-4" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-5" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>R
<ul>
<li>Learn from the best: <a href="http://adv-r.had.co.nz/" class="uri">http://adv-r.had.co.nz/</a>; <a href="http://r4ds.had.co.nz/" class="uri">http://r4ds.had.co.nz/</a></li>
<li>R documentation: <a href="http://cran.r-project.org/manuals.html" class="uri">http://cran.r-project.org/manuals.html</a></li>
<li>Collection of R tutorials: <a href="http://cran.r-project.org/other-docs.html" class="uri">http://cran.r-project.org/other-docs.html</a></li>
<li>R for Programmers (by Norman Matloff, UC–Davis) <a href="http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf" class="uri">http://heather.cs.ucdavis.edu/~matloff/R/RProg.pdf</a></li>
<li>Calling C and Fortran from R (by Charles Geyer, UMinn) <a href="http://www.stat.umn.edu/~charlie/rc/" class="uri">http://www.stat.umn.edu/~charlie/rc/</a></li>
<li>State of the Art in Parallel Computing with R (Schmidberger et al.) <a href="http://www.jstatso" class="uri">http://www.jstatso</a>|.org/v31/i01/paper</li>
</ul></li>
</ul>

</div>
</div>
</div>



<div id="python-installation" class="section level1">
<h1>Python Installation</h1>
<div class="alert alert-info">
<p><strong>Your professional conduct is greatly appreciated. Out of respect to your fellow workshop attendees and instructors, please arrive at your workshop on time, having pre-installed all necessary software and materials. This will likely take 15-20 minutes.</strong></p>
</div>
<p>Before starting any of our Python workshops, it is necessary to complete 2 tasks. Please make sure both of these tasks are completed <strong>before</strong> you attend your workshop, as, depending on your internet speed, they may take a long time.</p>
<ol style="list-style-type: decimal">
<li>download and unzip <strong>class materials</strong></li>
<li>download and install <strong>Anaconda Python 3 distribution</strong></li>
</ol>
<p><img src="Python/PythonInstall/images/install_software_Python.png" /></p>
<div id="troubleshooting-session-1" class="section level2">
<h2>Troubleshooting session</h2>
<p>We will hold a troubleshooting session during the 20 minutes prior to the start of the workshop.
<strong>If you are unable to complete all of the tasks, please stop by the training room during this session.</strong>
Once the workshop starts we will <strong>NOT</strong> be able to give you one-to-one assistance with troubleshooting installation problems. Likewise, if you arrive late, please do <strong>NOT</strong> expect one-to-one assistance for anything covered at the beginning of the workshop.</p>
</div>
<div id="materials-1" class="section level2">
<h2>Materials</h2>
<p>Download class materials for your workshop:</p>
<ul>
<li>Python Introduction: <a href="https://github.com/IQSS/dss-workshops/raw/master/Python/PythonIntro.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Python/PythonIntro.zip</a></li>
<li>Python Webscraping: <a href="https://github.com/IQSS/dss-workshops/raw/master/Python/PythonWebScrape.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Python/PythonWebScrape.zip</a></li>
</ul>
<p>Extract materials from the zipped directory (Right-click =&gt; Extract All on Windows, double-click on Mac) and move them to your desktop.</p>
<p>It will be useful when you view the above materials for you to see the different file extensions on your computer. Here are instructions for enabling this:</p>
<ul>
<li><a href="https://support.apple.com/guide/mac-help/show-or-hide-filename-extensions-on-mac-mchlp2304/mac">Mac OS</a></li>
<li><a href="http://kb.winzip.com/kb/entry/26/">Windows OS</a></li>
</ul>
</div>
<div id="software-1" class="section level2">
<h2>Software</h2>
<p>The <strong>Anaconda Python distribution</strong> is designed with data science in mind and contains a curated set of 270+ pre-installed Python packages. It is essential that you have the Anaconda Python distribution pre-installed so that we can start the workshop on time. It is also important that you have the <strong>latest version</strong> of the distribution, which currently is:</p>
<ul>
<li>Anaconda Python distribution version <strong>2020.07</strong>, which contains Python version <strong>3.8.5</strong>.</li>
</ul>
<p><strong>Mac OS X:</strong></p>
<ul>
<li>Install Anaconda Python 3 by downloading and running <a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.pkg">this .pkg file</a>. Accept the defaults proposed by the Anaconda installer.</li>
</ul>
<p><strong>Windows:</strong></p>
<ul>
<li>Install Anaconda Python 3 by downloading and running <a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-Windows-x86_64.exe">this .exe file</a>. Accept the defaults proposed by the Anaconda installer.</li>
</ul>
<p><strong>Linux:</strong></p>
<ul>
<li>Install Anaconda Python 3 by downloading and running <a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh">this .sh file</a>. Accept the defaults proposed by the Anaconda installer.</li>
</ul>
<div class="alert alert-success">
<p><strong>Success? After installing, please start the <code>Anaconda Navigator</code> program. If you were successful with the installation, you should see a window similar to this:</strong></p>
</div>
<p><img src="Python/PythonInstall/images/Anaconda_navigator.png" /></p>
<p>To check that the installation is working correctly, click the <code>Launch</code> button under <code>JupyterLab</code>. A JupyterLab window should open in your web browser.</p>
<div class="alert alert-danger">
<p><strong>If you are having any difficulties with the installation, please stop by the training room 20 minutes prior to the start of the workshop.</strong></p>
</div>
</div>
<div id="jupyter-notebook-interfaces" class="section level2">
<h2>Jupyter notebook interfaces</h2>
<p>We will be using Jupyter Notebooks to run our Python code. <a href="https://jupyter-notebook.readthedocs.io/en/stable/">Jupyter Notebooks</a> are documents that combine text, code, images, math, and rich media and can be viewed in a browser. There are two main ways to interact with Jupyter Notebooks:</p>
<ol style="list-style-type: decimal">
<li>using <strong>JupyterLab</strong>, a modern “extensible environment for interactive and reproducible computing” that runs in your web browser.</li>
<li>using <strong>Jupyter Notebook</strong>, an older browser-based application.</li>
</ol>
<p>Compared to Jupyter Notebook, JupyterLab provides a more modern, richer and more robust coding environment. For this reason, <strong>we strongly recommend that you use JupyterLab to interact with notebooks</strong>.</p>
<div id="launch-jupyterlab" class="section level3">
<h3>Launch JupyterLab</h3>
<p>Here’s how to start JupyterLab and open a notebook within this interface (<strong>recommended</strong>):</p>
<ol style="list-style-type: decimal">
<li>Start the <code>Anaconda Navigator</code> program</li>
<li>Click the <code>Launch</code> button under <code>JupyterLab</code></li>
<li>A browser window will open with your computer’s files listed on the left hand side of the page. Navigate to the folder with the workshop materials that you downloaded to your desktop and double-click on the folder</li>
<li>Within the workshop materials folder, double-click on the file with the word “BLANK” in the name (<code>*_BLANK.ipynb</code>). (If a pop-up window asks you to <code>Select Kernel</code> choose <code>Python 3</code> kernel.) The Jupyter Notebook should now open on the right hand side of the page.</li>
</ol>
<p>If you have technical difficulty with JupyterLab you can try the older Jupyter Notebook as a fallback by clicking the <code>Launch</code> button under <code>Jupyter Notebook</code> in step 2.</p>
</div>
</div>
<div id="resources-6" class="section level2">
<h2>Resources</h2>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
<div id="python-introduction" class="section level1">
<h1>Python Introduction</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Functions</li>
<li>Objects</li>
<li>Assignment</li>
<li>Finding help</li>
<li>List and dictionary structures</li>
<li>Indexing data structures</li>
<li>Iterating over collections of data</li>
<li>Importing packages</li>
</ul>
<div id="setup-4" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials-4" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./PythonInstall.html">Python Installation</a> instructions and ensure that you can successfully start JupyterLab.</p>
<p>A handy <a href="Python/PythonIntro/python-cheat-sheet-basic.pdf">cheat-sheet</a> is available to help you look up and remember basic syntax.</p>
</div>
<div id="class-structure-4" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites-4" class="section level3">
<h3>Prerequisites</h3>
<p>This is an introductory Python course:</p>
<ul>
<li>Assumes no prior knowledge of <strong>how to use</strong> Python</li>
<li>We do assume you know <strong>why</strong> you want to learn Python. If you don’t, and want a comparison of Python to other statistical software, see our <a href="./DataScienceTools.html">Data Science Tools</a> workshop</li>
<li>Relatively slow-paced</li>
</ul>
</div>
<div id="goals-3" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the Python language by analyzing the text of Lewis Carroll’s <em>Alice’s Adventures in Wonderland</em>.
In particular, our goals are to learn about:</p>
<ol style="list-style-type: decimal">
<li>What Python is and how it works</li>
<li>How we can interact with Python</li>
<li>Foundations of the language (functions, objects, assignment, methods)</li>
<li>Using methods and lists to analyze data</li>
<li>Iterating over collections of data to automate repetitive tasks</li>
<li>Storing related data in dictionaries (as key - value pairs)</li>
<li>Importing packages to add functionality</li>
</ol>
</div>
</div>
</div>
<div id="python-basics" class="section level2">
<h2>Python basics</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the foundations of the Python language.</strong></p>
<ol style="list-style-type: decimal">
<li>What Python is and how it works</li>
<li>Python interfaces</li>
<li>Functions</li>
<li>Objects</li>
<li>Assignment</li>
<li>Methods</li>
</ol>
</div>
<div id="what-is-python" class="section level3">
<h3>What is Python?</h3>
<ul>
<li>Python is a free general purpose programming language</li>
<li>Python is an interpreted language, not a compiled one, meaning that all commands
typed on the keyboard are directly executed without requiring to build a complete
program (this is like R and unlike C, Fortran, Pascal, etc.)</li>
<li>Python has existed for about 30 years</li>
<li>Python is modular — most functionality is from add-on packages. So the language can
be thought of as a <em>platform</em> for creating and running a large number of useful packages.</li>
</ul>
</div>
<div id="why-use-python" class="section level3">
<h3>Why use Python?</h3>
<ul>
<li>Relatively easy to learn</li>
<li>Extremely flexible: can be used to manipulate, analyze, and visualize data,
make web sites, write games, and much more (Youtube and DropBox were written in Python)</li>
<li>Cutting edge machine learning tools</li>
<li>Publication quality graphics</li>
<li>150,000+ add on packages covering all aspects of statistics and machine learning</li>
<li>Active community of users</li>
</ul>
</div>
<div id="how-does-python-work" class="section level3">
<h3>How does Python work?</h3>
<p>While graphical-based statistical software (e.g., SPSS, GraphPad) immediately display
the results of an analysis, <strong>Python stores results in an <code>object</code> (a data structure)</strong>,
so that an analysis can be done with no result displayed. Such a feature is very
useful, since a user can extract only that part of the results that is of interest
and can pass results into further analyses.</p>
<p>For example, if you run a series of 20 regressions and want to compare the
different regression coefficients, Python can display only the estimated coefficients:
thus the results may take a single line, whereas graphical-based software could
open 20 results windows. In addition, these regression coefficients can be passed
directly into further analyses — such as generating predictions.</p>
<p><img src="Python/PythonIntro/images/python_chain.png" /></p>
<p>When Python is running, variables, data, functions, results, etc., are <strong>stored in memory</strong>
on the computer in the form of <code>objects</code> that have a name. The user can
<strong>perform actions</strong> on these objects with <code>operators</code> (arithmetic, logical,
comparison, etc.) and <code>functions</code> (which are themselves objects). Here’s a
schematic of how this all fits together:</p>
<p><img src="Python/PythonIntro/images/python_works.png" /></p>
</div>
<div id="interfaces-1" class="section level3">
<h3>Interfaces</h3>
<div id="text-editors-ides-notebooks-1" class="section level4">
<h4>Text editors, IDEs, &amp; Notebooks</h4>
<p>There are different ways of interacting with Python. The two main ways are through:</p>
<ol style="list-style-type: decimal">
<li><strong>text editors</strong> or <strong>Integrated Development Environments (IDEs):</strong> Text editors and IDEs are not really separate categories; as you add features to a text editor it becomes more like an IDE. Some editors/IDEs are language-specific while others are general purpose — typically providing language support via plugins. The following table lists a few popular editors/IDEs that can be used with Python. In this workshop, we will use <a href="https://jupyter.org/">JupyterLab</a>, a modern “extensible environment for interactive and reproducible computing” that runs in your web browser.</li>
</ol>
<table>
<thead>
<tr class="header">
<th align="left">Editor / IDE</th>
<th align="left">Features</th>
<th align="left">Ease of use</th>
<th align="left">Language support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Spyder</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Python only</td>
</tr>
<tr class="even">
<td align="left">PyCharm</td>
<td align="left">Excellent</td>
<td align="left">Moderate</td>
<td align="left">Python only</td>
</tr>
<tr class="odd">
<td align="left">JupyterLab</td>
<td align="left">Good</td>
<td align="left">Easy</td>
<td align="left">Excellent</td>
</tr>
<tr class="even">
<td align="left">VS code</td>
<td align="left">Excellent</td>
<td align="left">Easy</td>
<td align="left">Very good</td>
</tr>
<tr class="odd">
<td align="left">Atom</td>
<td align="left">Good</td>
<td align="left">Moderate</td>
<td align="left">Good</td>
</tr>
<tr class="even">
<td align="left">Vim</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Good</td>
</tr>
<tr class="odd">
<td align="left">Emacs</td>
<td align="left">Excellent</td>
<td align="left">Hard</td>
<td align="left">Excellent</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li><strong>Notebooks:</strong> Browser-based applications that allow you to create and share documents that contain live code, equations, visualizations, and narrative text. One popular choice is <a href="https://jupyter.org/">Jupyter Notebook</a>; an open source notebook that has support for 40+ languages, but has limited features compared with the JupyterLab IDE.</li>
</ol>
</div>
<div id="source-code-literate-programming-1" class="section level4">
<h4>Source code &amp; literate programming</h4>
<p>There are also several different <strong>formats</strong> available for writing code in Python.
These basically boil down to a choice between:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Source code:</strong> the practice of writing code, and possibly comments, in a plain text document. In Python this is done by writing code in a text file with a <code>.py</code> extension. Writing source code has the great advantage of being simple. Souce code is the format of choice if you intend to run your code as a complete script - for example, from the command line.</p></li>
<li><p><strong>Literate programming:</strong> the practice of embedding computer code in a natural language document. In Python this is often done using the aformentioned <a href="https://jupyter.org/">Jupyter Notebook</a>, which is a <a href="https://www.json.org/json-en.html">JSON</a> document containing an ordered list of input/output cells which can contain code, text (using <em>Markdown</em>), mathematics, plots, and rich media, usually ending with the <code>.ipynb</code> extension. Jupyter Notebooks are easy to write, human-readable, and the format of choice if you intend to run your code interactively, by running small pieces of code and looking at each output. Researchers can use Notebooks to write their journal papers, dissertations, and statistics/math class notes, since it is easy to convert into other formats later, such as HTML (for a webpage), MS Word, or PDF (via LaTeX).</p></li>
</ol>
<p>Here are some resources for learning more about Jupyter Notebooks:</p>
<ul>
<li><a href="https://www.dataquest.io/blog/jupyter-notebook-tutorial/" class="uri">https://www.dataquest.io/blog/jupyter-notebook-tutorial/</a></li>
<li><a href="https://www.datacamp.com/community/tutorials/tutorial-jupyter-notebook" class="uri">https://www.datacamp.com/community/tutorials/tutorial-jupyter-notebook</a></li>
<li><a href="https://realpython.com/jupyter-notebook-introduction/" class="uri">https://realpython.com/jupyter-notebook-introduction/</a></li>
</ul>
</div>
</div>
<div id="launch-jupyterlab-1" class="section level3">
<h3>Launch JupyterLab</h3>
<ol style="list-style-type: decimal">
<li>Start the <code>Anaconda Navigator</code> program</li>
<li>Click the <code>Launch</code> button under <code>JupyterLab</code></li>
<li>A browser window will open with your computer’s files listed on the left hand side of the page. Navigate to the folder called <code>PythonIntro</code> that you downloaded to your desktop and double-click on the folder</li>
<li>Within the <code>PythonIntro</code> folder, double-click on the file with the word “BLANK” in the name (<code>PythonIntro_BLANK.ipynb</code>). A pop-up window will ask you to <code>Select Kernal</code> — you should select the Python 3 kernal. The Jupyter Notebook should now open on the right hand side of the page</li>
</ol>
<p>A Jupyter Notebook contains one or more <em>cells</em> containing notes or code. To insert a new cell click the <code>+</code> button in the upper left. To execute a cell, select it and press <code>Control+Enter</code> or click the <code>Run</code> button at the top.</p>
</div>
<div id="syntax-rules-1" class="section level3">
<h3>Syntax rules</h3>
<ul>
<li>Python is case sensitive</li>
<li>Python uses white space as part of the syntax (it’s important!)</li>
<li>Variable names should start with a letter (A-Z and a-z)
and can include letters, digits (0-9), and underscores (_)</li>
<li>Comments can be inserted using a hash <code>#</code> symbol</li>
<li>Functions must be written with parentheses, even
if there is nothing within them; for example: <code>len()</code></li>
</ul>
</div>
<div id="function-calls-1" class="section level3">
<h3>Function calls</h3>
<p><strong>Functions perform actions</strong> — they take some input, called <code>arguments</code> and return some
output (i.e., a result). Here’s a schematic of how a function works:</p>
<p><img src="Python/PythonIntro/images/function.png" /></p>
<p>The general form for calling Python functions is</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb478-1"><a href="#cb478-1"></a><span class="co"># function_name(arg1, arg2, arg3, ... argn)</span></span></code></pre></div>
<p>The arguments in a function can be objects (data, formulae, expressions, etc.),
some of which could be defined by default in the function; these default values may
be modified by the user by specifying options.</p>
</div>
<div id="assignment-1" class="section level3">
<h3>Assignment</h3>
<p>In Python we can assign an object (data structure) to an name using the <code>=</code> operator.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb479-1"><a href="#cb479-1"></a><span class="co"># name = thing_to_assign</span></span>
<span id="cb479-2"><a href="#cb479-2"></a>x <span class="op">=</span> <span class="dv">10</span></span></code></pre></div>
<p>The name on the left of the equals sign is one that we chose. When choosing names, they must:</p>
<ol style="list-style-type: decimal">
<li>start with a <em>letter</em></li>
<li>use only <em>letters</em>, <em>numbers</em> and <em>underscores</em></li>
</ol>
</div>
<div id="reading-data-1" class="section level3">
<h3>Reading data</h3>
<p>Reading information from a file is the first step in many projects, so we’ll use functions to read data into Python and assign them to a named object. The workshop materials you downloaded earlier include a file named <code>Alice_in_wonderland.txt</code> which contains the text of Lewis Carroll’s <em>Alice’s Adventures in Wonderland</em>. We can use the <code>open()</code> function to create a file <strong>object</strong> that makes a <strong>connection</strong> to the file:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb480-1"><a href="#cb480-1"></a>alice_file <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;Alice_in_wonderland.txt&quot;</span>)</span></code></pre></div>
<p>The <code>alice_file</code> object name we just created does <em>not</em> contain the contents of <code>Alice_in_wonderland.txt</code>. It is a representation in Python of the <em>file itself</em> rather than the <em>contents</em> of the file.</p>
</div>
<div id="object-methods" class="section level3">
<h3>Object methods</h3>
<p>The <code>alice_file</code> object provides <em>methods</em> that we can use to do things with it. Methods are invoked using syntax that looks like <code>ObjectName.method()</code>. You can see the methods available for acting on an object by typing the object’s name followed by a <code>.</code> and pressing the <code>tab</code> key. For example, typing <code>alice_file.</code> and pressing <code>tab</code> will display a list of methods as shown below.</p>
<p><img src="Python/PythonIntro/images/notebook_file_completion.png" />.</p>
<p>Among the methods we have for doing things with our <code>alice_file</code> object is one named <code>read</code>. We can use the <code>help</code> function to learn more about it.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb481-1"><a href="#cb481-1"></a><span class="bu">help</span>(alice_file.read)</span></code></pre></div>
<pre><code>## Help on built-in function read:
## 
## read(size=-1, /) method of _io.TextIOWrapper instance
##     Read at most n characters from stream.
##     
##     Read from underlying buffer until we have n characters or we hit EOF.
##     If n is negative or omitted, read until EOF.</code></pre>
<p>Since <code>alice_file.read</code> looks promising, we will invoke this method and see what it does.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb483-1"><a href="#cb483-1"></a>alice_txt <span class="op">=</span> alice_file.read()</span>
<span id="cb483-2"><a href="#cb483-2"></a><span class="bu">print</span>(alice_txt[:<span class="dv">500</span>]) <span class="co"># the [:500] gets the first 500 character -- more on this later.</span></span></code></pre></div>
<pre><code>## ﻿ALICE&#39;S ADVENTURES IN WONDERLAND
## 
## by
## 
## Lewis Carroll
## 
## CHAPTER I. Down the Rabbit-Hole
## 
## Alice was beginning to get very tired of sitting by her sister on the
## bank, and of having nothing to do: once or twice she had peeped into the
## book her sister was reading, but it had no pictures or conversations in
## it, &#39;and what is the use of a book,&#39; thought Alice &#39;without pictures or
## conversations?&#39;
## 
## So she was considering in her own mind (as well as she could, for the
## hot day made her feel very sleepy and s</code></pre>
<p>That’s all there is to it! We’ve read the contents of <code>Alice_in_wonderland.txt</code> and stored this text in a Python object we named <code>alice_txt</code>. Now let’s start to explore this object, and learn some more things about Python along the way.</p>
</div>
</div>
<div id="using-object-methods-lists" class="section level2">
<h2>Using object methods &amp; lists</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to use methods and lists to analyze data.</strong> We will do this using the Alice text to count:</p>
<ol style="list-style-type: decimal">
<li>Words</li>
<li>Chapters</li>
<li>Paragraphs</li>
</ol>
</div>
<p>How many words does the text contain? To answer this question, we can split the text up so there is one element per word, and then count the number of words.</p>
<div id="splitting-a-string-into-a-list-of-words" class="section level3">
<h3>Splitting a string into a list of words</h3>
<p>How do we figure out how to split strings in Python? We can ask Python what our <code>alice_txt</code> object is and what methods it provides. We can ask Python what things are using the <code>type()</code> function, like this:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb485-1"><a href="#cb485-1"></a><span class="bu">type</span>(alice_txt)</span></code></pre></div>
<pre><code>## &lt;class &#39;str&#39;&gt;</code></pre>
<p>Python tells us that <code>alice_txt</code> is of type <code>str</code> (i.e., it is a string). We can find out what methods are available for working with strings by typing <code>alice_txt.</code> and pressing <code>tab</code>. We’ll see that among the methods is one named <code>split</code>, as shown below.</p>
<p><img src="Python/PythonIntro/images/notebook_string_completion.png" /></p>
<p>To learn how to use this method we can check the documentation.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb487-1"><a href="#cb487-1"></a><span class="bu">help</span>(alice_txt.split)</span></code></pre></div>
<pre><code>## Help on built-in function split:
## 
## split(...) method of builtins.str instance
##     S.split(sep=None, maxsplit=-1) -&gt; list of strings
##     
##     Return a list of the words in S, using sep as the
##     delimiter string.  If maxsplit is given, at most maxsplit
##     splits are done. If sep is not specified or is None, any
##     whitespace string is a separator and empty strings are
##     removed from the result.</code></pre>
<p>Since the default is to split on whitespace (spaces, newlines, tabs) we can get a reasonable word count simply by calling the <code>split</code> method and counting the number of elements in the result. But, before we do that, we should learn more about the type of object the <code>split</code> method has returned.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb489-1"><a href="#cb489-1"></a>alice_words <span class="op">=</span> alice_txt.split() <span class="co"># returns a list</span></span>
<span id="cb489-2"><a href="#cb489-2"></a><span class="bu">type</span>(alice_words)</span></code></pre></div>
<pre><code>## &lt;class &#39;list&#39;&gt;</code></pre>
</div>
<div id="working-with-lists" class="section level3">
<h3>Working with lists</h3>
<p>The <code>split</code> method we used to break up the text of <em>Alice in Wonderland</em> into words produced a <em>list</em>. A lot of the techniques we’ll use later to analyze this text also produce lists, so its worth taking a few minutes to learn more about them.</p>
<p>Note that the displayed representation of lists and other data structures in Python often closely matches the syntax used to create them. For example, we can create a list using square brackets, just as we see when we print a list.</p>
<p>A <em>list</em> in Python is used to store a collection of items:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb491-1"><a href="#cb491-1"></a><span class="co"># create a list</span></span>
<span id="cb491-2"><a href="#cb491-2"></a>y <span class="op">=</span> [<span class="dv">1</span>, <span class="st">&quot;b&quot;</span>, <span class="dv">3</span>, <span class="st">&quot;D&quot;</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span></code></pre></div>
<p>As with other types in Python, you can get a list of methods by typing the name of the object followed by a <code>.</code> and pressing <code>tab</code>.</p>
</div>
<div id="extracting-subsets-from-lists" class="section level3">
<h3>Extracting subsets from lists</h3>
<p>Among the things you can do with a list is extract subsets of items using <strong>bracket indexing notation</strong>. This is useful in many situations, including the current one where we want to inspect a long list without printing out the whole thing.</p>
<p>The examples below show how indexing works in Python. First using pseudocode:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb492-1"><a href="#cb492-1"></a><span class="co"># syntax</span></span>
<span id="cb492-2"><a href="#cb492-2"></a><span class="co"># object[ start : end : by ]</span></span>
<span id="cb492-3"><a href="#cb492-3"></a></span>
<span id="cb492-4"><a href="#cb492-4"></a><span class="co"># defaults</span></span>
<span id="cb492-5"><a href="#cb492-5"></a><span class="co"># object[ 0 : end : 1 ]</span></span></code></pre></div>
<p>Then using a real list:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb493-1"><a href="#cb493-1"></a><span class="co"># create a list</span></span>
<span id="cb493-2"><a href="#cb493-2"></a>y <span class="op">=</span> [<span class="dv">1</span>, <span class="st">&quot;b&quot;</span>, <span class="dv">3</span>, <span class="st">&quot;D&quot;</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb493-3"><a href="#cb493-3"></a></span>
<span id="cb493-4"><a href="#cb493-4"></a>y[<span class="dv">0</span>] <span class="co"># returns first element - the number 1 (yes, the index counts from zero!)</span></span></code></pre></div>
<pre><code>## 1</code></pre>
<div class="sourceCode" id="cb495"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb495-1"><a href="#cb495-1"></a>y[<span class="dv">1</span>] <span class="co"># returns second element - the letter &quot;b&quot;</span></span></code></pre></div>
<pre><code>## &#39;b&#39;</code></pre>
<div class="sourceCode" id="cb497"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb497-1"><a href="#cb497-1"></a>y[ :<span class="dv">3</span>] <span class="co"># returns a list with only the first 3 elements, but index is of length 4 (0 to 3) because last index is excluded</span></span></code></pre></div>
<pre><code>## [1, &#39;b&#39;, 3]</code></pre>
<div class="sourceCode" id="cb499"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb499-1"><a href="#cb499-1"></a>y[<span class="dv">2</span>:<span class="dv">5</span>] <span class="co"># returns a list with elements 3, &quot;D&quot;, 5</span></span></code></pre></div>
<pre><code>## [3, &#39;D&#39;, 5]</code></pre>
<div class="sourceCode" id="cb501"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb501-1"><a href="#cb501-1"></a>y[<span class="op">-</span><span class="dv">1</span>] <span class="co"># returns last element - the number 6 </span></span></code></pre></div>
<pre><code>## 6</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1"></a>y[<span class="op">-</span><span class="dv">4</span>: ] <span class="co"># returns a list with last 4 elements</span></span></code></pre></div>
<pre><code>## [3, &#39;D&#39;, 5, 6]</code></pre>
<div class="sourceCode" id="cb505"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1"></a>alice_words[<span class="dv">11</span>:<span class="dv">20</span>] <span class="co"># returns a list with words 11 through 19</span></span></code></pre></div>
<pre><code>## [&#39;Rabbit-Hole&#39;, &#39;Alice&#39;, &#39;was&#39;, &#39;beginning&#39;, &#39;to&#39;, &#39;get&#39;, &#39;very&#39;, &#39;tired&#39;, &#39;of&#39;]</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1"></a>alice_words[<span class="op">-</span><span class="dv">10</span>: ] <span class="co"># returns a list with the last 10 words</span></span></code></pre></div>
<pre><code>## [&#39;her&#39;, &#39;own&#39;, &#39;child-life,&#39;, &#39;and&#39;, &#39;the&#39;, &#39;happy&#39;, &#39;summer&#39;, &#39;days.&#39;, &#39;THE&#39;, &#39;END&#39;]</code></pre>
</div>
<div id="using-sets-to-count-unique-items" class="section level3">
<h3>Using sets to count unique items</h3>
<p>Now that we have a list containing the individual words from <em>Alice’s Adventures in Wonderland</em>, we can calculate how many words there are in total using the <code>len()</code> (length) function:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1"></a><span class="bu">len</span>(alice_words) <span class="co"># counts elements in a data structure</span></span></code></pre></div>
<pre><code>## 26445</code></pre>
<p>According to our above computation, there are about 26 thousand total words in the Alice text. But how many <em>unique</em> words are there? Python has a special data structure called a <em>set</em> that makes it easy to find out. A <em>set</em> drops all duplicates, giving a collection of the unique elements. Here’s a simple example:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb511-1"><a href="#cb511-1"></a><span class="co"># set example</span></span>
<span id="cb511-2"><a href="#cb511-2"></a>mylist <span class="op">=</span> {<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">5</span>}</span>
<span id="cb511-3"><a href="#cb511-3"></a><span class="bu">set</span>(mylist)</span></code></pre></div>
<pre><code>## {1, 4, 5, 9}</code></pre>
<p>Now we can count the number of unique elements in the list by getting the length <code>len()</code> of the set <code>set()</code>:</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb513-1"><a href="#cb513-1"></a><span class="bu">len</span>(<span class="bu">set</span>(mylist))</span></code></pre></div>
<pre><code>## 4</code></pre>
<p>We can now use the <code>set()</code> function to convert the list of all words (<code>alice_words</code>) into a set of <em>unique</em> words and then count them:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb515-1"><a href="#cb515-1"></a><span class="bu">len</span>(<span class="bu">set</span>(alice_words)) <span class="co"># counts unique elements in a data structure</span></span></code></pre></div>
<pre><code>## 5295</code></pre>
<p>There are 5295 unique words in the text.</p>
</div>
<div id="exercise-0-3" class="section level3">
<h3>Exercise 0</h3>
<p><strong>Reading text from a file &amp; splitting</strong></p>
<p><em>Alice’s Adventures in Wonderland</em> is full of memorable characters. The main characters from the story are listed, one-per-line, in the file named <code>Characters.txt</code>.</p>
<p>NOTE: we will not always explicitly demonstrate everything you need to know in order to complete an exercise. Instead we focus on teaching you how to discover available methods and how use the help function to learn how to use them. It is expected that you will spend some time during the exercises looking for appropriate methods and perhaps reading documentation.</p>
<ol style="list-style-type: decimal">
<li>Open the <code>Characters.txt</code> file and read its contents.</li>
</ol>
<div class="sourceCode" id="cb517"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb517-1"><a href="#cb517-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Split text on newlines to produce a list with one element per line. Store the result as <code>alice_characters</code>. HINT: you can split on newlines using the <code>\n</code> separator.</li>
</ol>
<div class="sourceCode" id="cb518"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb518-1"><a href="#cb518-1"></a><span class="co">##</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Open the Characters.txt file and read its contents.</li>
</ol>
<div class="sourceCode" id="cb519"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb519-1"><a href="#cb519-1"></a>characters_file <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;Characters.txt&quot;</span>)</span>
<span id="cb519-2"><a href="#cb519-2"></a>characters_txt <span class="op">=</span> characters_file.read()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Split text on newlines to produce a list with one element per line.
Store the result as “alice_characters”.</li>
</ol>
<div class="sourceCode" id="cb520"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb520-1"><a href="#cb520-1"></a>alice_characters <span class="op">=</span> characters_txt.split(sep<span class="op">=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb520-2"><a href="#cb520-2"></a>alice_characters</span></code></pre></div>
<pre><code>## [&#39;Alice&#39;, &#39;White Rabbit&#39;, &#39;Mouse&#39;, &#39;Dodo&#39;, &#39;Lory&#39;, &#39;Eaglet&#39;, &#39;Duck&#39;, &#39;Pat&#39;, &#39;Bill the Lizard&#39;, &#39;Puppy&#39;, &#39;Caterpillar&#39;, &#39;Duchess&#39;, &#39;Cheshire Cat&#39;, &#39;March Hare&#39;, &#39;Hatter&#39;, &#39;Dormouse&#39;, &#39;Queen of Hearts&#39;, &#39;Knave of Hearts&#39;, &#39;King of Hearts&#39;, &#39;Gryphon&#39;, &#39;Mock Turtle&#39;, &#39;&#39;]</code></pre>
</div>
</details>
</div>
<div id="control-flow" class="section level3">
<h3>Control flow</h3>
<p>Sometimes we may want to control the flow of code in an analysis using <strong>choices</strong>,
such as <code>if</code> and <code>else</code> statements, which allow you to run different code depending on the input.
The basic form is:</p>
<pre><code>```python
if (condition) true_action else false_action
```

If `condition` is `TRUE`, `true_action` is evaluated; if `condition` is `FALSE`,
the optional `false_action` is evaluated.</code></pre>
<p>The conditions that are evaluated use <strong>logical and relational operators</strong> to determine equivalence or make some other relational comparisons.</p>
</div>
<div id="logical-relational-operators-1" class="section level3">
<h3>Logical &amp; relational operators</h3>
<p>Here’s a table of commonly used relational operators:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>==</code></td>
<td align="left">equal to</td>
</tr>
<tr class="even">
<td align="left"><code>!=</code></td>
<td align="left">not equal to</td>
</tr>
<tr class="odd">
<td align="left"><code>&gt;</code></td>
<td align="left">greater than</td>
</tr>
<tr class="even">
<td align="left"><code>&gt;=</code></td>
<td align="left">greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left"><code>&lt;</code></td>
<td align="left">less than</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;=</code></td>
<td align="left">less than or equal to</td>
</tr>
</tbody>
</table>
<p>These relational operators may be combined with logical operators, such as <code>and</code> or <code>or</code>, as we’ll see below.</p>
</div>
<div id="counting-list-elements" class="section level3">
<h3>Counting list elements</h3>
<p>Now that we know how to split a string and how to work with the resulting list, we can split on chapter markers to count the number of chapters. All we need to do is specify the string to split on. Since each chapter is marked with the string <code>'CHAPTER '</code> followed by the chapter number, we can split the text up into chapters using this as the separator.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb523-1"><a href="#cb523-1"></a>alice_chapters <span class="op">=</span> alice_txt.split(<span class="st">&quot;CHAPTER &quot;</span>)</span>
<span id="cb523-2"><a href="#cb523-2"></a><span class="bu">len</span>(alice_chapters)</span></code></pre></div>
<pre><code>## 13</code></pre>
<p>Since the first element contains the material <em>before</em> the first chapter, this tells us there are twelve chapters in the book.</p>
<p>We can also count the number of times the “Bunny” and “Duck” characters appear in a given Chapter, say Chapter 2:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb525-1"><a href="#cb525-1"></a>bunny_count_ch2 <span class="op">=</span> alice_chapters[<span class="dv">2</span>].count(<span class="st">&quot;Bunny&quot;</span>)</span>
<span id="cb525-2"><a href="#cb525-2"></a><span class="bu">print</span>(bunny_count_ch2)</span></code></pre></div>
<pre><code>## 0</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1"></a>duck_count_ch2 <span class="op">=</span> alice_chapters[<span class="dv">2</span>].count(<span class="st">&quot;Duck&quot;</span>)</span>
<span id="cb527-2"><a href="#cb527-2"></a><span class="bu">print</span>(duck_count_ch2)</span></code></pre></div>
<pre><code>## 1</code></pre>
<p>By combining choice statements with logical and/or relational operators, we can then determine which of these two characters
appears more often in Chapter 2:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb529-1"><a href="#cb529-1"></a><span class="cf">if</span> bunny_count_ch2 <span class="op">&lt;</span> duck_count_ch2:</span>
<span id="cb529-2"><a href="#cb529-2"></a>    <span class="bu">print</span>(<span class="st">&quot;Bunny count is less than Duck count in Chapter II.&quot;</span>)</span>
<span id="cb529-3"><a href="#cb529-3"></a><span class="cf">elif</span> bunny_count_ch2 <span class="op">&gt;</span> duck_count_ch2:</span>
<span id="cb529-4"><a href="#cb529-4"></a>    <span class="bu">print</span>(<span class="st">&quot;Bunny count is larger than Duck count in Chapter II.&quot;</span>)</span>
<span id="cb529-5"><a href="#cb529-5"></a><span class="cf">else</span>:</span>
<span id="cb529-6"><a href="#cb529-6"></a>    <span class="bu">print</span>(<span class="st">&quot;Bunny count is equal to Duck count in Chapter II.&quot;</span>)</span></code></pre></div>
<pre><code>## Bunny count is less than Duck count in Chapter II.</code></pre>
<p>We can count paragraphs in a similar way to chapters. Paragraphs are indicated by a blank line, i.e., two newlines in a row. When working with strings we can represent newlines with <code>\n</code>. Paragraphs are indicated by two new lines, and so our basic paragraph separator is <code>\n\n</code>. We can see this separator by looking at the content.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb531-1"><a href="#cb531-1"></a><span class="bu">print</span>(alice_txt[:<span class="dv">500</span>]) <span class="co"># explicit printing --- formats text nicely</span></span></code></pre></div>
<pre><code>## ﻿ALICE&#39;S ADVENTURES IN WONDERLAND
## 
## by
## 
## Lewis Carroll
## 
## CHAPTER I. Down the Rabbit-Hole
## 
## Alice was beginning to get very tired of sitting by her sister on the
## bank, and of having nothing to do: once or twice she had peeped into the
## book her sister was reading, but it had no pictures or conversations in
## it, &#39;and what is the use of a book,&#39; thought Alice &#39;without pictures or
## conversations?&#39;
## 
## So she was considering in her own mind (as well as she could, for the
## hot day made her feel very sleepy and s</code></pre>
<div class="sourceCode" id="cb533"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb533-1"><a href="#cb533-1"></a>alice_txt[:<span class="dv">500</span>] <span class="co"># returns content without printing it</span></span></code></pre></div>
<pre><code>## &quot;\ufeffALICE&#39;S ADVENTURES IN WONDERLAND\n\nby\n\nLewis Carroll\n\nCHAPTER I. Down the Rabbit-Hole\n\nAlice was beginning to get very tired of sitting by her sister on the\nbank, and of having nothing to do: once or twice she had peeped into the\nbook her sister was reading, but it had no pictures or conversations in\nit, &#39;and what is the use of a book,&#39; thought Alice &#39;without pictures or\nconversations?&#39;\n\nSo she was considering in her own mind (as well as she could, for the\nhot day made her feel very sleepy and s&quot;</code></pre>
<div class="sourceCode" id="cb535"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb535-1"><a href="#cb535-1"></a>alice_paragraphs <span class="op">=</span> alice_txt.split(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p>Before counting the number of paragraphs, I want to inspect the result to see if it looks correct:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb536-1"><a href="#cb536-1"></a><span class="bu">print</span>(alice_paragraphs[<span class="dv">0</span>], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">==========&quot;</span>)</span></code></pre></div>
<pre><code>## ﻿ALICE&#39;S ADVENTURES IN WONDERLAND 
## ==========</code></pre>
<div class="sourceCode" id="cb538"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb538-1"><a href="#cb538-1"></a><span class="bu">print</span>(alice_paragraphs[<span class="dv">1</span>], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">==========&quot;</span>)</span></code></pre></div>
<pre><code>## by 
## ==========</code></pre>
<div class="sourceCode" id="cb540"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb540-1"><a href="#cb540-1"></a><span class="bu">print</span>(alice_paragraphs[<span class="dv">2</span>], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">==========&quot;</span>)</span></code></pre></div>
<pre><code>## Lewis Carroll 
## ==========</code></pre>
<p>We’re counting the title, author, and chapter lines as paragraphs, but this will do for a rough count.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb542-1"><a href="#cb542-1"></a><span class="bu">len</span>(alice_paragraphs)</span></code></pre></div>
<pre><code>## 830</code></pre>
<p>Now let’s use a logical operator to find out if “Alice” or “Eaglet” appear in paragraph 11:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb544-1"><a href="#cb544-1"></a>alice_eaglet_exist <span class="op">=</span> <span class="st">&quot;Alice&quot;</span> <span class="kw">in</span> alice_paragraphs[<span class="dv">10</span>] <span class="kw">or</span> <span class="st">&quot;Eaglet&quot;</span> <span class="kw">in</span> alice_paragraphs[<span class="dv">10</span>]</span>
<span id="cb544-2"><a href="#cb544-2"></a>alice_eaglet_exist</span></code></pre></div>
<pre><code>## True</code></pre>
</div>
<div id="exercise-1-4" class="section level3">
<h3>Exercise 1</h3>
<p><strong>Count the number of main characters</strong></p>
<p>So far we’ve learned that there are 12 chapters, around 830 paragraphs, and about 26 thousand words in <em>Alice’s Adventures in Wonderland</em>. Along the way we’ve also learned how to open a file and read its contents, split strings, calculate the length of objects, discover methods for string and list objects, and index/subset lists in Python. Now it is time for you to put these skills to use to learn something about the main characters in the story.</p>
<ol style="list-style-type: decimal">
<li>Count the number of main characters in the story (i.e., get the length of the list you created in previous exercise).</li>
</ol>
<div class="sourceCode" id="cb546"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb546-1"><a href="#cb546-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Extract and print just the first character from the list you created in the previous exercise.</li>
</ol>
<div class="sourceCode" id="cb547"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb547-1"><a href="#cb547-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Test whether the length of the 3rd and 8th character’s names are equal. Test whether the length of
the 3rd character’s name is greater than or equal to the length of the 6th character’s name. Now test
whether EITHER of the above conditions are true. HINT: use the <code>len()</code> function.</li>
</ol>
<div class="sourceCode" id="cb548"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb548-1"><a href="#cb548-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>(BONUS, optional): Sort the list you created in step 2 alphabetically,
and then extract the last element.</li>
</ol>
<div class="sourceCode" id="cb549"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb549-1"><a href="#cb549-1"></a><span class="co">##</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Count the number of main characters in the story (i.e., get the length of the list you created in previous exercise).</li>
</ol>
<div class="sourceCode" id="cb550"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb550-1"><a href="#cb550-1"></a><span class="bu">len</span>(alice_characters)</span></code></pre></div>
<pre><code>## 22</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Extract and print just the first character from the list you created in the previous exercise.</li>
</ol>
<div class="sourceCode" id="cb552"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb552-1"><a href="#cb552-1"></a><span class="bu">print</span>(alice_characters[<span class="dv">0</span>])</span></code></pre></div>
<pre><code>## Alice</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Test whether the length of the 3rd and 8th character’s names are equal. Test whether the length of
the 3rd character’s name is greater than or equal to the length of the 6th character’s name. Now test
whether EITHER of the above conditions are true. HINT: use the <code>len()</code> function.</li>
</ol>
<div class="sourceCode" id="cb554"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb554-1"><a href="#cb554-1"></a><span class="bu">len</span>(alice_characters[<span class="dv">2</span>]) <span class="op">==</span> <span class="bu">len</span>(alice_characters[<span class="dv">7</span>]) <span class="kw">or</span> <span class="bu">len</span>(alice_characters[<span class="dv">2</span>]) <span class="op">&gt;=</span> <span class="bu">len</span>(alice_characters[<span class="dv">5</span>])</span></code></pre></div>
<pre><code>## False</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>(BONUS, optional): Sort the list you created in step 2 alphabetically,
and then extract the last element.</li>
</ol>
<div class="sourceCode" id="cb556"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb556-1"><a href="#cb556-1"></a>alice_characters.sort()</span>
<span id="cb556-2"><a href="#cb556-2"></a>alice_characters[<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<pre><code>## &#39;White Rabbit&#39;</code></pre>
</div>
</details>
</div>
</div>
<div id="iterating-over-collections-of-data" class="section level2">
<h2>Iterating over collections of data</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to automate repetitive tasks by iterating over collections of data.</strong> We will do this using the Alice text to count:</p>
<ol style="list-style-type: decimal">
<li>Words nested within paragraphs</li>
<li>Paragraphs nested within chapters</li>
</ol>
</div>
<p>This far our analysis has treated the text as a “flat” data structure. For example, when we counted words we just counted words in the whole document, rather than counting the number of words in each chapter. If we want to treat our document as a nested structure, with words forming sentences, sentences forming paragraphs, paragraphs forming chapters, and chapters forming the book, we need to learn some additional tools. Specifically, we need to learn how to iterate over lists (or other collections) and do things with each element in a collection.</p>
<p>There are several ways to iterate in Python, of which we will focus on <em>for loops</em>.</p>
<div id="iterating-over-lists-using-for-loops" class="section level3">
<h3>Iterating over lists using for-loops</h3>
<p>A <em>for loop</em> is a way of cycling through the elements of a collection and doing something with each one. The for loop logic is:</p>
<center>
<img src="Python/PythonIntro/images/for_loop_pic_small.png" />
</center>
<p>The for loop syntax is:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb558-1"><a href="#cb558-1"></a><span class="cf">for</span> <span class="op">&lt;</span>thing<span class="op">&gt;</span> <span class="kw">in</span> <span class="op">&lt;</span>collection<span class="op">&gt;</span>:</span>
<span id="cb558-2"><a href="#cb558-2"></a>    do stuff <span class="cf">with</span> <span class="op">&lt;</span>thing<span class="op">&gt;</span></span></code></pre></div>
<center>
<img src="Python/PythonIntro/images/python_for_loop_small.png" />
</center>
<p>Notice that:</p>
<ol style="list-style-type: decimal">
<li><strong>the body of the for-loop is indented</strong>. This is important, because it is this indentation that defines the <em>body</em> of the loop — the place where things are done.</li>
<li><strong>White space matters in Python!</strong></li>
</ol>
<p>A simple example:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb559-1"><a href="#cb559-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb559-2"><a href="#cb559-2"></a>    <span class="bu">print</span>(i)</span></code></pre></div>
<pre><code>## 0
## 1
## 2
## 3
## 4
## 5
## 6
## 7
## 8
## 9</code></pre>
<div class="sourceCode" id="cb561"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb561-1"><a href="#cb561-1"></a><span class="bu">print</span>(<span class="st">&#39;DONE.&#39;</span>)</span></code></pre></div>
<pre><code>## DONE.</code></pre>
<p>Notice that “DONE.” is only printed once, since <code>print('DONE.')</code> is not indented and is therefore outside of the body of the loop.</p>
<p>As a simple example using the Alice text, we can cycle through the first 6 paragraphs and print each one. Cycling through with a loop makes it easy to insert a separator between the paragraphs, making it much clearer to read the output:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb563-1"><a href="#cb563-1"></a><span class="cf">for</span> paragraph <span class="kw">in</span> alice_paragraphs[:<span class="dv">6</span>]:</span>
<span id="cb563-2"><a href="#cb563-2"></a>    <span class="bu">print</span>(paragraph)</span>
<span id="cb563-3"><a href="#cb563-3"></a>    <span class="bu">print</span>(<span class="st">&#39;==================================&#39;</span>)</span></code></pre></div>
<pre><code>## ﻿ALICE&#39;S ADVENTURES IN WONDERLAND
## ==================================
## by
## ==================================
## Lewis Carroll
## ==================================
## CHAPTER I. Down the Rabbit-Hole
## ==================================
## Alice was beginning to get very tired of sitting by her sister on the
## bank, and of having nothing to do: once or twice she had peeped into the
## book her sister was reading, but it had no pictures or conversations in
## it, &#39;and what is the use of a book,&#39; thought Alice &#39;without pictures or
## conversations?&#39;
## ==================================
## So she was considering in her own mind (as well as she could, for the
## hot day made her feel very sleepy and stupid), whether the pleasure
## of making a daisy-chain would be worth the trouble of getting up and
## picking the daisies, when suddenly a White Rabbit with pink eyes ran
## close by her.
## ==================================</code></pre>
<div class="sourceCode" id="cb565"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb565-1"><a href="#cb565-1"></a><span class="bu">print</span>(<span class="st">&#39;DONE.&#39;</span>)</span></code></pre></div>
<pre><code>## DONE.</code></pre>
<p>Loops in Python are great because the syntax is relatively simple, and because they are very powerful. Inside of the body of a loop you can use all the tools you use elsewhere in Python.</p>
<p>Here is one more example of a loop, this time iterating over all the chapters and calculating the number of paragraphs in each chapter.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb567-1"><a href="#cb567-1"></a><span class="cf">for</span> chapter <span class="kw">in</span> alice_chapters[<span class="dv">1</span>:]:</span>
<span id="cb567-2"><a href="#cb567-2"></a>    paragraphs <span class="op">=</span> chapter.split(<span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</span>
<span id="cb567-3"><a href="#cb567-3"></a>    <span class="bu">print</span>(<span class="bu">len</span>(paragraphs))</span></code></pre></div>
<pre><code>## 33
## 29
## 51
## 45
## 81
## 84
## 108
## 74
## 95
## 88
## 77
## 73</code></pre>
</div>
<div id="organizing-results-in-dictionaries" class="section level3">
<h3>Organizing results in dictionaries</h3>
<p>It’s often useful to store separate pieces of data that are related to one another in a <code>dict</code> (i.e., “dictionary”), which is designed to store key-value pairs. For example, we can calculate the number of times “Alice” is mentioned per chapter and associate each count with the chapter title it corresponds to.</p>
<p>The dictionary structure looks like:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb569-1"><a href="#cb569-1"></a><span class="co"># mydict = {key1:value1, key2:value2, key3:value3}</span></span></code></pre></div>
<p>A simple example:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb570-1"><a href="#cb570-1"></a>mydict <span class="op">=</span> {<span class="st">&quot;apple&quot;</span>:<span class="dv">5</span>, <span class="st">&quot;pear&quot;</span>:<span class="dv">6</span>, <span class="st">&quot;grape&quot;</span>:<span class="dv">10</span>}</span>
<span id="cb570-2"><a href="#cb570-2"></a><span class="bu">print</span>(mydict)</span></code></pre></div>
<pre><code>## {&#39;apple&#39;: 5, &#39;pear&#39;: 6, &#39;grape&#39;: 10}</code></pre>
<div class="sourceCode" id="cb572"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb572-1"><a href="#cb572-1"></a><span class="co"># compare the above dict to a list</span></span>
<span id="cb572-2"><a href="#cb572-2"></a>mylist <span class="op">=</span>[<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span>]</span>
<span id="cb572-3"><a href="#cb572-3"></a><span class="bu">print</span>(mylist)</span></code></pre></div>
<pre><code>## [5, 6, 10]</code></pre>
<p>To associate chapter titles with “Alice” counts, we will first need to learn how to <strong>append</strong> elements to a list:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb574-1"><a href="#cb574-1"></a>container <span class="op">=</span> [] <span class="co"># a list</span></span>
<span id="cb574-2"><a href="#cb574-2"></a></span>
<span id="cb574-3"><a href="#cb574-3"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb574-4"><a href="#cb574-4"></a>    container.append(i) <span class="co"># append elements to the list</span></span>
<span id="cb574-5"><a href="#cb574-5"></a></span>
<span id="cb574-6"><a href="#cb574-6"></a><span class="bu">print</span>(container)    </span></code></pre></div>
<pre><code>## [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
<p>Now, with the Alice text, first we can iterate over each chapter and grab just the first line (that is, the chapter titles). These will become our <strong>keys</strong>.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb576-1"><a href="#cb576-1"></a>chapter_titles <span class="op">=</span> []</span>
<span id="cb576-2"><a href="#cb576-2"></a></span>
<span id="cb576-3"><a href="#cb576-3"></a><span class="cf">for</span> chapter <span class="kw">in</span> alice_chapters[<span class="dv">1</span>:]:</span>
<span id="cb576-4"><a href="#cb576-4"></a>    chapter_titles.append(chapter.split(sep<span class="op">=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)[<span class="dv">0</span>])</span>
<span id="cb576-5"><a href="#cb576-5"></a></span>
<span id="cb576-6"><a href="#cb576-6"></a><span class="bu">print</span>(chapter_titles)</span></code></pre></div>
<pre><code>## [&#39;I. Down the Rabbit-Hole&#39;, &#39;II. The Pool of Tears&#39;, &#39;III. A Caucus-Race and a Long Tale&#39;, &#39;IV. The Rabbit Sends in a Little Bill&#39;, &#39;V. Advice from a Caterpillar&#39;, &#39;VI. Pig and Pepper&#39;, &#39;VII. A Mad Tea-Party&#39;, &quot;VIII. The Queen&#39;s Croquet-Ground&quot;, &quot;IX. The Mock Turtle&#39;s Story&quot;, &#39;X. The Lobster Quadrille&#39;, &#39;XI. Who Stole the Tarts?&#39;, &quot;XII. Alice&#39;s Evidence&quot;]</code></pre>
<p>Next, we can iterate over each chapter and count the number of times “Alice” was mentioned. These will become our <strong>values</strong>.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb578-1"><a href="#cb578-1"></a>chapter_Alice <span class="op">=</span> []</span>
<span id="cb578-2"><a href="#cb578-2"></a></span>
<span id="cb578-3"><a href="#cb578-3"></a><span class="cf">for</span> chapter <span class="kw">in</span> alice_chapters[<span class="dv">1</span>:]:</span>
<span id="cb578-4"><a href="#cb578-4"></a>    chapter_Alice.append(chapter.count(<span class="st">&quot;Alice&quot;</span>))</span>
<span id="cb578-5"><a href="#cb578-5"></a></span>
<span id="cb578-6"><a href="#cb578-6"></a><span class="bu">print</span>(chapter_Alice)  </span></code></pre></div>
<pre><code>## [28, 24, 23, 31, 35, 43, 51, 39, 52, 30, 16, 23]</code></pre>
<p>Finally we can combine the chapter titles (<strong>keys</strong>) and “Alice” counts (<strong>values</strong>) and convert them to a dictionary.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb580-1"><a href="#cb580-1"></a><span class="co"># combine titles and counts</span></span>
<span id="cb580-2"><a href="#cb580-2"></a>mydict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(chapter_titles, chapter_Alice))</span>
<span id="cb580-3"><a href="#cb580-3"></a></span>
<span id="cb580-4"><a href="#cb580-4"></a><span class="bu">print</span>(mydict)</span>
<span id="cb580-5"><a href="#cb580-5"></a></span>
<span id="cb580-6"><a href="#cb580-6"></a><span class="co"># help(zip)         </span></span></code></pre></div>
<pre><code>## {&#39;I. Down the Rabbit-Hole&#39;: 28, &#39;II. The Pool of Tears&#39;: 24, &#39;III. A Caucus-Race and a Long Tale&#39;: 23, &#39;IV. The Rabbit Sends in a Little Bill&#39;: 31, &#39;V. Advice from a Caterpillar&#39;: 35, &#39;VI. Pig and Pepper&#39;: 43, &#39;VII. A Mad Tea-Party&#39;: 51, &quot;VIII. The Queen&#39;s Croquet-Ground&quot;: 39, &quot;IX. The Mock Turtle&#39;s Story&quot;: 52, &#39;X. The Lobster Quadrille&#39;: 30, &#39;XI. Who Stole the Tarts?&#39;: 16, &quot;XII. Alice&#39;s Evidence&quot;: 23}</code></pre>
</div>
<div id="exercise-2-3" class="section level3">
<h3>Exercise 2</h3>
<p><strong>Iterating &amp; counting things</strong></p>
<p>Now that we know how to iterate using for-loops, the possibilities really start to open up. For example, we can use these techniques to count the number of times each character appears in the story.</p>
<ol style="list-style-type: decimal">
<li>Make sure you have both the text and the list of characters.</li>
</ol>
<p>Open and read both “Alice_in_wonderland.txt” and
“Characters.txt” if you have not already done so.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb582-1"><a href="#cb582-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Which chapter has the most words?</li>
</ol>
<p>Split the text into chapters (i.e., split on “CHAPTER”) and use a for-loop to iterate over the chapters.
For each chapter, split it into words and calculate the length.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb583-1"><a href="#cb583-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>How many times is each character mentioned in the text?</li>
</ol>
<p>Iterate over the list of characters using a for-loop.
For each character, call the count method with that character as the argument.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb584-1"><a href="#cb584-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>(BONUS, optional): Put the character counts computed
above in a dictionary with character names as the keys and
counts as the values.</li>
</ol>
<div class="sourceCode" id="cb585"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb585-1"><a href="#cb585-1"></a><span class="co">##</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<ol style="list-style-type: decimal">
<li>Make sure you have both the text and the list of characters.
Open and read both “Alice_in_wonderland.txt” and “Characters.txt” if you have not already done so.</li>
</ol>
<div class="sourceCode" id="cb586"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb586-1"><a href="#cb586-1"></a>characters_txt <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;Characters.txt&quot;</span>).read()</span>
<span id="cb586-2"><a href="#cb586-2"></a>alice_txt <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;Alice_in_wonderland.txt&quot;</span>).read()</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Which chapter has the most words?
Split the text into chapters (i.e., split on “CHAPTER”) and use a for-loop to iterate over the chapters.
For each chapter, split it into words and calculate the length.</li>
</ol>
<div class="sourceCode" id="cb587"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb587-1"><a href="#cb587-1"></a>words_per_chapter <span class="op">=</span> []</span>
<span id="cb587-2"><a href="#cb587-2"></a></span>
<span id="cb587-3"><a href="#cb587-3"></a><span class="cf">for</span> chapter <span class="kw">in</span> alice_chapters:</span>
<span id="cb587-4"><a href="#cb587-4"></a>    words_per_chapter.append(<span class="bu">len</span>(chapter.split()))</span>
<span id="cb587-5"><a href="#cb587-5"></a></span>
<span id="cb587-6"><a href="#cb587-6"></a><span class="bu">print</span>(words_per_chapter)</span></code></pre></div>
<pre><code>## [7, 2184, 2098, 1701, 2614, 2185, 2592, 2286, 2486, 2271, 2028, 1877, 2104]</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>How many times is each character mentioned in the text?
Iterate over the list of characters using a for-loop.
For each character, call the count method with that character as the argument.</li>
</ol>
<div class="sourceCode" id="cb589"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb589-1"><a href="#cb589-1"></a>num_per_character <span class="op">=</span> []</span>
<span id="cb589-2"><a href="#cb589-2"></a></span>
<span id="cb589-3"><a href="#cb589-3"></a><span class="cf">for</span> character <span class="kw">in</span> characters_txt.split(sep<span class="op">=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>):</span>
<span id="cb589-4"><a href="#cb589-4"></a>    num_per_character.append(alice_txt.count(character))</span>
<span id="cb589-5"><a href="#cb589-5"></a></span>
<span id="cb589-6"><a href="#cb589-6"></a><span class="bu">print</span>(num_per_character)</span></code></pre></div>
<pre><code>## [395, 20, 30, 13, 7, 3, 3, 3, 0, 0, 27, 42, 4, 30, 55, 40, 3, 3, 0, 55, 53, 144403]</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>(BONUS, optional): Put the character counts computed above in a
dictionary with character names as the keys and counts as the values.</li>
</ol>
<div class="sourceCode" id="cb591"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb591-1"><a href="#cb591-1"></a>characters <span class="op">=</span> characters_txt.split(sep<span class="op">=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb591-2"><a href="#cb591-2"></a><span class="bu">dict</span>(<span class="bu">zip</span>(characters, num_per_character))</span></code></pre></div>
<pre><code>## {&#39;Alice&#39;: 395, &#39;White Rabbit&#39;: 20, &#39;Mouse&#39;: 30, &#39;Dodo&#39;: 13, &#39;Lory&#39;: 7, &#39;Eaglet&#39;: 3, &#39;Duck&#39;: 3, &#39;Pat&#39;: 3, &#39;Bill the Lizard&#39;: 0, &#39;Puppy&#39;: 0, &#39;Caterpillar&#39;: 27, &#39;Duchess&#39;: 42, &#39;Cheshire Cat&#39;: 4, &#39;March Hare&#39;: 30, &#39;Hatter&#39;: 55, &#39;Dormouse&#39;: 40, &#39;Queen of Hearts&#39;: 3, &#39;Knave of Hearts&#39;: 3, &#39;King of Hearts&#39;: 0, &#39;Gryphon&#39;: 55, &#39;Mock Turtle&#39;: 53, &#39;&#39;: 144403}</code></pre>
</div>
</details>
</div>
</div>
<div id="importing-packages" class="section level2">
<h2>Importing packages</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to expand Python’s functionality by importing packages.</strong></p>
<ol style="list-style-type: decimal">
<li>Import <code>numpy</code></li>
<li>Calculate simple statistics</li>
</ol>
</div>
<p>Now that we know how to iterate over lists and calculate numbers for each element, we may wish to do some simple math using these numbers. For example, we may want to calculate the mean and standard deviation of the distribution of the number of paragraphs in each chapter. Python has a handful of math functions built-in (e.g., <code>min()</code> and <code>max()</code>) but built-in math support is pretty limited.</p>
<p>When you find that something isn’t available in Python itself, its time to look for a package that does it. Although it is somewhat overkill for simply calculating a mean we’re going to use a popular package called <code>numpy</code> for this. The <code>numpy</code> package is included in the Anaconda Python distribution we are using, so we don’t need to install it separately.</p>
<p>To use <code>numpy</code> or other packages, you must first import them.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb593-1"><a href="#cb593-1"></a><span class="co"># import &lt;package-name&gt;</span></span></code></pre></div>
<p>We can import <code>numpy</code> as follows:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb594-1"><a href="#cb594-1"></a><span class="im">import</span> numpy</span></code></pre></div>
<p>To use functions from a package, we can prefix the function with the package name, separated by a period:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb595-1"><a href="#cb595-1"></a><span class="co"># &lt;package-name&gt;.&lt;function_name&gt;()</span></span></code></pre></div>
<p>The <code>numpy</code> package is very popular and includes a lot of useful functions. For example, we can use it to calculate means and standard deviations:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb596-1"><a href="#cb596-1"></a><span class="bu">print</span>(numpy.mean(chapter_Alice))</span></code></pre></div>
<pre><code>## 32.916666666666664</code></pre>
<div class="sourceCode" id="cb598"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb598-1"><a href="#cb598-1"></a><span class="bu">print</span>(numpy.std(chapter_Alice))</span></code></pre></div>
<pre><code>## 10.92747556493366</code></pre>
</div>
<div id="wrap-up-5" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-5" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-7" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Graphics
<ul>
<li>matplotlib: <a href="https://matplotlib.org/" class="uri">https://matplotlib.org/</a></li>
<li>seaborn: <a href="https://seaborn.pydata.org/" class="uri">https://seaborn.pydata.org/</a></li>
<li>plotly: <a href="https://plot.ly/python/" class="uri">https://plot.ly/python/</a></li>
</ul></li>
<li>Quantitative Data Analysis
<ul>
<li>numpy: <a href="http://www.numpy.org/" class="uri">http://www.numpy.org/</a></li>
<li>scipy: <a href="https://www.scipy.org/" class="uri">https://www.scipy.org/</a></li>
<li>pandas: <a href="https://pandas.pydata.org/" class="uri">https://pandas.pydata.org/</a></li>
<li>scikit-learn: <a href="http://scikit-learn.org/stable/" class="uri">http://scikit-learn.org/stable/</a></li>
<li>statsmodels: <a href="http://www.statsmodels.org/stable/" class="uri">http://www.statsmodels.org/stable/</a></li>
</ul></li>
<li>Text analysis
<ul>
<li>textblob: <a href="https://textblob.readthedocs.io/en/dev/" class="uri">https://textblob.readthedocs.io/en/dev/</a></li>
<li>nltk: <a href="http://www.nltk.org/" class="uri">http://www.nltk.org/</a></li>
<li>Gensim: <a href="https://radimrehurek.com/gensim/" class="uri">https://radimrehurek.com/gensim/</a></li>
</ul></li>
<li>Webscraping
<ul>
<li>scrapy: <a href="https://scrapy.org/" class="uri">https://scrapy.org/</a></li>
<li>requests: <a href="http://docs.python-requests.org/en/master/" class="uri">http://docs.python-requests.org/en/master/</a></li>
<li>lxml: <a href="https://lxml.de/" class="uri">https://lxml.de/</a></li>
<li>BeautifulSoup: <a href="https://www.crummy.com/software/BeautifulSoup/" class="uri">https://www.crummy.com/software/BeautifulSoup/</a></li>
</ul></li>
<li>Social Network Analysis
<ul>
<li>networkx: <a href="https://networkx.github.io/" class="uri">https://networkx.github.io/</a></li>
<li>graph-tool: <a href="https://graph-tool.skewed.de/" class="uri">https://graph-tool.skewed.de/</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="python-web-scraping" class="section level1">
<h1>Python Web-Scraping</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Web basics</li>
<li>Making web requests</li>
<li>Inspecting web sites</li>
<li>Retrieving JSON data</li>
<li>Using Xpaths to retrieve <code>html</code> content</li>
<li>Parsing <code>html</code> content</li>
<li>Cleaning and storing text from <code>html</code></li>
</ul>
<div id="setup-5" class="section level2">
<h2>Setup</h2>
<div id="software-and-materials-5" class="section level3">
<h3>Software and Materials</h3>
<p>Follow the <a href="./PythonInstall.html">Python Installation</a> instructions and ensure that you can successfully start JupyterLab.</p>
</div>
<div id="class-structure-5" class="section level3">
<h3>Class Structure</h3>
<p>Informal - Ask questions at any time. Really!</p>
<p>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</p>
</div>
<div id="prerequisites-5" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate / advanced Python course:</p>
<ul>
<li>Assumes knowledge of Python, including:
<ul>
<li>lists</li>
<li>dictionaries</li>
<li>logical indexing</li>
<li>iteration with for-loops</li>
</ul></li>
<li>Assumes basic knowledge of web page structure</li>
<li>Relatively fast-paced</li>
</ul>
<p>If you need an introduction to Python or a refresher, we recommend our <a href="https://iqss.github.io/dss-workshops/PythonIntro.html">Python Introduction</a>.</p>
</div>
<div id="goals-4" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>This workshop is organized into two main parts:</p>
<ol style="list-style-type: decimal">
<li>Retrive information in JSON format</li>
<li>Parse HTML files</li>
</ol>
<p>Note that this workshop will not teach you everything you need to know in order to retrieve data from any web service you might wish to scrape.</p>
</div>
</div>
</div>
<div id="web-scraping-background" class="section level2">
<h2>Web scraping background</h2>
<div id="what-is-web-scraping" class="section level3">
<h3>What is web scraping?</h3>
<p>Web scraping is the activity of automating retrieval of information from a web service designed for human interaction.</p>
</div>
<div id="is-web-scraping-legal-is-it-ethical" class="section level3">
<h3>Is web scraping legal? Is it ethical?</h3>
<p>It depends. If you have legal questions seek legal counsel. You can mitigate some ethical issues by building delays and restrictions into your web scraping program so as to avoid impacting the availability of the web service for other users or the cost of hosting the service for the service provider.</p>
</div>
<div id="web-scraping-approaches" class="section level3">
<h3>Web scraping approaches</h3>
<p>No two websites are identical — websites are built for different purposes by different people and so have different underlying structures. Because they are heterogeneous, there is no single way to scrape a website. <strong>The scraping approach therefore has to be tailored to each individual site.</strong> Here are some commonly used approaches:</p>
<ol style="list-style-type: decimal">
<li>Use requests to extract information from structured JSON / XML files</li>
<li>Use requests to extract information from HTML</li>
<li>Automate a browser to retrieve information from HTML</li>
</ol>
<p>Bear in mind that even once you’ve decided upon the best approach for a particular site, it will be necessary to modify that approach to suit your particular use-case.</p>
</div>
<div id="how-does-the-web-work" class="section level3">
<h3>How does the web work?</h3>
<div id="components" class="section level4">
<h4>Components</h4>
<p>Computers connected to the web are called <strong>clients</strong> and <strong>servers</strong>. A simplified diagram of how they interact might look like this:</p>
<p><img src="Python/PythonWebScrape/images/client_server.png" /></p>
<ul>
<li><strong>Clients</strong> are the typical web user’s internet-connected devices (for example, your computer connected to your Wi-Fi) and web-accessing software available on those devices (usually a web browser like Firefox or Chrome).</li>
<li><strong>Servers</strong> are computers that store webpages, sites, or apps. When a client device wants to access a webpage, a copy of the webpage is downloaded from the server onto the client machine to be displayed in the user’s web browser.</li>
<li><strong>HTTP</strong> is a language for clients and servers to speak to each other.</li>
</ul>
</div>
<div id="so-what-happens" class="section level4">
<h4>So what happens?</h4>
<p>When you type a web address into your browser:</p>
<ol style="list-style-type: decimal">
<li>The browser finds the address of the server that the website lives on.</li>
<li>The browser sends an <strong>HTTP request message</strong> to the server, asking it to send a copy of the website to the client.</li>
<li>If the server approves the client’s request, the server sends the client a <code>200 OK</code> message, and then starts displaying the website in the browser.</li>
</ol>
</div>
</div>
</div>
<div id="retrieve-data-in-json-format-if-you-can" class="section level2">
<h2>Retrieve data in JSON format if you can</h2>
<div class="alert alert-info">
<p><strong>GOAL: To retrieve information in JSON format and organize it into a spreadsheet.</strong></p>
<ol style="list-style-type: decimal">
<li>Inspect the website to check if the content is stored in JSON format</li>
<li>Make a request to the website server to retrieve the JSON file</li>
<li>Convert from JSON format into a Python dictionary</li>
<li>Extract the data from the dictionary and store in a .csv file</li>
</ol>
</div>
<p>We wish to extract information from <a href="https://www.harvardartmuseums.org/collections" class="uri">https://www.harvardartmuseums.org/collections</a>. Like most modern web pages, a lot goes on behind the scenes to produce the page we see in our browser. Our goal is to pull back the curtain to see what the website does when we interact with it. Once we see how the website works we can start retrieving data from it.</p>
<p>If we are lucky we’ll find a resource that returns the data we’re looking for in a structured format like <a href="https://json.org/">JSON</a> or <a href="https://en.wikipedia.org/wiki/XML">XML</a>.</p>
<p><img src="Python/PythonWebScrape/images/json-format.png" /></p>
<p>This is useful because it is very easy to convert data from JSON or XML into a spreadsheet type format — like a csv or Excel file.</p>
<div id="examine-the-websites-structure" class="section level3">
<h3>Examine the website’s structure</h3>
<p>The basic strategy is pretty much the same for most scraping projects. We will use our web browser (Chrome or Firefox recommended) to examine the page you wish to retrieve data from, and copy/paste information from your web browser into your scraping program.</p>
<p>We start by opening the collections web page in a web browser and inspecting it.</p>
<p><img src="Python/PythonWebScrape/images/dev_tools.png" /></p>
<p><img src="Python/PythonWebScrape/images/dev_tools_pane.png" /></p>
<p>If we scroll down to the bottom of the Collections page, we’ll see a button that says “Load More”. Let’s see what happens when we click on that button. To do so, click on “Network” in the developer tools window, then click the “Load More Collections” button. You should see a list of requests that were made as a result of clicking that button, as shown below.</p>
<p><img src="Python/PythonWebScrape/images/dev_tools_network.png" /></p>
<p>If we look at that second request, the one to a script named <code>browse</code>, we’ll see that it returns all the information we need, in a convenient format called <code>JSON</code>. All we need to retrieve collection data is to make <code>GET</code> requests to <a href="https://www.harvardartmuseums.org/browse" class="uri">https://www.harvardartmuseums.org/browse</a> with the correct parameters.</p>
</div>
<div id="launch-jupyterlab-2" class="section level3">
<h3>Launch JupyterLab</h3>
<ol style="list-style-type: decimal">
<li>Start the <code>Anaconda Navigator</code> program</li>
<li>Click the <code>Launch</code> button under <code>Jupyter Lab</code></li>
<li>A browser window will open with your computer’s files listed on the left hand side of the page. Navigate to the folder called <code>PythonWebScrape</code> that you downloaded to your desktop and double-click on the folder</li>
<li>Within the <code>PythonWebScrape</code> folder, double-click on the file with the word “BLANK” in the name (<code>PythonWebScrape_BLANK.ipynb</code>). A pop-up window will ask you to <code>Select Kernal</code> — you should select the Python 3 kernal. The Jupyter Notebook should now open on the right hand side of the page</li>
</ol>
<p>A Jupyter Notebook contains one or more <em>cells</em> containing notes or code. To insert a new cell click the <code>+</code> button in the upper left. To execute a cell, select it and press <code>Control+Enter</code> or click the <code>Run</code> button at the top.</p>
</div>
<div id="making-requests" class="section level3">
<h3>Making requests</h3>
<p>To retrieve information from the website (i.e., make a request), we need to know the location of the information we want to collect. The Uniform Resource Locator (URL) — commonly know as a “web address”, specifies the location of a resource (such as a web page) on the internet.</p>
<p>A URL is usually composed of 5 parts:</p>
<p><img src="Python/PythonWebScrape/images/URL.png" /></p>
<p>The 4th part, the “query string”, contains one or more <strong>parameters</strong>. The 5th part, the “fragment”, is an internal page reference and may not be present.</p>
<p>For example, the URL we want to retrieve data from has the following structure:</p>
<pre><code>protocol                    domain    path  parameters
   https www.harvardartmuseums.org  browse  load_amount=10&amp;offset=0</code></pre>
<p>It is often convenient to create variables containing the domain(s) and path(s) you’ll be working with, as this allows you to swap out paths and parameters as needed. Note that the path is separated from the domain with <code>/</code> and the parameters are separated from the path with <code>?</code>. If there are multiple parameters they are separated from each other with a <code>&amp;</code>.</p>
<p>For example, we can define the domain and path of the collections URL as follows:</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb601-1"><a href="#cb601-1"></a>museum_domain <span class="op">=</span> <span class="st">&#39;https://www.harvardartmuseums.org&#39;</span></span>
<span id="cb601-2"><a href="#cb601-2"></a>collection_path <span class="op">=</span> <span class="st">&#39;browse&#39;</span></span>
<span id="cb601-3"><a href="#cb601-3"></a></span>
<span id="cb601-4"><a href="#cb601-4"></a>collection_url <span class="op">=</span> (museum_domain</span>
<span id="cb601-5"><a href="#cb601-5"></a>                  <span class="op">+</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb601-6"><a href="#cb601-6"></a>                  <span class="op">+</span> collection_path)</span>
<span id="cb601-7"><a href="#cb601-7"></a></span>
<span id="cb601-8"><a href="#cb601-8"></a><span class="bu">print</span>(collection_url)</span></code></pre></div>
<pre><code>## &#39;https://www.harvardartmuseums.org/browse&#39;</code></pre>
<p>Note that we omit the parameters here because it is usually easier to pass them as a <code>dict</code> when using the <code>requests</code> library in Python. This will become clearer shortly.</p>
<p>Now that we’ve constructed the URL we wish to interact with, we’re ready to make our first request in Python.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb603-1"><a href="#cb603-1"></a><span class="im">import</span> requests</span>
<span id="cb603-2"><a href="#cb603-2"></a></span>
<span id="cb603-3"><a href="#cb603-3"></a>collections1 <span class="op">=</span> requests.get(</span>
<span id="cb603-4"><a href="#cb603-4"></a>    collection_url,</span>
<span id="cb603-5"><a href="#cb603-5"></a>    params <span class="op">=</span> {<span class="st">&#39;load_amount&#39;</span>: <span class="dv">10</span>,</span>
<span id="cb603-6"><a href="#cb603-6"></a>                  <span class="st">&#39;offset&#39;</span>: <span class="dv">0</span>}</span>
<span id="cb603-7"><a href="#cb603-7"></a>)</span></code></pre></div>
<p>Note that the parameters <code>load_amount</code> and <code>offset</code> are essentially another way of setting page numbers — they refer to the amount of information retrieved at one time and the starting position, respectively.</p>
</div>
<div id="parsing-json-data" class="section level3">
<h3>Parsing JSON data</h3>
<p>We already know from inspecting network traffic in our web browser that this URL returns JSON, but we can use Python to verify this assumption.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb604-1"><a href="#cb604-1"></a>collections1.headers[<span class="st">&#39;Content-Type&#39;</span>]</span></code></pre></div>
<pre><code>## &#39;application/json&#39;</code></pre>
<p>Since JSON is a structured data format, parsing it into Python data structures is easy. In fact, there’s a method for that!</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb606-1"><a href="#cb606-1"></a>collections1 <span class="op">=</span> collections1.json()</span>
<span id="cb606-2"><a href="#cb606-2"></a><span class="co"># print(collections1)</span></span></code></pre></div>
<p>That’s it. Really, we are done here. Everyone go home!</p>
<p>OK not really, there is still more we can learn. But you have to admit that was pretty easy. If you can identify a service that returns the data you want in structured from, web scraping becomes a pretty trivial enterprise. We’ll discuss several other scenarios and topics, but for some web scraping tasks this is really all you need to know.</p>
</div>
<div id="organizing-saving-the-data" class="section level3">
<h3>Organizing &amp; saving the data</h3>
<p>The records we retrieved from <a href="https://www.harvardartmuseums.org/browse" class="uri">https://www.harvardartmuseums.org/browse</a> are arranged as a list of dictionaries. We can easily select the fields of arrange these data into a pandas <code>DataFrame</code> to facilitate subsequent analysis.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb607-1"><a href="#cb607-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<div class="sourceCode" id="cb608"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb608-1"><a href="#cb608-1"></a>records1 <span class="op">=</span> pd.DataFrame.from_records(collections1[<span class="st">&#39;records&#39;</span>])</span></code></pre></div>
<div class="sourceCode" id="cb609"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb609-1"><a href="#cb609-1"></a><span class="bu">print</span>(records1)</span></code></pre></div>
<pre><code>##                        copyright  contextualtextcount  ...                        seeAlso                        details
## 0                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 1                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 2             © 2004 Glenn Ligon                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 3                           None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;technical&#39;: [{&#39;text&#39;: &#39;I...
## 4                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 5                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 6                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 7                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 8  © Estate of Pablo Picasso ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 9  © Succession H. Matisse / ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 
## [10 rows x 63 columns]</code></pre>
<p>and write the data to a file.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb611-1"><a href="#cb611-1"></a>records1.to_csv(<span class="st">&quot;records1.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="iterating-to-retrieve-all-the-data" class="section level3">
<h3>Iterating to retrieve all the data</h3>
<p>Of course we don’t want just the first page of collections. How can we retrieve all of them?</p>
<p>Now that we know the web service works, and how to make requests in Python, we can iterate in the usual way.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb612-1"><a href="#cb612-1"></a>records <span class="op">=</span> []</span>
<span id="cb612-2"><a href="#cb612-2"></a><span class="cf">for</span> offset <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>):</span>
<span id="cb612-3"><a href="#cb612-3"></a>    param_values <span class="op">=</span> {<span class="st">&#39;load_amount&#39;</span>: <span class="dv">10</span>, <span class="st">&#39;offset&#39;</span>: offset}</span>
<span id="cb612-4"><a href="#cb612-4"></a>    current_request <span class="op">=</span> requests.get(collection_url, params <span class="op">=</span> param_values)</span>
<span id="cb612-5"><a href="#cb612-5"></a>    records.extend(current_request.json()[<span class="st">&#39;records&#39;</span>])</span></code></pre></div>
<div class="sourceCode" id="cb613"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb613-1"><a href="#cb613-1"></a><span class="co">## convert list of dicts to a `DataFrame`</span></span>
<span id="cb613-2"><a href="#cb613-2"></a>records_final <span class="op">=</span> pd.DataFrame.from_records(records)</span></code></pre></div>
<div class="sourceCode" id="cb614"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb614-1"><a href="#cb614-1"></a><span class="co"># write the data to a file.</span></span>
<span id="cb614-2"><a href="#cb614-2"></a>records_final.to_csv(<span class="st">&quot;records_final.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb615"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb615-1"><a href="#cb615-1"></a><span class="bu">print</span>(records_final)</span></code></pre></div>
<pre><code>##                         copyright  contextualtextcount  ...                        seeAlso                        details
## 0                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 1                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 2              © 2004 Glenn Ligon                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 3                            None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;technical&#39;: [{&#39;text&#39;: &#39;I...
## 4                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 5                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 6                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 7                            None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 8   © Estate of Pablo Picasso ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 9   © Succession H. Matisse / ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 10                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 11                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 12                           None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;technical&#39;: [{&#39;text&#39;: &#39;X...
## 13                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 14                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 15  © Estate of Alfred Stiegli...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 16                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 17                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 18  © 2020 The Estate of David...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 19                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 20                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 21                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;coins&#39;: {&#39;reverseinscrip...
## 22                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 23                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 24                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 25                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 26                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 27          © 1981 Gary Schneider                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 28                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 29                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 30  © 2020 The Arshile Gorky F...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 31                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 32  © Succession H. Matisse / ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 33                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 34                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 35                           None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 36                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 37  Artwork © Estate of Ben Sh...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 38                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 39   © Andy Warhol Foundation ...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 40                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 41                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 42                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 43                           None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;technical&#39;: [{&#39;text&#39;: &#39;X...
## 44                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 45                           None                    1  ...  [{&#39;id&#39;: &#39;https://iiif.harv...  {&#39;technical&#39;: [{&#39;text&#39;: &#39;X...
## 46               © Allan McCollum                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 47                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 48                           None                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 49  © Estate of Alfred Stiegli...                    0  ...  [{&#39;id&#39;: &#39;https://iiif.harv...                            NaN
## 
## [50 rows x 63 columns]</code></pre>
</div>
<div id="exercise-0-4" class="section level3">
<h3>Exercise 0</h3>
<p><strong>Retrieve exhibits data</strong></p>
<p>In this exercise you will retrieve information about the art exhibitions at Harvard Art Museums from <a href="https://www.harvardartmuseums.org/exhibitions" class="uri">https://www.harvardartmuseums.org/exhibitions</a></p>
<ol style="list-style-type: decimal">
<li>Using a web browser (Firefox or Chrome recommended) inspect the
page at <a href="https://www.harvardartmuseums.org/exhibitions" class="uri">https://www.harvardartmuseums.org/exhibitions</a>. Examine
the network traffic as you interact with the page. Try to find
where the data displayed on that page comes from.</li>
</ol>
<div class="sourceCode" id="cb617"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb617-1"><a href="#cb617-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Make a <code>get</code> request in Python to retrieve the data from the URL
identified in step1.</li>
</ol>
<div class="sourceCode" id="cb618"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb618-1"><a href="#cb618-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Write a <em>loop</em> or <em>list comprehension</em> in Python to retrieve data
for the first 5 pages of exhibitions data.</li>
</ol>
<div class="sourceCode" id="cb619"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb619-1"><a href="#cb619-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Bonus (optional): Convert the data you retrieved into a pandas
<code>DataFrame</code> and save it to a <code>.csv</code> file.</li>
</ol>
<div class="sourceCode" id="cb620"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb620-1"><a href="#cb620-1"></a><span class="co">##</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Question #1:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb621-1"><a href="#cb621-1"></a>museum_domain <span class="op">=</span> <span class="st">&quot;https://www.harvardartmuseums.org&quot;</span></span>
<span id="cb621-2"><a href="#cb621-2"></a>exhibit_path <span class="op">=</span> <span class="st">&quot;search/load_next&quot;</span></span>
<span id="cb621-3"><a href="#cb621-3"></a>exhibit_url <span class="op">=</span> museum_domain <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> exhibit_path</span>
<span id="cb621-4"><a href="#cb621-4"></a><span class="bu">print</span>(exhibit_url)</span></code></pre></div>
<pre><code>## &#39;https://www.harvardartmuseums.org/search/load_next&#39;</code></pre>
<p>Question #2:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb623-1"><a href="#cb623-1"></a><span class="im">import</span> requests</span>
<span id="cb623-2"><a href="#cb623-2"></a><span class="im">from</span> pprint <span class="im">import</span> pprint <span class="im">as</span> <span class="bu">print</span> </span>
<span id="cb623-3"><a href="#cb623-3"></a>exhibit1 <span class="op">=</span> requests.get(exhibit_url, params <span class="op">=</span> {<span class="st">&#39;type&#39;</span>: <span class="st">&#39;past-exhibition&#39;</span>, <span class="st">&#39;page&#39;</span>: <span class="dv">1</span>})</span>
<span id="cb623-4"><a href="#cb623-4"></a><span class="bu">print</span>(exhibit1.headers[<span class="st">&quot;Content-Type&quot;</span>])</span></code></pre></div>
<pre><code>## &#39;application/json&#39;</code></pre>
<div class="sourceCode" id="cb625"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb625-1"><a href="#cb625-1"></a>exhibit1 <span class="op">=</span> exhibit1.json()</span>
<span id="cb625-2"><a href="#cb625-2"></a><span class="co"># print(exhibit1)</span></span></code></pre></div>
<p>Questions #3+4 (loop solution):</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb626-1"><a href="#cb626-1"></a>firstFivePages <span class="op">=</span> []</span>
<span id="cb626-2"><a href="#cb626-2"></a><span class="cf">for</span> page <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>):</span>
<span id="cb626-3"><a href="#cb626-3"></a>    records_per_page <span class="op">=</span> requests.get(exhibit_url, params <span class="op">=</span> {<span class="st">&#39;type&#39;</span>: <span class="st">&#39;past-exhibition&#39;</span>, <span class="st">&#39;page&#39;</span>: page}).json()[<span class="st">&#39;records&#39;</span>]</span>
<span id="cb626-4"><a href="#cb626-4"></a>    firstFivePages.extend(records_per_page)</span>
<span id="cb626-5"><a href="#cb626-5"></a>firstFivePages_records <span class="op">=</span> pd.DataFrame.from_records(firstFivePages)</span>
<span id="cb626-6"><a href="#cb626-6"></a><span class="bu">print</span>(firstFivePages_records)</span></code></pre></div>
<pre><code>##                  shortdescription                         images  ...                   publications                         videos
## 0                            None  [{&#39;date&#39;: None, &#39;copyright...  ...                            NaN                            NaN
## 1                            None  [{&#39;date&#39;: &#39;2018-11-09&#39;, &#39;c...  ...                            NaN                            NaN
## 2                            None  [{&#39;date&#39;: &#39;2018-06-04&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 3                            None  [{&#39;date&#39;: &#39;2001-03-01&#39;, &#39;c...  ...                            NaN                            NaN
## 4                            None  [{&#39;date&#39;: &#39;2005-04-18&#39;, &#39;c...  ...                            NaN                            NaN
## 5                            None  [{&#39;date&#39;: &#39;2018-06-29&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Marina I...
## 6                            None  [{&#39;date&#39;: &#39;2018-03-15&#39;, &#39;c...  ...                            NaN                            NaN
## 7                            None  [{&#39;date&#39;: &#39;2016-10-17&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 8                            None  [{&#39;date&#39;: &#39;2017-02-16&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 9                            None  [{&#39;date&#39;: &#39;2018-01-23&#39;, &#39;c...  ...                            NaN                            NaN
## 10                           None  [{&#39;date&#39;: &#39;2001-04-01&#39;, &#39;c...  ...                            NaN                            NaN
## 11                           None  [{&#39;date&#39;: &#39;2016-06-10&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Fernando...
## 12                           None  [{&#39;date&#39;: &#39;2008-10-27&#39;, &#39;c...  ...                            NaN                            NaN
## 13                           None  [{&#39;date&#39;: &#39;2017-10-05&#39;, &#39;c...  ...                            NaN                            NaN
## 14                           None  [{&#39;date&#39;: &#39;2002-05-01&#39;, &#39;c...  ...                            NaN                            NaN
## 15                           None  [{&#39;date&#39;: &#39;2007-08-01&#39;, &#39;c...  ...                            NaN                            NaN
## 16                           None  [{&#39;date&#39;: &#39;2003-03-21&#39;, &#39;c...  ...                            NaN                            NaN
## 17                           None  [{&#39;date&#39;: &#39;2017-05-08&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 18                           None  [{&#39;date&#39;: &#39;2002-08-01&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Symposiu...
## 19                           None  [{&#39;date&#39;: &#39;2016-07-05&#39;, &#39;c...  ...                            NaN                            NaN
## 20                           None  [{&#39;date&#39;: &#39;2017-03-29&#39;, &#39;c...  ...                            NaN                            NaN
## 21                           None  [{&#39;date&#39;: &#39;2015-03-22&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...  [{&#39;description&#39;: &#39;The Phil...
## 22                           None  [{&#39;date&#39;: &#39;2017-03-07&#39;, &#39;c...  ...                            NaN                            NaN
## 23  Harvard professor Ewa Laje...  [{&#39;date&#39;: &#39;2001-03-01&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 24  This exhibition features w...  [{&#39;date&#39;: &#39;2016-07-12&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 25                           None  [{&#39;date&#39;: &#39;2017-02-08&#39;, &#39;c...  ...                            NaN                            NaN
## 26                           None  [{&#39;date&#39;: &#39;2001-06-01&#39;, &#39;c...  ...                            NaN                            NaN
## 27                           None  [{&#39;date&#39;: &#39;2005-11-03&#39;, &#39;c...  ...                            NaN                            NaN
## 28                           None  [{&#39;date&#39;: &#39;2015-04-06&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Wolfgang...
## 29                    In progress  [{&#39;date&#39;: &#39;2016-07-28&#39;, &#39;c...  ...                            NaN                            NaN
## 30                           None  [{&#39;date&#39;: None, &#39;copyright...  ...                            NaN                            NaN
## 31                           None  [{&#39;date&#39;: &#39;2016-03-21&#39;, &#39;c...  ...                            NaN                            NaN
## 32                           None  [{&#39;date&#39;: &#39;2007-04-18&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 33                           None  [{&#39;date&#39;: &#39;2015-04-01&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 34                           None  [{&#39;date&#39;: &#39;2016-01-12&#39;, &#39;c...  ...                            NaN                            NaN
## 35                           None  [{&#39;date&#39;: &#39;2002-07-01&#39;, &#39;c...  ...                            NaN                            NaN
## 36                           None  [{&#39;date&#39;: &#39;2007-02-27&#39;, &#39;c...  ...                            NaN                            NaN
## 37                           None  [{&#39;date&#39;: &#39;2006-01-18&#39;, &#39;c...  ...                            NaN                            NaN
## 38                           None  [{&#39;date&#39;: &#39;2015-10-29&#39;, &#39;c...  ...                            NaN                            NaN
## 39                           None  [{&#39;date&#39;: &#39;2014-08-12&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...  [{&#39;description&#39;: &#39;Teaser: ...
## 40                           None  [{&#39;date&#39;: &#39;2005-11-03&#39;, &#39;c...  ...                            NaN                            NaN
## 41                           None  [{&#39;date&#39;: &#39;1989-08-01&#39;, &#39;c...  ...                            NaN                            NaN
## 42  This multi-component insta...  [{&#39;date&#39;: &#39;2014-03-31&#39;, &#39;c...  ...                            NaN                            NaN
## 43                           None  [{&#39;date&#39;: &#39;2009-11-30&#39;, &#39;c...  ...                            NaN                            NaN
## 44  Harvard Art Museums’ new p...  [{&#39;date&#39;: &#39;2012-06-29&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Rothko S...
## 45                           None  [{&#39;date&#39;: &#39;2014-11-10&#39;, &#39;c...  ...                            NaN                            NaN
## 46  In the Japanese context, a...  [{&#39;date&#39;: &#39;2012-07-17&#39;, &#39;c...  ...                            NaN                            NaN
## 47  World’s Fairs were created...  [{&#39;date&#39;: &#39;2005-12-21&#39;, &#39;c...  ...                            NaN                            NaN
## 48                           None  [{&#39;date&#39;: &#39;2005-11-09&#39;, &#39;c...  ...                            NaN                            NaN
## 49  Teaching Galleries\r\n\r\n...  [{&#39;date&#39;: &#39;2003-03-18&#39;, &#39;c...  ...                            NaN                            NaN
## 
## [50 rows x 19 columns]</code></pre>
<p>Questions #3+4 (list comprehension solution):</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb628-1"><a href="#cb628-1"></a>first5Pages <span class="op">=</span> [requests.get(exhibit_url, params <span class="op">=</span> {<span class="st">&#39;type&#39;</span>: <span class="st">&#39;past-exhibition&#39;</span>, <span class="st">&#39;page&#39;</span>: page}).json()[<span class="st">&#39;records&#39;</span>] <span class="cf">for</span> page <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)]</span>
<span id="cb628-2"><a href="#cb628-2"></a><span class="im">from</span> itertools <span class="im">import</span> chain</span>
<span id="cb628-3"><a href="#cb628-3"></a>first5Pages <span class="op">=</span> <span class="bu">list</span>(chain.from_iterable(first5Pages))</span>
<span id="cb628-4"><a href="#cb628-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb628-5"><a href="#cb628-5"></a>first5Pages_records <span class="op">=</span> pd.DataFrame.from_records(first5Pages)</span>
<span id="cb628-6"><a href="#cb628-6"></a><span class="bu">print</span>(first5Pages_records)</span></code></pre></div>
<pre><code>##                  shortdescription                         images  ...                   publications                         videos
## 0                            None  [{&#39;date&#39;: None, &#39;copyright...  ...                            NaN                            NaN
## 1                            None  [{&#39;date&#39;: &#39;2018-11-09&#39;, &#39;c...  ...                            NaN                            NaN
## 2                            None  [{&#39;date&#39;: &#39;2018-06-04&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 3                            None  [{&#39;date&#39;: &#39;2001-03-01&#39;, &#39;c...  ...                            NaN                            NaN
## 4                            None  [{&#39;date&#39;: &#39;2005-04-18&#39;, &#39;c...  ...                            NaN                            NaN
## 5                            None  [{&#39;date&#39;: &#39;2018-06-29&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Marina I...
## 6                            None  [{&#39;date&#39;: &#39;2018-03-15&#39;, &#39;c...  ...                            NaN                            NaN
## 7                            None  [{&#39;date&#39;: &#39;2016-10-17&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 8                            None  [{&#39;date&#39;: &#39;2017-02-16&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 9                            None  [{&#39;date&#39;: &#39;2018-01-23&#39;, &#39;c...  ...                            NaN                            NaN
## 10                           None  [{&#39;date&#39;: &#39;2001-04-01&#39;, &#39;c...  ...                            NaN                            NaN
## 11                           None  [{&#39;date&#39;: &#39;2016-06-10&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Fernando...
## 12                           None  [{&#39;date&#39;: &#39;2008-10-27&#39;, &#39;c...  ...                            NaN                            NaN
## 13                           None  [{&#39;date&#39;: &#39;2017-10-05&#39;, &#39;c...  ...                            NaN                            NaN
## 14                           None  [{&#39;date&#39;: &#39;2002-05-01&#39;, &#39;c...  ...                            NaN                            NaN
## 15                           None  [{&#39;date&#39;: &#39;2007-08-01&#39;, &#39;c...  ...                            NaN                            NaN
## 16                           None  [{&#39;date&#39;: &#39;2003-03-21&#39;, &#39;c...  ...                            NaN                            NaN
## 17                           None  [{&#39;date&#39;: &#39;2017-05-08&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 18                           None  [{&#39;date&#39;: &#39;2002-08-01&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Symposiu...
## 19                           None  [{&#39;date&#39;: &#39;2016-07-05&#39;, &#39;c...  ...                            NaN                            NaN
## 20                           None  [{&#39;date&#39;: &#39;2017-03-29&#39;, &#39;c...  ...                            NaN                            NaN
## 21                           None  [{&#39;date&#39;: &#39;2015-03-22&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...  [{&#39;description&#39;: &#39;The Phil...
## 22                           None  [{&#39;date&#39;: &#39;2017-03-07&#39;, &#39;c...  ...                            NaN                            NaN
## 23  Harvard professor Ewa Laje...  [{&#39;date&#39;: &#39;2001-03-01&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 24  This exhibition features w...  [{&#39;date&#39;: &#39;2016-07-12&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 25                           None  [{&#39;date&#39;: &#39;2017-02-08&#39;, &#39;c...  ...                            NaN                            NaN
## 26                           None  [{&#39;date&#39;: &#39;2001-06-01&#39;, &#39;c...  ...                            NaN                            NaN
## 27                           None  [{&#39;date&#39;: &#39;2005-11-03&#39;, &#39;c...  ...                            NaN                            NaN
## 28                           None  [{&#39;date&#39;: &#39;2015-04-06&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Wolfgang...
## 29                    In progress  [{&#39;date&#39;: &#39;2016-07-28&#39;, &#39;c...  ...                            NaN                            NaN
## 30                           None  [{&#39;date&#39;: None, &#39;copyright...  ...                            NaN                            NaN
## 31                           None  [{&#39;date&#39;: &#39;2016-03-21&#39;, &#39;c...  ...                            NaN                            NaN
## 32                           None  [{&#39;date&#39;: &#39;2007-04-18&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 33                           None  [{&#39;date&#39;: &#39;2015-04-01&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...                            NaN
## 34                           None  [{&#39;date&#39;: &#39;2016-01-12&#39;, &#39;c...  ...                            NaN                            NaN
## 35                           None  [{&#39;date&#39;: &#39;2002-07-01&#39;, &#39;c...  ...                            NaN                            NaN
## 36                           None  [{&#39;date&#39;: &#39;2007-02-27&#39;, &#39;c...  ...                            NaN                            NaN
## 37                           None  [{&#39;date&#39;: &#39;2006-01-18&#39;, &#39;c...  ...                            NaN                            NaN
## 38                           None  [{&#39;date&#39;: &#39;2015-10-29&#39;, &#39;c...  ...                            NaN                            NaN
## 39                           None  [{&#39;date&#39;: &#39;2014-08-12&#39;, &#39;c...  ...  [{&#39;publicationplace&#39;: &#39;Cam...  [{&#39;description&#39;: &#39;Teaser: ...
## 40                           None  [{&#39;date&#39;: &#39;2005-11-03&#39;, &#39;c...  ...                            NaN                            NaN
## 41                           None  [{&#39;date&#39;: &#39;1989-08-01&#39;, &#39;c...  ...                            NaN                            NaN
## 42  This multi-component insta...  [{&#39;date&#39;: &#39;2014-03-31&#39;, &#39;c...  ...                            NaN                            NaN
## 43                           None  [{&#39;date&#39;: &#39;2009-11-30&#39;, &#39;c...  ...                            NaN                            NaN
## 44  Harvard Art Museums’ new p...  [{&#39;date&#39;: &#39;2012-06-29&#39;, &#39;c...  ...                            NaN  [{&#39;description&#39;: &#39;Rothko S...
## 45                           None  [{&#39;date&#39;: &#39;2014-11-10&#39;, &#39;c...  ...                            NaN                            NaN
## 46  In the Japanese context, a...  [{&#39;date&#39;: &#39;2012-07-17&#39;, &#39;c...  ...                            NaN                            NaN
## 47  World’s Fairs were created...  [{&#39;date&#39;: &#39;2005-12-21&#39;, &#39;c...  ...                            NaN                            NaN
## 48                           None  [{&#39;date&#39;: &#39;2005-11-09&#39;, &#39;c...  ...                            NaN                            NaN
## 49  Teaching Galleries\r\n\r\n...  [{&#39;date&#39;: &#39;2003-03-18&#39;, &#39;c...  ...                            NaN                            NaN
## 
## [50 rows x 19 columns]</code></pre>
</div>
</details>
</div>
</div>
<div id="parsing-html-if-you-have-to" class="section level2">
<h2>Parsing HTML if you have to</h2>
<div class="alert alert-info">
<p><strong>GOAL: To retrieve information in HTML format and organize it into a spreadsheet.</strong></p>
<ol style="list-style-type: decimal">
<li>Make a request to the website server to retrieve the HTML</li>
<li>Inspect the HTML to determine the XPATHs that point to the data we want</li>
<li>Extract the information from the location the XPATHs point to and store in a dictionary</li>
<li>Convert from a dictionary to a .csv file</li>
</ol>
</div>
<p>As we’ve seen, you can often inspect network traffic or other sources to locate the source of the data you are interested in and the API used to retrieve it. You should always start by looking for these shortcuts and using them where possible. If you are really lucky, you’ll find a shortcut that returns the data as JSON or XML. If you are not quite so lucky, you will have to parse HTML to retrieve the information you need.</p>
<div id="document-object-model-dom" class="section level3">
<h3>Document Object Model (DOM)</h3>
<p>To parse HTML, we need to have a nice tree structure that contains the whole HTML file through which we can locate the information. This tree-like structure is the <strong>Document Object Model (DOM)</strong>. DOM is a cross-platform and language-independent interface that treats an XML or HTML document as a tree structure wherein each node is an object representing a part of the document. The DOM represents a document with a logical tree. <em>Each branch of the tree ends in a node, and each node contains objects</em>. DOM methods allow programmatic access to the tree; with them one can change the structure, style or content of a document. The following is an example of DOM hierarchy in an HTML document:</p>
<p><img src="Python/PythonWebScrape/images/DOM.png" /></p>
</div>
<div id="retrieving-html" class="section level3">
<h3>Retrieving HTML</h3>
<p>When I inspect the network traffic while interacting with <a href="https://www.harvardartmuseums.org/calendar" class="uri">https://www.harvardartmuseums.org/calendar</a> I don’t see any requests that return JSON data. The best we can do appears to be to return HTML.</p>
<p>To retrieve data on the events listed in the calender, the first step is the same as before: we make a <code>get</code> request.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb630-1"><a href="#cb630-1"></a>calendar_path <span class="op">=</span> <span class="st">&#39;calendar&#39;</span></span>
<span id="cb630-2"><a href="#cb630-2"></a></span>
<span id="cb630-3"><a href="#cb630-3"></a>calendar_url <span class="op">=</span> (museum_domain <span class="co"># recall that we defined museum_domain earlier</span></span>
<span id="cb630-4"><a href="#cb630-4"></a>                  <span class="op">+</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb630-5"><a href="#cb630-5"></a>                  <span class="op">+</span> calendar_path)</span>
<span id="cb630-6"><a href="#cb630-6"></a></span>
<span id="cb630-7"><a href="#cb630-7"></a><span class="bu">print</span>(calendar_url)</span></code></pre></div>
<pre><code>## &#39;https://www.harvardartmuseums.org/calendar&#39;</code></pre>
<div class="sourceCode" id="cb632"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb632-1"><a href="#cb632-1"></a>events <span class="op">=</span> requests.get(calendar_url)</span></code></pre></div>
<p>As before, we can check the headers to see what type of content we received in response to our request.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb633-1"><a href="#cb633-1"></a>events.headers[<span class="st">&#39;Content-Type&#39;</span>]</span></code></pre></div>
<pre><code>## &#39;text/html; charset=UTF-8&#39;</code></pre>
</div>
<div id="parsing-html-using-the-lxml-library" class="section level3">
<h3>Parsing HTML using the lxml library</h3>
<p>Like JSON, HTML is structured; unlike JSON, it is designed to be rendered into a human-readable page rather than simply to store and exchange data in a computer-readable format. Consequently, parsing HTML and extracting information from it is somewhat more difficult than parsing JSON.</p>
<p>While JSON parsing is built into the Python <code>requests</code> library, parsing HTML requires a separate library. I recommend using the HTML parser from the <code>lxml</code> library; others prefer an alternative called <code>beautifulsoup4</code>.</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb635-1"><a href="#cb635-1"></a><span class="im">from</span> lxml <span class="im">import</span> html</span>
<span id="cb635-2"><a href="#cb635-2"></a></span>
<span id="cb635-3"><a href="#cb635-3"></a><span class="co"># convert a html text representation (`events.text`) into </span></span>
<span id="cb635-4"><a href="#cb635-4"></a><span class="co"># a tree-structure (DOM) html representation (`events_html`)</span></span>
<span id="cb635-5"><a href="#cb635-5"></a>events_html <span class="op">=</span> html.fromstring(events.text)</span></code></pre></div>
</div>
<div id="using-xpath-to-extract-content-from-html" class="section level3">
<h3>Using XPath to extract content from HTML</h3>
<p><code>XPath</code> is a tool for identifying particular elements within a HTML document. The developer tools built into modern web browsers make it easy to generate <code>XPath</code>s that can be used to identify the elements of a web page that we wish to extract.</p>
<p>We can open the html document we retrieved and inspect it using our web browser.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb636-1"><a href="#cb636-1"></a>html.open_in_browser(events_html, encoding <span class="op">=</span> <span class="st">&#39;UTF-8&#39;</span>)</span></code></pre></div>
<p><img src="Python/PythonWebScrape/images/dev_tools_right_click.png" /></p>
<p><img src="Python/PythonWebScrape/images/dev_tools_inspect.png" /></p>
<p>Once we identify the element containing the information of interest we can use our web browser to copy the <code>XPath</code> that uniquely identifies that element.</p>
<p><img src="Python/PythonWebScrape/images/dev_tools_xpath.png" /></p>
<p>Next we can use Python to extract the element of interest:</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb637-1"><a href="#cb637-1"></a>events_list_html <span class="op">=</span> events_html.xpath(<span class="st">&#39;//*[@id=&quot;events_list&quot;]/article&#39;</span>)</span></code></pre></div>
<p>Let’s just extract the second element in our events list.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb638-1"><a href="#cb638-1"></a>second_event_html <span class="op">=</span> events_list_html[<span class="dv">1</span>]</span></code></pre></div>
<p>Once again, we can use a web browser to inspect the HTML we’re currently working with - from the second event - and to figure out what we want to extract from it.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb639-1"><a href="#cb639-1"></a>html.open_in_browser(second_event_html, encoding <span class="op">=</span> <span class="st">&#39;UTF-8&#39;</span>)</span></code></pre></div>
<p>As before we can use our browser to find the xpath of the elements we want.</p>
<p><img src="Python/PythonWebScrape/images/dev_tools_figcaption.png" /></p>
<p>(Note that the <code>html.open_in_browser</code> function adds enclosing <code>html</code> and <code>body</code> tags in order to create a complete web page for viewing. This requires that we adjust the <code>xpath</code> accordingly.)</p>
<p>By repeating this process for each element we want, we can build a list of the xpaths to those elements.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb640-1"><a href="#cb640-1"></a>elements_we_want <span class="op">=</span> {<span class="st">&#39;figcaption&#39;</span>: <span class="st">&#39;div/figure/div/figcaption&#39;</span>,</span>
<span id="cb640-2"><a href="#cb640-2"></a>                    <span class="st">&#39;date&#39;</span>: <span class="st">&#39;div/div/header/time&#39;</span>,</span>
<span id="cb640-3"><a href="#cb640-3"></a>                    <span class="st">&#39;title&#39;</span>: <span class="st">&#39;div/div/header/h2/a&#39;</span>,</span>
<span id="cb640-4"><a href="#cb640-4"></a>                    <span class="st">&#39;time&#39;</span>: <span class="st">&#39;div/div/div/p[1]/time&#39;</span>,</span>
<span id="cb640-5"><a href="#cb640-5"></a>                    <span class="st">&#39;description&#39;</span>: <span class="st">&#39;div/div/div/p[3]&#39;</span></span>
<span id="cb640-6"><a href="#cb640-6"></a>                    }</span></code></pre></div>
<p>Finally, we can iterate over the elements we want and extract them.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb641-1"><a href="#cb641-1"></a>second_event_values <span class="op">=</span> {}</span>
<span id="cb641-2"><a href="#cb641-2"></a><span class="cf">for</span> key <span class="kw">in</span> elements_we_want.keys():</span>
<span id="cb641-3"><a href="#cb641-3"></a>    element <span class="op">=</span> second_event_html.xpath(elements_we_want[key])[<span class="dv">0</span>]</span>
<span id="cb641-4"><a href="#cb641-4"></a>    second_event_values[key] <span class="op">=</span> element.text_content().strip()</span>
<span id="cb641-5"><a href="#cb641-5"></a></span>
<span id="cb641-6"><a href="#cb641-6"></a><span class="bu">print</span>(second_event_values)</span></code></pre></div>
<pre><code>## {&#39;date&#39;: &#39;Thursday, August 27, 2020&#39;,
##  &#39;description&#39;: &#39;We’ll take a close look at a late 18th-century book &#39;
##                 &#39;illustration by French artists Pierre-Paul Prud’hon and &#39;
##                 &#39;Barthélemy Roger.&#39;,
##  &#39;figcaption&#39;: &#39;Pierre-Paul Prud’hon (design and etching) and Barthélemy &#39;
##                &#39;Joseph Fulcran Roger (engraving), French, Phrosine and &#39;
##                &#39;Mélidore, 1797. Etching and engraving. Harvard Art &#39;
##                &#39;Museums/Fogg Museum, Gray Collection of Engravings Fund and &#39;
##                &#39;the Jakob Rosenberg Fund, G9063.&#39;,
##  &#39;time&#39;: &#39;2:00pm - 2:30pm&#39;,
##  &#39;title&#39;: &#39;Art Talk Live: One Print—Five Stories&#39;}</code></pre>
</div>
<div id="iterating-to-retrieve-content-from-a-list-of-html-elements" class="section level3">
<h3>Iterating to retrieve content from a list of HTML elements</h3>
<p>So far we’ve retrieved information only for the second event. To
retrieve data for all the events listed on the page we need to iterate
over the events. If we are very lucky, each event will have exactly
the same information structured in exactly the same way and we can
simply extend the code we wrote above to iterate over the events list.</p>
<p>Unfortunately, not all these elements are available for every event, so
we need to take care to handle the case where one or more of these
elements is not available. We can do that by <strong>defining a function</strong> that
tries to retrieve a value and returns an empty string if it fails.</p>
<p>If you’re not familiar with Python functions, here’s the basic syntax:</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb643-1"><a href="#cb643-1"></a><span class="co"># anatomy of a function</span></span>
<span id="cb643-2"><a href="#cb643-2"></a></span>
<span id="cb643-3"><a href="#cb643-3"></a><span class="kw">def</span> name_of_function(arg1, arg2, ...argn):  <span class="co"># define the function name and arguments</span></span>
<span id="cb643-4"><a href="#cb643-4"></a>    <span class="op">&lt;</span>body of function<span class="op">&gt;</span>   <span class="co"># specify calculations</span></span>
<span id="cb643-5"><a href="#cb643-5"></a>    <span class="cf">return</span> <span class="op">&lt;</span>result<span class="op">&gt;</span>      <span class="co"># output result of calculations</span></span></code></pre></div>
<p>Here’s an example of a simple function:</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb644-1"><a href="#cb644-1"></a><span class="kw">def</span> square_fun(x):</span>
<span id="cb644-2"><a href="#cb644-2"></a>    y <span class="op">=</span> x<span class="op">**</span><span class="dv">2</span> <span class="co"># exponentiation</span></span>
<span id="cb644-3"><a href="#cb644-3"></a>    <span class="cf">return</span> y</span>
<span id="cb644-4"><a href="#cb644-4"></a></span>
<span id="cb644-5"><a href="#cb644-5"></a>square_fun(<span class="dv">4</span>)    </span></code></pre></div>
<pre><code>## 16</code></pre>
<p>Here’s a function to perform our actual task:</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb646-1"><a href="#cb646-1"></a><span class="kw">def</span> get_event_info(event, path):</span>
<span id="cb646-2"><a href="#cb646-2"></a>    <span class="cf">try</span>:</span>
<span id="cb646-3"><a href="#cb646-3"></a>        info <span class="op">=</span> event.xpath(path)[<span class="dv">0</span>].text_content().strip()</span>
<span id="cb646-4"><a href="#cb646-4"></a>    <span class="cf">except</span>:</span>
<span id="cb646-5"><a href="#cb646-5"></a>        info <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb646-6"><a href="#cb646-6"></a>    <span class="cf">return</span> info</span></code></pre></div>
<p>Armed with this function we can iterate over the list of events and extract the available information for each one.</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb647-1"><a href="#cb647-1"></a>all_event_values <span class="op">=</span> {}</span>
<span id="cb647-2"><a href="#cb647-2"></a><span class="cf">for</span> key <span class="kw">in</span> elements_we_want.keys():</span>
<span id="cb647-3"><a href="#cb647-3"></a>    key_values <span class="op">=</span> []</span>
<span id="cb647-4"><a href="#cb647-4"></a>    <span class="cf">for</span> event <span class="kw">in</span> events_list_html: </span>
<span id="cb647-5"><a href="#cb647-5"></a>        key_values.append(get_event_info(event, elements_we_want[key]))</span>
<span id="cb647-6"><a href="#cb647-6"></a>    all_event_values[key] <span class="op">=</span> key_values</span></code></pre></div>
<p>For convenience we can arrange these values in a pandas <code>DataFrame</code> and save them as .csv files, just as we did with our exhibitions data earlier.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb648-1"><a href="#cb648-1"></a>all_event_values <span class="op">=</span> pd.DataFrame.from_dict(all_event_values)</span>
<span id="cb648-2"><a href="#cb648-2"></a></span>
<span id="cb648-3"><a href="#cb648-3"></a>all_event_values.to_csv(<span class="st">&quot;all_event_values.csv&quot;</span>)</span>
<span id="cb648-4"><a href="#cb648-4"></a></span>
<span id="cb648-5"><a href="#cb648-5"></a><span class="bu">print</span>(all_event_values)</span></code></pre></div>
</div>
<div id="exercise-1-5" class="section level3">
<h3>Exercise 1</h3>
<p><strong>parsing HTML</strong></p>
<p>In this exercise you will retrieve information about the physical layout of the Harvard Art Museums. The web page at
<a href="https://www.harvardartmuseums.org/visit/floor-plan" class="uri">https://www.harvardartmuseums.org/visit/floor-plan</a> contains this information in HTML from.</p>
<ol style="list-style-type: decimal">
<li><p>Using a web browser (Firefox or Chrome recommended) inspect the
page at <a href="https://www.harvardartmuseums.org/visit/floor-plan" class="uri">https://www.harvardartmuseums.org/visit/floor-plan</a>. Copy
the <code>XPath</code> to the element containing the list of level
information. (HINT: the element if interest is a <code>ul</code>, i.e.,
<code>unordered list</code>.)</p></li>
<li><p>Make a <code>get</code> request in Python to retrieve the web page at
<a href="https://www.harvardartmuseums.org/visit/floor-plan" class="uri">https://www.harvardartmuseums.org/visit/floor-plan</a>. Extract the
content from your request object and parse it using <code>html.fromstring</code>
from the <code>lxml</code> library.</p></li>
</ol>
<div class="sourceCode" id="cb649"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb649-1"><a href="#cb649-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Use your web browser to find the <code>XPath</code>s to the facilities housed on
level one. Use Python to extract the text from those <code>Xpath</code>s.</li>
</ol>
<div class="sourceCode" id="cb650"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb650-1"><a href="#cb650-1"></a><span class="co">##</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Bonus (optional): Write a <em>for loop</em> or <em>list comprehension</em> in Python
to retrieve data for all the levels.</li>
</ol>
<div class="sourceCode" id="cb651"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb651-1"><a href="#cb651-1"></a><span class="co">##</span></span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<p>Question #2:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb652-1"><a href="#cb652-1"></a><span class="im">from</span> lxml <span class="im">import</span> html</span>
<span id="cb652-2"><a href="#cb652-2"></a>floor_plan <span class="op">=</span> requests.get(<span class="st">&#39;https://www.harvardartmuseums.org/visit/floor-plan&#39;</span>)</span>
<span id="cb652-3"><a href="#cb652-3"></a>floor_plan_html <span class="op">=</span> html.fromstring(floor_plan.text)</span></code></pre></div>
<p>Question #3:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb653-1"><a href="#cb653-1"></a>level_one <span class="op">=</span> floor_plan_html.xpath(<span class="st">&#39;/html/body/main/section/ul/li[5]/div[2]/ul&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb653-2"><a href="#cb653-2"></a><span class="bu">print</span>(<span class="bu">type</span>(level_one))</span></code></pre></div>
<pre><code>## &lt;class &#39;lxml.html.HtmlElement&#39;&gt;</code></pre>
<div class="sourceCode" id="cb655"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb655-1"><a href="#cb655-1"></a><span class="bu">print</span>(<span class="bu">len</span>(level_one))</span></code></pre></div>
<pre><code>## 6</code></pre>
<div class="sourceCode" id="cb657"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb657-1"><a href="#cb657-1"></a>level_one_facilities <span class="op">=</span> floor_plan_html.xpath(<span class="st">&#39;/html/body/main/section/ul/li[5]/div[2]/ul/li&#39;</span>)</span>
<span id="cb657-2"><a href="#cb657-2"></a><span class="bu">print</span>(<span class="bu">len</span>(level_one_facilities))</span></code></pre></div>
<pre><code>## 6</code></pre>
<div class="sourceCode" id="cb659"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb659-1"><a href="#cb659-1"></a><span class="bu">print</span>([facility.text_content() <span class="cf">for</span> facility <span class="kw">in</span> level_one_facilities])</span></code></pre></div>
<pre><code>## [&#39;Admissions&#39;, &#39;Collection Galleries&#39;, &#39;Courtyard&#39;, &#39;Shop&#39;, &#39;Café&#39;, &#39;Coatroom&#39;]</code></pre>
<p>Question #4:</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb661-1"><a href="#cb661-1"></a>all_levels <span class="op">=</span> floor_plan_html.xpath(<span class="st">&#39;/html/body/main/section/ul/li&#39;</span>)</span>
<span id="cb661-2"><a href="#cb661-2"></a><span class="bu">print</span>(<span class="bu">len</span>(all_levels))</span></code></pre></div>
<pre><code>## 6</code></pre>
<div class="sourceCode" id="cb663"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb663-1"><a href="#cb663-1"></a>all_levels_facilities <span class="op">=</span> []</span>
<span id="cb663-2"><a href="#cb663-2"></a><span class="cf">for</span> level <span class="kw">in</span> all_levels:</span>
<span id="cb663-3"><a href="#cb663-3"></a>    level_facilities <span class="op">=</span> []</span>
<span id="cb663-4"><a href="#cb663-4"></a>    level_facilities_collection <span class="op">=</span> level.xpath(<span class="st">&#39;div[2]/ul/li&#39;</span>)</span>
<span id="cb663-5"><a href="#cb663-5"></a>    <span class="cf">for</span> level_facility <span class="kw">in</span> level_facilities_collection:</span>
<span id="cb663-6"><a href="#cb663-6"></a>        level_facilities.append(level_facility.text_content())</span>
<span id="cb663-7"><a href="#cb663-7"></a>    all_levels_facilities.append(level_facilities)</span>
<span id="cb663-8"><a href="#cb663-8"></a><span class="bu">print</span>(all_levels_facilities)</span></code></pre></div>
<pre><code>## [[&#39;Conservation Center / Lightbox Gallery&#39;],
##  [&#39;Art Study Center&#39;],
##  [&#39;Collection Galleries&#39;,
##   &#39;Special Exhibitions Gallery&#39;,
##   &#39;University Galleries&#39;],
##  [&#39;Collections Galleries&#39;],
##  [&#39;Admissions&#39;,
##   &#39;Collection Galleries&#39;,
##   &#39;Courtyard&#39;,
##   &#39;Shop&#39;,
##   &#39;Café&#39;,
##   &#39;Coatroom&#39;],
##  [&#39;Lower Lobby&#39;,
##   &#39;Lecture Halls&#39;,
##   &#39;Seminar Room&#39;,
##   &#39;Materials Lab&#39;,
##   &#39;Coatroom&#39;,
##   &#39;Offices&#39;]]</code></pre>
</div>
</details>
</div>
</div>
<div id="scrapy-for-large-complex-projects" class="section level2">
<h2><code>Scrapy</code>: for large / complex projects</h2>
<p>Scraping websites using the <code>requests</code> library to make GET and POST requests, and the <code>lxml</code> library to process HTML is a good way to learn basic web scraping techniques. It is a good choice for small to medium size projects. For very large or complicated scraping tasks the <code>scrapy</code> library offers a number of conveniences, including asynchronous retrieval, session management, convenient methods for extracting and storing values, and more. More information about <code>scrapy</code> can be found at <a href="https://doc.scrapy.org" class="uri">https://doc.scrapy.org</a>.</p>
</div>
<div id="browser-drivers-a-last-resort" class="section level2">
<h2>Browser drivers: a last resort</h2>
<p>It is sometimes necessary (or sometimes just easier) to use a web browser as an intermediary rather than communicate directly with a web service. This method of using a “browser driver” has the advantage of being able to use the javascript engine and session management features of a web browser; the main disadvantage is that it is slower and tends to be more fragile than using <code>requests</code> or <code>scrapy</code> to make requests directly from Python. For small scraping projects involving complicated sites with CAPTHAs or lots of complicated javascript using a browser driver can be a good option. More information is available at <a href="https://www.seleniumhq.org/docs/03_webdriver.jsp" class="uri">https://www.seleniumhq.org/docs/03_webdriver.jsp</a>.</p>
</div>
<div id="wrap-up-6" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-6" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-8" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
</div>



<div id="stata-installation" class="section level1">
<h1>Stata Installation</h1>
<div class="alert alert-info">
<p><strong>Your professional conduct is greatly appreciated. Out of respect to your fellow workshop attendees and instructors, please arrive at your workshop on time, having pre-installed all necessary software and materials. This will likely take 10-15 minutes.</strong></p>
</div>
<div id="troubleshooting" class="section level2">
<h2>Troubleshooting</h2>
<p>Unfortunately, we are not able to help with any Stata download or installation problems you may encounter. <strong>If you are unable to download or install Stata SE or MP, please contact your vendor (e.g., HUIT or Stata Corp.) prior to the start of the workshop.</strong> Once the workshop starts we will <strong>NOT</strong> be able to give you one-to-one assistance with setting up Stata. Likewise, if you arrive late, please do <strong>NOT</strong> expect one-to-one assistance for anything covered at the beginning of the workshop.</p>
</div>
<div id="materials-2" class="section level2">
<h2>Materials</h2>
<p>Download class materials for your workshop:</p>
<ul>
<li>Stata Introduction: <a href="https://github.com/IQSS/dss-workshops/raw/master/Stata/StataIntro.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Stata/StataIntro.zip</a></li>
<li>Stata Data Management: <a href="https://github.com/IQSS/dss-workshops/raw/master/Stata/StataDataManage.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Stata/StataDataManage.zip</a></li>
<li>Stata Regression Models: <a href="https://github.com/IQSS/dss-workshops/raw/master/Stata/StataModels.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Stata/StataModels.zip</a></li>
<li>Stata Graphics: <a href="https://github.com/IQSS/dss-workshops/raw/master/Stata/StataGraphics.zip" class="uri">https://github.com/IQSS/dss-workshops/raw/master/Stata/StataGraphics.zip</a></li>
</ul>
<p>Extract materials from the zipped directory (Right-click -&gt; Extract All on Windows, double-click on Mac) and move them to your desktop.</p>
<p>It will be useful when you view the above materials for you to see the different file extensions on your computer. Here are instructions for enabling this:</p>
<ul>
<li><a href="https://support.apple.com/guide/mac-help/show-or-hide-filename-extensions-on-mac-mchlp2304/mac">Mac OS</a></li>
<li><a href="http://kb.winzip.com/kb/entry/26/">Windows OS</a></li>
</ul>
</div>
<div id="software-2" class="section level2">
<h2>Software</h2>
<p>It is important that you have the <strong>latest numeric version</strong> of Stata installed, which currently is:</p>
<ul>
<li>Stata version <strong>16.1</strong></li>
</ul>
<p>It does not matter whether you use Stata version MP, SE, or IC in this workshop, since we will not be performing computational intensive analyses.</p>
<p><strong>If you are affiliated with Harvard FAS:</strong></p>
<p>You have access to the licensed Stata MP program. Go to the software download page: <a href="https://downloads.fas.harvard.edu/download" class="uri">https://downloads.fas.harvard.edu/download</a>, log in using your Harvard key and download Stata MP.</p>
<p><strong>If you are affiliated with other Harvard schools or MIT:</strong></p>
<ul>
<li>First check with your school or department whether they provide you free access to Stata MP, SE, or IC.</li>
<li>If not, you can download the program directly from Stata Corporation with a single user annual license fee starting at $94 for Stata/IC for students or $125 for Stata/IC for education. Stata Corp.’s website is <a href="https://www.stata.com/" class="uri">https://www.stata.com/</a>.</li>
</ul>
<div class="alert alert-success">
<p>After you successfully installed Stata, you should be able to open the program and see the following start page (note that the Stata version reported may be newer):</p>
</div>
<p><img src="Stata/StataInstall/images/Stata_start_panel.png" /></p>
<div class="alert alert-danger">
<p><strong>If you are having any difficulties with the installation or your Stata screen does not look like this one, please contact your Stata vendor for technical support prior to the start of the workshop.</strong></p>
</div>
</div>
<div id="resources-9" class="section level2">
<h2>Resources</h2>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
</ul>

</div>
</div>
<div id="stata-introduction" class="section level1">
<h1>Stata Introduction</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Stata interface and Do-files</li>
<li>Reading and writing data</li>
<li>Basic summary statistics</li>
<li>Basic graphs</li>
<li>Basic data management</li>
<li>Bivariate analyses</li>
</ul>
<div id="setup-6" class="section level2">
<h2>Setup</h2>
<div id="class-structure-and-organization" class="section level3">
<h3>Class Structure and organization</h3>
<ul>
<li>Informal — Ask questions at any time. Really!</li>
<li>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</li>
<li>If you are using a laptop, you will need to adjust file paths accordingly</li>
<li>Make comments in your Do-file - save on flash drive or email to yourself</li>
</ul>
</div>
<div id="prerequisites-6" class="section level3">
<h3>Prerequisites</h3>
<p>This is an introductory Stata course:</p>
<ul>
<li>Assumes no prior knowledge of <strong>how to use</strong> Stata</li>
<li>We do assume you know <strong>why</strong> you want to learn Stata. If you don’t, and want a comparison of Stata to other statistical software, see our <a href="./DataScienceTools.html">Data Science Tools</a> workshop</li>
<li>Relatively slow-paced</li>
</ul>
</div>
<div id="goals-5" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the Stata language by analyzing data from the general social survey (gss).
In particular, our goals are to:</p>
<ol style="list-style-type: decimal">
<li>Familiarize yourself with the Stata interface</li>
<li>Get data in and out of Stata</li>
<li>Compute statistics and construct graphical displays</li>
<li>Compute new variables and transformations</li>
<li>Perform univariate and bivariate data analyses</li>
</ol>
</div>
</div>
</div>
<div id="stata-basics" class="section level2">
<h2>Stata basics</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn the basics about Stata, how to interact with Stata, and how to read in and save data.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>What is Stata, why use Stata, and advantages of using Stata</li>
<li>Three ways of interacing with Stata</li>
<li>Set the working directory</li>
<li>Read, save, and write data</li>
</ol>
</div>
<div id="what-is-stata" class="section level3">
<h3>What is Stata?</h3>
<ul>
<li>Stata is a statistical software package that you can use to perform data analysis and management, as well as create graphics</li>
<li>Stata is commonly used among health, sociology, and economics researchers, particularly those working with large data sets</li>
</ul>
</div>
<div id="why-use-stata" class="section level3">
<h3>Why use Stata?</h3>
<ul>
<li>It is easy to learn and is supported by a wide range of introductory textbooks</li>
<li>It offers a wide range of statistical models in a consistent interface</li>
<li>It presents results in a clear format</li>
<li>It has very good built-in help documentation and a broad user community where you can seek help</li>
<li>Student and other discount packages are available at reasonable cost</li>
</ul>
</div>
<div id="how-does-stata-work" class="section level3">
<h3>How does Stata work?</h3>
<p>When Stata is running, variables, data, etc., are <strong>stored in memory</strong>.
The user can use <code>clear</code> command to clear up memory before running further commands,
unless they want to <code>save</code> their changes in the original dataset or a new dataset.</p>
</div>
<div id="interfaces-2" class="section level3">
<h3>Interfaces</h3>
<p><img src="Stata/StataIntro/images/StataInterface.png" /></p>
<ul>
<li>Review and Variable windows can be closed (user preference)</li>
<li>Command window can be shortened (recommended)</li>
</ul>
<div id="gui-and-command-window" class="section level4">
<h4>GUI and command window</h4>
<p>There are two ways of interacting with Stata that will not result in a saveable record of what you have done:</p>
<ol style="list-style-type: decimal">
<li><p><strong>GUI</strong>. The Graphical User Interface (GUI) allows you to perform analyses using drop-down menus, rather than writing code. This can be easier for first time users and Stata will helpfully display the command and proper syntax for the operation that you have selected. However, we strongly recommend not using the GUI, since it does not produce a script — a record of what you have done — and thus leads to analyses that are unreproducible.</p></li>
<li><p><strong>Command window</strong>. From the command window you can type commands to manage and analyze your data.</p>
<ul>
<li>The advantage is that you can quickly produce output of a single command.</li>
<li>The disadvantage is that you cannot store your syntax in a script to reproduce in the future.</li>
</ul></li>
</ol>
</div>
<div id="do-file" class="section level4">
<h4>Do-file</h4>
<p>The third way of interacting with Stata does provide you with a saveable record of your work:</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Do-file</strong>. A do-file is a plain text file within which you can write and save commands for later use. There are several advantages to using a do-file and we strongly recommend that you always interact with Stata in this way:
<ul>
<li>Allows you to submit more than one command to Stata at once.</li>
<li>Has specialized features for programmers such as syntax highlighting, code folding, autocompletion, and bookmarks to important lines in your code, brace matching, and more.</li>
<li>With a do-file, it is easy to <strong>save, review, change, and share</strong> your code with others — including your future self!</li>
</ul></li>
</ol>
<p>Here are some resources for learning more about Stata and do-files:</p>
<ul>
<li><a href="https://www.stata.com/" class="uri">https://www.stata.com/</a></li>
<li><a href="https://www.stata.com/manuals13/gsw13.pdf" class="uri">https://www.stata.com/manuals13/gsw13.pdf</a></li>
<li><a href="https://sociology.fas.harvard.edu/files/sociology/files/creating_a_do_file.pdf" class="uri">https://sociology.fas.harvard.edu/files/sociology/files/creating_a_do_file.pdf</a></li>
</ul>
</div>
</div>
<div id="stata-help" class="section level3">
<h3>Stata help</h3>
<p>To get help in Stata type <code>help</code> followed by topic or command, e.g., <code>help codebook</code>.</p>
</div>
<div id="syntax-rules-2" class="section level3">
<h3>Syntax rules</h3>
<ul>
<li><p>Most Stata commands follow the same basic syntax: <code>Command varlist, options</code>.</p></li>
<li><p>Use comments liberally — start with a comment describing your do-file and use comments throughout</p>
<ul>
<li>Use <code>*</code> to comment a line and <code>//</code> for in-line comments</li>
<li>Use <code>///</code> to break varlists over multiple lines</li>
</ul></li>
</ul>
</div>
<div id="exercise-0-5" class="section level3">
<h3>Exercise 0</h3>
<p>Launch the Stata program (MP or SE, does not matter unless doing computationally intensive work)
* Open up a new do-file
* Run our first Stata code!</p>
<ol style="list-style-type: decimal">
<li>Try to get Stata to say “Hello World!”. Search <code>help display</code></li>
</ol>
<div class="sourceCode" id="cb665"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb665-1"><a href="#cb665-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Try to get Stata to break “Hello World!” over two lines:</li>
</ol>
<div class="sourceCode" id="cb666"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb666-1"><a href="#cb666-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb667"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb667-1"><a href="#cb667-1"></a>disp <span class="st">&quot;Hello &quot;</span> <span class="st">&quot;World!&quot;</span> <span class="co">// &#39;disp&#39; is short for &#39;display&#39;</span></span>
<span id="cb667-2"><a href="#cb667-2"></a></span>
<span id="cb667-3"><a href="#cb667-3"></a>disp <span class="st">&quot;Hello&quot;</span> <span class="co">///</span></span>
<span id="cb667-4"><a href="#cb667-4"></a>     <span class="st">&quot; World!&quot;</span></span></code></pre></div>
</div>
</details>
</div>
<div id="working-directory" class="section level3">
<h3>Working directory</h3>
<ol style="list-style-type: decimal">
<li>print current working directory</li>
</ol>
<div class="sourceCode" id="cb668"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb668-1"><a href="#cb668-1"></a>pwd </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>change working directory</li>
</ol>
<div class="sourceCode" id="cb669"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb669-1"><a href="#cb669-1"></a>cd C:\Users\yiw640\Desktop\StataIntro\</span></code></pre></div>
<div id="a-note-about-file-path-names" class="section level4">
<h4>A note about file path names</h4>
<ul>
<li>If your file path has no spaces in the name (that means all directories, folders, file names, etc. can have no spaces), you can write the file path as it is</li>
<li>If there are spaces, you need to put your file path name in quotes</li>
<li>Best to get in the habit of quoting file paths</li>
</ul>
</div>
</div>
<div id="reading-data-2" class="section level3">
<h3>Reading data</h3>
<div id="data-file-commands" class="section level4">
<h4>Data file commands</h4>
<ul>
<li>Next, we want to open our data file</li>
<li>Open / save data sets with <code>use</code> and <code>save</code>:</li>
</ul>
<div class="sourceCode" id="cb670"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb670-1"><a href="#cb670-1"></a><span class="co">// open the gss.dta data set </span></span>
<span id="cb670-2"><a href="#cb670-2"></a><span class="kw">use</span> gss.dta, <span class="kw">clear</span></span>
<span id="cb670-3"><a href="#cb670-3"></a></span>
<span id="cb670-4"><a href="#cb670-4"></a><span class="co">// save data file</span></span>
<span id="cb670-5"><a href="#cb670-5"></a><span class="kw">save</span> newgss.dta, <span class="kw">replace</span> <span class="co">// `replace` option means OK to overwrite existing file</span></span></code></pre></div>
</div>
<div id="wheres-my-data" class="section level4">
<h4>Where’s my data?</h4>
<ul>
<li>Data editor (<strong>browse</strong>)</li>
<li>Data editor (<strong>edit</strong>)
<ul>
<li>Using the data editor is discouraged (why?)</li>
</ul></li>
<li>Always keep any changes to your data in your do-file</li>
<li>Avoid temptation of making manual changes by viewing data via the browser rather than editor</li>
</ul>
</div>
<div id="reading-non-stata-data" class="section level4">
<h4>Reading non-Stata data</h4>
<ul>
<li>Import / export delimited text files</li>
</ul>
<div class="sourceCode" id="cb671"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb671-1"><a href="#cb671-1"></a><span class="co">// import data from a .csv file</span></span>
<span id="cb671-2"><a href="#cb671-2"></a>import delimited gss.csv, <span class="kw">clear</span></span>
<span id="cb671-3"><a href="#cb671-3"></a></span>
<span id="cb671-4"><a href="#cb671-4"></a><span class="co">// save data to a .csv file</span></span>
<span id="cb671-5"><a href="#cb671-5"></a><span class="kw">export</span> delimited gss_new.csv, <span class="kw">replace</span></span></code></pre></div>
<ul>
<li>Import / export Excel files</li>
</ul>
<div class="sourceCode" id="cb672"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb672-1"><a href="#cb672-1"></a><span class="co">// import/export Excel files</span></span>
<span id="cb672-2"><a href="#cb672-2"></a><span class="kw">clear</span></span>
<span id="cb672-3"><a href="#cb672-3"></a>import excel gss.xlsx</span>
<span id="cb672-4"><a href="#cb672-4"></a><span class="kw">export</span> excel gss_new, <span class="kw">replace</span></span></code></pre></div>
<p>What if my data is from another statistical software program?</p>
<ul>
<li>SPSS/PASW will allow you to save your data as a Stata file
<ul>
<li>Go to: file -&gt; save as -&gt; Stata (use most recent version available)</li>
<li>Then you can just go into Stata and open it</li>
</ul></li>
<li>Another option is <code>StatTransfer</code>, a program that converts data from/to many common formats, including SAS, SPSS, Stata, and many more.</li>
</ul>
</div>
</div>
</div>
<div id="statistics-graphs" class="section level2">
<h2>Statistics &amp; graphs</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn the basic commands to review, inspect, and plot data in Stata.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Learn more about the variables in our dataset — using the <code>describe</code>, <code>codebook</code>, and <code>browse</code> commands</li>
<li>Produce univariate distributions using <code>histogram</code>, and bivariate distribution using <code>scatterplot</code></li>
<li>Tabulate or summarize your data within certain groups using <code>bysort</code></li>
</ol>
</div>
<p>The most frequently used commands for reviewing and inspecting data are summarized below:</p>
<table>
<thead>
<tr class="header">
<th align="left">Command</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>describe</code></td>
<td align="left">labels, storage type etc.</td>
</tr>
<tr class="even">
<td align="left"><code>sum</code></td>
<td align="left">statistical summary (mean, sd, min/max etc.)</td>
</tr>
<tr class="odd">
<td align="left"><code>codebook</code></td>
<td align="left">storage type, unique values, labels</td>
</tr>
<tr class="even">
<td align="left"><code>list</code></td>
<td align="left">print actual values</td>
</tr>
<tr class="odd">
<td align="left"><code>tab</code></td>
<td align="left">(cross) tabulate variables</td>
</tr>
<tr class="even">
<td align="left"><code>browse</code></td>
<td align="left">view the data in a spreadsheet-like window</td>
</tr>
</tbody>
</table>
<p>First, let’s ask Stata for help about these commands:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb673-1"><a href="#cb673-1"></a><span class="kw">help</span> <span class="kw">sum</span></span></code></pre></div>
<div class="sourceCode" id="cb674"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb674-1"><a href="#cb674-1"></a><span class="kw">use</span> gss.dta, <span class="kw">clear</span></span>
<span id="cb674-2"><a href="#cb674-2"></a></span>
<span id="cb674-3"><a href="#cb674-3"></a><span class="kw">sum</span> educ <span class="co">// statistical summary of education</span></span></code></pre></div>
<div class="sourceCode" id="cb675"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb675-1"><a href="#cb675-1"></a><span class="kw">codebook</span> region <span class="co">// information about how region is coded</span></span></code></pre></div>
<div class="sourceCode" id="cb676"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb676-1"><a href="#cb676-1"></a><span class="kw">tab</span> sex <span class="co">// numbers of male and female participants</span></span></code></pre></div>
<p>Note — if you run these commands without specifying variables, Stata will produce output for every variable</p>
<div id="basic-graphing-commands" class="section level3">
<h3>Basic graphing commands</h3>
<p>Univariate distribution(s) using <code>hist</code>:</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb677-1"><a href="#cb677-1"></a><span class="co">// Histograms </span></span>
<span id="cb677-2"><a href="#cb677-2"></a><span class="kw">hist</span> educ</span></code></pre></div>
<div class="sourceCode" id="cb678"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb678-1"><a href="#cb678-1"></a><span class="co">// histogram with normal curve; see `help hist` for other options</span></span>
<span id="cb678-2"><a href="#cb678-2"></a><span class="kw">hist</span> age, <span class="fu">normal</span>  </span></code></pre></div>
<p>View bivariate distributions with scatterplots:</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb679-1"><a href="#cb679-1"></a><span class="co">// scatterplots </span></span>
<span id="cb679-2"><a href="#cb679-2"></a><span class="kw">twoway</span> (<span class="kw">scatter</span> educ age)</span></code></pre></div>
<div class="sourceCode" id="cb680"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb680-1"><a href="#cb680-1"></a><span class="kw">graph</span> <span class="fu">matrix</span> educ age inc</span></code></pre></div>
</div>
<div id="the-by-command" class="section level3">
<h3>The <code>by</code> command</h3>
<p>Sometimes, you’d like to generate output based on different categories of a grouping variable, for example:</p>
<ol style="list-style-type: decimal">
<li>you want to know the distribution of happiness seperately for men and women: tabulate <code>happy</code> by <code>sex</code>:</li>
</ol>
<div class="sourceCode" id="cb681"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb681-1"><a href="#cb681-1"></a><span class="kw">bysort</span> sex: <span class="kw">tab</span> happy</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>you want to know the mean level of education for different marital status: summarize <code>education</code> by marital status (<code>marital</code>):</li>
</ol>
<div class="sourceCode" id="cb682"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb682-1"><a href="#cb682-1"></a><span class="kw">bysort</span> marital: <span class="kw">sum</span> educ </span></code></pre></div>
<p>Save your changes to the original <code>gss.dta</code> dataset.</p>
</div>
<div id="exercise-1-6" class="section level3">
<h3>Exercise 1</h3>
<p>We are using The Generations of Talent Study (<code>talent.dta</code>) to practice reading in data, plotting data, and calculating descriptive statistics. The dataset includes information on quality of employment as experienced by today’s multigenerational workforces. Here is a codebook of a subset of variables:</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Variable name</th>
<th align="left">Label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">job</td>
<td align="left">type of main job</td>
</tr>
<tr class="even">
<td align="left">workload</td>
<td align="left">how long hours do you work per week</td>
</tr>
<tr class="odd">
<td align="left">otherjob</td>
<td align="left">do you have other paid jobs beside main job</td>
</tr>
<tr class="even">
<td align="left">schedule</td>
<td align="left">which best describes your work schedule</td>
</tr>
<tr class="odd">
<td align="left">fulltime</td>
<td align="left">Does your employer consider you a full-time or part-time employee</td>
</tr>
<tr class="even">
<td align="left">B3A</td>
<td align="left">How important are the following to you? Your work</td>
</tr>
<tr class="odd">
<td align="left">B3B</td>
<td align="left">How important are the following to you? Your family</td>
</tr>
<tr class="even">
<td align="left">B3C</td>
<td align="left">How important are the following to you? Your friends</td>
</tr>
<tr class="odd">
<td align="left">marital</td>
<td align="left">Which of the following best describes your current marital status</td>
</tr>
<tr class="even">
<td align="left">I3</td>
<td align="left">Sex/gender</td>
</tr>
<tr class="odd">
<td align="left">income</td>
<td align="left">What was your total household income during last year</td>
</tr>
</tbody>
</table>
<p>Create a new do-file for the following exercise prompts. After the exercise save the do-file to your working directory.</p>
<ol style="list-style-type: decimal">
<li>Read in the dataset <code>talent.dta</code>:</li>
</ol>
<div class="sourceCode" id="cb683"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb683-1"><a href="#cb683-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Examine a few selected variables using the <code>describe</code>, <code>sum</code> and <code>codebook</code> commands:</li>
</ol>
<div class="sourceCode" id="cb684"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb684-1"><a href="#cb684-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Produce a histogram of hours worked (<code>workload</code>) and add a normal curve:</li>
</ol>
<div class="sourceCode" id="cb685"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb685-1"><a href="#cb685-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarize the total household income last year (<code>income</code>) by marital status (<code>marital</code>):</li>
</ol>
<div class="sourceCode" id="cb686"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb686-1"><a href="#cb686-1"></a>##</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Cross-tabulate marital status (<code>marital</code>) with respondents’ type of main job (<code>job</code>):</li>
</ol>
<div class="sourceCode" id="cb687"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb687-1"><a href="#cb687-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb688"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb688-1"><a href="#cb688-1"></a><span class="kw">use</span> talent.dta, <span class="kw">clear</span></span>
<span id="cb688-2"><a href="#cb688-2"></a><span class="kw">describe</span> workperweek</span>
<span id="cb688-3"><a href="#cb688-3"></a><span class="kw">tab</span> I3</span>
<span id="cb688-4"><a href="#cb688-4"></a><span class="kw">sum</span> income</span>
<span id="cb688-5"><a href="#cb688-5"></a><span class="kw">codebook</span> job</span>
<span id="cb688-6"><a href="#cb688-6"></a></span>
<span id="cb688-7"><a href="#cb688-7"></a><span class="kw">hist</span> workload, <span class="fu">normal</span> </span>
<span id="cb688-8"><a href="#cb688-8"></a></span>
<span id="cb688-9"><a href="#cb688-9"></a><span class="kw">bysort</span> marital: <span class="kw">sum</span> income</span>
<span id="cb688-10"><a href="#cb688-10"></a><span class="kw">bysort</span> job: <span class="kw">tab</span> marital </span>
<span id="cb688-11"><a href="#cb688-11"></a><span class="kw">summarize</span> income <span class="kw">if</span> marital == 1</span>
<span id="cb688-12"><a href="#cb688-12"></a></span>
<span id="cb688-13"><a href="#cb688-13"></a><span class="kw">save</span> talent.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="basic-data-management" class="section level2">
<h2>Basic data management</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to add <em>variable labels</em> and <em>value labels</em>, as well as create <em>new variables</em> in Stata.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Use <code>label</code> and <code>rename</code> to set / modify variable and value labels</li>
<li>Use <code>generate</code> and <code>replace</code> to create a new variables based on values of existing variables/recode a variable</li>
</ol>
</div>
<div id="variable-value-labels" class="section level3">
<h3>Variable &amp; value labels</h3>
<div id="variable-labels" class="section level4">
<h4>Variable labels</h4>
<p>It’s good practice to ALWAYS label every variable, no matter how insignificant it may seem.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb689-1"><a href="#cb689-1"></a><span class="co">// Labelling and renaming </span></span>
<span id="cb689-2"><a href="#cb689-2"></a><span class="co">// Label variable inc &quot;household income&quot;</span></span>
<span id="cb689-3"><a href="#cb689-3"></a><span class="kw">label</span> <span class="kw">var</span> inc <span class="st">&quot;household income&quot;</span></span>
<span id="cb689-4"><a href="#cb689-4"></a></span>
<span id="cb689-5"><a href="#cb689-5"></a><span class="co">// change the name &quot;educ&quot; to &quot;education&quot;</span></span>
<span id="cb689-6"><a href="#cb689-6"></a><span class="kw">rename</span> educ education</span>
<span id="cb689-7"><a href="#cb689-7"></a></span>
<span id="cb689-8"><a href="#cb689-8"></a><span class="co">// you can search names and labels with `lookfor`</span></span>
<span id="cb689-9"><a href="#cb689-9"></a><span class="kw">lookfor</span> household</span></code></pre></div>
</div>
<div id="value-labels" class="section level4">
<h4>Value labels</h4>
<p>Value labels are a little more complicated, with a two step process: define a value label, then assign defined label to variable(s)</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb690-1"><a href="#cb690-1"></a><span class="co">// define a value label for sex </span></span>
<span id="cb690-2"><a href="#cb690-2"></a><span class="kw">label</span> <span class="kw">define</span> mySexLabel 1 <span class="st">&quot;Male&quot;</span> 2 <span class="st">&quot;Female&quot;</span></span>
<span id="cb690-3"><a href="#cb690-3"></a></span>
<span id="cb690-4"><a href="#cb690-4"></a><span class="co">// assign our label set to the sex variable</span></span>
<span id="cb690-5"><a href="#cb690-5"></a><span class="kw">label</span> <span class="kw">values</span> sex mySexLabel</span></code></pre></div>
</div>
</div>
<div id="working-on-subsets" class="section level3">
<h3>Working on subsets</h3>
<p>It is often useful to select just those rows of your data where some condition holds — for example select only rows where sex is 1 (male). The following operators allow you to do this:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">==</td>
<td align="left">equal to</td>
</tr>
<tr class="even">
<td align="left">!=</td>
<td align="left">not equal to</td>
</tr>
<tr class="odd">
<td align="left">&gt;</td>
<td align="left">greater than</td>
</tr>
<tr class="even">
<td align="left">&gt;=</td>
<td align="left">greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left">&lt;</td>
<td align="left">less than</td>
</tr>
<tr class="even">
<td align="left">&lt;=</td>
<td align="left">less than or equal to</td>
</tr>
<tr class="odd">
<td align="left">&amp;</td>
<td align="left">and</td>
</tr>
<tr class="even">
<td align="left">|</td>
<td align="left">or</td>
</tr>
</tbody>
</table>
<p>Note the double equals signs for testing equality.</p>
</div>
<div id="generating-replacing-variables" class="section level3">
<h3>Generating &amp; replacing variables</h3>
<p>Often, it can be useful to start with a new variable composed of blank values and fill values in based on the values of existing variables:</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb691-1"><a href="#cb691-1"></a><span class="co">// generate a column of missings</span></span>
<span id="cb691-2"><a href="#cb691-2"></a><span class="kw">gen</span> age_wealth = .</span>
<span id="cb691-3"><a href="#cb691-3"></a></span>
<span id="cb691-4"><a href="#cb691-4"></a><span class="co">// Next, start adding your qualifications</span></span>
<span id="cb691-5"><a href="#cb691-5"></a><span class="kw">replace</span> age_wealth=1 <span class="kw">if</span> age &lt; 30 &amp; inc &lt; 10</span>
<span id="cb691-6"><a href="#cb691-6"></a><span class="kw">replace</span> age_wealth=2 <span class="kw">if</span> age &lt; 30 &amp; inc &gt; 10</span>
<span id="cb691-7"><a href="#cb691-7"></a><span class="kw">replace</span> age_wealth=3 <span class="kw">if</span> age &gt; 30 &amp; inc &lt; 10</span>
<span id="cb691-8"><a href="#cb691-8"></a><span class="kw">replace</span> age_wealth=4 <span class="kw">if</span> age &gt; 30 &amp; inc &gt; 10</span></code></pre></div>
</div>
<div id="exercise-2-4" class="section level3">
<h3>Exercise 2</h3>
<p>Open the <code>talent.dta</code> data, use the basic data management tools we have learned to add labels and generate new variables:</p>
<ol style="list-style-type: decimal">
<li>Tabulate the variable, marital status (<code>marital</code>), with and without labels:</li>
</ol>
<div class="sourceCode" id="cb692"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb692-1"><a href="#cb692-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Summarize the total household income last year (<code>income</code>) for married individuals only:</li>
</ol>
<div class="sourceCode" id="cb693"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb693-1"><a href="#cb693-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generate a new <code>overwork</code> dummy variable from the original variable <code>workperweek</code> that will take on a value of 1 if a person works more than 40 hours per week, and 0 if a person works equal to or less than 40 hours per week:</li>
</ol>
<div class="sourceCode" id="cb694"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb694-1"><a href="#cb694-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Generate a new <code>marital_dummy</code> dummy variable from the original variable <code>marital</code> that will take on a value of 1 if a person is either married or partnered and 0 otherwise:</li>
</ol>
<div class="sourceCode" id="cb695"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb695-1"><a href="#cb695-1"></a>##</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Rename the <code>Sex</code> variable and give it a more intuitive name:</li>
</ol>
<div class="sourceCode" id="cb696"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb696-1"><a href="#cb696-1"></a>##</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Give a variable label and value labels for the variable <code>overwork</code>:</li>
</ol>
<div class="sourceCode" id="cb697"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb697-1"><a href="#cb697-1"></a>##</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Generate a new variable called <code>work_family</code> and code it as 2 if a respondent perceived work to be more important than family, 1 if a respondent perceived family to be more important than work, and 0 if the two are of equal importance:</li>
</ol>
<div class="sourceCode" id="cb698"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb698-1"><a href="#cb698-1"></a>##</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Save the changes to <code>newtalent.dta</code></li>
</ol>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb699"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb699-1"><a href="#cb699-1"></a><span class="kw">use</span> talent.dta, <span class="kw">clear</span></span>
<span id="cb699-2"><a href="#cb699-2"></a></span>
<span id="cb699-3"><a href="#cb699-3"></a><span class="kw">tab</span> marital</span>
<span id="cb699-4"><a href="#cb699-4"></a><span class="kw">tab</span> marital, nol </span>
<span id="cb699-5"><a href="#cb699-5"></a></span>
<span id="cb699-6"><a href="#cb699-6"></a><span class="kw">gen</span> overwork = .</span>
<span id="cb699-7"><a href="#cb699-7"></a><span class="kw">replace</span> overwork = 1 <span class="kw">if</span> workperweek &gt; 40</span>
<span id="cb699-8"><a href="#cb699-8"></a><span class="kw">replace</span> overwork = 0 <span class="kw">if</span> workperweek &lt;= 40</span>
<span id="cb699-9"><a href="#cb699-9"></a><span class="kw">tab</span> overwork</span>
<span id="cb699-10"><a href="#cb699-10"></a></span>
<span id="cb699-11"><a href="#cb699-11"></a><span class="kw">gen</span> marital_dummy = .</span>
<span id="cb699-12"><a href="#cb699-12"></a><span class="kw">replace</span> marital_dummy = 1 <span class="kw">if</span> marital == 1 | marital == 2</span>
<span id="cb699-13"><a href="#cb699-13"></a><span class="kw">replace</span> marital_dummy = 0 <span class="kw">if</span> marital != 1 &amp; marital != 2</span>
<span id="cb699-14"><a href="#cb699-14"></a><span class="kw">tab</span> marital_dummy</span>
<span id="cb699-15"><a href="#cb699-15"></a></span>
<span id="cb699-16"><a href="#cb699-16"></a><span class="kw">rename</span> I3 Sex</span>
<span id="cb699-17"><a href="#cb699-17"></a></span>
<span id="cb699-18"><a href="#cb699-18"></a><span class="kw">label</span> <span class="kw">variable</span> overwork <span class="st">&quot;whether someone works more than 40 hours per week&quot;</span></span>
<span id="cb699-19"><a href="#cb699-19"></a><span class="kw">label</span> <span class="kw">define</span> overworklabel 1 <span class="st">&quot;Yes&quot;</span> 0 <span class="st">&quot;No&quot;</span></span>
<span id="cb699-20"><a href="#cb699-20"></a><span class="kw">label</span> <span class="kw">values</span> overwork overworklabel</span>
<span id="cb699-21"><a href="#cb699-21"></a></span>
<span id="cb699-22"><a href="#cb699-22"></a><span class="kw">gen</span> work_family = .</span>
<span id="cb699-23"><a href="#cb699-23"></a><span class="kw">replace</span> work_family = 2 <span class="kw">if</span> B3A &gt; B3B</span>
<span id="cb699-24"><a href="#cb699-24"></a><span class="kw">replace</span> work_family = 1 <span class="kw">if</span> B3A &lt; B3B</span>
<span id="cb699-25"><a href="#cb699-25"></a><span class="kw">replace</span> work_family = 0 <span class="kw">if</span> B3A == B3B</span>
<span id="cb699-26"><a href="#cb699-26"></a></span>
<span id="cb699-27"><a href="#cb699-27"></a><span class="kw">save</span> newtalent.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="bivariate-analyses" class="section level2">
<h2>Bivariate analyses</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn the basic commands for performing the following bivariate analyses.</strong></p>
<ol style="list-style-type: decimal">
<li>Chi-squared test</li>
<li>Independent group t-test</li>
<li>One-way ANOVA</li>
</ol>
</div>
<div id="chi-squared-test" class="section level3">
<h3>Chi-squared test</h3>
<p>The Chi-squared statistic is commonly used for testing relationships between categorical variables.</p>
<p>In Stata, both the <code>tabulate</code> and <code>tabi</code> commands conduct the Pearson’s Chi-square test.</p>
<ul>
<li>The <code>tabulate</code> (may be abbreviated as <code>tab</code>) command produces one- or two-way frequency tables given one or two raw variables</li>
<li>The <code>tabi</code> command is used to re-analyze a published table without access to the raw data</li>
<li>These commands also can run a Chi-square test using the <code>chi2</code> option:</li>
</ul>
<div class="sourceCode" id="cb700"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb700-1"><a href="#cb700-1"></a><span class="kw">tab</span> sex happy, <span class="fu">chi2</span> </span></code></pre></div>
<p>The first command below conducts a Chi-square test for a 2x2 table, while the second and third commands run the test for 3x2 and 2x3 tables, respectively.</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb701-1"><a href="#cb701-1"></a><span class="kw">tabi</span> 33 48 \ 37 52, <span class="fu">chi2</span></span>
<span id="cb701-2"><a href="#cb701-2"></a><span class="kw">tabi</span> 33 48 \ 37 52 \ 36 42, <span class="fu">chi2</span></span>
<span id="cb701-3"><a href="#cb701-3"></a><span class="kw">tabi</span> 33 48 26 \ 37 52 38, <span class="fu">chi2</span></span></code></pre></div>
</div>
<div id="t-test" class="section level3">
<h3>t-test</h3>
<p>The t-test is a type of inferential statistic that can be used to determine if a sample mean differs from a postulated population mean, or if two sample means came from the same population.</p>
<p>Types of t-test:</p>
<ul>
<li>Independent group t-test: designed to compare means of same variable between two groups. For example, test GRE scores between students from two countries</li>
<li>Other t-tests: single sample t-test; paired t-test. More details see: <a href="https://www.stata.com/manuals13/rttest.pdf" class="uri">https://www.stata.com/manuals13/rttest.pdf</a></li>
</ul>
<p>In our example, we conduct an independent group t-test to compare mean income (<code>inc</code>) between males and females (<code>sex</code>):</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb702-1"><a href="#cb702-1"></a><span class="kw">ttest</span> inc, <span class="kw">by</span>(sex)</span></code></pre></div>
</div>
<div id="one-way-anova" class="section level3">
<h3>One-way ANOVA</h3>
<p>One-way ANOVA allows us to test the equality of more than two sample means (i.e., whether they could plausibly have come from the same population). For example, our dataset contains income (<code>inc</code>) and four regions of the country (<code>region</code>). Using one-way ANOVA, we can simultaneously test the equality of the income means across all regions.</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb703-1"><a href="#cb703-1"></a><span class="kw">oneway</span> inc region </span></code></pre></div>
<p>Now we find evidence that the means are different, but perhaps we are interested only in testing whether the means for the North (region==1) and South (region==4) are different. We also use one-way ANOVA, which in this case would be equivelant to the independent group t-test:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb704-1"><a href="#cb704-1"></a><span class="kw">oneway</span> inc region <span class="kw">if</span> region==1 | region==4</span></code></pre></div>
</div>
<div id="exercise-3-4" class="section level3">
<h3>Exercise 3</h3>
<p>Open the <code>newtalent.dta</code> data, use the basic data management tools we have learned to conduct bivariate analysis.</p>
<ol style="list-style-type: decimal">
<li>Test the relationship between two variables <code>sex</code> and type of main job (<code>job</code>):</li>
</ol>
<div class="sourceCode" id="cb705"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb705-1"><a href="#cb705-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Test if there is a significant difference in hours worked per week (<code>workload</code>) and <code>sex</code>:</li>
</ol>
<div class="sourceCode" id="cb706"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb706-1"><a href="#cb706-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Test if there is a significant difference in hours worked per week (<code>workload</code>) and marital status (<code>marital</code>):</li>
</ol>
<div class="sourceCode" id="cb707"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb707-1"><a href="#cb707-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb708"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb708-1"><a href="#cb708-1"></a><span class="kw">use</span> newtalent.dta, <span class="kw">clear</span> </span>
<span id="cb708-2"><a href="#cb708-2"></a></span>
<span id="cb708-3"><a href="#cb708-3"></a><span class="kw">tab</span> Sex job, <span class="fu">chi2</span> </span>
<span id="cb708-4"><a href="#cb708-4"></a></span>
<span id="cb708-5"><a href="#cb708-5"></a><span class="kw">ttest</span> workload, <span class="kw">by</span>(Sex)</span>
<span id="cb708-6"><a href="#cb708-6"></a><span class="kw">oneway</span> workload marital </span>
<span id="cb708-7"><a href="#cb708-7"></a></span>
<span id="cb708-8"><a href="#cb708-8"></a><span class="kw">save</span> newtalent.dta, <span class="kw">replace</span> </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="wrap-up-7" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-7" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-10" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Stata
<ul>
<li>UCLA website: <a href="http://www.ats.ucla.edu/stat/Stata/" class="uri">http://www.ats.ucla.edu/stat/Stata/</a></li>
<li>Stata website: <a href="http://www.stata.com/help.cgi?contents" class="uri">http://www.stata.com/help.cgi?contents</a></li>
<li>Email list: <a href="http://www.stata.com/statalist/" class="uri">http://www.stata.com/statalist/</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="stata-data-management" class="section level1">
<h1>Stata Data Management</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Generating and replacing variables</li>
<li>Missing values</li>
<li>Variable types and conversion</li>
<li>Merging, appending, and joining</li>
<li>Creating summarized data sets</li>
</ul>
<div id="setup-7" class="section level2">
<h2>Setup</h2>
<div id="class-structure-and-organization-1" class="section level3">
<h3>Class structure and organization</h3>
<ul>
<li>Please feel free to ask questions at any point if they are relevant to the current topic (or if you are lost!)</li>
<li>Collaboration is encouraged - please introduce yourself to your neighbors!</li>
<li>If you are using a laptop, you will need to adjust file paths accordingly</li>
<li>Make comments in your do-file - save on flash drive or email to yourself</li>
</ul>
</div>
<div id="prerequisites-7" class="section level3">
<h3>Prerequisites</h3>
<ul>
<li>This is an introduction to data management in Stata</li>
<li>Assumes basic knowledge of Stata</li>
<li>Not appropriate for people already familiar with Stata</li>
<li>If you are catching on before the rest of the class, experiment with command features described in help files</li>
</ul>
</div>
<div id="goals-6" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p>We will learn about the Stata language by analyzing data from the general social survey (gss). In particular, our goals are to learn:</p>
<ol style="list-style-type: decimal">
<li>Basic data manipulation commands</li>
<li>Dealing with missing values</li>
<li>Variable types and conversion</li>
<li>Merging and appending datasets</li>
</ol>
</div>
</div>
</div>
<div id="opening-files" class="section level2">
<h2>Opening Files</h2>
<div class="alert alert-info">
<p><strong>GOAL: To understand the working directory of Stata, how to change working directory, and open files from the working directory.</strong> In particular:</p>
</div>
<p>Look at bottom left hand corner of Stata screen, this is the directory Stata is currently reading from. Files are located in the <code>StataDatMan</code> folder in your user directory. Let’s start by telling Stata where to look for these:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb709-1"><a href="#cb709-1"></a><span class="co">// change directory</span></span>
<span id="cb709-2"><a href="#cb709-2"></a>cd <span class="st">&quot;~/Desktop/dss-workshops/Stata/StataDatMan&quot;</span></span>
<span id="cb709-3"><a href="#cb709-3"></a></span>
<span id="cb709-4"><a href="#cb709-4"></a><span class="co">// Use dir to see what is in the directory:</span></span>
<span id="cb709-5"><a href="#cb709-5"></a><span class="ot">dir</span></span>
<span id="cb709-6"><a href="#cb709-6"></a><span class="ot">dir</span> dataSets</span></code></pre></div>
<p>Now we can read in the <code>gss.dta</code> dataset:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb710-1"><a href="#cb710-1"></a><span class="kw">use</span> dataSets/gss.dta</span></code></pre></div>
</div>
<div id="generating-replacing-variables-1" class="section level2">
<h2>Generating &amp; replacing variables</h2>
<div class="alert alert-info">
<p><strong>GOAL: You’ll learn how to generate new variables or recode existing variables.</strong> In particular, we will learn to use:</p>
<ol style="list-style-type: decimal">
<li><code>generate</code> (<code>gen</code>) to create new variables</li>
<li><code>egenerate</code> (<code>egen</code>) to create new variables using more complicated calculations than <code>gen</code> allows</li>
<li><code>replace</code> to replace existing variables</li>
<li><code>recode</code> to change existing categorical variables</li>
</ol>
</div>
<div id="generate-replace" class="section level3">
<h3>Generate &amp; Replace</h3>
<p>The <code>generate</code> command creates a new variables. Often, this is used in combination with the <code>replace</code> command and logic statements to create a new variable. Available logical operators include the following:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">==</td>
<td align="left">equal to</td>
</tr>
<tr class="even">
<td align="left">!=</td>
<td align="left">not equal to</td>
</tr>
<tr class="odd">
<td align="left">&gt;</td>
<td align="left">greater than</td>
</tr>
<tr class="even">
<td align="left">&gt;=</td>
<td align="left">greater than or equal to</td>
</tr>
<tr class="odd">
<td align="left">&lt;</td>
<td align="left">less than</td>
</tr>
<tr class="even">
<td align="left">&lt;=</td>
<td align="left">less than or equal to</td>
</tr>
<tr class="odd">
<td align="left">&amp;</td>
<td align="left">and</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb711-1"><a href="#cb711-1"></a><span class="co">//create &quot;hapnew&quot; variable</span></span>
<span id="cb711-2"><a href="#cb711-2"></a><span class="kw">gen</span> hapnew = .</span>
<span id="cb711-3"><a href="#cb711-3"></a><span class="co">//set to 0 if happy equals 1</span></span>
<span id="cb711-4"><a href="#cb711-4"></a><span class="kw">replace</span> hapnew=0 <span class="kw">if</span> happy==1 </span>
<span id="cb711-5"><a href="#cb711-5"></a><span class="co">//set to 1 if happy both and hapmar are greater than 3</span></span>
<span id="cb711-6"><a href="#cb711-6"></a><span class="kw">replace</span> hapnew=1 <span class="kw">if</span> happy&gt;3 &amp; hapmar&gt;3 </span>
<span id="cb711-7"><a href="#cb711-7"></a><span class="co">// tabulate the new </span></span>
<span id="cb711-8"><a href="#cb711-8"></a><span class="kw">tab</span> hapnew</span></code></pre></div>
</div>
<div id="recode" class="section level3">
<h3>Recode</h3>
<p>The <code>recode</code> command is basically <code>generate</code> and <code>replace</code> combined. You can <code>recode</code> an existing variable OR use <code>recode</code> to create a new variable (via the <code>gen</code> option).</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb712-1"><a href="#cb712-1"></a><span class="co">// recode the wrkstat variable </span></span>
<span id="cb712-2"><a href="#cb712-2"></a><span class="kw">recode</span> wrkstat (1=8) (2=7) (3=6) (4=5) (5=4) (6=3) (7=2) (8=1)</span>
<span id="cb712-3"><a href="#cb712-3"></a><span class="co">// recode wrkstat into a new variable named wrkstat2</span></span>
<span id="cb712-4"><a href="#cb712-4"></a><span class="kw">recode</span> wrkstat (1=8), <span class="kw">gen</span>(wrkstat2)</span>
<span id="cb712-5"><a href="#cb712-5"></a><span class="co">// tabulate workstat</span></span>
<span id="cb712-6"><a href="#cb712-6"></a><span class="kw">tab</span> wrkstat</span></code></pre></div>
<p>The table below illustrates common forms of recoding:</p>
<table>
<thead>
<tr class="header">
<th align="left">Rule</th>
<th align="left">Example</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">#=#</td>
<td align="left">3=1</td>
<td align="left">3 recoded to 1</td>
</tr>
<tr class="even">
<td align="left">##=#</td>
<td align="left">2.=9</td>
<td align="left">2 and . recoded to 9</td>
</tr>
<tr class="odd">
<td align="left">#/#=#</td>
<td align="left">1/5=4</td>
<td align="left">1 through 5 recoded to 4</td>
</tr>
<tr class="even">
<td align="left">nonmissing=#</td>
<td align="left">nonmiss=8</td>
<td align="left">nonmissing recoded to 8</td>
</tr>
<tr class="odd">
<td align="left">missing=#</td>
<td align="left">miss=9</td>
<td align="left">missing recoded to 9</td>
</tr>
</tbody>
</table>
</div>
<div id="egen" class="section level3">
<h3>egen</h3>
<p>The <code>egen</code> command (“extensions” to the <code>gen</code> command) reaches beyond simple computations (var1 + var2, log(var1), etc.) to add descriptive stats, standardizations and more. For example, we can use <code>egen</code> to create a new variable that counts the number of “yes” responses on computer, email and internet use:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb713-1"><a href="#cb713-1"></a><span class="co">// count number of yes on use comp email and net </span></span>
<span id="cb713-2"><a href="#cb713-2"></a><span class="kw">egen</span> compuser = <span class="fu">anycount</span>(usecomp usemail usenet), <span class="kw">values</span>(1)</span>
<span id="cb713-3"><a href="#cb713-3"></a><span class="kw">tab</span> compuser</span></code></pre></div>
<p>Here are some additional examples of <code>egen</code> in action:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb714-1"><a href="#cb714-1"></a><span class="co">// assess how much missing data each participant has:</span></span>
<span id="cb714-2"><a href="#cb714-2"></a><span class="kw">egen</span> countmiss = <span class="fu">rowmiss</span>(age-wifeft)</span>
<span id="cb714-3"><a href="#cb714-3"></a><span class="kw">codebook</span> countmiss</span>
<span id="cb714-4"><a href="#cb714-4"></a><span class="co">// compare values on multiple variables</span></span>
<span id="cb714-5"><a href="#cb714-5"></a><span class="kw">egen</span> ftdiff = <span class="fu">diff</span>(wkftwife wkfthusb)</span>
<span id="cb714-6"><a href="#cb714-6"></a><span class="kw">codebook</span> ftdiff</span></code></pre></div>
<p>You will need to refer to the documentation to discover what else <code>egen</code> can do: type <code>help egen</code> in Stata to get a complete list of available functions.</p>
</div>
<div id="exercise-0-6" class="section level3">
<h3>Exercise 0</h3>
<ol style="list-style-type: decimal">
<li>Open the <code>gss.dta</code> data, <code>generate</code> a new variable that represents the squared value of <code>age</code>.</li>
</ol>
<div class="sourceCode" id="cb715"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb715-1"><a href="#cb715-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>generate</code> a new variable equal to “1” if <code>income</code> is greater than “19”.</li>
</ol>
<div class="sourceCode" id="cb716"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb716-1"><a href="#cb716-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a new variable that counts the number of missing responses for each respondent. What is the maximum number of missing variables?</li>
</ol>
<div class="sourceCode" id="cb717"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb717-1"><a href="#cb717-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb718"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb718-1"><a href="#cb718-1"></a><span class="kw">use</span> dataSets/gss.dta, <span class="kw">clear</span></span>
<span id="cb718-2"><a href="#cb718-2"></a><span class="kw">gen</span> age2 = age^2</span>
<span id="cb718-3"><a href="#cb718-3"></a></span>
<span id="cb718-4"><a href="#cb718-4"></a><span class="kw">describe</span> income</span>
<span id="cb718-5"><a href="#cb718-5"></a><span class="kw">label</span> <span class="ot">list</span> income</span>
<span id="cb718-6"><a href="#cb718-6"></a><span class="kw">recode</span> income (99=.) (98=.)</span>
<span id="cb718-7"><a href="#cb718-7"></a><span class="kw">gen</span> highincome =0 <span class="kw">if</span> income != .</span>
<span id="cb718-8"><a href="#cb718-8"></a><span class="kw">replace</span> highincome=1 <span class="kw">if</span> income&gt;19</span>
<span id="cb718-9"><a href="#cb718-9"></a><span class="kw">sum</span> highincome</span>
<span id="cb718-10"><a href="#cb718-10"></a></span>
<span id="cb718-11"><a href="#cb718-11"></a><span class="kw">egen</span> nmissing = <span class="fu">rowmiss</span>(<span class="dt">_all</span>)</span>
<span id="cb718-12"><a href="#cb718-12"></a><span class="kw">sum</span> nmissing</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="missing-values" class="section level2">
<h2>Missing values</h2>
<div class="alert alert-info">
<p><strong>GOAL: Learn how missing values are coded and how to recode them.</strong></p>
</div>
<p>Stata’s symbol for a missing value is a period <code>.</code> and this value is coded and treated as <strong>positive infinity</strong> (i.e., the largest possible value), so it’s easy to make mistakes when making logical and relational comparisons!</p>
<div id="making-sure-missingness-is-preserved" class="section level3">
<h3>Making sure missingness is preserved</h3>
<p>To identify highly educated women, we might use the command:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb719-1"><a href="#cb719-1"></a><span class="co">// generate and replace without considering missing values</span></span>
<span id="cb719-2"><a href="#cb719-2"></a><span class="kw">gen</span> hi_ed=0</span>
<span id="cb719-3"><a href="#cb719-3"></a><span class="kw">replace</span> hi_ed=1 <span class="kw">if</span> wifeduc&gt;15</span>
<span id="cb719-4"><a href="#cb719-4"></a><span class="co">// What happens to our missing values?</span></span>
<span id="cb719-5"><a href="#cb719-5"></a><span class="kw">tab</span> hi_ed, <span class="fu">mi</span> nola</span></code></pre></div>
<p>It looks like around 66% have higher education, but look closer:</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb720-1"><a href="#cb720-1"></a><span class="co">// generate hi_ed2, but only set a value if wifeduc is not missing</span></span>
<span id="cb720-2"><a href="#cb720-2"></a><span class="kw">gen</span> hi_ed2 = 0 <span class="kw">if</span> wifeduc != . </span>
<span id="cb720-3"><a href="#cb720-3"></a><span class="co">// only replace non-missing values</span></span>
<span id="cb720-4"><a href="#cb720-4"></a><span class="kw">replace</span> hi_ed2=1 <span class="kw">if</span> wifeduc &gt;15 &amp; wifeduc !=. </span>
<span id="cb720-5"><a href="#cb720-5"></a><span class="co">//check to see that missingness is preserved</span></span>
<span id="cb720-6"><a href="#cb720-6"></a><span class="kw">tab</span> hi_ed2, <span class="fu">mi</span></span></code></pre></div>
<p>The correct value is 10%. Moral of the story? Be careful with missing values and remember that Stata considers missing values to be <strong>positive infinity</strong>!</p>
</div>
<div id="bulk-conversion-to-missing-values" class="section level3">
<h3>Bulk Conversion to missing values</h3>
<p>Often the data collection / generating procedure will have used some other value besides <code>.</code> to represent missing values. The <code>mvdecode</code> command will convert all these values to missing. For example:</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb721-1"><a href="#cb721-1"></a><span class="kw">mvdecode</span> <span class="dt">_all</span>, mv(999)</span></code></pre></div>
<p>The <code>_all</code> command tells Stata to perform this conversion for all variables. Use this command carefully! If you have any variables where “999” is a legitimate value, Stata is going to recode it to missing. As an alternative, you could list var names separately rather than using <code>_all</code>.</p>
</div>
</div>
<div id="variable-types" class="section level2">
<h2>Variable types</h2>
<div class="alert alert-info">
<p><strong>GOAL: Learn about the two main types of variables that Stata uses: string and numeric.</strong></p>
</div>
<p>To be able to perform any mathematical operations, your variables need to be in a numeric format. Stata can store numbers with differing levels of precision, as described in the table below:</p>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">Minimum</th>
<th align="left">Maximum</th>
<th align="left">being 0</th>
<th align="left">bytes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">byte</td>
<td align="left">-127</td>
<td align="left">100</td>
<td align="left">+/-1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">int</td>
<td align="left">-32,767</td>
<td align="left">32,740</td>
<td align="left">+/-1</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">long</td>
<td align="left">-2,147,483,647</td>
<td align="left">2,147,483,620</td>
<td align="left">+/-1</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">float</td>
<td align="left">-1.70141173319*10<sup>38</sup></td>
<td align="left">1.70141173319*10<sup>38</sup></td>
<td align="left">+/-10<sup>-38</sup></td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="left">double</td>
<td align="left">-8.9884656743*10<sup>307</sup></td>
<td align="left">8.9884656743*10<sup>307</sup></td>
<td align="left">+/-10<sup>-323</sup></td>
<td align="left">8</td>
</tr>
</tbody>
</table>
<p>Precision for float is 3.795x10<sup>-8</sup>. Precision for double is 1.414x10<sup>-16</sup>.</p>
<div id="converting-to-from-strings" class="section level3">
<h3>Converting to &amp; from Strings</h3>
<p>Stata provides several ways to convert to and from strings. You can use <code>tostring</code> and <code>destring</code> to convert from one type to the other:</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb722-1"><a href="#cb722-1"></a><span class="co">// convert degree to a string</span></span>
<span id="cb722-2"><a href="#cb722-2"></a><span class="kw">tostring</span> degree, <span class="kw">gen</span>(degree_s)</span>
<span id="cb722-3"><a href="#cb722-3"></a><span class="co">// and back to a number</span></span>
<span id="cb722-4"><a href="#cb722-4"></a><span class="kw">destring</span> degree_s, <span class="kw">gen</span>(degree_n)</span></code></pre></div>
<p>Use <code>decode</code> and <code>encode</code> to convert to / from variable labels:</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb723-1"><a href="#cb723-1"></a><span class="co">// convert degree to a descriptive string</span></span>
<span id="cb723-2"><a href="#cb723-2"></a><span class="kw">decode</span> degree, <span class="kw">gen</span>(degree_s2)</span>
<span id="cb723-3"><a href="#cb723-3"></a><span class="co">// and back to a number with labels</span></span>
<span id="cb723-4"><a href="#cb723-4"></a><span class="kw">encode</span> degree_s2, <span class="kw">gen</span>(degree_n2)</span></code></pre></div>
</div>
<div id="converting-strings-to-date-time" class="section level3">
<h3>Converting strings to date / time</h3>
<p>Often date / time variables start out as strings — you’ll need to convert them to numbers using one of the conversion functions listed below:</p>
<table>
<thead>
<tr class="header">
<th align="left">Format</th>
<th align="left">Meaning</th>
<th align="left">String-to-numeric conversion function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">%tc</td>
<td align="left">milliseconds</td>
<td align="left">clock(string, mask)</td>
</tr>
<tr class="even">
<td align="left">%td</td>
<td align="left">days</td>
<td align="left">date(string, mask)</td>
</tr>
<tr class="odd">
<td align="left">%tw</td>
<td align="left">weeks</td>
<td align="left">weekly(string, mask)</td>
</tr>
<tr class="even">
<td align="left">%tm</td>
<td align="left">months</td>
<td align="left">monthly(string, mask)</td>
</tr>
<tr class="odd">
<td align="left">%tq</td>
<td align="left">quarters</td>
<td align="left">quarterly(string, mask)</td>
</tr>
<tr class="even">
<td align="left">%ty</td>
<td align="left">years</td>
<td align="left">yearly(string, mask)</td>
</tr>
</tbody>
</table>
<p>Date / time variables are stored as the number of units elapsed since 01 January 1960 00:00:00.000. For example, the <code>date</code> function returns the number of days since that time, and the <code>clock</code> function returns the number of milliseconds since that time.</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb724-1"><a href="#cb724-1"></a><span class="co">// create string variable and convert to date</span></span>
<span id="cb724-2"><a href="#cb724-2"></a><span class="kw">gen</span> <span class="fu">date</span> = <span class="st">&quot;November 9 2020&quot;</span></span>
<span id="cb724-3"><a href="#cb724-3"></a><span class="kw">gen</span> date1 = <span class="fu">date</span>(<span class="fu">date</span>, <span class="st">&quot;MDY&quot;</span>)</span>
<span id="cb724-4"><a href="#cb724-4"></a><span class="ot">list</span> date1 <span class="kw">in</span> 1/5</span></code></pre></div>
</div>
<div id="formatting-numbers-as-dates" class="section level3">
<h3>Formatting numbers as dates</h3>
<p>Once you have converted a string to a number you can format it for display. You can either accept the defaults used by your formatting string or provide details to customize it.</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb725-1"><a href="#cb725-1"></a><span class="co">// format so humans can read the date</span></span>
<span id="cb725-2"><a href="#cb725-2"></a><span class="kw">format</span> date1 %<span class="kw">d</span></span>
<span id="cb725-3"><a href="#cb725-3"></a><span class="ot">list</span> date1 <span class="kw">in</span> 1/5</span>
<span id="cb725-4"><a href="#cb725-4"></a><span class="co">// format with detail</span></span>
<span id="cb725-5"><a href="#cb725-5"></a><span class="kw">format</span> date1 %tdMonth_dd,_CCYY</span>
<span id="cb725-6"><a href="#cb725-6"></a><span class="ot">list</span> date1 <span class="kw">in</span> 1/5</span></code></pre></div>
</div>
<div id="exercise-1-7" class="section level3">
<h3>Exercise 1</h3>
<p><strong>Missing values, string conversion, &amp; by processing</strong></p>
<ol style="list-style-type: decimal">
<li>Recode values “99” and “98” on the variable <code>hrs1</code> as missing.</li>
</ol>
<div class="sourceCode" id="cb726"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb726-1"><a href="#cb726-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Recode the <code>marital</code> variable into a string variable and then back into a numeric variable.</li>
</ol>
<div class="sourceCode" id="cb727"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb727-1"><a href="#cb727-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a new variable that associates each individual with the average number of hours worked among individuals with matching educational degrees (see the last <code>by</code> example for inspiration).</li>
</ol>
<div class="sourceCode" id="cb728"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb728-1"><a href="#cb728-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb729"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb729-1"><a href="#cb729-1"></a><span class="kw">use</span> dataSets/gss.dta, <span class="kw">clear</span></span>
<span id="cb729-2"><a href="#cb729-2"></a><span class="kw">sum</span> hrs1</span>
<span id="cb729-3"><a href="#cb729-3"></a><span class="kw">recode</span> hrs1 (99=.) (98=.) </span>
<span id="cb729-4"><a href="#cb729-4"></a><span class="kw">sum</span> hrs1</span>
<span id="cb729-5"><a href="#cb729-5"></a></span>
<span id="cb729-6"><a href="#cb729-6"></a><span class="kw">tostring</span> marital, <span class="kw">gen</span>(marstring)</span>
<span id="cb729-7"><a href="#cb729-7"></a><span class="kw">destring</span> marstring, <span class="kw">gen</span>(mardstring)</span>
<span id="cb729-8"><a href="#cb729-8"></a><span class="co">//compare with</span></span>
<span id="cb729-9"><a href="#cb729-9"></a><span class="kw">decode</span> marital, <span class="kw">gen</span>(marital_s)</span>
<span id="cb729-10"><a href="#cb729-10"></a><span class="kw">encode</span> marital_s, <span class="kw">gen</span>(marital_n)</span>
<span id="cb729-11"><a href="#cb729-11"></a></span>
<span id="cb729-12"><a href="#cb729-12"></a><span class="kw">describe</span> marital marstring mardstring marital_s marital_n</span>
<span id="cb729-13"><a href="#cb729-13"></a><span class="kw">sum</span> marital marstring mardstring marital_s marital_n</span>
<span id="cb729-14"><a href="#cb729-14"></a></span>
<span id="cb729-15"><a href="#cb729-15"></a><span class="kw">bysort</span> degree: <span class="kw">egen</span> hrsdegree = <span class="kw">mean</span>(hrs1)</span>
<span id="cb729-16"><a href="#cb729-16"></a><span class="kw">tab</span> hrsdegree</span>
<span id="cb729-17"><a href="#cb729-17"></a><span class="kw">tab</span> hrsdegree degree </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="merging-appending-collapsing" class="section level2">
<h2>Merging, appending, &amp; collapsing</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn the basic commands to merge, append, or join two dataset in Stata.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>How to append datasets</li>
<li>How to merge datasets and types of merge</li>
<li>Collapse from master data and create a new dataset of summary statistics</li>
</ol>
</div>
<div id="appending-datasets" class="section level3">
<h3>Appending datasets</h3>
<p>Sometimes you have observations in two different datasets, or you’d like to add observations to an existing dataset. In this case you can use the <code>append</code> command to add observations to the end of the observations in the master dataset. For example:</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb730-1"><a href="#cb730-1"></a><span class="kw">clear</span></span>
<span id="cb730-2"><a href="#cb730-2"></a><span class="co">// from the append help file</span></span>
<span id="cb730-3"><a href="#cb730-3"></a><span class="kw">webuse</span> even</span>
<span id="cb730-4"><a href="#cb730-4"></a><span class="ot">list</span></span>
<span id="cb730-5"><a href="#cb730-5"></a><span class="kw">webuse</span> odd</span>
<span id="cb730-6"><a href="#cb730-6"></a><span class="ot">list</span></span>
<span id="cb730-7"><a href="#cb730-7"></a><span class="co">// Append even data to the end of the odd data</span></span>
<span id="cb730-8"><a href="#cb730-8"></a><span class="kw">append</span> <span class="kw">using</span> <span class="st">&quot;http://www.stata-press.com/data/r14/even&quot;</span></span>
<span id="cb730-9"><a href="#cb730-9"></a><span class="ot">list</span></span>
<span id="cb730-10"><a href="#cb730-10"></a><span class="kw">clear</span></span></code></pre></div>
<p>To keep track of where observations came from, use the <code>generate</code> option as shown below:</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb731-1"><a href="#cb731-1"></a><span class="kw">webuse</span> odd</span>
<span id="cb731-2"><a href="#cb731-2"></a><span class="kw">append</span> <span class="kw">using</span> <span class="st">&quot;http://www.stata-press.com/data/r14/even&quot;</span>, <span class="kw">generate</span>(observesource)</span>
<span id="cb731-3"><a href="#cb731-3"></a><span class="ot">list</span></span>
<span id="cb731-4"><a href="#cb731-4"></a><span class="kw">clear</span></span></code></pre></div>
<p>There is a <code>force</code> option will allow for data type mismatches, but this is not recommended. Remember, <code>append</code> is for adding observations (i.e., rows) from a second data set to your current dataset.</p>
</div>
<div id="merging-datasets" class="section level3">
<h3>Merging datasets</h3>
<p>You can <code>merge</code> variables from a second dataset to the dataset you’re currently working with. There are different ways that you might be interested in merging data:</p>
<ul>
<li>Two datasets with same participant pool, one row per participant (1:1)</li>
<li>A dataset with one participant per row with a dataset with multiple rows per participant (1:many or many:1)</li>
</ul>
<p>Before you begin:</p>
<ol style="list-style-type: decimal">
<li>Identify the <code>ID</code> that you will use to merge your two datasets</li>
<li>Determine which variables you’d like to merge</li>
<li>Variable types must match across datasets (there is a <code>force</code> option to get around this, but it is not recommended)</li>
</ol>
<p>Note — data do NOT have to be sorted prior to merging.</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb732-1"><a href="#cb732-1"></a><span class="co">// Adapted from the merge help page</span></span>
<span id="cb732-2"><a href="#cb732-2"></a><span class="kw">webuse</span> autosize </span>
<span id="cb732-3"><a href="#cb732-3"></a><span class="ot">list</span></span>
<span id="cb732-4"><a href="#cb732-4"></a><span class="kw">webuse</span> autoexpense</span>
<span id="cb732-5"><a href="#cb732-5"></a><span class="ot">list</span></span>
<span id="cb732-6"><a href="#cb732-6"></a></span>
<span id="cb732-7"><a href="#cb732-7"></a><span class="kw">webuse</span> autosize</span>
<span id="cb732-8"><a href="#cb732-8"></a><span class="kw">merge</span> 1:1 make <span class="kw">using</span> <span class="st">&quot;http://www.stata-press.com/data/r14/autoexpense&quot;</span></span>
<span id="cb732-9"><a href="#cb732-9"></a><span class="ot">list</span></span>
<span id="cb732-10"><a href="#cb732-10"></a><span class="kw">clear</span></span>
<span id="cb732-11"><a href="#cb732-11"></a></span>
<span id="cb732-12"><a href="#cb732-12"></a><span class="co">// keep only the matches (AKA &quot;inner join&quot;)</span></span>
<span id="cb732-13"><a href="#cb732-13"></a><span class="kw">webuse</span> autosize, <span class="kw">clear</span></span>
<span id="cb732-14"><a href="#cb732-14"></a><span class="kw">merge</span> 1:1 make <span class="kw">using</span> <span class="st">&quot;http://www.stata-press.com/data/r14/autoexpense&quot;</span>, <span class="kw">keep</span>(<span class="fu">match</span>) nogen</span>
<span id="cb732-15"><a href="#cb732-15"></a><span class="ot">list</span></span>
<span id="cb732-16"><a href="#cb732-16"></a><span class="kw">clear</span></span></code></pre></div>
<p>Remember, <code>merge</code> is for adding variables (i.e., columns) from a second data set.</p>
</div>
<div id="merge-options" class="section level3">
<h3>Merge Options</h3>
<p>There are several options that provide more fine-grain control over what happens to non-id columns contained in both data sets. If you’ve carefully cleaned and prepared the data prior to merging this shouldn’t be an issue, but here are some details about how Stata handles this situation.</p>
<ul>
<li>In standard merge, the current active dataset is the authority and WON’T CHANGE</li>
<li>If your current dataset has missing data and some of those values are not missing in your new dataset, specify <code>update</code> – this will fill in missing data in the current dataset</li>
<li>If you want data from your new dataset to overwrite that in your current dataset, specify <code>replace update</code> — this will replace current data with new data UNLESS the value is missing in the new dataset</li>
</ul>
</div>
<div id="many-to-many-merges---joinby-command" class="section level3">
<h3>Many-to-many merges - joinby command</h3>
<p>Stata allows you to specify merges like <code>merge m:m id</code> using <code>newdata.dta</code>, but it is difficult to imagine a situation where this would be useful. If you are thinking about using <code>merge m:m</code> chances are good that you actually need <code>joinby</code>. Please refer to the <code>joinby</code> help page for details.</p>
</div>
<div id="collapse" class="section level3">
<h3>Collapse</h3>
<p><code>collapse</code> will take your current active dataset and create a new dataset of summary statistics</p>
<ul>
<li>Useful in hierarchical linear modeling if you’d like to create aggregate, summary statistics</li>
<li>Can generate group summary data for many descriptive stats</li>
<li>Can also attach weights</li>
</ul>
<p>Before you <code>collapse</code>:</p>
<ul>
<li>Save your current dataset and then save it again under a new name (this will prevent <code>collapse</code> from writing over your original data</li>
<li>Consider issues of missing data. Do you want Stata to use all possible observations? If not, the <code>cw</code> (casewise) option will make casewise deletions</li>
</ul>
<div class="sourceCode" id="cb733"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb733-1"><a href="#cb733-1"></a><span class="co">// Adapted from the collapse help page</span></span>
<span id="cb733-2"><a href="#cb733-2"></a><span class="kw">clear</span></span>
<span id="cb733-3"><a href="#cb733-3"></a><span class="kw">webuse</span> college</span>
<span id="cb733-4"><a href="#cb733-4"></a><span class="ot">list</span></span>
<span id="cb733-5"><a href="#cb733-5"></a><span class="co">// mean and sd by hospital</span></span>
<span id="cb733-6"><a href="#cb733-6"></a><span class="kw">collapse</span> (<span class="kw">mean</span>) mean_gpa = gpa mean_hour = hour (<span class="fu">sd</span>) sd_gpa = gpa sd_hour = hour, <span class="kw">by</span>(<span class="fu">year</span>)</span>
<span id="cb733-7"><a href="#cb733-7"></a><span class="ot">list</span></span>
<span id="cb733-8"><a href="#cb733-8"></a><span class="kw">clear</span></span></code></pre></div>
<p>You could also generate different statistics for multiple variables.</p>
</div>
<div id="exercise-2-5" class="section level3">
<h3>Exercise 2</h3>
<p><strong>Append, merge, &amp; collapse</strong></p>
<p>Open the <code>gss2.dta</code> dataset. This dataset contains only half of the variables that are in the complete gss dataset.</p>
<ol style="list-style-type: decimal">
<li>Merge dataset <code>gss1.dta</code> with dataset <code>gss2.dta</code>. The identification variable is <code>id</code>.</li>
</ol>
<div class="sourceCode" id="cb734"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb734-1"><a href="#cb734-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Open the <code>gss.dta</code> dataset and merge in data from the <code>marital.dta</code> dataset, which includes income information grouped by individuals’ marital status. The <code>marital.dta</code> dataset contains collapsed data regarding average statistics of individuals based on their marital status.</li>
</ol>
<div class="sourceCode" id="cb735"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb735-1"><a href="#cb735-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Open the <code>gssAppend.dta</code> dataset and create a new dataset that combines the observations in <code>gssAppend.dta</code> with those in <code>gssAddObserve.dta</code>.</li>
</ol>
<div class="sourceCode" id="cb736"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb736-1"><a href="#cb736-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Open the <code>gss.dta</code> dataset and create a new dataset that summarizes the mean and standard deviation of income based on individuals’ degree status (<code>degree</code>). In the process of creating this new dataset, rename your three new variables.</li>
</ol>
<div class="sourceCode" id="cb737"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb737-1"><a href="#cb737-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb738"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb738-1"><a href="#cb738-1"></a><span class="kw">use</span> dataSets/gss2.dta, <span class="kw">clear</span></span>
<span id="cb738-2"><a href="#cb738-2"></a><span class="kw">merge</span> 1:1 id <span class="kw">using</span> dataSets/gss1.dta</span>
<span id="cb738-3"><a href="#cb738-3"></a><span class="kw">save</span> gss3.dta, <span class="kw">replace</span></span>
<span id="cb738-4"><a href="#cb738-4"></a></span>
<span id="cb738-5"><a href="#cb738-5"></a><span class="kw">use</span> dataSets/gss.dta, <span class="kw">clear</span></span>
<span id="cb738-6"><a href="#cb738-6"></a><span class="kw">merge</span> <span class="fu">m</span>:1 marital <span class="kw">using</span> dataSets/marital.dta, nogenerate <span class="kw">replace</span> update</span>
<span id="cb738-7"><a href="#cb738-7"></a><span class="kw">save</span> gss4.dta, <span class="kw">replace</span></span>
<span id="cb738-8"><a href="#cb738-8"></a></span>
<span id="cb738-9"><a href="#cb738-9"></a><span class="kw">use</span> dataSets/gssAppend.dta, <span class="kw">clear</span></span>
<span id="cb738-10"><a href="#cb738-10"></a><span class="kw">append</span> <span class="kw">using</span> dataSets/gssAddObserve, <span class="kw">generate</span>(observe) </span>
<span id="cb738-11"><a href="#cb738-11"></a></span>
<span id="cb738-12"><a href="#cb738-12"></a><span class="kw">use</span> dataSets/gss.dta, <span class="kw">clear</span></span>
<span id="cb738-13"><a href="#cb738-13"></a><span class="kw">save</span> collapse2.dta, <span class="kw">replace</span></span>
<span id="cb738-14"><a href="#cb738-14"></a><span class="kw">use</span> collapse2.dta, <span class="kw">clear</span></span>
<span id="cb738-15"><a href="#cb738-15"></a><span class="kw">collapse</span> (<span class="kw">mean</span>) meaninc=income (<span class="fu">sd</span>) sdinc=income, <span class="kw">by</span>(marital)</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="wrap-up-8" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-8" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work-in-progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-11" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Stata
<ul>
<li>UCLA website: <a href="http://www.ats.ucla.edu/stat/Stata/" class="uri">http://www.ats.ucla.edu/stat/Stata/</a></li>
<li>Stata website: <a href="http://www.stata.com/help.cgi?contents" class="uri">http://www.stata.com/help.cgi?contents</a></li>
<li>Email list: <a href="http://www.stata.com/statalist/" class="uri">http://www.stata.com/statalist/</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="stata-regression-models" class="section level1">
<h1>Stata Regression Models</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Models with continuous outcomes
<ul>
<li>OLS regression</li>
<li>OLS model assumptions and diagnostics</li>
<li>Including interaction terms</li>
<li>Including categorical predictors</li>
</ul></li>
<li>Models with binary outcomes
<ul>
<li>Logistic regression</li>
<li>Obtaining odds ratios</li>
</ul></li>
<li>Exporting &amp; saving results
<ul>
<li>Regression tables</li>
<li>Model comparison</li>
</ul></li>
<li>Obtaining quantities of interest
<ul>
<li>Margins of responses
<ul>
<li>APM: Average Predictive Margins</li>
<li>PMM: Predictive Margins at the Means</li>
<li>PMR: Predictive Margins at Representative values</li>
</ul></li>
<li>Margins of changes in responses
<ul>
<li>AME: Average Marginal Effects</li>
<li>MEM: Marginal Effects at the Means</li>
<li>MER: Marginal Effects at Representative values</li>
</ul></li>
</ul></li>
</ul>
<div id="setup-8" class="section level2">
<h2>Setup</h2>
<div id="class-structure-and-organization-2" class="section level3">
<h3>Class structure and organization</h3>
<ul>
<li>Informal — Ask questions at any time. Really!</li>
<li>Collaboration is encouraged - please spend a minute introducing yourself to your neighbors!</li>
<li>If you are using a laptop, you will need to adjust file paths accordingly</li>
<li>Make comments in your do-file - save on flash drive or email to yourself</li>
</ul>
</div>
<div id="prerequisites-8" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate-level Stata modeling workshop</p>
<ul>
<li>Assumes basic knowledge of Stata</li>
<li>Not appropriate for people already well familiar with modeling in Stata</li>
<li>If you are catching on before the rest of the class, experiment with command features described in help files</li>
</ul>
</div>
<div id="goals-7" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p><strong>We will learn about the Stata modeling ecosystem by analyzing data from three datasets.</strong> In particular, our goals are to learn about:</p>
<ol style="list-style-type: decimal">
<li>Modeling workflow</li>
<li>Modeling continuous outcomes<br />
</li>
<li>Modeling binary outcomes</li>
<li>Producing regression tables</li>
<li>Obtaining margins of responses</li>
<li>Obtaining margins of changes in responses</li>
</ol>
</div>
</div>
</div>
<div id="modeling-workflow-1" class="section level2">
<h2>Modeling workflow</h2>
<p>Before we delve into the details of how to fit models in Stata, it’s worth taking a step back and thinking more broadly about the components of the modeling process. These can roughly be divided into 3 stages:</p>
<ol style="list-style-type: decimal">
<li>Pre-estimation</li>
<li>Estimation</li>
<li>Post-estimaton</li>
</ol>
<p>At each stage, the goal is to complete a different task (e.g., to clean data, fit a model, test a hypothesis),
but the process is sequential — we move through the stages in order (though often many times in one project!)</p>
<p><img src="Stata/StataModels/images/Stata_model_pipeline.png" /></p>
<p>Throughout this workshop we will go through these stages several times as we fit different types of model.</p>
</div>
<div id="before-fitting-a-model-1" class="section level2">
<h2>Before fitting a model</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the data by creating summaries and visualizations.</strong></p>
</div>
<div id="the-dataset" class="section level3">
<h3>The dataset</h3>
<p>We have a dataset (<code>states.dta</code>) on a variety of variables for all 50 states. Variables include population, density, energy use, voting tendencies, graduation rates, income, etc.</p>
<p>We’re going to ask the question: does the amount of money spent on education (<code>expense</code>), family income(<code>income</code>), and percentage of students taking SATs (<code>percent</code>) affect the mean SAT score (<code>csat</code>) in a state?</p>
</div>
<div id="set-working-directory" class="section level3">
<h3>Set working directory</h3>
<p>Files are located in the <code>dataSets</code> folder in <code>StataMod</code>. Start by telling Stata where to look for these:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb739-1"><a href="#cb739-1"></a><span class="co">// change directory</span></span>
<span id="cb739-2"><a href="#cb739-2"></a>cd <span class="st">&quot;~/Desktop/Stata/StataMod&quot;</span></span></code></pre></div>
<p>Use <code>dir</code> to see what is in the directory:</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb740-1"><a href="#cb740-1"></a><span class="ot">dir</span></span>
<span id="cb740-2"><a href="#cb740-2"></a>cd dataSets</span></code></pre></div>
</div>
<div id="load-the-data-1" class="section level3">
<h3>Load the data</h3>
<div class="sourceCode" id="cb741"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb741-1"><a href="#cb741-1"></a><span class="co">// use the states data set</span></span>
<span id="cb741-2"><a href="#cb741-2"></a><span class="kw">use</span> dataSets/states.dta</span></code></pre></div>
</div>
<div id="examine-descriptive-statistics" class="section level3">
<h3>Examine descriptive statistics</h3>
<div class="sourceCode" id="cb742"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb742-1"><a href="#cb742-1"></a><span class="co">// descriptive statistics </span></span>
<span id="cb742-2"><a href="#cb742-2"></a><span class="kw">sum</span> expense income <span class="kw">percent</span> csat</span></code></pre></div>
</div>
<div id="visualize-the-data" class="section level3">
<h3>Visualize the data</h3>
<div class="sourceCode" id="cb743"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb743-1"><a href="#cb743-1"></a><span class="co">// visualize data </span></span>
<span id="cb743-2"><a href="#cb743-2"></a><span class="kw">scatter</span> expense income</span>
<span id="cb743-3"><a href="#cb743-3"></a><span class="kw">scatter</span> expense <span class="kw">percent</span> </span></code></pre></div>
</div>
</div>
<div id="models-with-continuous-outcomes-1" class="section level2">
<h2>Models with continuous outcomes</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn about the Stata modeling ecosystem by using the <code>regress</code> command to fit ordinary least squares (OLS) models.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Stata syntax for model specification</li>
<li>Model diagnostics for checking OLS assumptions</li>
<li>Including interaction terms</li>
<li>Including categorical predictors</li>
</ol>
</div>
<div id="fit-the-model" class="section level3">
<h3>Fit the model</h3>
<p>To fit a model in Stata, we first have to convert our theoretical model into
Stata syntax — a symbolic representation of the model:</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb744-1"><a href="#cb744-1"></a><span class="co">// model specification</span></span>
<span id="cb744-2"><a href="#cb744-2"></a>command outcome pred1 pred2 pred3</span></code></pre></div>
<p>Note that immediately after the modeling command comes the outcome variable, followed by numerous predictors.</p>
<p>For example, the following model predicts SAT scores based on the amount of money spent on education (<code>expense</code>), family income(<code>income</code>), and percentage of students taking SATs (<code>percent</code>) in a state. Here’s the theoretical model:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
SATscores_i = \beta_01 + \beta_1expenditures_i + \beta_2income_i +\beta_3SATpercent_i + \epsilon_i
\]</span></p>
</div>
<p>And here’s how we use the <code>regress</code> command to fit this model in Stata:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb745-1"><a href="#cb745-1"></a><span class="kw">regress</span> csat expense income <span class="kw">percent</span> </span></code></pre></div>
</div>
<div id="ols-assumptions" class="section level3">
<h3>OLS assumptions</h3>
<p>OLS regression relies on several assumptions, including:</p>
<ol style="list-style-type: decimal">
<li>The model includes all relevant variables (i.e., no omitted variable bias).</li>
<li>The model is linear in the parameters (i.e., the coefficients and error term).</li>
<li>The error term has an expected value of zero.</li>
<li>All right-hand-side variables are uncorrelated with the error term.</li>
<li>No right-hand-side variables are a perfect linear function of other RHS variables.</li>
<li>Observations of the error term are uncorrelated with each other.</li>
<li>The error term has constant variance (i.e., homoscedasticity).</li>
<li>(Optional - only needed for inference). The error term is normally distributed.</li>
</ol>
<p>We can investigate assumptions #7 and #8 by plotting model diagnostics. A simple histogram of the residuals can be informative:</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb746-1"><a href="#cb746-1"></a><span class="co">// graph the residual values of csat</span></span>
<span id="cb746-2"><a href="#cb746-2"></a><span class="kw">predict</span> <span class="kw">resid</span>, residual</span>
<span id="cb746-3"><a href="#cb746-3"></a><span class="kw">histogram</span> <span class="kw">resid</span>, <span class="fu">normal</span> </span></code></pre></div>
<p>We can also examine homoscedasticity:</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb747-1"><a href="#cb747-1"></a><span class="kw">rvfplot</span>, <span class="kw">yline</span>(0)</span></code></pre></div>
<p>Type <code>-help regress postestimation</code> — for more information about model diagnostics. If assumptions are not met, alter the specification and refit the model.</p>
</div>
<div id="interactions" class="section level3">
<h3>Interactions</h3>
<p>What if we wanted to test an interaction between <code>percent</code> and <code>high</code>?</p>
<p>Option 1: generate product terms by hand:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb748-1"><a href="#cb748-1"></a><span class="co">// generate product of percent and high</span></span>
<span id="cb748-2"><a href="#cb748-2"></a><span class="kw">gen</span> percenthigh = <span class="kw">percent</span>*high </span>
<span id="cb748-3"><a href="#cb748-3"></a><span class="kw">regress</span> csat expense income <span class="kw">percent</span> high percenthigh</span></code></pre></div>
<p>Option 2: let Stata do your dirty work:</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb749-1"><a href="#cb749-1"></a><span class="co">// use the # sign to represent interactions </span></span>
<span id="cb749-2"><a href="#cb749-2"></a><span class="kw">regress</span> csat <span class="kw">percent</span> high c.percent#c.high</span>
<span id="cb749-3"><a href="#cb749-3"></a><span class="co">// same as: regress csat c.percent##c.high</span></span></code></pre></div>
</div>
<div id="categorical-predictors" class="section level3">
<h3>Categorical predictors</h3>
<p>For categorical variables, we first need to dummy code. Let’s use <code>region</code> as an example.</p>
<p>Option 1: create dummy codes before fitting regression model:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb750-1"><a href="#cb750-1"></a><span class="co">// create region dummy codes using tab </span></span>
<span id="cb750-2"><a href="#cb750-2"></a><span class="kw">tab</span> region, <span class="kw">gen</span>(region)</span>
<span id="cb750-3"><a href="#cb750-3"></a></span>
<span id="cb750-4"><a href="#cb750-4"></a><span class="co">// regress csat on region</span></span>
<span id="cb750-5"><a href="#cb750-5"></a><span class="kw">regress</span> csat region1 region2 region3</span></code></pre></div>
<p>Option 2: let Stata do it for you:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb751-1"><a href="#cb751-1"></a><span class="co">// regress csat on region using fvvarlist syntax</span></span>
<span id="cb751-2"><a href="#cb751-2"></a><span class="co">// see `help fvvarlist` for details</span></span>
<span id="cb751-3"><a href="#cb751-3"></a><span class="kw">regress</span> csat i.region</span></code></pre></div>
</div>
<div id="exercise-0-7" class="section level3">
<h3>Exercise 0</h3>
<p><strong>Regression with continuous outcomes</strong></p>
<p>Open the datafile, <code>gss.dta</code>.</p>
<p>Fit an OLS regression model to predict general happiness (<code>happy</code>) based on respondent’s sex (<code>sex</code>), marital status (<code>marital</code>), highest year of school completed (<code>educ</code>), and respondent’s income for last year (<code>rincome</code>).</p>
<ol style="list-style-type: decimal">
<li>Before running the regression, examine descriptive statistics of the variables and generate a few scatterplots.</li>
</ol>
<div class="sourceCode" id="cb752"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb752-1"><a href="#cb752-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run your regression model.</li>
</ol>
<div class="sourceCode" id="cb753"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb753-1"><a href="#cb753-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Examine the plausibility of the assumptions of normality and homoscedasticity.</li>
</ol>
<div class="sourceCode" id="cb754"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb754-1"><a href="#cb754-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Add on to the regression equation by generating an interaction term between <code>sex</code> and <code>educ</code> and testing the interaction.</li>
</ol>
<div class="sourceCode" id="cb755"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb755-1"><a href="#cb755-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb756"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb756-1"><a href="#cb756-1"></a><span class="co">// 1.  Before running the regression, examine descriptive statistics of the variables and generate a few scatterplots.</span></span>
<span id="cb756-2"><a href="#cb756-2"></a></span>
<span id="cb756-3"><a href="#cb756-3"></a><span class="kw">sum</span> happy educ rincome </span>
<span id="cb756-4"><a href="#cb756-4"></a><span class="kw">tab</span> sex </span>
<span id="cb756-5"><a href="#cb756-5"></a><span class="kw">tab</span> marital </span>
<span id="cb756-6"><a href="#cb756-6"></a></span>
<span id="cb756-7"><a href="#cb756-7"></a><span class="kw">scatter</span> happy rincome</span>
<span id="cb756-8"><a href="#cb756-8"></a></span>
<span id="cb756-9"><a href="#cb756-9"></a><span class="co">// 2.  Run your regression model. </span></span>
<span id="cb756-10"><a href="#cb756-10"></a></span>
<span id="cb756-11"><a href="#cb756-11"></a><span class="kw">regress</span> happy i.sex educ i.marital rincome</span>
<span id="cb756-12"><a href="#cb756-12"></a></span>
<span id="cb756-13"><a href="#cb756-13"></a><span class="co">// 3.  Examine the plausibility of the assumptions of normality and homoscedasticity. </span></span>
<span id="cb756-14"><a href="#cb756-14"></a></span>
<span id="cb756-15"><a href="#cb756-15"></a><span class="kw">hist</span> happy, <span class="fu">normal</span> </span>
<span id="cb756-16"><a href="#cb756-16"></a><span class="kw">rvfplot</span>,<span class="kw">yline</span>(0)</span>
<span id="cb756-17"><a href="#cb756-17"></a></span>
<span id="cb756-18"><a href="#cb756-18"></a><span class="co">// 4.  Add on to the regression equation by generating an interaction term between `sex` and `educ` and testing the interaction.</span></span>
<span id="cb756-19"><a href="#cb756-19"></a></span>
<span id="cb756-20"><a href="#cb756-20"></a><span class="kw">regress</span> happy i.sex##c.educ i.marital rincome</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="models-with-binary-outcomes-1" class="section level2">
<h2>Models with binary outcomes</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to use the <code>logit</code> command to model binary outcomes.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Run the model to obtain estimates on the log odds scale</li>
<li>Transform model coefficients into odds ratios</li>
</ol>
</div>
<div id="the-dataset-1" class="section level3">
<h3>The Dataset</h3>
<p>Using the <code>states.dta</code> data, we’re going to ask the question: does people per square mile (<code>density</code>), percent HS graduates taking SAT (<code>percent</code>), and per pupil expenditures for primary and secondary school (<code>expense</code>) affect the probability of having an SAT score greater than or equal to 1000 (<code>sat_binary</code>)?</p>
</div>
<div id="load-the-dataset" class="section level3">
<h3>Load the dataset</h3>
<div class="sourceCode" id="cb757"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb757-1"><a href="#cb757-1"></a><span class="co">// use the states data set</span></span>
<span id="cb757-2"><a href="#cb757-2"></a><span class="kw">use</span> dataSets/states.dta</span></code></pre></div>
</div>
<div id="recode-the-outcome-variable" class="section level3">
<h3>Recode the outcome variable</h3>
<p>Recode the composite SAT score (<code>csat</code>) into two categories: <strong>whether a region’s mean SAT score is greater than or equal to 1000, or less than 1000.</strong></p>
<div class="sourceCode" id="cb758"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb758-1"><a href="#cb758-1"></a><span class="kw">gen</span> sat_binary = .</span>
<span id="cb758-2"><a href="#cb758-2"></a><span class="kw">replace</span> sat_binary = 0 <span class="kw">if</span> csat &lt; 1000</span>
<span id="cb758-3"><a href="#cb758-3"></a><span class="kw">replace</span> sat_binary = 1 <span class="kw">if</span> csat &gt;= 1000</span></code></pre></div>
</div>
<div id="run-summary-statistics" class="section level3">
<h3>Run summary statistics</h3>
<div class="sourceCode" id="cb759"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb759-1"><a href="#cb759-1"></a><span class="kw">tab</span> sat_binary</span>
<span id="cb759-2"><a href="#cb759-2"></a><span class="kw">sum</span> density <span class="kw">percent</span> expense </span></code></pre></div>
</div>
<div id="run-the-logistic-model" class="section level3">
<h3>Run the logistic model</h3>
<p>Let’s predict the probability of having mean SAT score greater than or equal to 1000 based on <code>density</code>, <code>percent</code>, and <code>expense</code>.</p>
<p>Here’s the theoretical model:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
logit(p(SAT1000_i = 1)) = \beta_{0}1 + \beta_1density_i + \beta_2SATpercent_i + \beta_3expenditures_i 
\]</span></p>
</div>
<p>where <span class="math inline">\(logit(\cdot)\)</span> is the non-linear link function that relates a linear expression of the predictors to the expectation of the binary response:</p>
<div class="alert alert-secondary">
<p><span class="math display">\[
logit(p(SAT1000_i = 1)) = ln \left( \frac{p(SAT1000_i = 1)}{1-p(SAT1000_i = 1)} \right) = ln \left( \frac{p(SAT1000_i = 1)}{p(SAT1000_i = 0)} \right)
\]</span></p>
</div>
<p>And here’s how we use the <code>logit</code> command to fit this model in Stata:</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb760-1"><a href="#cb760-1"></a><span class="co">// logit regression with estimates on the log odds scale </span></span>
<span id="cb760-2"><a href="#cb760-2"></a><span class="kw">logit</span> sat_binary density <span class="kw">percent</span> expense</span>
<span id="cb760-3"><a href="#cb760-3"></a></span>
<span id="cb760-4"><a href="#cb760-4"></a><span class="co">// logit regression with estimates on the odds ratio scale </span></span>
<span id="cb760-5"><a href="#cb760-5"></a><span class="kw">logit</span> sat_binary density <span class="kw">percent</span> expense, <span class="kw">or</span> </span></code></pre></div>
</div>
<div id="exercise-1-8" class="section level3">
<h3>Exercise 1</h3>
<p><strong>Regression with binary outcomes</strong></p>
<p>Use the data file, <code>gss.dta</code>. Examine how age of a respondent (<code>age</code>), highest year of school completed (<code>degree</code>), hours per day watching TV (<code>tvhours</code>), and total family income for last year (<code>income</code>) relate to whether someone uses internet (<code>usenet</code>).</p>
<ol style="list-style-type: decimal">
<li>Load the dataset.</li>
</ol>
<div class="sourceCode" id="cb761"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb761-1"><a href="#cb761-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Run summary statistics, delete subjects who did not provide an answer to the <code>usenet</code> question.</li>
</ol>
<div class="sourceCode" id="cb762"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb762-1"><a href="#cb762-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb763"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb763-1"><a href="#cb763-1"></a><span class="co">// 1.  Load the dataset. </span></span>
<span id="cb763-2"><a href="#cb763-2"></a></span>
<span id="cb763-3"><a href="#cb763-3"></a><span class="kw">use</span> gss.dta, <span class="kw">clear</span> </span>
<span id="cb763-4"><a href="#cb763-4"></a></span>
<span id="cb763-5"><a href="#cb763-5"></a><span class="co">// 2.  Run summary statistics, delete subjects who did not provide an answer to the `usenet` question.</span></span>
<span id="cb763-6"><a href="#cb763-6"></a></span>
<span id="cb763-7"><a href="#cb763-7"></a><span class="kw">tab</span> usenet </span>
<span id="cb763-8"><a href="#cb763-8"></a><span class="kw">drop</span> <span class="kw">if</span> usenet == 9</span>
<span id="cb763-9"><a href="#cb763-9"></a><span class="kw">tab</span> degree </span>
<span id="cb763-10"><a href="#cb763-10"></a><span class="kw">sum</span> age tvhours income </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="exporting-saving-results" class="section level2">
<h2>Exporting &amp; saving results</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to store and export Stata models.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>How to store results from models</li>
<li>How to compare models</li>
<li>How to export Stata model output to Excel</li>
</ol>
</div>
<div id="storing-results" class="section level3">
<h3>Storing results</h3>
<p>Stata offers several user-friendly options for storing and viewing regression output from multiple models. First, download the necessary packages:</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb764-1"><a href="#cb764-1"></a><span class="co">// install outreg2 package</span></span>
<span id="cb764-2"><a href="#cb764-2"></a><span class="kw">findit</span> outreg2</span></code></pre></div>
<p>Then store the results of some regression models using the <code>estimates</code> command and <code>store</code> option:</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb765-1"><a href="#cb765-1"></a><span class="co">// fit two regression models and store the results</span></span>
<span id="cb765-2"><a href="#cb765-2"></a><span class="kw">regress</span> csat expense income <span class="kw">percent</span> high</span>
<span id="cb765-3"><a href="#cb765-3"></a><span class="kw">estimates</span> <span class="kw">store</span> Model1</span>
<span id="cb765-4"><a href="#cb765-4"></a>  </span>
<span id="cb765-5"><a href="#cb765-5"></a><span class="kw">regress</span> csat expense income <span class="kw">percent</span> high i.region</span>
<span id="cb765-6"><a href="#cb765-6"></a><span class="kw">estimates</span> <span class="kw">store</span> Model2</span></code></pre></div>
<p>The stored models can be recalled by name using the <code>estimates</code> command and <code>replay</code> option:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb766-1"><a href="#cb766-1"></a><span class="co">// display Model1</span></span>
<span id="cb766-2"><a href="#cb766-2"></a><span class="kw">estimates</span> <span class="fu">replay</span> Model1</span></code></pre></div>
</div>
<div id="comparing-models-1" class="section level3">
<h3>Comparing models</h3>
<p>The stored models can be compared by name using the <code>estimates</code> command and <code>table</code> option. For a more formal comparison, the <code>lrtest</code> command can be used to perform a likelihhod ratio test:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb767-1"><a href="#cb767-1"></a><span class="co">// compare Model1 and Model2 coefficients</span></span>
<span id="cb767-2"><a href="#cb767-2"></a><span class="kw">estimates</span> <span class="kw">table</span> Model1 Model2</span>
<span id="cb767-3"><a href="#cb767-3"></a></span>
<span id="cb767-4"><a href="#cb767-4"></a><span class="co">// compare Model1 and Model2 fit </span></span>
<span id="cb767-5"><a href="#cb767-5"></a><span class="kw">lrtest</span> Model1 Model2 </span></code></pre></div>
</div>
<div id="exporting-to-excel" class="section level3">
<h3>Exporting to Excel</h3>
<p>To avoid human error when transferring coefficients into tables, Excel can be used to format publication-ready tables:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb768-1"><a href="#cb768-1"></a>outreg2 [Model1 Model2] <span class="kw">using</span> csatprediction.xls, <span class="kw">replace</span></span></code></pre></div>
</div>
<div id="exercise-2-6" class="section level3">
<h3>Exercise 2</h3>
<p><strong>Exporting &amp; saving results</strong></p>
<ol style="list-style-type: decimal">
<li>Fit the logistic model and save it as <code>Model1</code>.</li>
</ol>
<div class="sourceCode" id="cb769"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb769-1"><a href="#cb769-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Add another predictor (<code>hrs1</code>) in the model and save the new model as <code>Model2</code> and compare between <code>Model1</code> and <code>Model2</code>.</li>
</ol>
<div class="sourceCode" id="cb770"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb770-1"><a href="#cb770-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Save the output of the better fitted model to a word document.</li>
</ol>
<div class="sourceCode" id="cb771"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb771-1"><a href="#cb771-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 2 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb772"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb772-1"><a href="#cb772-1"></a><span class="co">// 1.  Fit the logistic model and save it as `Model1`.  </span></span>
<span id="cb772-2"><a href="#cb772-2"></a></span>
<span id="cb772-3"><a href="#cb772-3"></a><span class="kw">logit</span> usenet age i.degree tvhours income </span>
<span id="cb772-4"><a href="#cb772-4"></a><span class="kw">est</span> <span class="kw">store</span> Model1</span>
<span id="cb772-5"><a href="#cb772-5"></a></span>
<span id="cb772-6"><a href="#cb772-6"></a><span class="co">// 2.  Add another predictor (`hrs1`) in the model and save the new model as `Model2` and compare between `Model1` and `Model2`. </span></span>
<span id="cb772-7"><a href="#cb772-7"></a></span>
<span id="cb772-8"><a href="#cb772-8"></a><span class="kw">logit</span> usenet age i.degree tvhours income hrs1</span>
<span id="cb772-9"><a href="#cb772-9"></a><span class="kw">est</span> <span class="kw">store</span> Model2 </span>
<span id="cb772-10"><a href="#cb772-10"></a></span>
<span id="cb772-11"><a href="#cb772-11"></a><span class="kw">lrtest</span> Model1 Model2</span>
<span id="cb772-12"><a href="#cb772-12"></a></span>
<span id="cb772-13"><a href="#cb772-13"></a><span class="co">// 3.  Save the better fitted model output to a word document. </span></span>
<span id="cb772-14"><a href="#cb772-14"></a></span>
<span id="cb772-15"><a href="#cb772-15"></a><span class="kw">logit</span> usenet age i.degree tvhours income hrs1</span>
<span id="cb772-16"><a href="#cb772-16"></a>outreg2 <span class="kw">using</span> Mymodel.doc</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="obtaining-quantities-of-interest" class="section level2">
<h2>Obtaining quantities of interest</h2>
<div class="alert alert-info">
<p><strong>GOAL: To obtain easy to interpret output from regression models.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Margins of responses (a.k.a. predictive margins)</li>
<li>Margins of changes of responses (a.k.a. marginal effects)</li>
<li>Graphs of margins</li>
</ol>
</div>
<p>The default summary model output that Stata produces is useful and intuitive for relatively simple models, especially if the outcome is continuous. For more complex models, especially non-linear models or those with interactions, the default output only reports a small subset of information from the model and/or presents results on an unintuitive scale. For such models, it is often easier to interpret <strong>margins</strong> — specifically, <em>margins of responses</em> or <em>margins of changes in responses</em>. Margins are statistics calculated from predictions of a previously fit model at fixed values of some covariates and averaging over the remaining covariates. Margins answers the question, <strong>“What does my model have to say about such-and-such a group or such-and-such a person?”</strong>. It answers this question:</p>
<ol style="list-style-type: decimal">
<li>Either conditionally –— based on fixed values of covariates (e.g., the mean) -—- or averaged over the observations in the data.</li>
<li>In terms of the response given covariate levels (<strong>margins of responses</strong>), or any other response you can calculate as a function of your estimated parameters -—- linear responses, probabilities, hazards, survival times, odds ratios, risk differences. (a.k.a. <em>predictive margins</em>, or <em>adjusted predictions</em>, or <em>estimated marginal means</em>, or <em>least-squares means</em>).</li>
<li>In terms of the <em>change</em> in the response for a <em>change</em> in covariate levels (<strong>margins of changes in responses</strong>). (a.k.a. <em>marginal effects</em> or <em>partial effects</em>).</li>
<li>Providing standard errors, test statistics, and confidence intervals and those statistics can take the covariates as given or adjust for sampling.</li>
</ol>
<p>To calculate such effects in Stata, we need a flexible way of obtaining quantities of interest from the model. This is generally done using a <a href="https://www.stata.com/manuals13/u20.pdf">post-estimation tool</a>. The main post-estimation tool Stata has in its arsenal is the <code>margins</code> command. This is a very flexible tool for producing a variety of quantities of interest from almost all model types that Stata supports. In particular, <code>margins</code> can calculate:</p>
<ol style="list-style-type: decimal">
<li>Different types of <em>margins of responses</em>:
<ul>
<li><strong>APM: Average Predictive Margins</strong> (average of the responses among actual people in the data)</li>
<li><strong>PMM: Predictive Margins at the Means</strong> (expected response for a person with average characteristics)</li>
<li><strong>PMR: Predictive Margins at Representative values</strong> (expected response across a range of covariate values)</li>
</ul></li>
<li>Difference types of <em>margins of changes in responses</em>:
<ul>
<li><strong>AME: Average Marginal Effects</strong> (average of the changes in responses among actual people in the data)</li>
<li><strong>MEM: Marginal Effects at the Means</strong> (expected change in response for a person with average characteristics)</li>
<li><strong>MER: Marginal Effects at Representative values</strong> (expected change in response across a range of covariate values)</li>
</ul></li>
</ol>
<p>The <code>margins</code> command can only be used <em>after</em> you’ve run a regression and acts on the results of the most recent regression command. The <code>marginsplot</code> command can be used to graph any of these margins or comparisons of margins and acts on the results of the most recent <code>margins</code> command.</p>
</div>
<div id="margins-of-responses" class="section level2">
<h2>Margins of responses</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to produce margins of responses.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>APM: Average Predictive Margins<br />
</li>
<li>PMM: Predictive Margins at the Means</li>
<li>PMR: Predictive Margins at Representative values</li>
<li>Graph margins of responses</li>
</ol>
</div>
<div id="the-dataset-2" class="section level3">
<h3>The dataset</h3>
<p>The case study examples use the <code>nhanesII</code> dataset (Second National Health and Nutrition Examination Survey),
which was conducted in the mid to late 1970s. More on the study can be found at <a href="https://wwwn.cdc.gov/nchs/nhanes/nhanes2/" class="uri">https://wwwn.cdc.gov/nchs/nhanes/nhanes2/</a>. Let’s load the data:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb773-1"><a href="#cb773-1"></a><span class="kw">use</span> dataSets/nhanesII.dta</span></code></pre></div>
</div>
<div id="fit-a-model" class="section level3">
<h3>Fit a model</h3>
<p>We will examine a continuous measure of systolic blood pressure (<code>bpsystol</code>) as a function of a respondent’s age (<code>age</code>), whether they have diabetes (<code>diabetes</code>), and what geographical region they come from (<code>region</code>), using OLS regression.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb774-1"><a href="#cb774-1"></a><span class="kw">regress</span> bpsystol age i.diabetes i.region</span></code></pre></div>
</div>
<div id="apm-average-predictive-margins" class="section level3">
<h3>APM: Average Predictive Margins</h3>
<p>If you just type <code>margins</code> by itself, Stata will calculate the predicted value of the model outcome (<code>bpsystol</code>) for each observation in the data, then report the mean value of those predictions.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb775-1"><a href="#cb775-1"></a>margins</span></code></pre></div>
<p>If <code>margins</code> is followed by a categorical variable, for example, <code>region</code>, Stata first identifies all the levels of the categorical variable. Then, it calculates what the mean predicted value of the model outcome (<code>bpsystol</code>) would be if all observations had that value for <code>region</code>. All other variables are left unchanged.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb776-1"><a href="#cb776-1"></a><span class="co">// margins for dummy variable </span></span>
<span id="cb776-2"><a href="#cb776-2"></a>margins diabetes</span>
<span id="cb776-3"><a href="#cb776-3"></a></span>
<span id="cb776-4"><a href="#cb776-4"></a><span class="co">// margins for multi-level categorical variable </span></span>
<span id="cb776-5"><a href="#cb776-5"></a>margins region</span></code></pre></div>
</div>
<div id="pmm-predictive-margins-at-the-means" class="section level3">
<h3>PMM: Predictive Margins at the Means</h3>
<p>By default, <code>margins</code> reports the average of the predictions for each person (i.e., observation) in the data. This is the average response among the actual people in the data. But we can also get <code>margins</code> to report the prediction at the average of the covariates by using the <code>atmeans</code> option. This represents the expected response of a person with average characteristics.</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb777-1"><a href="#cb777-1"></a><span class="co">// margins for dummy variable </span></span>
<span id="cb777-2"><a href="#cb777-2"></a>margins diabetes, atmeans</span></code></pre></div>
</div>
<div id="pmr-predictive-margins-at-representative-values" class="section level3">
<h3>PMR: Predictive Margins at Representative values</h3>
<p>For continuous variables, <code>margins</code> cannot look at all possible values, but we can specify which values we want to examine with the <code>at</code> option:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb778-1"><a href="#cb778-1"></a>margins, <span class="fu">at</span>(age = (50 80))</span></code></pre></div>
<p>The previous step calculates the mean predicted value of the model outcome (<code>bpsystol</code>) with <code>age</code> set to 50, and then again with <code>age</code> set to 80. We can also add more values by listing the numbers we want in a <em>numlist</em>:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb779-1"><a href="#cb779-1"></a><span class="co">// predicted values for ages 50 to 80 in 5 year increments</span></span>
<span id="cb779-2"><a href="#cb779-2"></a>margins, <span class="fu">at</span>(age=(50(5)80))</span></code></pre></div>
</div>
<div id="graph-margins-of-responses" class="section level3">
<h3>Graph margins of responses</h3>
<p>The previous step calculates the mean predicted value of <code>bpsystol</code> with age set to 50, 55, 60, 65, 70, 75, and 80. We can now use <code>marginsplot</code> to graph the results.</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb780-1"><a href="#cb780-1"></a>marginsplot</span></code></pre></div>
</div>
<div id="exercise-3-5" class="section level3">
<h3>Exercise 3</h3>
<p><strong>Margins of responses</strong></p>
<p>Open the datafile <code>gss.dta</code></p>
<ol style="list-style-type: decimal">
<li>Fit an OLS regression model to predict general happiness (<code>happy</code>) based on respondent’s sex (<code>sex</code>), marital status (<code>marital</code>), highest year of school completed (<code>educ</code>), and respondent’s income for last year (<code>rincome</code>). Obtain average predictive margins for <code>happy</code>.</li>
</ol>
<div class="sourceCode" id="cb781"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb781-1"><a href="#cb781-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Obtain predictive margins of <code>sex</code> and <code>marital</code>.</li>
</ol>
<div class="sourceCode" id="cb782"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb782-1"><a href="#cb782-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Obtain predictive margins of <code>rincome</code> from 10000 to 30000, with an interval of 5000.</li>
</ol>
<div class="sourceCode" id="cb783"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb783-1"><a href="#cb783-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Create a <code>marginsplot</code> and interpret the results.</li>
</ol>
<div class="sourceCode" id="cb784"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb784-1"><a href="#cb784-1"></a>## </span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 3 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb785"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb785-1"><a href="#cb785-1"></a><span class="co">// 1. Fit an OLS regression model to predict general happiness (`happy`) based on respondent&#39;s sex (`sex`), marital status (`marital`), highest year of school completed (`educ`), and respondent&#39;s income for last year (`rincome`). Obtain average predictive margins for `happy`.</span></span>
<span id="cb785-2"><a href="#cb785-2"></a></span>
<span id="cb785-3"><a href="#cb785-3"></a><span class="kw">regress</span> happy i.sex educ i.marital rincome</span>
<span id="cb785-4"><a href="#cb785-4"></a>margins </span>
<span id="cb785-5"><a href="#cb785-5"></a></span>
<span id="cb785-6"><a href="#cb785-6"></a><span class="co">// 2. Obtain predictive margins of `sex` and `marital`. </span></span>
<span id="cb785-7"><a href="#cb785-7"></a></span>
<span id="cb785-8"><a href="#cb785-8"></a>margins, sex </span>
<span id="cb785-9"><a href="#cb785-9"></a>margins, marital</span>
<span id="cb785-10"><a href="#cb785-10"></a></span>
<span id="cb785-11"><a href="#cb785-11"></a><span class="co">// 3. Obtain predictive margins of `rincome` from 10000 to 30000, with an interval of 5000. </span></span>
<span id="cb785-12"><a href="#cb785-12"></a></span>
<span id="cb785-13"><a href="#cb785-13"></a>margins, <span class="fu">at</span>(rincome=(10000(5000)30000))</span>
<span id="cb785-14"><a href="#cb785-14"></a></span>
<span id="cb785-15"><a href="#cb785-15"></a><span class="co">// 4. Create a `marginsplot` and interpret the results. </span></span>
<span id="cb785-16"><a href="#cb785-16"></a></span>
<span id="cb785-17"><a href="#cb785-17"></a>marginsplot </span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="margins-of-changes-in-responses" class="section level2">
<h2>Margins of changes in responses</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to produce margins of changes in responses.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>AME: Average Marginal Effects</li>
<li>MEM: Marginal Effects at the Means</li>
<li>MER: Marginal Effects at Representative values</li>
<li>Graph margins of changes in responses</li>
</ol>
</div>
<div id="the-dataset-3" class="section level3">
<h3>The dataset</h3>
<p>We will be using the same dataset as the previous example: the Second National Health and Nutrition Examination Survey (NHANES II). Let’s load the data:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb786-1"><a href="#cb786-1"></a><span class="kw">use</span> dataSets/nhanesII.dta</span></code></pre></div>
</div>
<div id="fit-a-model-1" class="section level3">
<h3>Fit a model</h3>
<p>We will predict the probability of someone having diabetes (<code>diabetes</code>), as a function of race (<code>black</code>), sex (<code>female</code>), and age (<code>age</code>), using logistic regression.</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb787-1"><a href="#cb787-1"></a><span class="kw">logit</span> diabetes <span class="bn">black</span> female age, <span class="kw">nolog</span> </span></code></pre></div>
</div>
<div id="ame-average-marginal-effects" class="section level3">
<h3>AME: Average Marginal Effects</h3>
<p>We can first obtain the Average Predictive Margins of race (<code>black</code>) and sex (<code>female</code>). Then, we can use the <code>dydx</code> command to estimate changes in the response when the levels of race and sex change. Since, by default, these changes are averaged over each person in the dataset, we obtain Average Marginal Effects. As the current model is logistic, margins automatically back-transforms the APMs and AMEs from the estimation scale (i.e., the log odds scale) to the response scale (i.e., the probability scale).</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb788-1"><a href="#cb788-1"></a><span class="co">// obtain Average Predictive Margins </span></span>
<span id="cb788-2"><a href="#cb788-2"></a>margins <span class="bn">black</span> female </span>
<span id="cb788-3"><a href="#cb788-3"></a></span>
<span id="cb788-4"><a href="#cb788-4"></a><span class="co">// calculate the average of all the marginal effects </span></span>
<span id="cb788-5"><a href="#cb788-5"></a>margins, <span class="kw">dydx</span>(<span class="bn">black</span> female)</span></code></pre></div>
</div>
<div id="mem-marginal-effects-at-the-mean" class="section level3">
<h3>MEM: Marginal Effects at the Mean</h3>
<p>By default, <code>margins</code> with the <code>dydx</code> command reports the average of the changes in the probability of the response among actual people in the data. But we can also get margins to report the expected change in the probability of the response for a person with average characteristics by using the <code>atmeans</code> option.</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb789-1"><a href="#cb789-1"></a><span class="co">// obtain Predictive Margins at the Means</span></span>
<span id="cb789-2"><a href="#cb789-2"></a>margins <span class="bn">black</span> female, atmeans</span>
<span id="cb789-3"><a href="#cb789-3"></a></span>
<span id="cb789-4"><a href="#cb789-4"></a><span class="co">// calculate marginal effects with all other covariates fixed at their sample means </span></span>
<span id="cb789-5"><a href="#cb789-5"></a>margins, <span class="kw">dydx</span>(<span class="bn">black</span> female) atmeans</span></code></pre></div>
</div>
<div id="mer-marginal-effects-at-representative-values" class="section level3">
<h3>MER: Marginal Effects at Representative values</h3>
<p>For continuous variables, <code>margins</code> needs us to specify which values we want to examine using the <code>at</code> option. We can calculate the change in the probability of the model outcome (<code>diabetes</code>) when levels of race (<code>black</code>) and sex (<code>female</code>) change, across a range of values for <code>age</code> by supplying a list of numbers to a <em>numlist</em>:</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb790-1"><a href="#cb790-1"></a><span class="co">// obtain Predictive Margins at Representative values</span></span>
<span id="cb790-2"><a href="#cb790-2"></a><span class="co">// choose range of values for one or more variables</span></span>
<span id="cb790-3"><a href="#cb790-3"></a><span class="co">// note: the `vsquish` option omits vertical white space between results</span></span>
<span id="cb790-4"><a href="#cb790-4"></a>margins <span class="bn">black</span>, <span class="fu">at</span>(age=(20 30 40 50 60 70)) vsquish </span>
<span id="cb790-5"><a href="#cb790-5"></a></span>
<span id="cb790-6"><a href="#cb790-6"></a><span class="co">// calculate marginal effects across that range </span></span>
<span id="cb790-7"><a href="#cb790-7"></a>margins, <span class="kw">dydx</span>(<span class="bn">black</span> female) <span class="fu">at</span>(age=(20 30 40 50 60 70)) vsquish </span></code></pre></div>
</div>
<div id="graph-margins-of-changes-in-responses" class="section level3">
<h3>Graph margins of changes in responses</h3>
<p>The previous step calculates the average change in the predicted probability of <code>diabetes</code>, when levels of race (<code>black</code>) and sex (<code>female</code>) change, with age set to 20, 30, 40, 50, 60, and 70. We can now use <code>marginsplot</code> to graph the results.</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb791-1"><a href="#cb791-1"></a>marginsplot</span></code></pre></div>
</div>
<div id="exercise-4-2" class="section level3">
<h3>Exercise 4</h3>
<p><strong>Margins of changes in responses</strong></p>
<p>Open the datafile <code>gss.dta</code></p>
<ol style="list-style-type: decimal">
<li>Fit a logistic model to examine how whether someone uses internet (<code>usenet</code>) is related to age of the respondent (<code>age</code>), highest year of school completed (<code>degree</code>), hours per day watching TV (<code>tvhours</code>), and total family income for last year (<code>income</code>). Obtain Average Predictive Margins and Average Marginal Effects for <code>degree</code>.</li>
</ol>
<div class="sourceCode" id="cb792"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb792-1"><a href="#cb792-1"></a>## </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Obtain Predictive Margins of <code>degree</code> at Representative values of <code>tvhours</code> from 0 to 10 hours, on a 1 hour interval. Examine how the marginal effect of <code>degree</code> differs across the range of <code>tvhours</code> (i.e., obtain Marginal Effects at Representative values).</li>
</ol>
<div class="sourceCode" id="cb793"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb793-1"><a href="#cb793-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Create a <code>marginsplot</code> for the marginal effects from #2.</li>
</ol>
<div class="sourceCode" id="cb794"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb794-1"><a href="#cb794-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 4 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb795"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb795-1"><a href="#cb795-1"></a><span class="co">// 1. Fit a logistic model to examine how whether someone uses internet (`usenet`) is related to age of the respondent (`age`), highest year of school completed (`degree`), hours per day watching TV (`tvhours`), and total family income for last year (`income`). Obtain Average Predictive Margins and Average Marginal Effects for `degree`.</span></span>
<span id="cb795-2"><a href="#cb795-2"></a></span>
<span id="cb795-3"><a href="#cb795-3"></a><span class="kw">logit</span> usenet age i.degree tvhours income </span>
<span id="cb795-4"><a href="#cb795-4"></a></span>
<span id="cb795-5"><a href="#cb795-5"></a>margins degree</span>
<span id="cb795-6"><a href="#cb795-6"></a>margins, <span class="kw">dydx</span>(degree)</span>
<span id="cb795-7"><a href="#cb795-7"></a></span>
<span id="cb795-8"><a href="#cb795-8"></a><span class="co">// 2. Obtain Predictive Margins of `degree` at Representative values of `tvhours` from 0 to 10 hours, on a 1 hour interval. Examine how the marginal effect of `degree` differs across the range of `tvhours` (i.e., obtain Marginal Effects at Representative values). </span></span>
<span id="cb795-9"><a href="#cb795-9"></a></span>
<span id="cb795-10"><a href="#cb795-10"></a>margins degree, <span class="fu">at</span>(tvhours=(0 1 2 3 4 5 6 7 8 9 10) vsquish </span>
<span id="cb795-11"><a href="#cb795-11"></a>margins, <span class="kw">dydx</span>(degree) <span class="fu">at</span>(tvhours=(0 1 2 3 4 5 6 7 8 9 10)) vsquish </span>
<span id="cb795-12"><a href="#cb795-12"></a></span>
<span id="cb795-13"><a href="#cb795-13"></a><span class="co">// 3. Create a `marginsplot` for the marginal effects from #2. </span></span>
<span id="cb795-14"><a href="#cb795-14"></a>marginsplot</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="wrap-up-9" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-9" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-12" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Stata
<ul>
<li>UCLA website: <a href="http://www.ats.ucla.edu/stat/Stata/" class="uri">http://www.ats.ucla.edu/stat/Stata/</a></li>
<li>Stata website: <a href="http://www.stata.com/help.cgi?contents" class="uri">http://www.stata.com/help.cgi?contents</a></li>
<li>Email list: <a href="http://www.stata.com/statalist/" class="uri">http://www.stata.com/statalist/</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div id="stata-graphics" class="section level1">
<h1>Stata Graphics</h1>
<p><strong>Topics</strong></p>
<ul>
<li>Univariate graphs</li>
<li>Bivariate graphs</li>
</ul>
<div id="setup-9" class="section level2">
<h2>Setup</h2>
<div id="class-structure-and-organization-3" class="section level3">
<h3>Class structure and organization</h3>
<ul>
<li>Please feel free to ask questions at any point if they are relevant to the current topic (or if you are lost!)</li>
<li>Collaboration is encouraged - please introduce yourself to your neighbors!</li>
<li>If you are using a laptop, you will need to adjust file paths accordingly</li>
<li>Make comments in your Do-file - save on flash drive or email to yourself</li>
</ul>
</div>
<div id="prerequisites-9" class="section level3">
<h3>Prerequisites</h3>
<p>This is an intermediate-level Stata graphics workshop</p>
<ul>
<li>Assumes basic knowledge of Stata</li>
<li>Not appropriate for people already well familiar with graphing in Stata</li>
<li>If you are catching on before the rest of the class, experiment with command features described in help files</li>
</ul>
</div>
<div id="goals-8" class="section level3">
<h3>Goals</h3>
<div class="alert alert-success">
<p><strong>We will learn about Stata graphics by practicing graphing using two real datasets.</strong> In particular, our goals are to:</p>
<ol style="list-style-type: decimal">
<li>Plot basic graphs in Stata</li>
<li>Plot two-way graphs in Stata</li>
</ol>
</div>
</div>
</div>
<div id="graphing-in-stata" class="section level2">
<h2>Graphing in Stata</h2>
<div class="alert alert-info">
<p><strong>GOAL: To get familiar with how to produce graphs in Stata.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Learn about graphing strategies</li>
<li>Compare two examples of a bad graph and a good graph</li>
</ol>
</div>
<div id="graphing-strategies" class="section level3">
<h3>Graphing strategies</h3>
<ul>
<li>Keep it simple</li>
<li>Labels, labels, labels!!</li>
<li>Avoid cluttered graphs</li>
<li>Every part of the graph should be meaningful</li>
<li>Avoid:
<ul>
<li>Shading</li>
<li>Distracting colors</li>
<li>Decoration</li>
</ul></li>
<li>Always know what you are working with before you get started
<ul>
<li>Recognize scale of data</li>
<li>If you are using multiple variables, how do their scales align?</li>
</ul></li>
<li>Before any graphing procedure review variables with <code>codebook</code>, <code>sum</code>, <code>tab</code>, etc.</li>
<li>HELPFUL STATA HINT: If you want your command to go on multiple lines use <code>///</code> at end of each line</li>
</ul>
</div>
<div id="terrible-graph" class="section level3">
<h3>Terrible graph</h3>
<p><img src="Stata/StataGraphics/images/Terrible.png" /></p>
</div>
<div id="much-better-graph" class="section level3">
<h3>Much better graph</h3>
<p><img src="Stata/StataGraphics/images/Good.png" /></p>
</div>
</div>
<div id="univariate-graphics" class="section level2">
<h2>Univariate graphics</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to graph a single continuous and categorical variable.</strong> In particular:</p>
<ol style="list-style-type: decimal">
<li>Graph a continuous variable using a histogram</li>
<li>Graph a categorical variable using a bar graph</li>
</ol>
</div>
<div id="our-first-dataset" class="section level3">
<h3>Our first dataset</h3>
<ul>
<li>Time Magazine Public School Poll
<ul>
<li>Based on survey of 1,000 adults in U.S.</li>
<li>Conducted in August 2010</li>
<li>Questions regarding feelings about parental involvement, teachers union, current potential for reform</li>
</ul></li>
<li>Open Stata and call up the datafile for today</li>
</ul>
<div class="sourceCode" id="cb796"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb796-1"><a href="#cb796-1"></a><span class="co">// Step 1: tell Stata where to find data:</span></span>
<span id="cb796-2"><a href="#cb796-2"></a>cd <span class="st">&quot;~/StataGraphics/dataSets&quot;</span></span>
<span id="cb796-3"><a href="#cb796-3"></a></span>
<span id="cb796-4"><a href="#cb796-4"></a><span class="co">// Step 2: call up our dataset:</span></span>
<span id="cb796-5"><a href="#cb796-5"></a><span class="kw">use</span> TimePollPubSchools.dta</span></code></pre></div>
</div>
<div id="single-continuous-variable" class="section level3">
<h3>Single continuous variable</h3>
<p><strong>Example: Histogram</strong></p>
<ul>
<li>Stata assumes you are working with continuous data</li>
<li>Very simple syntax:
<ul>
<li><code>hist varname</code></li>
</ul></li>
<li>Put a comma after your varname and start adding options
<ul>
<li><code>bin(#)</code> : change the number of bars that the graph displays</li>
<li><code>normal</code> : overlay normal curve</li>
<li><code>addlabels</code> : add actual values to bars</li>
</ul></li>
</ul>
<p><strong>Histogram options</strong></p>
<ul>
<li>To change the numeric depiction of your data add these options after the comma
<ul>
<li>Choose one: <code>density</code>, <code>fraction</code>, <code>frequency</code>, <code>percent</code></li>
</ul></li>
<li>Be sure to properly describe your histogram:
<ul>
<li><code>title("insert name of graph")</code></li>
<li><code>subtitle("insert subtitle of graph")</code></li>
<li><code>note("insert note to appear at bottom of graph")</code></li>
<li><code>caption("insert caption to appear below notes")</code></li>
</ul></li>
</ul>
<p><strong>Histogram example</strong></p>
<div class="sourceCode" id="cb797"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb797-1"><a href="#cb797-1"></a><span class="kw">hist</span> F1, <span class="bn">bin</span>(10) <span class="kw">percent</span> <span class="bn">title</span>(<span class="st">&quot;TITLE&quot;</span>) <span class="co">///</span></span>
<span id="cb797-2"><a href="#cb797-2"></a>  <span class="bn">subtitle</span>(<span class="st">&quot;SUBTITLE&quot;</span>) <span class="bn">caption</span>(<span class="st">&quot;CAPTION&quot;</span>) <span class="kw">note</span>(<span class="st">&quot;NOTES&quot;</span>)</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/hist1.png" /></p>
<p><strong>Axis titles &amp; labels</strong></p>
<ul>
<li>Axis title options (default is variable label):
<ul>
<li><code>xtitle("insert x axis name")</code></li>
<li><code>ytitle("insert y axis name")</code></li>
</ul></li>
<li>Don’t want axis titles?
<ul>
<li><code>xtitle("")</code></li>
<li><code>ytitle("")</code></li>
</ul></li>
<li>Add labels to X or Y axis:
<ul>
<li><code>xlabel("insert x axis label")</code></li>
<li><code>ylabel("insert y axis label")</code></li>
</ul></li>
<li>Tell Stata how to scale each axis
<ul>
<li><code>xlabel("start\#(increment)end\#")</code></li>
<li><code>xlabel(0(5)100)</code> This would label x-axis from 0-100 in increments of 5</li>
</ul></li>
</ul>
<p><strong>Axis labels example</strong></p>
<div class="sourceCode" id="cb798"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb798-1"><a href="#cb798-1"></a><span class="kw">hist</span> F1, <span class="bn">bin</span>(10) <span class="kw">percent</span> <span class="bn">title</span>(<span class="st">&quot;TITLE&quot;</span>) <span class="bn">subtitle</span>(<span class="st">&quot;SUBTITLE&quot;</span>) <span class="co">///</span></span>
<span id="cb798-2"><a href="#cb798-2"></a>    <span class="bn">caption</span>(<span class="st">&quot;CAPTION&quot;</span>) <span class="kw">note</span>(<span class="st">&quot;NOTES&quot;</span>) <span class="co">///</span></span>
<span id="cb798-3"><a href="#cb798-3"></a>    <span class="bn">xtitle</span>(<span class="st">&quot;Here&#39;s your x-axis title&quot;</span>) <span class="co">///</span></span>
<span id="cb798-4"><a href="#cb798-4"></a>    <span class="bn">ytitle</span>(<span class="st">&quot;here&#39;s your y-axis title&quot;</span>)</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/hist2.png" /></p>
</div>
<div id="single-categorical-variable" class="section level3">
<h3>Single categorical variable</h3>
<ul>
<li>We can also use the <code>hist</code> command for bar graphs
<ul>
<li>Simply specify the option <code>discrete</code></li>
</ul></li>
<li>Stata will produce one bar for each level (i.e. category) of variable</li>
<li>Use <code>xlabel</code> command to insert names of individual categories</li>
</ul>
<div class="sourceCode" id="cb799"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb799-1"><a href="#cb799-1"></a><span class="kw">hist</span> F4, <span class="bn">title</span>(<span class="st">&quot;Racial breakdown of Time Poll Sample&quot;</span>) <span class="bn">xtitle</span>(<span class="st">&quot;Race&quot;</span>) <span class="co">///</span></span>
<span id="cb799-2"><a href="#cb799-2"></a>   <span class="bn">ytitle</span>(<span class="st">&quot;Percent&quot;</span>) <span class="kw">xlabel</span>(1 <span class="st">&quot;White&quot;</span> 2 <span class="st">&quot;Black&quot;</span> 3 <span class="st">&quot;Asian&quot;</span> 4 <span class="st">&quot;Hispanic&quot;</span> <span class="co">///</span></span>
<span id="cb799-3"><a href="#cb799-3"></a>   5 <span class="st">&quot;Other&quot;</span>) discrete <span class="kw">percent</span> <span class="bn">addlabels</span></span></code></pre></div>
<p><img src="Stata/StataGraphics/images/bargraph.png" /></p>
</div>
<div id="exercise-0-8" class="section level3">
<h3>Exercise 0</h3>
<p><strong>Histograms &amp; bar graphs</strong></p>
<ol style="list-style-type: decimal">
<li>Open the datafile, <code>NatNeighCrimeStudy.dta</code>.</li>
</ol>
<div class="sourceCode" id="cb800"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb800-1"><a href="#cb800-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create a histogram of the tract-level poverty rate (<code>T_POVRTY</code>).</li>
</ol>
<div class="sourceCode" id="cb801"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb801-1"><a href="#cb801-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Insert the normal curve over the histogram.</li>
</ol>
<div class="sourceCode" id="cb802"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb802-1"><a href="#cb802-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Change the numeric representation on the Y-axis to <code>percent</code>.</li>
</ol>
<div class="sourceCode" id="cb803"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb803-1"><a href="#cb803-1"></a>##</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Add appropriate titles to the overall graph and the x axis and y axis. Also, add a note that states the source of this data.</li>
</ol>
<div class="sourceCode" id="cb804"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb804-1"><a href="#cb804-1"></a>##</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Open the datafile, <code>TimePollPubSchools.dta</code>.</li>
</ol>
<div class="sourceCode" id="cb805"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb805-1"><a href="#cb805-1"></a>##</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Create a histogram of the question, “What grade would you give your child’s school” (<code>Q11</code>). Be sure to tell Stata that this is a categorical variable.</li>
</ol>
<div class="sourceCode" id="cb806"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb806-1"><a href="#cb806-1"></a>##</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Format this graph so that the axes have proper titles and labels. Also, add an appropriate title to the overall graph. Add a note stating the source of the data.</li>
</ol>
<div class="sourceCode" id="cb807"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb807-1"><a href="#cb807-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 0 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb808"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb808-1"><a href="#cb808-1"></a><span class="co">// 1.  Open the datafile, `NatNeighCrimeStudy.dta`.</span></span>
<span id="cb808-2"><a href="#cb808-2"></a><span class="kw">use</span> NatNeighCrimeStudy.dta, <span class="kw">clear</span></span>
<span id="cb808-3"><a href="#cb808-3"></a></span>
<span id="cb808-4"><a href="#cb808-4"></a><span class="co">// 2.  Create a histogram of the tract-level poverty rate (`T_POVRTY`).</span></span>
<span id="cb808-5"><a href="#cb808-5"></a><span class="kw">hist</span> T_POVRTY</span>
<span id="cb808-6"><a href="#cb808-6"></a></span>
<span id="cb808-7"><a href="#cb808-7"></a><span class="co">// 3.  Insert the normal curve over the histogram.</span></span>
<span id="cb808-8"><a href="#cb808-8"></a><span class="kw">hist</span> T_POVRTY, <span class="fu">normal</span></span>
<span id="cb808-9"><a href="#cb808-9"></a></span>
<span id="cb808-10"><a href="#cb808-10"></a><span class="co">// 4.  Change the numeric representation on the Y-axis to `percent`.</span></span>
<span id="cb808-11"><a href="#cb808-11"></a><span class="kw">hist</span> T_POVRTY, <span class="fu">normal</span> <span class="kw">percent</span></span>
<span id="cb808-12"><a href="#cb808-12"></a></span>
<span id="cb808-13"><a href="#cb808-13"></a><span class="co">// 5.  Add appropriate titles to the overall graph and the x axis and y axis. Also, add a note that states the source of this data.</span></span>
<span id="cb808-14"><a href="#cb808-14"></a><span class="kw">hist</span> T_POVRTY, <span class="fu">normal</span> <span class="kw">percent</span> <span class="bn">title</span>(<span class="st">&quot;Poverty Rate Distribution Among Study Participants&quot;</span>) <span class="bn">xtitle</span>(<span class="st">&quot;Poverty Rate&quot;</span>) <span class="bn">ytitle</span>(<span class="st">&quot;Percent&quot;</span>) <span class="kw">note</span>(<span class="st">&quot;Notes: Results are based on raw data&quot;</span>)</span>
<span id="cb808-15"><a href="#cb808-15"></a></span>
<span id="cb808-16"><a href="#cb808-16"></a><span class="co">// 6.  Open the datafile, `TimePollPubSchools.dta`.</span></span>
<span id="cb808-17"><a href="#cb808-17"></a><span class="kw">use</span> TimePollPubSchools.dta, <span class="kw">clear</span></span>
<span id="cb808-18"><a href="#cb808-18"></a></span>
<span id="cb808-19"><a href="#cb808-19"></a><span class="co">// 7.  Create a histogram of the question, &quot;What grade would you give your child&#39;s school&quot; (`Q11`). Be sure to tell Stata that this is a categorical variable.</span></span>
<span id="cb808-20"><a href="#cb808-20"></a><span class="kw">hist</span> Q11, discrete</span>
<span id="cb808-21"><a href="#cb808-21"></a></span>
<span id="cb808-22"><a href="#cb808-22"></a><span class="co">// 8.  Format this graph so that the axes have proper titles and labels. Also, add an appropriate title to the overall graph. Add a note stating the source of the data.</span></span>
<span id="cb808-23"><a href="#cb808-23"></a><span class="kw">hist</span> Q11, <span class="bn">title</span>(<span class="st">&quot;School grading breakdown of Time Poll Sample&quot;</span>) <span class="bn">xtitle</span>(<span class="st">&quot;Grades&quot;</span>) <span class="bn">ytitle</span>(<span class="st">&quot;Percent&quot;</span>) <span class="kw">xlabel</span>(1 <span class="st">&quot;A&quot;</span> 2 <span class="st">&quot;B&quot;</span> 3 <span class="st">&quot;C&quot;</span> 4 <span class="st">&quot;D&quot;</span> 5 <span class="st">&quot;F&quot;</span>) <span class="kw">note</span>(<span class="st">&quot;Notes: Data is based on a survey of 1000 adults in U.S. conducted in 2010&quot;</span>)</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="bivariate-graphics" class="section level2">
<h2>Bivariate graphics</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to produce two-way bivariate graphs.</strong> In particular, to learn:</p>
<ol style="list-style-type: decimal">
<li>The <code>twoway</code> command</li>
<li>The <code>twoway</code> <code>title</code> options</li>
<li>The <code>twoway</code> <code>symbol</code> options</li>
<li>How to overlay <code>twoway</code> graphs</li>
</ol>
</div>
<div id="next-dataset" class="section level3">
<h3>Next dataset</h3>
<ul>
<li>National Neighborhood Crime Study (NNCS)
<ul>
<li>N=9593 census tracts in 2000</li>
<li>Explore sources of variation in crime for communities in the United States</li>
<li>Tract-level data: crime, social disorganization, disadvantage, socioeconomic inequality</li>
<li>City-level data: labor market, socioeconomic inequality, population change</li>
</ul></li>
</ul>
</div>
<div id="the-twoway-family" class="section level3">
<h3>The <code>twoway</code> family</h3>
<ul>
<li><code>twoway</code> is basic Stata command for all two-way graphs</li>
<li>Use <code>twoway</code> anytime you want to make comparisons among variables</li>
<li>Can be used to combine graphs (i.e., overlay one graph with another)
<ul>
<li>e.g., insert line of best fit over a scatter plot</li>
</ul></li>
<li>Some basic examples:</li>
</ul>
<div class="sourceCode" id="cb809"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb809-1"><a href="#cb809-1"></a><span class="kw">use</span> NatNeighCrimeStudy.dta, <span class="kw">clear</span></span>
<span id="cb809-2"><a href="#cb809-2"></a></span>
<span id="cb809-3"><a href="#cb809-3"></a><span class="kw">twoway</span> <span class="kw">scatter</span> T_PERCAP T_VIOLNT</span>
<span id="cb809-4"><a href="#cb809-4"></a><span class="kw">twoway</span> <span class="bn">dropline</span> T_PERCAP T_VIOLNT</span>
<span id="cb809-5"><a href="#cb809-5"></a><span class="kw">twoway</span> lfitci T_PERCAP T_VIOLNT</span></code></pre></div>
<p><strong>Twoway &amp; the <code>by</code> statement</strong></p>
<div class="sourceCode" id="cb810"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb810-1"><a href="#cb810-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> T_PERCAP T_VIOLNT, <span class="kw">by</span>(DIVISION)</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/twowayby.png" /></p>
<p><strong>Twoway title options</strong></p>
<ul>
<li>Same title options as with histogram
<ul>
<li><code>title("insert name of graph")</code></li>
<li><code>subtitle("insert subtitle of graph")</code></li>
<li><code>note("insert note to appear at bottom of graph")</code></li>
<li><code>caption("insert caption to appear below notes")</code></li>
</ul></li>
</ul>
<p><strong>Twoway title options example</strong></p>
<div class="sourceCode" id="cb811"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb811-1"><a href="#cb811-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> T_PERCAP T_VIOLNT, <span class="co">///</span></span>
<span id="cb811-2"><a href="#cb811-2"></a>    <span class="bn">title</span>(<span class="st">&quot;Comparison of Per Capita Income&quot;</span> <span class="co">///</span></span>
<span id="cb811-3"><a href="#cb811-3"></a>          <span class="st">&quot;and Violent Crime Rate at Tract level&quot;</span>) <span class="co">///</span></span>
<span id="cb811-4"><a href="#cb811-4"></a>    <span class="bn">xtitle</span>(<span class="st">&quot;Violent Crime Rate&quot;</span>) <span class="bn">ytitle</span>(<span class="st">&quot;Per Capita Income&quot;</span>) <span class="co">///</span></span>
<span id="cb811-5"><a href="#cb811-5"></a>    <span class="kw">note</span>(<span class="st">&quot;Source: National Neighborhood Crime Study 2000&quot;</span>)</span></code></pre></div>
<p><strong>Twoway symbol options</strong></p>
<ul>
<li>A variety of symbol shapes are available: use <code>palette symbolpalette</code> to see them and <code>msymbol()</code> to set them</li>
</ul>
<p><img src="Stata/StataGraphics/images/Symbol.png" /></p>
<p><strong>Twoway symbol options example</strong></p>
<div class="sourceCode" id="cb812"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb812-1"><a href="#cb812-1"></a><span class="kw">twoway</span> <span class="kw">scatter</span> T_PERCAP T_VIOLNT, <span class="co">///</span></span>
<span id="cb812-2"><a href="#cb812-2"></a>    <span class="bn">title</span>(<span class="st">&quot;Comparison of Per Capita Income&quot;</span> <span class="co">///</span></span>
<span id="cb812-3"><a href="#cb812-3"></a>          <span class="st">&quot;and Violent Crime Rate at Tract level&quot;</span>) <span class="co">///</span></span>
<span id="cb812-4"><a href="#cb812-4"></a>    <span class="bn">xtitle</span>(<span class="st">&quot;Violent Crime Rate&quot;</span>) <span class="bn">ytitle</span>(<span class="st">&quot;Per Capita Income&quot;</span>) <span class="co">///</span></span>
<span id="cb812-5"><a href="#cb812-5"></a>    <span class="kw">note</span>(<span class="st">&quot;Source: National Neighborhood Crime Study 2000&quot;</span>) <span class="co">///</span></span>
<span id="cb812-6"><a href="#cb812-6"></a>    <span class="bn">msymbol</span>(Sh) mcolor(<span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/msymbol_mcolor.png" /></p>
</div>
<div id="overlaying-twoway-graphs" class="section level3">
<h3>Overlaying twoway graphs</h3>
<ul>
<li>Very simple to combine multiple graphs by just putting each graph command in parentheses
<ul>
<li><code>twoway (scatter var1 var2) (lfit var1 var2)</code></li>
</ul></li>
<li>Add individual options to each graph within the parentheses</li>
<li>Add overall graph options as usual following the comma
<ul>
<li><code>twoway (scatter var1 var2) (lfit var1 var2), options</code></li>
</ul></li>
</ul>
<p><strong>Overlaying points &amp; lines</strong></p>
<div class="sourceCode" id="cb813"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb813-1"><a href="#cb813-1"></a><span class="kw">twoway</span> (<span class="kw">scatter</span> T_PERCAP T_VIOLNT) <span class="co">///</span></span>
<span id="cb813-2"><a href="#cb813-2"></a>    (<span class="kw">lfit</span> T_PERCAP T_VIOLNT), <span class="co">///</span></span>
<span id="cb813-3"><a href="#cb813-3"></a>    <span class="bn">title</span>(<span class="st">&quot;Comparison of Per Capita Income&quot;</span> <span class="co">///</span></span>
<span id="cb813-4"><a href="#cb813-4"></a>          <span class="st">&quot;and Violent Crime Rate at Tract level&quot;</span>) <span class="co">///</span></span>
<span id="cb813-5"><a href="#cb813-5"></a>    <span class="bn">xtitle</span>(<span class="st">&quot;Violent Crime Rate&quot;</span>) <span class="bn">ytitle</span>(<span class="st">&quot;Per Capita Income&quot;</span>) <span class="co">///</span></span>
<span id="cb813-6"><a href="#cb813-6"></a>    <span class="kw">note</span>(<span class="st">&quot;Source: National  Neighborhood Crime Study 2000&quot;</span>)</span></code></pre></div>
<p><strong>Overlaying points &amp; labels</strong></p>
<div class="sourceCode" id="cb814"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb814-1"><a href="#cb814-1"></a><span class="kw">twoway</span> (<span class="kw">scatter</span> T_PERCAP T_VIOLNT <span class="kw">if</span> T_VIOLNT==1976, <span class="co">///</span></span>
<span id="cb814-2"><a href="#cb814-2"></a>    <span class="bn">mlabel</span>(<span class="st">&quot;CITY&quot;</span>)) (<span class="kw">scatter</span> T_PERCAP T_VIOLNT), <span class="co">///</span></span>
<span id="cb814-3"><a href="#cb814-3"></a>    <span class="bn">title</span>(<span class="st">&quot;Comparison of Per Capita Income&quot;</span> <span class="co">///</span></span>
<span id="cb814-4"><a href="#cb814-4"></a>          <span class="st">&quot;and Violent Crime Rate at Tract level&quot;</span>) <span class="co">///</span></span>
<span id="cb814-5"><a href="#cb814-5"></a>    <span class="kw">xlabel</span>(0(200)2400) <span class="kw">note</span>(<span class="st">&quot;Source: National Neighborhood&quot;</span> <span class="co">///</span></span>
<span id="cb814-6"><a href="#cb814-6"></a>                            <span class="st">&quot;Crime Study 2000&quot;</span>) <span class="bn">legend</span>(<span class="kw">off</span>)</span></code></pre></div>
</div>
<div id="twoway-line-graphs" class="section level3">
<h3>Twoway line graphs</h3>
<ul>
<li>Line graphs helpful for a variety of data
<ul>
<li>Especially any type of time series data</li>
</ul></li>
<li>We will use data on US life expectancy from 1900-1999
<ul>
<li><code>webuse uslifeexp, clear</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb815"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb815-1"><a href="#cb815-1"></a><span class="kw">webuse</span> uslifeexp, <span class="kw">clear</span></span>
<span id="cb815-2"><a href="#cb815-2"></a><span class="kw">twoway</span> (<span class="kw">line</span> le_wm <span class="fu">year</span>, mcolor(<span class="st">&quot;red&quot;</span>)) <span class="co">///</span></span>
<span id="cb815-3"><a href="#cb815-3"></a>       (<span class="kw">line</span> le_bm <span class="fu">year</span>, mcolor(<span class="st">&quot;green&quot;</span>))</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/linegraph1.png" /></p>
<div class="sourceCode" id="cb816"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb816-1"><a href="#cb816-1"></a><span class="kw">twoway</span> (<span class="kw">line</span> (le_wfemale le_wmale le_bf le_bm) <span class="fu">year</span>, <span class="co">///</span></span>
<span id="cb816-2"><a href="#cb816-2"></a>       lpattern(<span class="bn">dot</span> solid <span class="bn">dot</span> solid))</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/linegraph2.png" /></p>
</div>
<div id="stata-graphing-lines" class="section level3">
<h3>Stata graphing lines</h3>
<div class="sourceCode" id="cb817"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb817-1"><a href="#cb817-1"></a><span class="kw">palette</span> linepalette</span></code></pre></div>
<p><img src="Stata/StataGraphics/images/linepalette.png" /></p>
</div>
<div id="exercise-1-9" class="section level3">
<h3>Exercise 1</h3>
<p><strong>The <code>twoway</code> family</strong></p>
<ol style="list-style-type: decimal">
<li>Open the datafile, <code>NatNeighCrimeStudy.dta</code>.</li>
</ol>
<div class="sourceCode" id="cb818"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb818-1"><a href="#cb818-1"></a>##</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Create a basic twoway scatterplot that compares the city unemployment rate (<code>C_UNEMP</code>) to the percent secondary sector low-wage jobs (<code>C_SSLOW</code>)</li>
</ol>
<div class="sourceCode" id="cb819"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb819-1"><a href="#cb819-1"></a>##</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generate the same scatterplot, but this time, divide the plot by the dummy variable indicating whether the city is located in the south or not (<code>C_SOUTH</code>)</li>
</ol>
<div class="sourceCode" id="cb820"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb820-1"><a href="#cb820-1"></a>##</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Change the color of the symbol that you use in this scatter plot</li>
</ol>
<div class="sourceCode" id="cb821"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb821-1"><a href="#cb821-1"></a>##</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Change the type of symbol you use to a marker of your choice</li>
</ol>
<div class="sourceCode" id="cb822"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb822-1"><a href="#cb822-1"></a>##</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Notice in your scatterplot that is broken down by <code>C_SOUTH</code> that there is an outlier in the upper right hand corner of the “Not South” graph. Add the city name label to this marker.</li>
</ol>
<div class="sourceCode" id="cb823"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb823-1"><a href="#cb823-1"></a>##</span></code></pre></div>
<details>
<summary><span style="color:red"><b>Click for Exercise 1 Solution</b></span></summary>
<div class="alert alert-danger">
<div class="sourceCode" id="cb824"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb824-1"><a href="#cb824-1"></a><span class="co">// 1. Open the datafile, `NatNeighCrimeStudy.dta`.</span></span>
<span id="cb824-2"><a href="#cb824-2"></a><span class="kw">use</span> NatNeighCrimeStudy.dta, <span class="kw">clear</span></span>
<span id="cb824-3"><a href="#cb824-3"></a></span>
<span id="cb824-4"><a href="#cb824-4"></a><span class="co">// 2.  Create a basic twoway scatterplot that compares the city unemployment rate (`C_UNEMP`) to the percent secondary sector low-wage jobs (`C_SSLOW`)</span></span>
<span id="cb824-5"><a href="#cb824-5"></a><span class="kw">twoway</span> <span class="kw">scatter</span> C_UNEMP C_SSLOW</span>
<span id="cb824-6"><a href="#cb824-6"></a></span>
<span id="cb824-7"><a href="#cb824-7"></a><span class="co">// 3. Generate the same scatterplot, but this time, divide the plot by the dummy variable indicating whether the city is located in the south or not (`C_SOUTH`)</span></span>
<span id="cb824-8"><a href="#cb824-8"></a><span class="kw">twoway</span> <span class="kw">scatter</span> C_UNEMP C_SSLOW, <span class="kw">by</span>(C_SOUTH)</span>
<span id="cb824-9"><a href="#cb824-9"></a></span>
<span id="cb824-10"><a href="#cb824-10"></a><span class="co">// 4.  Change the color of the symbol that you use in this scatter plot</span></span>
<span id="cb824-11"><a href="#cb824-11"></a><span class="kw">twoway</span> <span class="kw">scatter</span> C_UNEMP C_SSLOW, <span class="kw">by</span>(C_SOUTH) mcolor(<span class="st">&quot;orange&quot;</span>)</span>
<span id="cb824-12"><a href="#cb824-12"></a></span>
<span id="cb824-13"><a href="#cb824-13"></a><span class="co">// 5.  Change the type of symbol you use to a marker of your choice</span></span>
<span id="cb824-14"><a href="#cb824-14"></a><span class="kw">twoway</span> <span class="kw">scatter</span> C_UNEMP C_SSLOW, <span class="kw">by</span>(C_SOUTH) mcolor(<span class="st">&quot;orange&quot;</span>) <span class="bn">msymbol</span>(diamond)</span>
<span id="cb824-15"><a href="#cb824-15"></a></span>
<span id="cb824-16"><a href="#cb824-16"></a><span class="co">// 6.  Notice in your scatterplot that is broken down by `C_SOUTH` that there is an outlier in the upper right hand corner of the &quot;Not South&quot; graph. Add the city name label to this marker.</span></span>
<span id="cb824-17"><a href="#cb824-17"></a><span class="kw">twoway</span> <span class="kw">scatter</span> C_UNEMP C_SSLOW, <span class="kw">by</span>(C_SOUTH) <span class="kw">if</span> C_UNEMP&gt;25 mcolor(<span class="st">&quot;orange&quot;</span>) <span class="bn">msymbol</span>(diamond) <span class="bn">mlabel</span>(CITY)</span>
<span id="cb824-18"><a href="#cb824-18"></a><span class="kw">twoway</span> (<span class="kw">scatter</span> C_UNEMP C_SSLOW <span class="kw">if</span> T_UNEMP&gt;15 &amp; C_SSLOW&gt;25, <span class="bn">mlabel</span>(CITY) <span class="kw">by</span>(C_SOUTH)) (<span class="kw">scatter</span> C_UNEMP C_SSLOW, <span class="kw">by</span>(C_SOUTH))</span></code></pre></div>
</div>
</details>
</div>
</div>
<div id="exporting-graphs" class="section level2">
<h2>Exporting graphs</h2>
<div class="alert alert-info">
<p><strong>GOAL: To learn how to export graphs in Stata.</strong></p>
</div>
<ul>
<li>From Stata, right click on image and select “save as” or try syntax:
<ul>
<li><code>graph export myfig.esp, replace</code></li>
</ul></li>
<li>In Microsoft Word: insert -&gt; picture -&gt; from file
<ul>
<li>Or, right click on graph in Stata and copy and paste into MS Word</li>
</ul></li>
</ul>
</div>
<div id="wrap-up-10" class="section level2">
<h2>Wrap-up</h2>
<div id="feedback-10" class="section level3">
<h3>Feedback</h3>
<p>These workshops are a work in progress, please provide any feedback to: <a href="mailto:help@iq.harvard.edu" class="email">help@iq.harvard.edu</a></p>
</div>
<div id="resources-13" class="section level3">
<h3>Resources</h3>
<ul>
<li>IQSS
<ul>
<li>Workshops: <a href="https://www.iq.harvard.edu/data-science-services/workshop-materials" class="uri">https://www.iq.harvard.edu/data-science-services/workshop-materials</a></li>
<li>Data Science Services: <a href="https://www.iq.harvard.edu/data-science-services" class="uri">https://www.iq.harvard.edu/data-science-services</a></li>
<li>Research Computing Environment: <a href="https://iqss.github.io/dss-rce/" class="uri">https://iqss.github.io/dss-rce/</a></li>
</ul></li>
<li>HBS
<ul>
<li>Research Computing Services workshops: <a href="https://training.rcs.hbs.org/workshops" class="uri">https://training.rcs.hbs.org/workshops</a></li>
<li>Other HBS RCS resources: <a href="https://training.rcs.hbs.org/workshop-materials" class="uri">https://training.rcs.hbs.org/workshop-materials</a></li>
<li>RCS consulting email: <a href="mailto:research@hbs.edu" class="uri">mailto:research@hbs.edu</a></li>
</ul></li>
<li>Stata
<ul>
<li>UCLA website: <a href="http://www.ats.ucla.edu/stat/Stata/" class="uri">http://www.ats.ucla.edu/stat/Stata/</a></li>
<li>Stata website: <a href="http://www.stata.com/help.cgi?contents" class="uri">http://www.stata.com/help.cgi?contents</a></li>
<li>Email list: <a href="http://www.stata.com/statalist/" class="uri">http://www.stata.com/statalist/</a></li>
</ul></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/IQSS/dss-workshops/edit/master/%s",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Data_Science_Workshops.pdf", "Data_Science_Workshops.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
